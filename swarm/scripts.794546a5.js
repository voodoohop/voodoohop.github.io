!function(){function t(t){return t&&t.__esModule?t.default:t}function e(t,e){return Object.keys(e).forEach((function(n){"default"!==n&&"__esModule"!==n&&Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[n]}})})),t}var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},i={};var r=function(t){var e=i[t];if(null==e)throw new Error("Could not resolve bundle with id "+t);return e};(function(t){for(var e=Object.keys(t),n=0;n<e.length;n++)i[e[n]]=t[e[n]]})(JSON.parse('{"cf748235c65b12a9":"scripts.794546a5.js","6551fa59549d79a0":"crackles.9aa93d70.wav","eefa4bccd40528c6":"spirit-image-1.96493979.jpg","53fb7b8b814f70f6":"spirit-image-2.4b75b086.jpg","152fd9ae7b5515d2":"spirit-image-3.07e54349.jpg","ad078da2d31ffadf":"spirit-image-4.d60caf33.jpg","cad36e8360a93e75":"spirit-image-5.69c74f7f.jpg","be4d9588cc35efb6":"spirit-image-6.89ae0aa4.jpg"}'));var s,o=null;var a,c=function(){return o||(o=function(){try{throw new Error}catch(e){var t=(""+e.stack).match(/(https?|file|ftp):\/\/[^)\n]+/g);if(t)return(""+t[0]).replace(/^((?:https?|file|ftp):\/\/.+)\/[^/]+$/,"$1")+"/"}return"/"}()),o},u=r;function h(t){if(""===t)return".";var e="/"===t[t.length-1]?t.slice(0,t.length-1):t,n=e.lastIndexOf("/");return-1===n?".":e.slice(0,n)}function l(t,e){if(t===e)return"";var n=t.split("/");"."===n[0]&&n.shift();var i,r,s=e.split("/");for("."===s[0]&&s.shift(),i=0;(i<s.length||i<n.length)&&null==r;i++)n[i]!==s[i]&&(r=i);var o=[];for(i=0;i<n.length-r;i++)o.push("..");return s.length>r&&o.push.apply(o,s.slice(r)),o.join("/")}(a=function(t,e){return l(h(u(t)),u(e))})._dirname=h,a._relative=l,s=c()+a("cf748235c65b12a9","6551fa59549d79a0");var p={};var d={};Object.defineProperty(d,"__esModule",{value:!0});
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var f=function(t,e){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function _(t,e){function n(){this.constructor=t}f(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var v=function(){return(v=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function m(t,e,n,i){var r,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(s<3?r(o):s>3?r(e,n,o):r(e,n))||o);return s>3&&o&&Object.defineProperty(e,n,o),o}function g(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((i=i.apply(t,e||[])).next())}))}function y(t,e){var n,i,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}function b(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function w(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,r,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(i=s.next()).done;)o.push(i.value)}catch(t){r={error:t}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return o}function C(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(w(arguments[e]));return t}var x={};Object.defineProperty(x,"__esModule",{value:!0});
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var T={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},S=function(t,e){if(!t)throw E(e)},E=function(t){return new Error("Firebase Database ("+T.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},A=function(t){for(var e=[],n=0,i=0;i<t.length;i++){var r=t.charCodeAt(i);r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=63&r|128):55296==(64512&r)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(r=65536+((1023&r)<<10)+(1023&t.charCodeAt(++i)),e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=63&r|128):(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=63&r|128)}return e},k={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[],r=0;r<t.length;r+=3){var s=t[r],o=r+1<t.length,a=o?t[r+1]:0,c=r+2<t.length,u=c?t[r+2]:0,h=s>>2,l=(3&s)<<4|a>>4,p=(15&a)<<2|u>>6,d=63&u;c||(d=64,o||(p=64)),i.push(n[h],n[l],n[p],n[d])}return i.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(A(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,i=0;n<t.length;){var r=t[n++];if(r<128)e[i++]=String.fromCharCode(r);else if(r>191&&r<224){var s=t[n++];e[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){var o=((7&r)<<18|(63&(s=t[n++]))<<12|(63&(a=t[n++]))<<6|63&t[n++])-65536;e[i++]=String.fromCharCode(55296+(o>>10)),e[i++]=String.fromCharCode(56320+(1023&o))}else{s=t[n++];var a=t[n++];e[i++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&a)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[],r=0;r<t.length;){var s=n[t.charAt(r++)],o=r<t.length?n[t.charAt(r)]:0,a=++r<t.length?n[t.charAt(r)]:64,c=++r<t.length?n[t.charAt(r)]:64;if(++r,null==s||null==o||null==a||null==c)throw Error();var u=s<<2|o>>4;if(i.push(u),64!==a){var h=o<<4&240|a>>2;if(i.push(h),64!==c){var l=a<<6&192|c;i.push(l)}}}return i},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},O=function(t){try{return k.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=D(t[n],e[n]));return t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var N=function(){function t(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}return t.prototype.wrapCallback=function(t){var e=this;return function(n,i){n?e.reject(n):e.resolve(i),"function"==typeof t&&(e.promise.catch((function(){})),1===t.length?t(n):t(n,i))}},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function I(){try{return"[object process]"===Object.prototype.toString.call(n.process)}catch(t){return!1}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var M=function(t){function e(n,i){var r=t.call(this,i)||this;return r.code=n,r.name="FirebaseError",Object.setPrototypeOf(r,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(r,P.prototype.create),r}return _(e,t),e}(Error),P=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var i=e[0]||{},r=this.service+"/"+t,s=this.errors[t],o=s?F(s,i):"Error",a=this.serviceName+": "+o+" ("+r+").",c=new M(r,a),u=0,h=Object.keys(i);u<h.length;u++){var l=h[u];"_"!==l.slice(-1)&&(l in c&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),c[l]=i[l])}return c},t}();function F(t,e){return t.replace(q,(function(t,n){var i=e[n];return null!=i?String(i):"<"+n+"?>"}))}var q=/\{\$([^}]+)}/g;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L(t){return JSON.parse(t)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var V=function(t){var e={},n={},i={},r="";try{var s=t.split(".");e=L(O(s[0])||""),n=L(O(s[1])||""),r=s[2],i=n.d||{},delete n.d}catch(t){}return{header:e,claims:n,data:i,signature:r}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var j=function(){function t(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}return t.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},t.prototype.compress_=function(t,e){e||(e=0);var n=this.W_;if("string"==typeof t)for(var i=0;i<16;i++)n[i]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(i=0;i<16;i++)n[i]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(i=16;i<80;i++){var r=n[i-3]^n[i-8]^n[i-14]^n[i-16];n[i]=4294967295&(r<<1|r>>>31)}var s,o,a=this.chain_[0],c=this.chain_[1],u=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(i=0;i<80;i++){i<40?i<20?(s=h^c&(u^h),o=1518500249):(s=c^u^h,o=1859775393):i<60?(s=c&u|h&(c|u),o=2400959708):(s=c^u^h,o=3395469782);r=(a<<5|a>>>27)+s+l+o+n[i]&4294967295;l=h,h=u,u=4294967295&(c<<30|c>>>2),c=a,a=r}this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+c&4294967295,this.chain_[2]=this.chain_[2]+u&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},t.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,i=0,r=this.buf_,s=this.inbuf_;i<e;){if(0===s)for(;i<=n;)this.compress_(t,i),i+=this.blockSize;if("string"==typeof t){for(;i<e;)if(r[s]=t.charCodeAt(i),++i,++s===this.blockSize){this.compress_(r),s=0;break}}else for(;i<e;)if(r[s]=t[i],++i,++s===this.blockSize){this.compress_(r),s=0;break}}this.inbuf_=s,this.total_+=e}},t.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var i=0;for(n=0;n<5;n++)for(var r=24;r>=0;r-=8)t[i]=this.chain_[n]>>r&255,++i;return t},t}();var W=function(){function t(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((function(){t(n)})).catch((function(t){n.error(t)}))}return t.prototype.next=function(t){this.forEachObserver((function(e){e.next(t)}))},t.prototype.error=function(t){this.forEachObserver((function(e){e.error(t)})),this.close(t)},t.prototype.complete=function(){this.forEachObserver((function(t){t.complete()})),this.close()},t.prototype.subscribe=function(t,e,n){var i,r=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(i=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,i=e;n<i.length;n++){var r=i[n];if(r in t&&"function"==typeof t[r])return!0}return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:n}).next&&(i.next=B),void 0===i.error&&(i.error=B),void 0===i.complete&&(i.complete=B);var s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{r.finalError?i.error(r.finalError):i.complete()}catch(t){}})),this.observers.push(i),s},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}}))},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((function(){e.observers=void 0,e.onNoObservers=void 0})))},t}();function B(){}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U(t,e,n){var i="";switch(e){case 1:i=n?"first":"First";break;case 2:i=n?"second":"Second";break;case 3:i=n?"third":"Third";break;case 4:i=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var r=t+" failed: ";return r+=i+" argument "}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var z=T;x.CONSTANTS=z;var Q=N;x.Deferred=Q;var H=P;x.ErrorFactory=H;var G=M;x.FirebaseError=G;var Y=j;x.Sha1=Y;var X=function(){return!(!navigator||!navigator.cookieEnabled)};x.areCookiesEnabled=X;var K=S;x.assert=K;var Z=E;x.assertionError=Z;var $=function(t,e){return function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];Promise.resolve(!0).then((function(){t.apply(void 0,n)})).catch((function(t){e&&e(t)}))}};x.async=$;var J=k;x.base64=J;var tt=O;x.base64Decode=tt;var et=function(t){var e=A(t);return k.encodeByteArray(e,!0)};x.base64Encode=et;var nt=
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};x.contains=nt;var it=function(t,e){var n=new W(t,e);return n.subscribe.bind(n)};x.createSubscribe=it;var rt=V;x.decode=rt;var st=
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t){return D(void 0,t)};x.deepCopy=st;var ot=D;x.deepExtend=ot;var at=U;x.errorPrefix=at;var ct=R;x.getUA=ct;var ut=function(t){var e=V(t).claims;return"object"==typeof e&&!0===e.admin};x.isAdmin=ut;var ht=function(){return"object"==typeof self&&self.self===self};x.isBrowser=ht;var lt=function(){var t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id};x.isBrowserExtension=lt;var pt=function(){return R().indexOf("Electron/")>=0};x.isElectron=pt;var dt=function(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0};x.isEmpty=dt;var ft=function(){var t=R();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0};x.isIE=ft;var _t=function(){return"indexedDB"in window&&null!==indexedDB};x.isIndexedDBAvailable=_t;var vt=function(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(R())};x.isMobileCordova=vt;var mt=I;x.isNode=mt;var gt=function(){return!0===T.NODE_CLIENT||!0===T.NODE_ADMIN};x.isNodeSdk=gt;var yt=function(){return"object"==typeof navigator&&"ReactNative"===navigator.product};x.isReactNative=yt;var bt=function(){return!I()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")};x.isSafari=bt;var wt=function(){return R().indexOf("MSAppHost/")>=0};x.isUWP=wt;var Ct=function(t){var e=V(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")};x.isValidFormat=Ct;var xt=function(t){var e=V(t).claims,n=Math.floor((new Date).getTime()/1e3),i=0,r=0;return"object"==typeof e&&(e.hasOwnProperty("nbf")?i=e.nbf:e.hasOwnProperty("iat")&&(i=e.iat),r=e.hasOwnProperty("exp")?e.exp:i+86400),!!n&&!!i&&!!r&&n>=i&&n<=r};x.isValidTimestamp=xt;var Tt=function(t){var e=V(t).claims;return"object"==typeof e&&e.hasOwnProperty("iat")?e.iat:null};x.issuedAtTime=Tt;var St=L;x.jsonEval=St;var Et=function(t,e,n){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(i[r]=e.call(n,t[r],r,t));return i}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */;x.map=Et;var At=function(t){for(var e=[],n=function(t,n){Array.isArray(n)?n.forEach((function(n){e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))})):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))},i=0,r=Object.entries(t);i<r.length;i++){var s=r[i];n(s[0],s[1])}return e.length?"&"+e.join("&"):""};x.querystring=At;var kt=function(t){var e={};return t.replace(/^\?/,"").split("&").forEach((function(t){if(t){var n=t.split("=");e[n[0]]=n[1]}})),e};x.querystringDecode=kt;var Ot=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0};x.safeGet=Ot;var Dt=function(t){for(var e=0,n=0;n<t.length;n++){var i=t.charCodeAt(n);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,n++):e+=3}return e};x.stringLength=Dt;var Nt=function(t){for(var e=[],n=0,i=0;i<t.length;i++){var r=t.charCodeAt(i);if(r>=55296&&r<=56319){var s=r-55296;i++,S(i<t.length,"Surrogate pair missing trail surrogate."),r=65536+(s<<10)+(t.charCodeAt(i)-56320)}r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=63&r|128):r<65536?(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=63&r|128):(e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=63&r|128)}return e};x.stringToByteArray=Nt;var Rt=function(t){return JSON.stringify(t)};x.stringify=Rt;var It=function(t,e,n,i){var r;if(i<e?r="at least "+e:i>n&&(r=0===n?"none":"no more than "+n),r)throw new Error(t+" failed: Was called with "+i+(1===i?" argument.":" arguments.")+" Expects "+r+".")};x.validateArgCount=It;var Mt=function(t,e,n,i){if((!i||n)&&"function"!=typeof n)throw new Error(U(t,e,i)+"must be a valid function.")};x.validateCallback=Mt;var Pt=function(t,e,n,i){if((!i||n)&&("object"!=typeof n||null===n))throw new Error(U(t,e,i)+"must be a valid context object.")};x.validateContextObject=Pt;var Ft=function(){return new Promise((function(t,e){try{var n=!0,i="validate-browser-context-for-indexeddb-analytics-module",r=window.indexedDB.open(i);r.onsuccess=function(){r.result.close(),n||window.indexedDB.deleteDatabase(i),t(!0)},r.onupgradeneeded=function(){n=!1},r.onerror=function(){var t;e((null===(t=r.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}}))};x.validateIndexedDBOpenable=Ft;var qt=function(t,e,n,i){if((!i||n)&&"string"!=typeof n)throw new Error(U(t,e,i)+"must be a valid firebase namespace.")};x.validateNamespace=qt;var Lt={};Object.defineProperty(Lt,"__esModule",{value:!0});var Vt=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}(),jt=function(){function t(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map}return t.prototype.get=function(t){void 0===t&&(t="[DEFAULT]");var e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){var n=new x.Deferred;this.instancesDeferred.set(e,n);try{var i=this.getOrInitializeService(e);i&&n.resolve(i)}catch(t){}}return this.instancesDeferred.get(e).promise},t.prototype.getImmediate=function(t){var e=v({identifier:"[DEFAULT]",optional:!1},t),n=e.identifier,i=e.optional,r=this.normalizeInstanceIdentifier(n);try{var s=this.getOrInitializeService(r);if(!s){if(i)return null;throw Error("Service "+this.name+" is not available")}return s}catch(t){if(i)return null;throw t}},t.prototype.getComponent=function(){return this.component},t.prototype.setComponent=function(t){var e,n;if(t.name!==this.name)throw Error("Mismatching Component "+t.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=t,function(t){return"EAGER"===t.instantiationMode}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t))try{this.getOrInitializeService("[DEFAULT]")}catch(t){}try{for(var i=b(this.instancesDeferred.entries()),r=i.next();!r.done;r=i.next()){var s=w(r.value,2),o=s[0],a=s[1],c=this.normalizeInstanceIdentifier(o);try{var u=this.getOrInitializeService(c);a.resolve(u)}catch(t){}}}catch(t){e={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}},t.prototype.clearInstance=function(t){void 0===t&&(t="[DEFAULT]"),this.instancesDeferred.delete(t),this.instances.delete(t)},t.prototype.delete=function(){return g(this,void 0,void 0,(function(){var t;return y(this,(function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(t.filter((function(t){return"INTERNAL"in t})).map((function(t){return t.INTERNAL.delete()})))];case 1:return e.sent(),[2]}}))}))},t.prototype.isComponentSet=function(){return null!=this.component},t.prototype.getOrInitializeService=function(t){var e=this.instances.get(t);return!e&&this.component&&(e=this.component.instanceFactory(this.container,function(t){return"[DEFAULT]"===t?void 0:t}(t)),this.instances.set(t,e)),e||null},t.prototype.normalizeInstanceIdentifier=function(t){return this.component?this.component.multipleInstances?t:"[DEFAULT]":t},t}();
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Wt=function(){function t(t){this.name=t,this.providers=new Map}return t.prototype.addComponent=function(t){var e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);e.setComponent(t)},t.prototype.addOrOverwriteComponent=function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},t.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var e=new jt(t,this);return this.providers.set(t,e),e},t.prototype.getProviders=function(){return Array.from(this.providers.values())},t}(),Bt=Vt;Lt.Component=Bt;var Ut=Wt;Lt.ComponentContainer=Ut;var zt,Qt=jt;function Ht(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<n;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,r++)i[r]=s[o];return i}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Lt.Provider=Qt;var Gt,Yt,Xt=[];(Yt=Gt||(Gt={}))[Yt.DEBUG=0]="DEBUG",Yt[Yt.VERBOSE=1]="VERBOSE",Yt[Yt.INFO=2]="INFO",Yt[Yt.WARN=3]="WARN",Yt[Yt.ERROR=4]="ERROR",Yt[Yt.SILENT=5]="SILENT";var Kt,Zt={debug:Gt.DEBUG,verbose:Gt.VERBOSE,info:Gt.INFO,warn:Gt.WARN,error:Gt.ERROR,silent:Gt.SILENT},$t=Gt.INFO,Jt=((zt={})[Gt.DEBUG]="log",zt[Gt.VERBOSE]="log",zt[Gt.INFO]="info",zt[Gt.WARN]="warn",zt[Gt.ERROR]="error",zt),te=function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(!(e<t.logLevel)){var r=(new Date).toISOString(),s=Jt[e];if(!s)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[s].apply(console,Ht(["["+r+"]  "+t.name+":"],n))}},ee=function(){function t(t){this.name=t,this._logLevel=$t,this._logHandler=te,this._userLogHandler=null,Xt.push(this)}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in Gt))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),t.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?Zt[t]:t},Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,Ht([this,Gt.DEBUG],t)),this._logHandler.apply(this,Ht([this,Gt.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,Ht([this,Gt.VERBOSE],t)),this._logHandler.apply(this,Ht([this,Gt.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,Ht([this,Gt.INFO],t)),this._logHandler.apply(this,Ht([this,Gt.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,Ht([this,Gt.WARN],t)),this._logHandler.apply(this,Ht([this,Gt.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,Ht([this,Gt.ERROR],t)),this._logHandler.apply(this,Ht([this,Gt.ERROR],t))},t}();function ne(t){Xt.forEach((function(e){e.setLogLevel(t)}))}var ie,re=((Kt={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",Kt["bad-app-name"]="Illegal App name: '{$appName}",Kt["duplicate-app"]="Firebase App named '{$appName}' already exists",Kt["app-deleted"]="Firebase App named '{$appName}' already deleted",Kt["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",Kt["invalid-log-argument"]="First argument to `onLog` must be null or a function.",Kt),se=new x.ErrorFactory("app","Firebase",re),oe=((ie={})["@firebase/app"]="fire-core",ie["@firebase/analytics"]="fire-analytics",ie["@firebase/auth"]="fire-auth",ie["@firebase/database"]="fire-rtdb",ie["@firebase/functions"]="fire-fn",ie["@firebase/installations"]="fire-iid",ie["@firebase/messaging"]="fire-fcm",ie["@firebase/performance"]="fire-perf",ie["@firebase/remote-config"]="fire-rc",ie["@firebase/storage"]="fire-gcs",ie["@firebase/firestore"]="fire-fst",ie["fire-js"]="fire-js",ie["firebase-wrapper"]="fire-js-all",ie),ae=new ee("@firebase/app"),ce=function(){function t(t,e,n){var i,r,s=this;this.firebase_=n,this.isDeleted_=!1,this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=x.deepCopy(t),this.container=new Lt.ComponentContainer(e.name),this._addComponent(new Lt.Component("app",(function(){return s}),"PUBLIC"));try{for(var o=b(this.firebase_.INTERNAL.components.values()),a=o.next();!a.done;a=o.next()){var c=a.value;this._addComponent(c)}}catch(t){i={error:t}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),t.prototype.delete=function(){var t=this;return new Promise((function(e){t.checkDestroyed_(),e()})).then((function(){return t.firebase_.INTERNAL.removeApp(t.name_),Promise.all(t.container.getProviders().map((function(t){return t.delete()})))})).then((function(){t.isDeleted_=!0}))},t.prototype._getService=function(t,e){return void 0===e&&(e="[DEFAULT]"),this.checkDestroyed_(),this.container.getProvider(t).getImmediate({identifier:e})},t.prototype._removeServiceInstance=function(t,e){void 0===e&&(e="[DEFAULT]"),this.container.getProvider(t).clearInstance(e)},t.prototype._addComponent=function(t){try{this.container.addComponent(t)}catch(e){ae.debug("Component "+t.name+" failed to register with FirebaseApp "+this.name,e)}},t.prototype._addOrOverwriteComponent=function(t){this.container.addOrOverwriteComponent(t)},t.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw se.create("app-deleted",{appName:this.name_})},t}();ce.prototype.name&&ce.prototype.options||ce.prototype.delete||console.log("dc");
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function ue(t){var e={},n=new Map,i={__esModule:!0,initializeApp:function(n,r){void 0===r&&(r={});if("object"!=typeof r||null===r){r={name:r}}var s=r;void 0===s.name&&(s.name="[DEFAULT]");var o=s.name;if("string"!=typeof o||!o)throw se.create("bad-app-name",{appName:String(o)});if(x.contains(e,o))throw se.create("duplicate-app",{appName:o});var a=new t(n,s,i);return e[o]=a,a},app:r,registerVersion:function(t,e,n){var i,r=null!==(i=oe[t])&&void 0!==i?i:t;n&&(r+="-"+n);var o=r.match(/\s|\//),a=e.match(/\s|\//);if(o||a){var c=['Unable to register library "'+r+'" with version "'+e+'":'];return o&&c.push('library name "'+r+'" contains illegal characters (whitespace or "/")'),o&&a&&c.push("and"),a&&c.push('version name "'+e+'" contains illegal characters (whitespace or "/")'),void ae.warn(c.join(" "))}s(new Lt.Component(r+"-version",(function(){return{library:r,version:e}}),"VERSION"))},setLogLevel:ne,onLog:function(t,e){if(null!==t&&"function"!=typeof t)throw se.create("invalid-log-argument",{appName:name});!function(t,e){for(var n=function(n){var i=null;e&&e.level&&(i=Zt[e.level]),n.userLogHandler=null===t?null:function(e,n){for(var r=[],s=2;s<arguments.length;s++)r[s-2]=arguments[s];var o=r.map((function(t){if(null==t)return null;if("string"==typeof t)return t;if("number"==typeof t||"boolean"==typeof t)return t.toString();if(t instanceof Error)return t.message;try{return JSON.stringify(t)}catch(t){return null}})).filter((function(t){return t})).join(" ");n>=(null!=i?i:e.logLevel)&&t({level:Gt[n].toLowerCase(),message:o,args:r,type:e.name})}},i=0,r=Xt;i<r.length;i++){n(r[i])}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t,e)},apps:null,SDK_VERSION:"7.17.1",INTERNAL:{registerComponent:s,removeApp:function(t){delete e[t]},components:n,useAsService:function(t,e){if("serverAuth"===e)return null;return e}}};function r(t){if(t=t||"[DEFAULT]",!x.contains(e,t))throw se.create("no-app",{appName:t});return e[t]}function s(s){var o,a,c=s.name;if(n.has(c))return ae.debug("There were multiple attempts to register component "+c+"."),"PUBLIC"===s.type?i[c]:null;if(n.set(c,s),"PUBLIC"===s.type){var u=function(t){if(void 0===t&&(t=r()),"function"!=typeof t[c])throw se.create("invalid-app-argument",{appName:c});return t[c]()};void 0!==s.serviceProps&&x.deepExtend(u,s.serviceProps),i[c]=u,t.prototype[c]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._getService.bind(this,c);return n.apply(this,s.multipleInstances?t:[])}}try{for(var h=b(Object.keys(e)),l=h.next();!l.done;l=h.next()){var p=l.value;e[p]._addComponent(s)}}catch(t){o={error:t}}finally{try{l&&!l.done&&(a=h.return)&&a.call(h)}finally{if(o)throw o.error}}return"PUBLIC"===s.type?i[c]:null}return i.default=i,Object.defineProperty(i,"apps",{get:function(){return Object.keys(e).map((function(t){return e[t]}))}}),r.App=t,i}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var he=function t(){var e=ue(ce);return e.INTERNAL=v(v({},e.INTERNAL),{createFirebaseNamespace:t,extendNamespace:function(t){x.deepExtend(e,t)},createSubscribe:x.createSubscribe,ErrorFactory:x.ErrorFactory,deepExtend:x.deepExtend}),e}(),le=function(){function t(t){this.container=t}return t.prototype.getPlatformInfoString=function(){return this.container.getProviders().map((function(t){if(function(t){var e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t)){var e=t.getImmediate();return e.library+"/"+e.version}return null})).filter((function(t){return t})).join(" ")},t}();
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
if(x.isBrowser()&&void 0!==self.firebase){ae.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var pe=self.firebase.SDK_VERSION;pe&&pe.indexOf("LITE")>=0&&ae.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var de=he.initializeApp;he.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return x.isNode()&&ae.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),de.apply(void 0,t)};var fe,_e,ve=he;(fe=ve).INTERNAL.registerComponent(new Lt.Component("platform-logger",(function(t){return new le(t)}),"PRIVATE")),fe.registerVersion("@firebase/app","0.6.9",_e),fe.registerVersion("fire-js","");var me=ve;d.default=me;var ge=ve;d.firebase=ge;var ye,be=(ye=d)&&"object"==typeof ye&&"default"in ye?ye.default:ye;
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
be.registerVersion("firebase","7.17.1","app"),p=be;var we,Ce,xe,Te={},Se=we={};function Ee(){throw new Error("setTimeout has not been defined")}function Ae(){throw new Error("clearTimeout has not been defined")}function ke(t){if(Ce===setTimeout)return setTimeout(t,0);if((Ce===Ee||!Ce)&&setTimeout)return Ce=setTimeout,setTimeout(t,0);try{return Ce(t,0)}catch(e){try{return Ce.call(null,t,0)}catch(e){return Ce.call(this,t,0)}}}!function(){try{Ce="function"==typeof setTimeout?setTimeout:Ee}catch(t){Ce=Ee}try{xe="function"==typeof clearTimeout?clearTimeout:Ae}catch(t){xe=Ae}}();var Oe,De=[],Ne=!1,Re=-1;function Ie(){Ne&&Oe&&(Ne=!1,Oe.length?De=Oe.concat(De):Re=-1,De.length&&Me())}function Me(){if(!Ne){var t=ke(Ie);Ne=!0;for(var e=De.length;e;){for(Oe=De,De=[];++Re<e;)Oe&&Oe[Re].run();Re=-1,e=De.length}Oe=null,Ne=!1,function(t){if(xe===clearTimeout)return clearTimeout(t);if((xe===Ae||!xe)&&clearTimeout)return xe=clearTimeout,clearTimeout(t);try{xe(t)}catch(e){try{return xe.call(null,t)}catch(e){return xe.call(this,t)}}}(t)}}function Pe(t,e){this.fun=t,this.array=e}function Fe(){}Se.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];De.push(new Pe(t,e)),1!==De.length||Ne||ke(Me)},Pe.prototype.run=function(){this.fun.apply(null,this.array)},Se.title="browser",Se.browser=!0,Se.env={},Se.argv=[],Se.version="",Se.versions={},Se.on=Fe,Se.addListener=Fe,Se.once=Fe,Se.off=Fe,Se.removeListener=Fe,Se.removeAllListeners=Fe,Se.emit=Fe,Se.prependListener=Fe,Se.prependOnceListener=Fe,Se.listeners=function(t){return[]},Se.binding=function(t){throw new Error("process.binding is not supported")},Se.cwd=function(){return"/"},Se.chdir=function(t){throw new Error("process.chdir is not supported")},Se.umask=function(){return 0},Object.defineProperty(Te,"__esModule",{value:!0});var qe,Le=function(t){return t&&"object"==typeof t&&"default"in t?t.default:t}(d),Ve=function(){function t(t){this.domStorage_=t,this.prefix_="firebase:"}return t.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),x.stringify(e))},t.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:x.jsonEval(e)},t.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t))},t.prototype.prefixedName_=function(t){return this.prefix_+t},t.prototype.toString=function(){return this.domStorage_.toString()},t}(),je=function(){function t(){this.cache_={},this.isInMemoryStorage=!0}return t.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e},t.prototype.get=function(t){return x.contains(this.cache_,t)?this.cache_[t]:null},t.prototype.remove=function(t){delete this.cache_[t]},t}(),We=function(t){try{if("undefined"!=typeof window&&void 0!==window[t]){var e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Ve(e)}}catch(t){}return new je},Be=We("localStorage"),Ue=We("sessionStorage"),ze=new ee("@firebase/database"),Qe=(qe=1,function(){return qe++}),He=function(t){var e=x.stringToByteArray(t),n=new x.Sha1;n.update(e);var i=n.digest();return x.base64.encodeByteArray(i)},Ge=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n="",i=0;i<t.length;i++){var r=t[i];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?n+=Ge.apply(null,r):n+="object"==typeof r?x.stringify(r):r,n+=" "}return n},Ye=null,Xe=!0,Ke=function(t,e){x.assert(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(ze.logLevel=Gt.VERBOSE,Ye=ze.log.bind(ze),e&&Ue.set("logging_enabled",!0)):"function"==typeof t?Ye=t:(Ye=null,Ue.remove("logging_enabled"))},Ze=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!0===Xe&&(Xe=!1,null===Ye&&!0===Ue.get("logging_enabled")&&Ke(!0)),Ye){var n=Ge.apply(null,t);Ye(n)}},$e=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Ze.apply(void 0,C([t],e))}},Je=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE INTERNAL ERROR: "+Ge.apply(void 0,C(t));ze.error(n)},tn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE FATAL ERROR: "+Ge.apply(void 0,C(t));throw ze.error(n),new Error(n)},en=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE WARNING: "+Ge.apply(void 0,C(t));ze.warn(n)},nn=function(t){return"number"==typeof t&&(t!=t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},rn=function(t,e){if(t===e)return 0;if("[MIN_NAME]"===t||"[MAX_NAME]"===e)return-1;if("[MIN_NAME]"===e||"[MAX_NAME]"===t)return 1;var n=pn(t),i=pn(e);return null!==n?null!==i?n-i==0?t.length-e.length:n-i:-1:null!==i?1:t<e?-1:1},sn=function(t,e){return t===e?0:t<e?-1:1},on=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+x.stringify(e))},an=function(t){if("object"!=typeof t||null===t)return x.stringify(t);var e=[];for(var n in t)e.push(n);e.sort();for(var i="{",r=0;r<e.length;r++)0!==r&&(i+=","),i+=x.stringify(e[r]),i+=":",i+=an(t[e[r]]);return i+="}"},cn=function(t,e){var n=t.length;if(n<=e)return[t];for(var i=[],r=0;r<n;r+=e)r+e>n?i.push(t.substring(r,n)):i.push(t.substring(r,r+e));return i};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function un(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])}var hn=function(t){x.assert(!nn(t),"Invalid JSON number");var e,n,i,r,s;0===t?(n=0,i=0,e=1/t==-1/0?1:0):(e=t<0,(t=Math.abs(t))>=Math.pow(2,-1022)?(n=(r=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,i=Math.round(t*Math.pow(2,52-r)-Math.pow(2,52))):(n=0,i=Math.round(t/Math.pow(2,-1074))));var o=[];for(s=52;s;s-=1)o.push(i%2?1:0),i=Math.floor(i/2);for(s=11;s;s-=1)o.push(n%2?1:0),n=Math.floor(n/2);o.push(e?1:0),o.reverse();var a=o.join(""),c="";for(s=0;s<64;s+=8){var u=parseInt(a.substr(s,8),2).toString(16);1===u.length&&(u="0"+u),c+=u}return c.toLowerCase()},ln=new RegExp("^-?(0*)\\d{1,10}$"),pn=function(t){if(ln.test(t)){var e=Number(t);if(e>=-2147483648&&e<=2147483647)return e}return null},dn=function(t){try{t()}catch(t){setTimeout((function(){var e=t.stack||"";throw en("Exception was thrown by user callback.",e),t}),Math.floor(0))}},fn=function(t,e){var n=setTimeout(t,e);return"object"==typeof n&&n.unref&&n.unref(),n},_n=function(){function t(t,e){if(void 0===e){this.pieces_=t.split("/");for(var n=0,i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[n]=this.pieces_[i],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}return Object.defineProperty(t,"Empty",{get:function(){return new t("")},enumerable:!1,configurable:!0}),t.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},t.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},t.prototype.popFront=function(){var e=this.pieceNum_;return e<this.pieces_.length&&e++,new t(this.pieces_,e)},t.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},t.prototype.toString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"},t.prototype.toUrlEncodedString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+encodeURIComponent(String(this.pieces_[e])));return t||"/"},t.prototype.slice=function(t){return void 0===t&&(t=0),this.pieces_.slice(this.pieceNum_+t)},t.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var e=[],n=this.pieceNum_;n<this.pieces_.length-1;n++)e.push(this.pieces_[n]);return new t(e,0)},t.prototype.child=function(e){for(var n=[],i=this.pieceNum_;i<this.pieces_.length;i++)n.push(this.pieces_[i]);if(e instanceof t)for(i=e.pieceNum_;i<e.pieces_.length;i++)n.push(e.pieces_[i]);else{var r=e.split("/");for(i=0;i<r.length;i++)r[i].length>0&&n.push(r[i])}return new t(n,0)},t.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},t.relativePath=function(e,n){var i=e.getFront(),r=n.getFront();if(null===i)return n;if(i===r)return t.relativePath(e.popFront(),n.popFront());throw new Error("INTERNAL ERROR: innerPath ("+n+") is not within outerPath ("+e+")")},t.comparePaths=function(t,e){for(var n=t.slice(),i=e.slice(),r=0;r<n.length&&r<i.length;r++){var s=rn(n[r],i[r]);if(0!==s)return s}return n.length===i.length?0:n.length<i.length?-1:1},t.prototype.equals=function(t){if(this.getLength()!==t.getLength())return!1;for(var e=this.pieceNum_,n=t.pieceNum_;e<=this.pieces_.length;e++,n++)if(this.pieces_[e]!==t.pieces_[n])return!1;return!0},t.prototype.contains=function(t){var e=this.pieceNum_,n=t.pieceNum_;if(this.getLength()>t.getLength())return!1;for(;e<this.pieces_.length;){if(this.pieces_[e]!==t.pieces_[n])return!1;++e,++n}return!0},t}(),vn=function(){function t(t,e){this.errorPrefix_=e,this.parts_=t.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=x.stringLength(this.parts_[n]);this.checkValid_()}return Object.defineProperty(t,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!1,configurable:!0}),Object.defineProperty(t,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!1,configurable:!0}),t.prototype.push=function(t){this.parts_.length>0&&(this.byteLength_+=1),this.parts_.push(t),this.byteLength_+=x.stringLength(t),this.checkValid_()},t.prototype.pop=function(){var t=this.parts_.pop();this.byteLength_-=x.stringLength(t),this.parts_.length>0&&(this.byteLength_-=1)},t.prototype.checkValid_=function(){if(this.byteLength_>t.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+t.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>t.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+t.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},t.prototype.toErrorString=function(){return 0===this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},t}(),mn=function(){function t(t,e,n,i,r,s){void 0===r&&(r=""),void 0===s&&(s=!1),this.secure=e,this.namespace=n,this.webSocketOnly=i,this.persistenceKey=r,this.includeNamespaceInQueryParams=s,this.host=t.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=Be.get("host:"+t)||this.host}return t.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams},t.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},t.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},t.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},t.prototype.updateHost=function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&Be.set("host:"+this.host,this.internalHost))},t.prototype.connectionURL=function(t,e){var n;if(x.assert("string"==typeof t,"typeof type must == string"),x.assert("object"==typeof e,"typeof params must == object"),"websocket"===t)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if("long_polling"!==t)throw new Error("Unknown connection type: "+t);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(e.ns=this.namespace);var i=[];return un(e,(function(t,e){i.push(t+"="+e)})),n+i.join("&")},t.prototype.toString=function(){var t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t},t.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},t}();var gn,yn,bn,wn,Cn,xn=function(t){var e=Tn(t),n=e.namespace;"firebase.com"===e.domain&&tn(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!==n||"localhost"===e.domain||tn("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&en("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var i="ws"===e.scheme||"wss"===e.scheme;return{repoInfo:new mn(e.host,e.secure,n,i,"",n!==e.subdomain),path:new _n(e.pathString)}},Tn=function(t){var e="",n="",i="",r="",s="",o=!0,a="https",c=443;if("string"==typeof t){var u=t.indexOf("//");u>=0&&(a=t.substring(0,u-1),t=t.substring(u+2));var h=t.indexOf("/");-1===h&&(h=t.length);var l=t.indexOf("?");-1===l&&(l=t.length),e=t.substring(0,Math.min(h,l)),h<l&&(r=
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t){for(var e="",n=t.split("/"),i=0;i<n.length;i++)if(n[i].length>0){var r=n[i];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch(t){}e+="/"+r}return e}(t.substring(h,l)));var p=function(t){var e,n,i={};"?"===t.charAt(0)&&(t=t.substring(1));try{for(var r=b(t.split("&")),s=r.next();!s.done;s=r.next()){var o=s.value;if(0!==o.length){var a=o.split("=");2===a.length?i[decodeURIComponent(a[0])]=decodeURIComponent(a[1]):en("Invalid query segment '"+o+"' in query '"+t+"'")}}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return i}(t.substring(Math.min(t.length,l)));(u=e.indexOf(":"))>=0?(o="https"===a||"wss"===a,c=parseInt(e.substring(u+1),10)):u=e.length;var d=e.slice(0,u);if("localhost"===d.toLowerCase())n="localhost";else if(d.split(".").length<=2)n=d;else{var f=e.indexOf(".");i=e.substring(0,f).toLowerCase(),n=e.substring(f+1),s=i}"ns"in p&&(s=p.ns)}return{host:e,port:c,domain:n,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}},Sn=/[\[\].#$\/\u0000-\u001F\u007F]/,En=/[\[\].#$\u0000-\u001F\u007F]/,An=function(t){return"string"==typeof t&&0!==t.length&&!Sn.test(t)},kn=function(t){return"string"==typeof t&&0!==t.length&&!En.test(t)},On=function(t){return null===t||"string"==typeof t||"number"==typeof t&&!nn(t)||t&&"object"==typeof t&&x.contains(t,".sv")},Dn=function(t,e,n,i,r){r&&void 0===n||Nn(x.errorPrefix(t,e,r),n,i)},Nn=function(t,e,n){var i=n instanceof _n?new vn(n,t):n;if(void 0===e)throw new Error(t+"contains undefined "+i.toErrorString());if("function"==typeof e)throw new Error(t+"contains a function "+i.toErrorString()+" with contents = "+e.toString());if(nn(e))throw new Error(t+"contains "+e.toString()+" "+i.toErrorString());if("string"==typeof e&&e.length>10485760/3&&x.stringLength(e)>10485760)throw new Error(t+"contains a string greater than 10485760 utf8 bytes "+i.toErrorString()+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){var r=!1,s=!1;if(un(e,(function(e,n){if(".value"===e)r=!0;else if(".priority"!==e&&".sv"!==e&&(s=!0,!An(e)))throw new Error(t+" contains an invalid key ("+e+") "+i.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');i.push(e),Nn(t,n,i),i.pop()})),r&&s)throw new Error(t+' contains ".value" child '+i.toErrorString()+" in addition to actual children.")}},Rn=function(t,e,n,i,r){if(!r||void 0!==n){var s=x.errorPrefix(t,e,r);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(s+" must be an object containing the children to replace.");var o=[];un(n,(function(t,e){var n=new _n(t);if(Nn(s,e,i.child(n)),".priority"===n.getBack()&&!On(e))throw new Error(s+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");o.push(n)})),function(t,e){var n,i;for(n=0;n<e.length;n++)for(var r=(i=e[n]).slice(),s=0;s<r.length;s++)if(".priority"===r[s]&&s===r.length-1);else if(!An(r[s]))throw new Error(t+"contains an invalid key ("+r[s]+") in path "+i.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(_n.comparePaths);var o=null;for(n=0;n<e.length;n++){if(i=e[n],null!==o&&o.contains(i))throw new Error(t+"contains a path "+o.toString()+" that is ancestor of another path "+i.toString());o=i}}(s,o)}},In=function(t,e,n,i){if(!i||void 0!==n){if(nn(n))throw new Error(x.errorPrefix(t,e,i)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!On(n))throw new Error(x.errorPrefix(t,e,i)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Mn=function(t,e,n,i){if(!i||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(x.errorPrefix(t,e,i)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},Pn=function(t,e,n,i){if(!(i&&void 0===n||An(n)))throw new Error(x.errorPrefix(t,e,i)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},Fn=function(t,e,n,i){if(!(i&&void 0===n||kn(n)))throw new Error(x.errorPrefix(t,e,i)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},qn=function(t,e,n,i){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Fn(t,e,n,i)},Ln=function(t,e){if(".info"===e.getFront())throw new Error(t+" failed = Can't modify data under /.info/")},Vn=function(t,e,n){var i=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!An(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==i.length&&!function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),kn(t)}(i))throw new Error(x.errorPrefix(t,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},jn=function(t,e,n,i){if((!i||void 0!==n)&&"boolean"!=typeof n)throw new Error(x.errorPrefix(t,e,i)+"must be a boolean.")},Wn=function(){function t(t,e){this.repo_=t,this.path_=e}return t.prototype.cancel=function(t){x.validateArgCount("OnDisconnect.cancel",0,1,arguments.length),x.validateCallback("OnDisconnect.cancel",1,t,!0);var e=new x.Deferred;return this.repo_.onDisconnectCancel(this.path_,e.wrapCallback(t)),e.promise},t.prototype.remove=function(t){x.validateArgCount("OnDisconnect.remove",0,1,arguments.length),Ln("OnDisconnect.remove",this.path_),x.validateCallback("OnDisconnect.remove",1,t,!0);var e=new x.Deferred;return this.repo_.onDisconnectSet(this.path_,null,e.wrapCallback(t)),e.promise},t.prototype.set=function(t,e){x.validateArgCount("OnDisconnect.set",1,2,arguments.length),Ln("OnDisconnect.set",this.path_),Dn("OnDisconnect.set",1,t,this.path_,!1),x.validateCallback("OnDisconnect.set",2,e,!0);var n=new x.Deferred;return this.repo_.onDisconnectSet(this.path_,t,n.wrapCallback(e)),n.promise},t.prototype.setWithPriority=function(t,e,n){x.validateArgCount("OnDisconnect.setWithPriority",2,3,arguments.length),Ln("OnDisconnect.setWithPriority",this.path_),Dn("OnDisconnect.setWithPriority",1,t,this.path_,!1),In("OnDisconnect.setWithPriority",2,e,!1),x.validateCallback("OnDisconnect.setWithPriority",3,n,!0);var i=new x.Deferred;return this.repo_.onDisconnectSetWithPriority(this.path_,t,e,i.wrapCallback(n)),i.promise},t.prototype.update=function(t,e){if(x.validateArgCount("OnDisconnect.update",1,2,arguments.length),Ln("OnDisconnect.update",this.path_),Array.isArray(t)){for(var n={},i=0;i<t.length;++i)n[""+i]=t[i];t=n,en("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Rn("OnDisconnect.update",1,t,this.path_,!1),x.validateCallback("OnDisconnect.update",2,e,!0);var r=new x.Deferred;return this.repo_.onDisconnectUpdate(this.path_,t,r.wrapCallback(e)),r.promise},t}(),Bn=function(){function t(t,e){this.committed=t,this.snapshot=e}return t.prototype.toJSON=function(){return x.validateArgCount("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},t}(),Un=(gn="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",yn=0,bn=[],function(t){var e,n=t===yn;yn=t;var i=new Array(8);for(e=7;e>=0;e--)i[e]=gn.charAt(t%64),t=Math.floor(t/64);x.assert(0===t,"Cannot push at time == 0");var r=i.join("");if(n){for(e=11;e>=0&&63===bn[e];e--)bn[e]=0;bn[e]++}else for(e=0;e<12;e++)bn[e]=Math.floor(64*Math.random());for(e=0;e<12;e++)r+=gn.charAt(bn[e]);return x.assert(20===r.length,"nextPushId: Length should be 20."),r}),zn=function(){function t(t,e){this.name=t,this.node=e}return t.Wrap=function(e,n){return new t(e,n)},t}(),Qn=function(){function t(){}return t.prototype.getCompare=function(){return this.compare.bind(this)},t.prototype.indexedValueChanged=function(t,e){var n=new zn("[MIN_NAME]",t),i=new zn("[MIN_NAME]",e);return 0!==this.compare(n,i)},t.prototype.minPost=function(){return zn.MIN},t}(),Hn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return _(e,t),Object.defineProperty(e,"__EMPTY_NODE",{get:function(){return wn},set:function(t){wn=t},enumerable:!1,configurable:!0}),e.prototype.compare=function(t,e){return rn(t.name,e.name)},e.prototype.isDefinedOn=function(t){throw x.assertionError("KeyIndex.isDefinedOn not expected to be called.")},e.prototype.indexedValueChanged=function(t,e){return!1},e.prototype.minPost=function(){return zn.MIN},e.prototype.maxPost=function(){return new zn("[MAX_NAME]",wn)},e.prototype.makePost=function(t,e){return x.assert("string"==typeof t,"KeyIndex indexValue must always be a string."),new zn(t,wn)},e.prototype.toString=function(){return".key"},e}(Qn),Gn=new Hn;var Yn,Xn,Kn,Zn=function(t){return"number"==typeof t?"number:"+hn(t):"string:"+t},$n=function(t){if(t.isLeafNode()){var e=t.val();x.assert("string"==typeof e||"number"==typeof e||"object"==typeof e&&x.contains(e,".sv"),"Priority must be a string or number.")}else x.assert(t===Cn||t.isEmpty(),"priority of unexpected type.");x.assert(t===Cn||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},Jn=function(){function t(e,n){void 0===n&&(n=t.__childrenNodeConstructor.EMPTY_NODE),this.value_=e,this.priorityNode_=n,this.lazyHash_=null,x.assert(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),$n(this.priorityNode_)}return Object.defineProperty(t,"__childrenNodeConstructor",{get:function(){return Yn},set:function(t){Yn=t},enumerable:!1,configurable:!0}),t.prototype.isLeafNode=function(){return!0},t.prototype.getPriority=function(){return this.priorityNode_},t.prototype.updatePriority=function(e){return new t(this.value_,e)},t.prototype.getImmediateChild=function(e){return".priority"===e?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE},t.prototype.getChild=function(e){return e.isEmpty()?this:".priority"===e.getFront()?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE},t.prototype.hasChild=function(){return!1},t.prototype.getPredecessorChildName=function(t,e){return null},t.prototype.updateImmediateChild=function(e,n){return".priority"===e?this.updatePriority(n):n.isEmpty()&&".priority"!==e?this:t.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)},t.prototype.updateChild=function(e,n){var i=e.getFront();return null===i?n:n.isEmpty()&&".priority"!==i?this:(x.assert(".priority"!==i||1===e.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(i,t.__childrenNodeConstructor.EMPTY_NODE.updateChild(e.popFront(),n)))},t.prototype.isEmpty=function(){return!1},t.prototype.numChildren=function(){return 0},t.prototype.forEachChild=function(t,e){return!1},t.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},t.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.priorityNode_.isEmpty()||(t+="priority:"+Zn(this.priorityNode_.val())+":");var e=typeof this.value_;t+=e+":",t+="number"===e?hn(this.value_):this.value_,this.lazyHash_=He(t)}return this.lazyHash_},t.prototype.getValue=function(){return this.value_},t.prototype.compareTo=function(e){return e===t.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof t.__childrenNodeConstructor?-1:(x.assert(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))},t.prototype.compareToLeafNode_=function(e){var n=typeof e.value_,i=typeof this.value_,r=t.VALUE_TYPE_ORDER.indexOf(n),s=t.VALUE_TYPE_ORDER.indexOf(i);return x.assert(r>=0,"Unknown leaf type: "+n),x.assert(s>=0,"Unknown leaf type: "+i),r===s?"object"===i?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:s-r},t.prototype.withIndex=function(){return this},t.prototype.isIndexed=function(){return!0},t.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode()){var e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1},t.VALUE_TYPE_ORDER=["object","boolean","number","string"],t}();var ti,ei,ni=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return _(e,t),e.prototype.compare=function(t,e){var n=t.node.getPriority(),i=e.node.getPriority(),r=n.compareTo(i);return 0===r?rn(t.name,e.name):r},e.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},e.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority())},e.prototype.minPost=function(){return zn.MIN},e.prototype.maxPost=function(){return new zn("[MAX_NAME]",new Jn("[PRIORITY-POST]",Kn))},e.prototype.makePost=function(t,e){var n=Xn(t);return new zn(e,new Jn("[PRIORITY-POST]",n))},e.prototype.toString=function(){return".priority"},e}(Qn)),ii=function(){function t(t,e,n,i,r){void 0===r&&(r=null),this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];for(var s=1;!t.isEmpty();)if(t=t,s=e?n(t.key,e):1,i&&(s*=-1),s<0)t=this.isReverse_?t.left:t.right;else{if(0===s){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}return t.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},t.prototype.hasNext=function(){return this.nodeStack_.length>0},t.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}},t}(),ri=function(){function t(e,n,i,r,s){this.key=e,this.value=n,this.color=null!=i?i:t.RED,this.left=null!=r?r:oi.EMPTY_NODE,this.right=null!=s?s:oi.EMPTY_NODE}return t.prototype.copy=function(e,n,i,r,s){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=i?i:this.color,null!=r?r:this.left,null!=s?s:this.right)},t.prototype.count=function(){return this.left.count()+1+this.right.count()},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},t.prototype.minKey=function(){return this.min_().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var i=this,r=n(t,i.key);return(i=r<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===r?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n))).fixUp_()},t.prototype.removeMin_=function(){if(this.left.isEmpty())return oi.EMPTY_NODE;var t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_()},t.prototype.remove=function(t,e){var n,i;if(e(t,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return oi.EMPTY_NODE;i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()},t.prototype.isRed_=function(){return this.color},t.prototype.fixUp_=function(){var t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t},t.prototype.moveRedLeft_=function(){var t=this.colorFlip_();return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t},t.prototype.moveRedRight_=function(){var t=this.colorFlip_();return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t},t.prototype.rotateLeft_=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight_=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth_=function(){var t=this.check_();return Math.pow(2,t)<=this.count()+1},t.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)},t.RED=!0,t.BLACK=!1,t}(),si=function(){function t(){}return t.prototype.copy=function(t,e,n,i,r){return this},t.prototype.insert=function(t,e,n){return new ri(t,e,null)},t.prototype.remove=function(t,e){return this},t.prototype.count=function(){return 0},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.check_=function(){return 0},t.prototype.isRed_=function(){return!1},t}(),oi=function(){function t(e,n){void 0===n&&(n=t.EMPTY_NODE),this.comparator_=e,this.root_=n}return t.prototype.insert=function(e,n){return new t(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,ri.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,ri.BLACK,null,null))},t.prototype.get=function(t){for(var e,n=this.root_;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key)))return n.value;e<0?n=n.left:e>0&&(n=n.right)}return null},t.prototype.getPredecessorKey=function(t){for(var e,n=this.root_,i=null;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key))){if(n.left.isEmpty())return i?i.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:e>0&&(i=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},t.prototype.isEmpty=function(){return this.root_.isEmpty()},t.prototype.count=function(){return this.root_.count()},t.prototype.minKey=function(){return this.root_.minKey()},t.prototype.maxKey=function(){return this.root_.maxKey()},t.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t)},t.prototype.getIterator=function(t){return new ii(this.root_,null,this.comparator_,!1,t)},t.prototype.getIteratorFrom=function(t,e){return new ii(this.root_,t,this.comparator_,!1,e)},t.prototype.getReverseIteratorFrom=function(t,e){return new ii(this.root_,t,this.comparator_,!0,e)},t.prototype.getReverseIterator=function(t){return new ii(this.root_,null,this.comparator_,!0,t)},t.EMPTY_NODE=new si,t}(),ai=Math.log(2),ci=function(){function t(t){var e;this.count=(e=t+1,parseInt(Math.log(e)/ai,10)),this.current_=this.count-1;var n,i=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=t+1&i}return t.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_);return this.current_--,t},t}(),ui=function(t,e,n,i){t.sort(e);var r=function(e,i){var s,o,a=i-e;if(0===a)return null;if(1===a)return s=t[e],o=n?n(s):s,new ri(o,s.node,ri.BLACK,null,null);var c=parseInt(a/2,10)+e,u=r(e,c),h=r(c+1,i);return s=t[c],o=n?n(s):s,new ri(o,s.node,ri.BLACK,u,h)},s=function(e){for(var i=null,s=null,o=t.length,a=function(e,i){var s=o-e,a=o;o-=e;var u=r(s+1,a),h=t[s],l=n?n(h):h;c(new ri(l,h.node,i,null,u))},c=function(t){i?(i.left=t,i=t):(s=t,i=t)},u=0;u<e.count;++u){var h=e.nextBitIsOne(),l=Math.pow(2,e.count-(u+1));h?a(l,ri.BLACK):(a(l,ri.BLACK),a(l,ri.RED))}return s}(new ci(t.length));return new oi(i||e,s)},hi={},li=function(){function t(t,e){this.indexes_=t,this.indexSet_=e}return Object.defineProperty(t,"Default",{get:function(){return x.assert(hi&&ni,"ChildrenNode.ts has not been loaded"),ti=ti||new t({".priority":hi},{".priority":ni})},enumerable:!1,configurable:!0}),t.prototype.get=function(t){var e=x.safeGet(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof oi?e:null},t.prototype.hasIndex=function(t){return x.contains(this.indexSet_,t.toString())},t.prototype.addIndex=function(e,n){x.assert(e!==Gn,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var i,r=[],s=!1,o=n.getIterator(zn.Wrap),a=o.getNext();a;)s=s||e.isDefinedOn(a.node),r.push(a),a=o.getNext();i=s?ui(r,e.getCompare()):hi;var c=e.toString(),u=v({},this.indexSet_);u[c]=e;var h=v({},this.indexes_);return h[c]=i,new t(h,u)},t.prototype.addToIndexes=function(e,n){var i=this;return new t(x.map(this.indexes_,(function(t,r){var s=x.safeGet(i.indexSet_,r);if(x.assert(s,"Missing index implementation for "+r),t===hi){if(s.isDefinedOn(e.node)){for(var o=[],a=n.getIterator(zn.Wrap),c=a.getNext();c;)c.name!==e.name&&o.push(c),c=a.getNext();return o.push(e),ui(o,s.getCompare())}return hi}var u=n.get(e.name),h=t;return u&&(h=h.remove(new zn(e.name,u))),h.insert(e,e.node)})),this.indexSet_)},t.prototype.removeFromIndexes=function(e,n){return new t(x.map(this.indexes_,(function(t){if(t===hi)return t;var i=n.get(e.name);return i?t.remove(new zn(e.name,i)):t})),this.indexSet_)},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function pi(t,e){return rn(t.name,e.name)}function di(t,e){return rn(t,e)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var fi=function(){function t(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&$n(this.priorityNode_),this.children_.isEmpty()&&x.assert(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(t,"EMPTY_NODE",{get:function(){return ei||(ei=new t(new oi(di),null,li.Default))},enumerable:!1,configurable:!0}),t.prototype.isLeafNode=function(){return!1},t.prototype.getPriority=function(){return this.priorityNode_||ei},t.prototype.updatePriority=function(e){return this.children_.isEmpty()?this:new t(this.children_,e,this.indexMap_)},t.prototype.getImmediateChild=function(t){if(".priority"===t)return this.getPriority();var e=this.children_.get(t);return null===e?ei:e},t.prototype.getChild=function(t){var e=t.getFront();return null===e?this:this.getImmediateChild(e).getChild(t.popFront())},t.prototype.hasChild=function(t){return null!==this.children_.get(t)},t.prototype.updateImmediateChild=function(e,n){if(x.assert(n,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(n);var i=new zn(e,n),r=void 0,s=void 0;n.isEmpty()?(r=this.children_.remove(e),s=this.indexMap_.removeFromIndexes(i,this.children_)):(r=this.children_.insert(e,n),s=this.indexMap_.addToIndexes(i,this.children_));var o=r.isEmpty()?ei:this.priorityNode_;return new t(r,o,s)},t.prototype.updateChild=function(t,e){var n=t.getFront();if(null===n)return e;x.assert(".priority"!==t.getFront()||1===t.getLength(),".priority must be the last token in a path");var i=this.getImmediateChild(n).updateChild(t.popFront(),e);return this.updateImmediateChild(n,i)},t.prototype.isEmpty=function(){return this.children_.isEmpty()},t.prototype.numChildren=function(){return this.children_.count()},t.prototype.val=function(e){if(this.isEmpty())return null;var n={},i=0,r=0,s=!0;if(this.forEachChild(ni,(function(o,a){n[o]=a.val(e),i++,s&&t.INTEGER_REGEXP_.test(o)?r=Math.max(r,Number(o)):s=!1})),!e&&s&&r<2*i){var o=[];for(var a in n)o[a]=n[a];return o}return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n},t.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.getPriority().isEmpty()||(t+="priority:"+Zn(this.getPriority().val())+":"),this.forEachChild(ni,(function(e,n){var i=n.hash();""!==i&&(t+=":"+e+":"+i)})),this.lazyHash_=""===t?"":He(t)}return this.lazyHash_},t.prototype.getPredecessorChildName=function(t,e,n){var i=this.resolveIndex_(n);if(i){var r=i.getPredecessorKey(new zn(t,e));return r?r.name:null}return this.children_.getPredecessorKey(t)},t.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.minKey();return n&&n.name}return this.children_.minKey()},t.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t);return e?new zn(e,this.children_.get(e)):null},t.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.maxKey();return n&&n.name}return this.children_.maxKey()},t.prototype.getLastChild=function(t){var e=this.getLastChildName(t);return e?new zn(e,this.children_.get(e)):null},t.prototype.forEachChild=function(t,e){var n=this.resolveIndex_(t);return n?n.inorderTraversal((function(t){return e(t.name,t.node)})):this.children_.inorderTraversal(e)},t.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t)},t.prototype.getIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,(function(t){return t}));for(var i=this.children_.getIteratorFrom(t.name,zn.Wrap),r=i.peek();null!=r&&e.compare(r,t)<0;)i.getNext(),r=i.peek();return i},t.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t)},t.prototype.getReverseIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,(function(t){return t}));for(var i=this.children_.getReverseIteratorFrom(t.name,zn.Wrap),r=i.peek();null!=r&&e.compare(r,t)>0;)i.getNext(),r=i.peek();return i},t.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===_i?-1:0},t.prototype.withIndex=function(e){if(e===Gn||this.indexMap_.hasIndex(e))return this;var n=this.indexMap_.addIndex(e,this.children_);return new t(this.children_,this.priorityNode_,n)},t.prototype.isIndexed=function(t){return t===Gn||this.indexMap_.hasIndex(t)},t.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode())return!1;var e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()===e.children_.count()){for(var n=this.getIterator(ni),i=e.getIterator(ni),r=n.getNext(),s=i.getNext();r&&s;){if(r.name!==s.name||!r.node.equals(s.node))return!1;r=n.getNext(),s=i.getNext()}return null===r&&null===s}return!1}return!1},t.prototype.resolveIndex_=function(t){return t===Gn?null:this.indexMap_.get(t.toString())},t.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,t}(),_i=new(function(t){function e(){return t.call(this,new oi(di),fi.EMPTY_NODE,li.Default)||this}return _(e,t),e.prototype.compareTo=function(t){return t===this?0:1},e.prototype.equals=function(t){return t===this},e.prototype.getPriority=function(){return this},e.prototype.getImmediateChild=function(t){return fi.EMPTY_NODE},e.prototype.isEmpty=function(){return!1},e}(fi));Object.defineProperties(zn,{MIN:{value:new zn("[MIN_NAME]",fi.EMPTY_NODE)},MAX:{value:new zn("[MAX_NAME]",_i)}}),Hn.__EMPTY_NODE=fi.EMPTY_NODE,Jn.__childrenNodeConstructor=fi,Cn=_i,function(t){Kn=t}(_i);function vi(t,e){if(void 0===e&&(e=null),null===t)return fi.EMPTY_NODE;if("object"==typeof t&&".priority"in t&&(e=t[".priority"]),x.assert(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!=typeof t||".sv"in t)return new Jn(t,vi(e));if(t instanceof Array){var n=fi.EMPTY_NODE;return un(t,(function(e,i){if(x.contains(t,e)&&"."!==e.substring(0,1)){var r=vi(i);!r.isLeafNode()&&r.isEmpty()||(n=n.updateImmediateChild(e,r))}})),n.updatePriority(vi(e))}var i=[],r=!1;if(un(t,(function(t,e){if("."!==t.substring(0,1)){var n=vi(e);n.isEmpty()||(r=r||!n.getPriority().isEmpty(),i.push(new zn(t,n)))}})),0===i.length)return fi.EMPTY_NODE;var s=ui(i,pi,(function(t){return t.name}),di);if(r){var o=ui(i,ni.getCompare());return new fi(s,vi(e),new li({".priority":o},{".priority":ni}))}return new fi(s,vi(e),li.Default)}!function(t){Xn=t}(vi);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var mi,gi=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return _(e,t),e.prototype.compare=function(t,e){var n=t.node.compareTo(e.node);return 0===n?rn(t.name,e.name):n},e.prototype.isDefinedOn=function(t){return!0},e.prototype.indexedValueChanged=function(t,e){return!t.equals(e)},e.prototype.minPost=function(){return zn.MIN},e.prototype.maxPost=function(){return zn.MAX},e.prototype.makePost=function(t,e){var n=vi(t);return new zn(e,n)},e.prototype.toString=function(){return".value"},e}(Qn)),yi=function(t){function e(e){var n=t.call(this)||this;return n.indexPath_=e,x.assert(!e.isEmpty()&&".priority"!==e.getFront(),"Can't create PathIndex with empty path or .priority key"),n}return _(e,t),e.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},e.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},e.prototype.compare=function(t,e){var n=this.extractChild(t.node),i=this.extractChild(e.node),r=n.compareTo(i);return 0===r?rn(t.name,e.name):r},e.prototype.makePost=function(t,e){var n=vi(t),i=fi.EMPTY_NODE.updateChild(this.indexPath_,n);return new zn(e,i)},e.prototype.maxPost=function(){var t=fi.EMPTY_NODE.updateChild(this.indexPath_,_i);return new zn("[MAX_NAME]",t)},e.prototype.toString=function(){return this.indexPath_.slice().join("/")},e}(Qn),bi=function(){function t(t,e,n){this.node_=t,this.ref_=e,this.index_=n}return t.prototype.val=function(){return x.validateArgCount("DataSnapshot.val",0,0,arguments.length),this.node_.val()},t.prototype.exportVal=function(){return x.validateArgCount("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},t.prototype.toJSON=function(){return x.validateArgCount("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},t.prototype.exists=function(){return x.validateArgCount("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},t.prototype.child=function(e){x.validateArgCount("DataSnapshot.child",0,1,arguments.length),e=String(e),Fn("DataSnapshot.child",1,e,!1);var n=new _n(e),i=this.ref_.child(n);return new t(this.node_.getChild(n),i,ni)},t.prototype.hasChild=function(t){x.validateArgCount("DataSnapshot.hasChild",1,1,arguments.length),Fn("DataSnapshot.hasChild",1,t,!1);var e=new _n(t);return!this.node_.getChild(e).isEmpty()},t.prototype.getPriority=function(){return x.validateArgCount("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},t.prototype.forEach=function(e){var n=this;if(x.validateArgCount("DataSnapshot.forEach",1,1,arguments.length),x.validateCallback("DataSnapshot.forEach",1,e,!1),this.node_.isLeafNode())return!1;var i=this.node_;return!!i.forEachChild(this.index_,(function(i,r){return e(new t(r,n.ref_.child(i),ni))}))},t.prototype.hasChildren=function(){return x.validateArgCount("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(t.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!1,configurable:!0}),t.prototype.numChildren=function(){return x.validateArgCount("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},t.prototype.getRef=function(){return x.validateArgCount("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(t.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),t}(),wi=function(){function t(t,e,n,i){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=i}return t.prototype.getPath=function(){var t=this.snapshot.getRef();return"value"===this.eventType?t.path:t.getParent().path},t.prototype.getEventType=function(){return this.eventType},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+x.stringify(this.snapshot.exportVal())},t}(),Ci=function(){function t(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}return t.prototype.getPath=function(){return this.path},t.prototype.getEventType=function(){return"cancel"},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.path.toString()+":cancel"},t}(),xi=function(){function t(t,e,n){this.callback_=t,this.cancelCallback_=e,this.context_=n}return t.prototype.respondsTo=function(t){return"value"===t},t.prototype.createEvent=function(t,e){var n=e.getQueryParams().getIndex();return new wi("value",this,new bi(t.snapshotNode,e.getRef(),n))},t.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){x.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var i=this.callback_;return function(){i.call(e,t.snapshot)}},t.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Ci(this,t,e):null},t.prototype.matches=function(e){return e instanceof t&&(!e.callback_||!this.callback_||e.callback_===this.callback_&&e.context_===this.context_)},t.prototype.hasAnyCallback=function(){return null!==this.callback_},t}(),Ti=function(){function t(t,e,n){this.callbacks_=t,this.cancelCallback_=e,this.context_=n}return t.prototype.respondsTo=function(t){var e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,x.contains(this.callbacks_,e)},t.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new Ci(this,t,e):null},t.prototype.createEvent=function(t,e){x.assert(null!=t.childName,"Child events should have a childName.");var n=e.getRef().child(t.childName),i=e.getQueryParams().getIndex();return new wi(t.type,this,new bi(t.snapshotNode,n,i),t.prevName)},t.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){x.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var i=this.callbacks_[t.eventType];return function(){i.call(e,t.snapshot,t.prevName)}},t.prototype.matches=function(e){var n=this;if(e instanceof t){if(!this.callbacks_||!e.callbacks_)return!0;if(this.context_===e.context_){var i=Object.keys(e.callbacks_),r=Object.keys(this.callbacks_),s=i.length;if(s===r.length){if(1===s){var o=i[0],a=r[0];return!(a!==o||e.callbacks_[o]&&this.callbacks_[a]&&e.callbacks_[o]!==this.callbacks_[a])}return r.every((function(t){return e.callbacks_[t]===n.callbacks_[t]}))}}}return!1},t.prototype.hasAnyCallback=function(){return null!==this.callbacks_},t}(),Si=function(){function t(t,e,n,i){this.repo=t,this.path=e,this.queryParams_=n,this.orderByCalled_=i}return Object.defineProperty(t,"__referenceConstructor",{get:function(){return x.assert(mi,"Reference.ts has not been loaded"),mi},set:function(t){mi=t},enumerable:!1,configurable:!0}),t.validateQueryEndpoints_=function(t){var e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===Gn){var i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",r="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(t.hasStart()){if("[MIN_NAME]"!==t.getIndexStartName())throw new Error(i);if("string"!=typeof e)throw new Error(r)}if(t.hasEnd()){if("[MAX_NAME]"!==t.getIndexEndName())throw new Error(i);if("string"!=typeof n)throw new Error(r)}}else if(t.getIndex()===ni){if(null!=e&&!On(e)||null!=n&&!On(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(x.assert(t.getIndex()instanceof yi||t.getIndex()===gi,"unknown index type."),null!=e&&"object"==typeof e||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},t.validateLimit_=function(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},t.prototype.validateNoPreviousOrderByCall_=function(t){if(!0===this.orderByCalled_)throw new Error(t+": You can't combine multiple orderBy calls.")},t.prototype.getQueryParams=function(){return this.queryParams_},t.prototype.getRef=function(){return x.validateArgCount("Query.ref",0,0,arguments.length),new t.__referenceConstructor(this.repo,this.path)},t.prototype.on=function(e,n,i,r){x.validateArgCount("Query.on",2,4,arguments.length),Mn("Query.on",1,e,!1),x.validateCallback("Query.on",2,n,!1);var s=t.getCancelAndContextArgs_("Query.on",i,r);if("value"===e)this.onValueEvent(n,s.cancel,s.context);else{var o={};o[e]=n,this.onChildEvent(o,s.cancel,s.context)}return n},t.prototype.onValueEvent=function(t,e,n){var i=new xi(t,e||null,n||null);this.repo.addEventCallbackForQuery(this,i)},t.prototype.onChildEvent=function(t,e,n){var i=new Ti(t,e,n);this.repo.addEventCallbackForQuery(this,i)},t.prototype.off=function(t,e,n){x.validateArgCount("Query.off",0,3,arguments.length),Mn("Query.off",1,t,!0),x.validateCallback("Query.off",2,e,!0),x.validateContextObject("Query.off",3,n,!0);var i=null,r=null;if("value"===t){var s=e||null;i=new xi(s,null,n||null)}else t&&(e&&((r={})[t]=e),i=new Ti(r,null,n||null));this.repo.removeEventCallbackForQuery(this,i)},t.prototype.once=function(e,n,i,r){var s=this;x.validateArgCount("Query.once",1,4,arguments.length),Mn("Query.once",1,e,!1),x.validateCallback("Query.once",2,n,!0);var o=t.getCancelAndContextArgs_("Query.once",i,r),a=!0,c=new x.Deferred;c.promise.catch((function(){}));var u=function(t){a&&(a=!1,s.off(e,u),n&&n.bind(o.context)(t),c.resolve(t))};return this.on(e,u,(function(t){s.off(e,u),o.cancel&&o.cancel.bind(o.context)(t),c.reject(t)})),c.promise},t.prototype.limitToFirst=function(e){if(x.validateArgCount("Query.limitToFirst",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new t(this.repo,this.path,this.queryParams_.limitToFirst(e),this.orderByCalled_)},t.prototype.limitToLast=function(e){if(x.validateArgCount("Query.limitToLast",1,1,arguments.length),"number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new t(this.repo,this.path,this.queryParams_.limitToLast(e),this.orderByCalled_)},t.prototype.orderByChild=function(e){if(x.validateArgCount("Query.orderByChild",1,1,arguments.length),"$key"===e)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===e)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===e)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');Fn("Query.orderByChild",1,e,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var n=new _n(e);if(n.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var i=new yi(n),r=this.queryParams_.orderBy(i);return t.validateQueryEndpoints_(r),new t(this.repo,this.path,r,!0)},t.prototype.orderByKey=function(){x.validateArgCount("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var e=this.queryParams_.orderBy(Gn);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.orderByPriority=function(){x.validateArgCount("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var e=this.queryParams_.orderBy(ni);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.orderByValue=function(){x.validateArgCount("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var e=this.queryParams_.orderBy(gi);return t.validateQueryEndpoints_(e),new t(this.repo,this.path,e,!0)},t.prototype.startAt=function(e,n){void 0===e&&(e=null),x.validateArgCount("Query.startAt",0,2,arguments.length),Dn("Query.startAt",1,e,this.path,!0),Pn("Query.startAt",2,n,!0);var i=this.queryParams_.startAt(e,n);if(t.validateLimit_(i),t.validateQueryEndpoints_(i),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===e&&(e=null,n=null),new t(this.repo,this.path,i,this.orderByCalled_)},t.prototype.endAt=function(e,n){void 0===e&&(e=null),x.validateArgCount("Query.endAt",0,2,arguments.length),Dn("Query.endAt",1,e,this.path,!0),Pn("Query.endAt",2,n,!0);var i=this.queryParams_.endAt(e,n);if(t.validateLimit_(i),t.validateQueryEndpoints_(i),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new t(this.repo,this.path,i,this.orderByCalled_)},t.prototype.equalTo=function(t,e){if(x.validateArgCount("Query.equalTo",1,2,arguments.length),Dn("Query.equalTo",1,t,this.path,!1),Pn("Query.equalTo",2,e,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(t,e).endAt(t,e)},t.prototype.toString=function(){return x.validateArgCount("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},t.prototype.toJSON=function(){return x.validateArgCount("Query.toJSON",0,1,arguments.length),this.toString()},t.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},t.prototype.queryIdentifier=function(){var t=this.queryObject(),e=an(t);return"{}"===e?"default":e},t.prototype.isEqual=function(e){if(x.validateArgCount("Query.isEqual",1,1,arguments.length),!(e instanceof t)){var n="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(n)}var i=this.repo===e.repo,r=this.path.equals(e.path),s=this.queryIdentifier()===e.queryIdentifier();return i&&r&&s},t.getCancelAndContextArgs_=function(t,e,n){var i={cancel:null,context:null};if(e&&n)i.cancel=e,x.validateCallback(t,3,i.cancel,!0),i.context=n,x.validateContextObject(t,4,i.context,!0);else if(e)if("object"==typeof e&&null!==e)i.context=e;else{if("function"!=typeof e)throw new Error(x.errorPrefix(t,3,!0)+" must either be a cancel callback or a context object.");i.cancel=e}return i},Object.defineProperty(t.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),t}(),Ei=function(){function t(t){this.node_=t}return t.prototype.getImmediateChild=function(e){return new t(this.node_.getImmediateChild(e))},t.prototype.node=function(){return this.node_},t}(),Ai=function(){function t(t,e){this.syncTree_=t,this.path_=e}return t.prototype.getImmediateChild=function(e){var n=this.path_.child(e);return new t(this.syncTree_,n)},t.prototype.node=function(){return this.syncTree_.calcCompleteEventCache(this.path_)},t}(),ki=function(t,e,n){return t&&"object"==typeof t?(x.assert(".sv"in t,"Unexpected leaf node or priority contents"),"string"==typeof t[".sv"]?Oi(t[".sv"],e,n):"object"==typeof t[".sv"]?Di(t[".sv"],e):void x.assert(!1,"Unexpected server value: "+JSON.stringify(t,null,2))):t},Oi=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:x.assert(!1,"Unexpected server value: "+t)}},Di=function(t,e,n){t.hasOwnProperty("increment")||x.assert(!1,"Unexpected server value: "+JSON.stringify(t,null,2));var i=t.increment;"number"!=typeof i&&x.assert(!1,"Unexpected increment value: "+i);var r=e.node();if(x.assert(null!=r,"Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;var s=r.getValue();return"number"!=typeof s?i:s+i},Ni=function(t,e,n,i){return Ii(e,new Ai(n,t),i)},Ri=function(t,e,n){return Ii(t,new Ei(e),n)};function Ii(t,e,n){var i,r=t.getPriority().val(),s=ki(r,e.getImmediateChild(".priority"),n);if(t.isLeafNode()){var o=t,a=ki(o.getValue(),e,n);return a!==o.getValue()||s!==o.getPriority().val()?new Jn(a,vi(s)):t}var c=t;return i=c,s!==c.getPriority().val()&&(i=i.updatePriority(new Jn(s))),c.forEachChild(ni,(function(t,r){var s=Ii(r,e.getImmediateChild(t),n);s!==r&&(i=i.updateImmediateChild(t,s))})),i}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Mi,Pi,Fi=function(){function t(){this.value=null,this.children=new Map}return t.prototype.find=function(t){if(null!=this.value)return this.value.getChild(t);if(!t.isEmpty()&&this.children.size>0){var e=t.getFront();return t=t.popFront(),this.children.has(e)?this.children.get(e).find(t):null}return null},t.prototype.remember=function(e,n){if(e.isEmpty())this.value=n,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(e,n);else{var i=e.getFront();this.children.has(i)||this.children.set(i,new t);var r=this.children.get(i);e=e.popFront(),r.remember(e,n)}},t.prototype.forget=function(t){if(t.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var e=this.value;this.value=null;var n=this;return e.forEachChild(ni,(function(t,e){n.remember(new _n(t),e)})),this.forget(t)}if(this.children.size>0){var i=t.getFront();if(t=t.popFront(),this.children.has(i))this.children.get(i).forget(t)&&this.children.delete(i);return 0===this.children.size}return!0},t.prototype.forEachTree=function(t,e){null!==this.value?e(t,this.value):this.forEachChild((function(n,i){var r=new _n(t.toString()+"/"+n);i.forEachTree(r,e)}))},t.prototype.forEachChild=function(t){this.children.forEach((function(e,n){t(n,e)}))},t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(Pi=Mi||(Mi={}))[Pi.OVERWRITE=0]="OVERWRITE",Pi[Pi.MERGE=1]="MERGE",Pi[Pi.ACK_USER_WRITE=2]="ACK_USER_WRITE",Pi[Pi.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";var qi,Li,Vi=function(){function t(t,e,n,i){this.fromUser=t,this.fromServer=e,this.queryId=n,this.tagged=i,x.assert(!i||e,"Tagged queries must be from server.")}return t.User=new t(!0,!1,null,!1),t.Server=new t(!1,!0,null,!1),t.forServerTaggedQuery=function(e){return new t(!1,!0,e,!0)},t}(),ji=function(){function t(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=Mi.ACK_USER_WRITE,this.source=Vi.User}return t.prototype.operationForChild=function(e){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return x.assert(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new _n(e));return new t(_n.Empty,n,this.revert)}return x.assert(this.path.getFront()===e,"operationForChild called for unrelated child."),new t(this.path.popFront(),this.affectedTree,this.revert)},t}(),Wi=function(){function t(t,e){void 0===e&&(qi||(qi=new oi(sn)),e=qi),this.value=t,this.children=e}return t.fromObject=function(e){var n=t.Empty;return un(e,(function(t,e){n=n.set(new _n(t),e)})),n},t.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},t.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:_n.Empty,value:this.value};if(t.isEmpty())return null;var n=t.getFront(),i=this.children.get(n);if(null!==i){var r=i.findRootMostMatchingPathAndValue(t.popFront(),e);return null!=r?{path:new _n(n).child(r.path),value:r.value}:null}return null},t.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,(function(){return!0}))},t.prototype.subtree=function(e){if(e.isEmpty())return this;var n=e.getFront(),i=this.children.get(n);return null!==i?i.subtree(e.popFront()):t.Empty},t.prototype.set=function(e,n){if(e.isEmpty())return new t(n,this.children);var i=e.getFront(),r=(this.children.get(i)||t.Empty).set(e.popFront(),n),s=this.children.insert(i,r);return new t(this.value,s)},t.prototype.remove=function(e){if(e.isEmpty())return this.children.isEmpty()?t.Empty:new t(null,this.children);var n=e.getFront(),i=this.children.get(n);if(i){var r=i.remove(e.popFront()),s=void 0;return s=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),null===this.value&&s.isEmpty()?t.Empty:new t(this.value,s)}return this},t.prototype.get=function(t){if(t.isEmpty())return this.value;var e=t.getFront(),n=this.children.get(e);return n?n.get(t.popFront()):null},t.prototype.setTree=function(e,n){if(e.isEmpty())return n;var i=e.getFront(),r=(this.children.get(i)||t.Empty).setTree(e.popFront(),n),s=void 0;return s=r.isEmpty()?this.children.remove(i):this.children.insert(i,r),new t(this.value,s)},t.prototype.fold=function(t){return this.fold_(_n.Empty,t)},t.prototype.fold_=function(t,e){var n={};return this.children.inorderTraversal((function(i,r){n[i]=r.fold_(t.child(i),e)})),e(t,this.value,n)},t.prototype.findOnPath=function(t,e){return this.findOnPath_(t,_n.Empty,e)},t.prototype.findOnPath_=function(t,e,n){var i=!!this.value&&n(e,this.value);if(i)return i;if(t.isEmpty())return null;var r=t.getFront(),s=this.children.get(r);return s?s.findOnPath_(t.popFront(),e.child(r),n):null},t.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,_n.Empty,e)},t.prototype.foreachOnPath_=function(e,n,i){if(e.isEmpty())return this;this.value&&i(n,this.value);var r=e.getFront(),s=this.children.get(r);return s?s.foreachOnPath_(e.popFront(),n.child(r),i):t.Empty},t.prototype.foreach=function(t){this.foreach_(_n.Empty,t)},t.prototype.foreach_=function(t,e){this.children.inorderTraversal((function(n,i){i.foreach_(t.child(n),e)})),this.value&&e(t,this.value)},t.prototype.foreachChild=function(t){this.children.inorderTraversal((function(e,n){n.value&&t(e,n.value)}))},t.Empty=new t(null),t}(),Bi=function(){function t(t,e){this.source=t,this.path=e,this.type=Mi.LISTEN_COMPLETE}return t.prototype.operationForChild=function(e){return this.path.isEmpty()?new t(this.source,_n.Empty):new t(this.source,this.path.popFront())},t}(),Ui=function(){function t(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=Mi.OVERWRITE}return t.prototype.operationForChild=function(e){return this.path.isEmpty()?new t(this.source,_n.Empty,this.snap.getImmediateChild(e)):new t(this.source,this.path.popFront(),this.snap)},t}(),zi=function(){function t(t,e,n){this.source=t,this.path=e,this.children=n,this.type=Mi.MERGE}return t.prototype.operationForChild=function(e){if(this.path.isEmpty()){var n=this.children.subtree(new _n(e));return n.isEmpty()?null:n.value?new Ui(this.source,_n.Empty,n.value):new t(this.source,_n.Empty,n)}return x.assert(this.path.getFront()===e,"Can't get a merge for a child not on the path of the operation"),new t(this.source,this.path.popFront(),this.children)},t.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},t}(),Qi=function(){function t(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}return t.prototype.isFullyInitialized=function(){return this.fullyInitialized_},t.prototype.isFiltered=function(){return this.filtered_},t.prototype.isCompleteForPath=function(t){if(t.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var e=t.getFront();return this.isCompleteForChild(e)},t.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)},t.prototype.getNode=function(){return this.node_},t}(),Hi=function(){function t(t,e){this.eventCache_=t,this.serverCache_=e}return t.prototype.updateEventSnap=function(e,n,i){return new t(new Qi(e,n,i),this.serverCache_)},t.prototype.updateServerSnap=function(e,n,i){return new t(this.eventCache_,new Qi(e,n,i))},t.prototype.getEventCache=function(){return this.eventCache_},t.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},t.prototype.getServerCache=function(){return this.serverCache_},t.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},t.Empty=new t(new Qi(fi.EMPTY_NODE,!1,!1),new Qi(fi.EMPTY_NODE,!1,!1)),t}(),Gi=function(){function t(t,e,n,i,r){this.type=t,this.snapshotNode=e,this.childName=n,this.oldSnap=i,this.prevName=r}return t.valueChange=function(e){return new t(t.VALUE,e)},t.childAddedChange=function(e,n){return new t(t.CHILD_ADDED,n,e)},t.childRemovedChange=function(e,n){return new t(t.CHILD_REMOVED,n,e)},t.childChangedChange=function(e,n,i){return new t(t.CHILD_CHANGED,n,e,i)},t.childMovedChange=function(e,n){return new t(t.CHILD_MOVED,n,e)},t.CHILD_ADDED="child_added",t.CHILD_REMOVED="child_removed",t.CHILD_CHANGED="child_changed",t.CHILD_MOVED="child_moved",t.VALUE="value",t}(),Yi=function(){function t(t){this.index_=t}return t.prototype.updateChild=function(t,e,n,i,r,s){x.assert(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");var o=t.getImmediateChild(e);return o.getChild(i).equals(n.getChild(i))&&o.isEmpty()===n.isEmpty()?t:(null!=s&&(n.isEmpty()?t.hasChild(e)?s.trackChildChange(Gi.childRemovedChange(e,o)):x.assert(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(Gi.childAddedChange(e,n)):s.trackChildChange(Gi.childChangedChange(e,n,o))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_))},t.prototype.updateFullNode=function(t,e,n){return null!=n&&(t.isLeafNode()||t.forEachChild(ni,(function(t,i){e.hasChild(t)||n.trackChildChange(Gi.childRemovedChange(t,i))})),e.isLeafNode()||e.forEachChild(ni,(function(e,i){if(t.hasChild(e)){var r=t.getImmediateChild(e);r.equals(i)||n.trackChildChange(Gi.childChangedChange(e,i,r))}else n.trackChildChange(Gi.childAddedChange(e,i))}))),e.withIndex(this.index_)},t.prototype.updatePriority=function(t,e){return t.isEmpty()?fi.EMPTY_NODE:t.updatePriority(e)},t.prototype.filtersNodes=function(){return!1},t.prototype.getIndexedFilter=function(){return this},t.prototype.getIndex=function(){return this.index_},t}(),Xi=function(){function t(){this.changeMap=new Map}return t.prototype.trackChildChange=function(t){var e=t.type,n=t.childName;x.assert(e===Gi.CHILD_ADDED||e===Gi.CHILD_CHANGED||e===Gi.CHILD_REMOVED,"Only child changes supported for tracking"),x.assert(".priority"!==n,"Only non-priority child changes can be tracked.");var i=this.changeMap.get(n);if(i){var r=i.type;if(e===Gi.CHILD_ADDED&&r===Gi.CHILD_REMOVED)this.changeMap.set(n,Gi.childChangedChange(n,t.snapshotNode,i.snapshotNode));else if(e===Gi.CHILD_REMOVED&&r===Gi.CHILD_ADDED)this.changeMap.delete(n);else if(e===Gi.CHILD_REMOVED&&r===Gi.CHILD_CHANGED)this.changeMap.set(n,Gi.childRemovedChange(n,i.oldSnap));else if(e===Gi.CHILD_CHANGED&&r===Gi.CHILD_ADDED)this.changeMap.set(n,Gi.childAddedChange(n,t.snapshotNode));else{if(e!==Gi.CHILD_CHANGED||r!==Gi.CHILD_CHANGED)throw x.assertionError("Illegal combination of changes: "+t+" occurred after "+i);this.changeMap.set(n,Gi.childChangedChange(n,t.snapshotNode,i.oldSnap))}}else this.changeMap.set(n,t)},t.prototype.getChanges=function(){return Array.from(this.changeMap.values())},t}(),Ki=new(function(){function t(){}return t.prototype.getCompleteChild=function(t){return null},t.prototype.getChildAfterChild=function(t,e,n){return null},t}()),Zi=function(){function t(t,e,n){void 0===n&&(n=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}return t.prototype.getCompleteChild=function(t){var e=this.viewCache_.getEventCache();if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);var n=null!=this.optCompleteServerCache_?new Qi(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(t,n)},t.prototype.getChildAfterChild=function(t,e,n){var i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),r=this.writes_.calcIndexedSlice(i,e,1,n,t);return 0===r.length?null:r[0]},t}(),$i=function(t,e){this.viewCache=t,this.changes=e},Ji=function(){function t(t){this.filter_=t}return t.prototype.assertIndexed=function(t){x.assert(t.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),x.assert(t.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},t.prototype.applyOperation=function(e,n,i,r){var s,o,a=new Xi;if(n.type===Mi.OVERWRITE){var c=n;c.source.fromUser?s=this.applyUserOverwrite_(e,c.path,c.snap,i,r,a):(x.assert(c.source.fromServer,"Unknown source."),o=c.source.tagged||e.getServerCache().isFiltered()&&!c.path.isEmpty(),s=this.applyServerOverwrite_(e,c.path,c.snap,i,r,o,a))}else if(n.type===Mi.MERGE){var u=n;u.source.fromUser?s=this.applyUserMerge_(e,u.path,u.children,i,r,a):(x.assert(u.source.fromServer,"Unknown source."),o=u.source.tagged||e.getServerCache().isFiltered(),s=this.applyServerMerge_(e,u.path,u.children,i,r,o,a))}else if(n.type===Mi.ACK_USER_WRITE){var h=n;s=h.revert?this.revertUserWrite_(e,h.path,i,r,a):this.ackUserWrite_(e,h.path,h.affectedTree,i,r,a)}else{if(n.type!==Mi.LISTEN_COMPLETE)throw x.assertionError("Unknown operation type: "+n.type);s=this.listenComplete_(e,n.path,i,a)}var l=a.getChanges();return t.maybeAddValueEvent_(e,s,l),new $i(s,l)},t.maybeAddValueEvent_=function(t,e,n){var i=e.getEventCache();if(i.isFullyInitialized()){var r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=t.getCompleteEventSnap();(n.length>0||!t.getEventCache().isFullyInitialized()||r&&!i.getNode().equals(s)||!i.getNode().getPriority().equals(s.getPriority()))&&n.push(Gi.valueChange(e.getCompleteEventSnap()))}},t.prototype.generateEventCacheAfterServerEvent_=function(t,e,n,i,r){var s=t.getEventCache();if(null!=n.shadowingWrite(e))return t;var o=void 0,a=void 0;if(e.isEmpty())if(x.assert(t.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),t.getServerCache().isFiltered()){var c=t.getCompleteServerSnap(),u=c instanceof fi?c:fi.EMPTY_NODE,h=n.calcCompleteEventChildren(u);o=this.filter_.updateFullNode(t.getEventCache().getNode(),h,r)}else{var l=n.calcCompleteEventCache(t.getCompleteServerSnap());o=this.filter_.updateFullNode(t.getEventCache().getNode(),l,r)}else{var p=e.getFront();if(".priority"===p){x.assert(1===e.getLength(),"Can't have a priority with additional path components");var d=s.getNode();a=t.getServerCache().getNode();var f=n.calcEventCacheAfterServerOverwrite(e,d,a);o=null!=f?this.filter_.updatePriority(d,f):s.getNode()}else{var _=e.popFront(),v=void 0;if(s.isCompleteForChild(p)){a=t.getServerCache().getNode();var m=n.calcEventCacheAfterServerOverwrite(e,s.getNode(),a);v=null!=m?s.getNode().getImmediateChild(p).updateChild(_,m):s.getNode().getImmediateChild(p)}else v=n.calcCompleteChild(p,t.getServerCache());o=null!=v?this.filter_.updateChild(s.getNode(),p,v,_,i,r):s.getNode()}}return t.updateEventSnap(o,s.isFullyInitialized()||e.isEmpty(),this.filter_.filtersNodes())},t.prototype.applyServerOverwrite_=function(t,e,n,i,r,s,o){var a,c=t.getServerCache(),u=s?this.filter_:this.filter_.getIndexedFilter();if(e.isEmpty())a=u.updateFullNode(c.getNode(),n,null);else if(u.filtersNodes()&&!c.isFiltered()){var h=c.getNode().updateChild(e,n);a=u.updateFullNode(c.getNode(),h,null)}else{var l=e.getFront();if(!c.isCompleteForPath(e)&&e.getLength()>1)return t;var p=e.popFront(),d=c.getNode().getImmediateChild(l).updateChild(p,n);a=".priority"===l?u.updatePriority(c.getNode(),d):u.updateChild(c.getNode(),l,d,p,Ki,null)}var f=t.updateServerSnap(a,c.isFullyInitialized()||e.isEmpty(),u.filtersNodes()),_=new Zi(i,f,r);return this.generateEventCacheAfterServerEvent_(f,e,i,_,o)},t.prototype.applyUserOverwrite_=function(t,e,n,i,r,s){var o,a,c=t.getEventCache(),u=new Zi(i,t,r);if(e.isEmpty())a=this.filter_.updateFullNode(t.getEventCache().getNode(),n,s),o=t.updateEventSnap(a,!0,this.filter_.filtersNodes());else{var h=e.getFront();if(".priority"===h)a=this.filter_.updatePriority(t.getEventCache().getNode(),n),o=t.updateEventSnap(a,c.isFullyInitialized(),c.isFiltered());else{var l=e.popFront(),p=c.getNode().getImmediateChild(h),d=void 0;if(l.isEmpty())d=n;else{var f=u.getCompleteChild(h);d=null!=f?".priority"===l.getBack()&&f.getChild(l.parent()).isEmpty()?f:f.updateChild(l,n):fi.EMPTY_NODE}if(p.equals(d))o=t;else{var _=this.filter_.updateChild(c.getNode(),h,d,l,u,s);o=t.updateEventSnap(_,c.isFullyInitialized(),this.filter_.filtersNodes())}}}return o},t.cacheHasChild_=function(t,e){return t.getEventCache().isCompleteForChild(e)},t.prototype.applyUserMerge_=function(e,n,i,r,s,o){var a=this,c=e;return i.foreach((function(i,u){var h=n.child(i);t.cacheHasChild_(e,h.getFront())&&(c=a.applyUserOverwrite_(c,h,u,r,s,o))})),i.foreach((function(i,u){var h=n.child(i);t.cacheHasChild_(e,h.getFront())||(c=a.applyUserOverwrite_(c,h,u,r,s,o))})),c},t.prototype.applyMerge_=function(t,e){return e.foreach((function(e,n){t=t.updateChild(e,n)})),t},t.prototype.applyServerMerge_=function(t,e,n,i,r,s,o){var a=this;if(t.getServerCache().getNode().isEmpty()&&!t.getServerCache().isFullyInitialized())return t;var c,u=t;c=e.isEmpty()?n:Wi.Empty.setTree(e,n);var h=t.getServerCache().getNode();return c.children.inorderTraversal((function(e,n){if(h.hasChild(e)){var c=t.getServerCache().getNode().getImmediateChild(e),l=a.applyMerge_(c,n);u=a.applyServerOverwrite_(u,new _n(e),l,i,r,s,o)}})),c.children.inorderTraversal((function(e,n){var c=!t.getServerCache().isCompleteForChild(e)&&null==n.value;if(!h.hasChild(e)&&!c){var l=t.getServerCache().getNode().getImmediateChild(e),p=a.applyMerge_(l,n);u=a.applyServerOverwrite_(u,new _n(e),p,i,r,s,o)}})),u},t.prototype.ackUserWrite_=function(t,e,n,i,r,s){if(null!=i.shadowingWrite(e))return t;var o=t.getServerCache().isFiltered(),a=t.getServerCache();if(null!=n.value){if(e.isEmpty()&&a.isFullyInitialized()||a.isCompleteForPath(e))return this.applyServerOverwrite_(t,e,a.getNode().getChild(e),i,r,o,s);if(e.isEmpty()){var c=Wi.Empty;return a.getNode().forEachChild(Gn,(function(t,e){c=c.set(new _n(t),e)})),this.applyServerMerge_(t,e,c,i,r,o,s)}return t}var u=Wi.Empty;return n.foreach((function(t,n){var i=e.child(t);a.isCompleteForPath(i)&&(u=u.set(t,a.getNode().getChild(i)))})),this.applyServerMerge_(t,e,u,i,r,o,s)},t.prototype.listenComplete_=function(t,e,n,i){var r=t.getServerCache(),s=t.updateServerSnap(r.getNode(),r.isFullyInitialized()||e.isEmpty(),r.isFiltered());return this.generateEventCacheAfterServerEvent_(s,e,n,Ki,i)},t.prototype.revertUserWrite_=function(t,e,n,i,r){var s;if(null!=n.shadowingWrite(e))return t;var o=new Zi(n,t,i),a=t.getEventCache().getNode(),c=void 0;if(e.isEmpty()||".priority"===e.getFront()){var u=void 0;if(t.getServerCache().isFullyInitialized())u=n.calcCompleteEventCache(t.getCompleteServerSnap());else{var h=t.getServerCache().getNode();x.assert(h instanceof fi,"serverChildren would be complete if leaf node"),u=n.calcCompleteEventChildren(h)}u=u,c=this.filter_.updateFullNode(a,u,r)}else{var l=e.getFront(),p=n.calcCompleteChild(l,t.getServerCache());null==p&&t.getServerCache().isCompleteForChild(l)&&(p=a.getImmediateChild(l)),(c=null!=p?this.filter_.updateChild(a,l,p,e.popFront(),o,r):t.getEventCache().getNode().hasChild(l)?this.filter_.updateChild(a,l,fi.EMPTY_NODE,e.popFront(),o,r):a).isEmpty()&&t.getServerCache().isFullyInitialized()&&(s=n.calcCompleteEventCache(t.getCompleteServerSnap())).isLeafNode()&&(c=this.filter_.updateFullNode(c,s,r))}return s=t.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(_n.Empty),t.updateEventSnap(c,s,this.filter_.filtersNodes())},t}(),tr=function(){function t(t){this.query_=t,this.index_=this.query_.getQueryParams().getIndex()}return t.prototype.generateEventsForChanges=function(t,e,n){var i=this,r=[],s=[];return t.forEach((function(t){t.type===Gi.CHILD_CHANGED&&i.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&s.push(Gi.childMovedChange(t.childName,t.snapshotNode))})),this.generateEventsForType_(r,Gi.CHILD_REMOVED,t,n,e),this.generateEventsForType_(r,Gi.CHILD_ADDED,t,n,e),this.generateEventsForType_(r,Gi.CHILD_MOVED,s,n,e),this.generateEventsForType_(r,Gi.CHILD_CHANGED,t,n,e),this.generateEventsForType_(r,Gi.VALUE,t,n,e),r},t.prototype.generateEventsForType_=function(t,e,n,i,r){var s=this,o=n.filter((function(t){return t.type===e}));o.sort(this.compareChanges_.bind(this)),o.forEach((function(e){var n=s.materializeSingleChange_(e,r);i.forEach((function(i){i.respondsTo(e.type)&&t.push(i.createEvent(n,s.query_))}))}))},t.prototype.materializeSingleChange_=function(t,e){return"value"===t.type||"child_removed"===t.type||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,this.index_)),t},t.prototype.compareChanges_=function(t,e){if(null==t.childName||null==e.childName)throw x.assertionError("Should only compare child_ events.");var n=new zn(t.childName,t.snapshotNode),i=new zn(e.childName,e.snapshotNode);return this.index_.compare(n,i)},t}(),er=function(){function t(t,e){this.query_=t,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),i=new Yi(n.getIndex()),r=n.getNodeFilter();this.processor_=new Ji(r);var s=e.getServerCache(),o=e.getEventCache(),a=i.updateFullNode(fi.EMPTY_NODE,s.getNode(),null),c=r.updateFullNode(fi.EMPTY_NODE,o.getNode(),null),u=new Qi(a,s.isFullyInitialized(),i.filtersNodes()),h=new Qi(c,o.isFullyInitialized(),r.filtersNodes());this.viewCache_=new Hi(h,u),this.eventGenerator_=new tr(this.query_)}return t.prototype.getQuery=function(){return this.query_},t.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},t.prototype.getCompleteServerCache=function(t){var e=this.viewCache_.getCompleteServerSnap();return e&&(this.query_.getQueryParams().loadsAllData()||!t.isEmpty()&&!e.getImmediateChild(t.getFront()).isEmpty())?e.getChild(t):null},t.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},t.prototype.addEventRegistration=function(t){this.eventRegistrations_.push(t)},t.prototype.removeEventRegistration=function(t,e){var n=[];if(e){x.assert(null==t,"A cancel should cancel all event registrations.");var i=this.query_.path;this.eventRegistrations_.forEach((function(t){e=e;var r=t.createCancelEvent(e,i);r&&n.push(r)}))}if(t){for(var r=[],s=0;s<this.eventRegistrations_.length;++s){var o=this.eventRegistrations_[s];if(o.matches(t)){if(t.hasAnyCallback()){r=r.concat(this.eventRegistrations_.slice(s+1));break}}else r.push(o)}this.eventRegistrations_=r}else this.eventRegistrations_=[];return n},t.prototype.applyOperation=function(t,e,n){t.type===Mi.MERGE&&null!==t.source.queryId&&(x.assert(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),x.assert(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var i=this.viewCache_,r=this.processor_.applyOperation(i,t,e,n);return this.processor_.assertIndexed(r.viewCache),x.assert(r.viewCache.getServerCache().isFullyInitialized()||!i.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=r.viewCache,this.generateEventsForChanges_(r.changes,r.viewCache.getEventCache().getNode(),null)},t.prototype.getInitialEvents=function(t){var e=this.viewCache_.getEventCache(),n=[];e.getNode().isLeafNode()||e.getNode().forEachChild(ni,(function(t,e){n.push(Gi.childAddedChange(t,e))}));return e.isFullyInitialized()&&n.push(Gi.valueChange(e.getNode())),this.generateEventsForChanges_(n,e.getNode(),t)},t.prototype.generateEventsForChanges_=function(t,e,n){var i=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(t,e,i)},t}(),nr=function(){function t(){this.views=new Map}return Object.defineProperty(t,"__referenceConstructor",{get:function(){return x.assert(Li,"Reference.ts has not been loaded"),Li},set:function(t){x.assert(!Li,"__referenceConstructor has already been defined"),Li=t},enumerable:!1,configurable:!0}),t.prototype.isEmpty=function(){return 0===this.views.size},t.prototype.applyOperation=function(t,e,n){var i,r,s=t.source.queryId;if(null!==s){var o=this.views.get(s);return x.assert(null!=o,"SyncTree gave us an op for an invalid query."),o.applyOperation(t,e,n)}var a=[];try{for(var c=b(this.views.values()),u=c.next();!u.done;u=c.next()){o=u.value;a=a.concat(o.applyOperation(t,e,n))}}catch(t){i={error:t}}finally{try{u&&!u.done&&(r=c.return)&&r.call(c)}finally{if(i)throw i.error}}return a},t.prototype.addEventRegistration=function(t,e,n,i,r){var s=t.queryIdentifier(),o=this.views.get(s);if(!o){var a=n.calcCompleteEventCache(r?i:null),c=!1;a?c=!0:i instanceof fi?(a=n.calcCompleteEventChildren(i),c=!1):(a=fi.EMPTY_NODE,c=!1);var u=new Hi(new Qi(a,c,!1),new Qi(i,r,!1));o=new er(t,u),this.views.set(s,o)}return o.addEventRegistration(e),o.getInitialEvents(e)},t.prototype.removeEventRegistration=function(e,n,i){var r,s,o=e.queryIdentifier(),a=[],c=[],u=this.hasCompleteView();if("default"===o)try{for(var h=b(this.views.entries()),l=h.next();!l.done;l=h.next()){var p=w(l.value,2),d=p[0],f=p[1];c=c.concat(f.removeEventRegistration(n,i)),f.isEmpty()&&(this.views.delete(d),f.getQuery().getQueryParams().loadsAllData()||a.push(f.getQuery()))}}catch(t){r={error:t}}finally{try{l&&!l.done&&(s=h.return)&&s.call(h)}finally{if(r)throw r.error}}else(f=this.views.get(o))&&(c=c.concat(f.removeEventRegistration(n,i)),f.isEmpty()&&(this.views.delete(o),f.getQuery().getQueryParams().loadsAllData()||a.push(f.getQuery())));return u&&!this.hasCompleteView()&&a.push(new t.__referenceConstructor(e.repo,e.path)),{removed:a,events:c}},t.prototype.getQueryViews=function(){var t,e,n=[];try{for(var i=b(this.views.values()),r=i.next();!r.done;r=i.next()){var s=r.value;s.getQuery().getQueryParams().loadsAllData()||n.push(s)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}return n},t.prototype.getCompleteServerCache=function(t){var e,n,i=null;try{for(var r=b(this.views.values()),s=r.next();!s.done;s=r.next()){var o=s.value;i=i||o.getCompleteServerCache(t)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return i},t.prototype.viewForQuery=function(t){if(t.getQueryParams().loadsAllData())return this.getCompleteView();var e=t.queryIdentifier();return this.views.get(e)},t.prototype.viewExistsForQuery=function(t){return null!=this.viewForQuery(t)},t.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},t.prototype.getCompleteView=function(){var t,e;try{for(var n=b(this.views.values()),i=n.next();!i.done;i=n.next()){var r=i.value;if(r.getQuery().getQueryParams().loadsAllData())return r}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}return null},t}(),ir=function(){function t(t){this.writeTree_=t}return t.prototype.addWrite=function(e,n){if(e.isEmpty())return new t(new Wi(n));var i=this.writeTree_.findRootMostValueAndPath(e);if(null!=i){var r=i.path,s=i.value,o=_n.relativePath(r,e);return s=s.updateChild(o,n),new t(this.writeTree_.set(r,s))}var a=new Wi(n);return new t(this.writeTree_.setTree(e,a))},t.prototype.addWrites=function(t,e){var n=this;return un(e,(function(e,i){n=n.addWrite(t.child(e),i)})),n},t.prototype.removeWrite=function(e){return e.isEmpty()?t.Empty:new t(this.writeTree_.setTree(e,Wi.Empty))},t.prototype.hasCompleteWrite=function(t){return null!=this.getCompleteNode(t)},t.prototype.getCompleteNode=function(t){var e=this.writeTree_.findRootMostValueAndPath(t);return null!=e?this.writeTree_.get(e.path).getChild(_n.relativePath(e.path,t)):null},t.prototype.getCompleteChildren=function(){var t=[],e=this.writeTree_.value;return null!=e?e.isLeafNode()||e.forEachChild(ni,(function(e,n){t.push(new zn(e,n))})):this.writeTree_.children.inorderTraversal((function(e,n){null!=n.value&&t.push(new zn(e,n.value))})),t},t.prototype.childCompoundWrite=function(e){if(e.isEmpty())return this;var n=this.getCompleteNode(e);return new t(null!=n?new Wi(n):this.writeTree_.subtree(e))},t.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},t.prototype.apply=function(t){return function t(e,n,i){if(null!=n.value)return i.updateChild(e,n.value);var r=null;return n.children.inorderTraversal((function(n,s){".priority"===n?(x.assert(null!==s.value,"Priority writes must always be leaf nodes"),r=s.value):i=t(e.child(n),s,i)})),i.getChild(e).isEmpty()||null===r||(i=i.updateChild(e.child(".priority"),r)),i}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(_n.Empty,this.writeTree_,t)},t.Empty=new t(new Wi(null)),t}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rr=function(){function t(){this.visibleWrites_=ir.Empty,this.allWrites_=[],this.lastWriteId_=-1}return t.prototype.childWrites=function(t){return new sr(t,this)},t.prototype.addOverwrite=function(t,e,n,i){x.assert(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),this.allWrites_.push({path:t,snap:e,writeId:n,visible:i}),i&&(this.visibleWrites_=this.visibleWrites_.addWrite(t,e)),this.lastWriteId_=n},t.prototype.addMerge=function(t,e,n){x.assert(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:t,children:e,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(t,e),this.lastWriteId_=n},t.prototype.getWrite=function(t){for(var e=0;e<this.allWrites_.length;e++){var n=this.allWrites_[e];if(n.writeId===t)return n}return null},t.prototype.removeWrite=function(t){var e=this,n=this.allWrites_.findIndex((function(e){return e.writeId===t}));x.assert(n>=0,"removeWrite called with nonexistent writeId.");var i=this.allWrites_[n];this.allWrites_.splice(n,1);for(var r=i.visible,s=!1,o=this.allWrites_.length-1;r&&o>=0;){var a=this.allWrites_[o];a.visible&&(o>=n&&this.recordContainsPath_(a,i.path)?r=!1:i.path.contains(a.path)&&(s=!0)),o--}if(r){if(s)return this.resetTree_(),!0;i.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(i.path):un(i.children,(function(t){e.visibleWrites_=e.visibleWrites_.removeWrite(i.path.child(t))}));return!0}return!1},t.prototype.getCompleteWriteData=function(t){return this.visibleWrites_.getCompleteNode(t)},t.prototype.calcCompleteEventCache=function(e,n,i,r){if(i||r){var s=this.visibleWrites_.childCompoundWrite(e);if(!r&&s.isEmpty())return n;if(r||null!=n||s.hasCompleteWrite(_n.Empty)){var o=t.layerTree_(this.allWrites_,(function(t){return(t.visible||r)&&(!i||!~i.indexOf(t.writeId))&&(t.path.contains(e)||e.contains(t.path))}),e);u=n||fi.EMPTY_NODE;return o.apply(u)}return null}var a=this.visibleWrites_.getCompleteNode(e);if(null!=a)return a;var c=this.visibleWrites_.childCompoundWrite(e);if(c.isEmpty())return n;if(null!=n||c.hasCompleteWrite(_n.Empty)){var u=n||fi.EMPTY_NODE;return c.apply(u)}return null},t.prototype.calcCompleteEventChildren=function(t,e){var n=fi.EMPTY_NODE,i=this.visibleWrites_.getCompleteNode(t);if(i)return i.isLeafNode()||i.forEachChild(ni,(function(t,e){n=n.updateImmediateChild(t,e)})),n;if(e){var r=this.visibleWrites_.childCompoundWrite(t);return e.forEachChild(ni,(function(t,e){var i=r.childCompoundWrite(new _n(t)).apply(e);n=n.updateImmediateChild(t,i)})),r.getCompleteChildren().forEach((function(t){n=n.updateImmediateChild(t.name,t.node)})),n}return this.visibleWrites_.childCompoundWrite(t).getCompleteChildren().forEach((function(t){n=n.updateImmediateChild(t.name,t.node)})),n},t.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n,i){x.assert(n||i,"Either existingEventSnap or existingServerSnap must exist");var r=t.child(e);if(this.visibleWrites_.hasCompleteWrite(r))return null;var s=this.visibleWrites_.childCompoundWrite(r);return s.isEmpty()?i.getChild(e):s.apply(i.getChild(e))},t.prototype.calcCompleteChild=function(t,e,n){var i=t.child(e),r=this.visibleWrites_.getCompleteNode(i);return null!=r?r:n.isCompleteForChild(e)?this.visibleWrites_.childCompoundWrite(i).apply(n.getNode().getImmediateChild(e)):null},t.prototype.shadowingWrite=function(t){return this.visibleWrites_.getCompleteNode(t)},t.prototype.calcIndexedSlice=function(t,e,n,i,r,s){var o,a=this.visibleWrites_.childCompoundWrite(t),c=a.getCompleteNode(_n.Empty);if(null!=c)o=c;else{if(null==e)return[];o=a.apply(e)}if((o=o.withIndex(s)).isEmpty()||o.isLeafNode())return[];for(var u=[],h=s.getCompare(),l=r?o.getReverseIteratorFrom(n,s):o.getIteratorFrom(n,s),p=l.getNext();p&&u.length<i;)0!==h(p,n)&&u.push(p),p=l.getNext();return u},t.prototype.recordContainsPath_=function(t,e){if(t.snap)return t.path.contains(e);for(var n in t.children)if(t.children.hasOwnProperty(n)&&t.path.child(n).contains(e))return!0;return!1},t.prototype.resetTree_=function(){this.visibleWrites_=t.layerTree_(this.allWrites_,t.DefaultFilter_,_n.Empty),this.allWrites_.length>0?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},t.DefaultFilter_=function(t){return t.visible},t.layerTree_=function(t,e,n){for(var i=ir.Empty,r=0;r<t.length;++r){var s=t[r];if(e(s)){var o=s.path,a=void 0;if(s.snap)n.contains(o)?(a=_n.relativePath(n,o),i=i.addWrite(a,s.snap)):o.contains(n)&&(a=_n.relativePath(o,n),i=i.addWrite(_n.Empty,s.snap.getChild(a)));else{if(!s.children)throw x.assertionError("WriteRecord should have .snap or .children");if(n.contains(o))a=_n.relativePath(n,o),i=i.addWrites(a,s.children);else if(o.contains(n))if((a=_n.relativePath(o,n)).isEmpty())i=i.addWrites(_n.Empty,s.children);else{var c=x.safeGet(s.children,a.getFront());if(c){var u=c.getChild(a.popFront());i=i.addWrite(_n.Empty,u)}}}}}return i},t}(),sr=function(){function t(t,e){this.treePath_=t,this.writeTree_=e}return t.prototype.calcCompleteEventCache=function(t,e,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,t,e,n)},t.prototype.calcCompleteEventChildren=function(t){return this.writeTree_.calcCompleteEventChildren(this.treePath_,t)},t.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,t,e,n)},t.prototype.shadowingWrite=function(t){return this.writeTree_.shadowingWrite(this.treePath_.child(t))},t.prototype.calcIndexedSlice=function(t,e,n,i,r){return this.writeTree_.calcIndexedSlice(this.treePath_,t,e,n,i,r)},t.prototype.calcCompleteChild=function(t,e){return this.writeTree_.calcCompleteChild(this.treePath_,t,e)},t.prototype.child=function(e){return new t(this.treePath_.child(e),this.writeTree_)},t}(),or=function(){function t(t){this.listenProvider_=t,this.syncPointTree_=Wi.Empty,this.pendingWriteTree_=new rr,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}return t.prototype.applyUserOverwrite=function(t,e,n,i){return this.pendingWriteTree_.addOverwrite(t,e,n,i),i?this.applyOperationToSyncPoints_(new Ui(Vi.User,t,e)):[]},t.prototype.applyUserMerge=function(t,e,n){this.pendingWriteTree_.addMerge(t,e,n);var i=Wi.fromObject(e);return this.applyOperationToSyncPoints_(new zi(Vi.User,t,i))},t.prototype.ackUserWrite=function(t,e){void 0===e&&(e=!1);var n=this.pendingWriteTree_.getWrite(t);if(this.pendingWriteTree_.removeWrite(t)){var i=Wi.Empty;return null!=n.snap?i=i.set(_n.Empty,!0):un(n.children,(function(t,e){i=i.set(new _n(t),e)})),this.applyOperationToSyncPoints_(new ji(n.path,i,e))}return[]},t.prototype.applyServerOverwrite=function(t,e){return this.applyOperationToSyncPoints_(new Ui(Vi.Server,t,e))},t.prototype.applyServerMerge=function(t,e){var n=Wi.fromObject(e);return this.applyOperationToSyncPoints_(new zi(Vi.Server,t,n))},t.prototype.applyListenComplete=function(t){return this.applyOperationToSyncPoints_(new Bi(Vi.Server,t))},t.prototype.applyTaggedQueryOverwrite=function(e,n,i){var r=this.queryKeyForTag_(i);if(null!=r){var s=t.parseQueryKey_(r),o=s.path,a=s.queryId,c=_n.relativePath(o,e),u=new Ui(Vi.forServerTaggedQuery(a),c,n);return this.applyTaggedOperation_(o,u)}return[]},t.prototype.applyTaggedQueryMerge=function(e,n,i){var r=this.queryKeyForTag_(i);if(r){var s=t.parseQueryKey_(r),o=s.path,a=s.queryId,c=_n.relativePath(o,e),u=Wi.fromObject(n),h=new zi(Vi.forServerTaggedQuery(a),c,u);return this.applyTaggedOperation_(o,h)}return[]},t.prototype.applyTaggedListenComplete=function(e,n){var i=this.queryKeyForTag_(n);if(i){var r=t.parseQueryKey_(i),s=r.path,o=r.queryId,a=_n.relativePath(s,e),c=new Bi(Vi.forServerTaggedQuery(o),a);return this.applyTaggedOperation_(s,c)}return[]},t.prototype.addEventRegistration=function(e,n){var i=e.path,r=null,s=!1;this.syncPointTree_.foreachOnPath(i,(function(t,e){var n=_n.relativePath(t,i);r=r||e.getCompleteServerCache(n),s=s||e.hasCompleteView()}));var o,a=this.syncPointTree_.get(i);(a?(s=s||a.hasCompleteView(),r=r||a.getCompleteServerCache(_n.Empty)):(a=new nr,this.syncPointTree_=this.syncPointTree_.set(i,a)),null!=r)?o=!0:(o=!1,r=fi.EMPTY_NODE,this.syncPointTree_.subtree(i).foreachChild((function(t,e){var n=e.getCompleteServerCache(_n.Empty);n&&(r=r.updateImmediateChild(t,n))})));var c=a.viewExistsForQuery(e);if(!c&&!e.getQueryParams().loadsAllData()){var u=t.makeQueryKey_(e);x.assert(!this.queryToTagMap.has(u),"View does not exist, but we have a tag");var h=t.getNextQueryTag_();this.queryToTagMap.set(u,h),this.tagToQueryMap.set(h,u)}var l=this.pendingWriteTree_.childWrites(i),p=a.addEventRegistration(e,n,l,r,o);if(!c&&!s){var d=a.viewForQuery(e);p=p.concat(this.setupListener_(e,d))}return p},t.prototype.removeEventRegistration=function(e,n,i){var r=this,s=e.path,o=this.syncPointTree_.get(s),a=[];if(o&&("default"===e.queryIdentifier()||o.viewExistsForQuery(e))){var c=o.removeEventRegistration(e,n,i);o.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(s));var u=c.removed;a=c.events;var h=-1!==u.findIndex((function(t){return t.getQueryParams().loadsAllData()})),l=this.syncPointTree_.findOnPath(s,(function(t,e){return e.hasCompleteView()}));if(h&&!l){var p=this.syncPointTree_.subtree(s);if(!p.isEmpty())for(var d=this.collectDistinctViewsForSubTree_(p),f=0;f<d.length;++f){var _=d[f],v=_.getQuery(),m=this.createListenerForView_(_);this.listenProvider_.startListening(t.queryForListening_(v),this.tagForQuery_(v),m.hashFn,m.onComplete)}}if(!l&&u.length>0&&!i)if(h){this.listenProvider_.stopListening(t.queryForListening_(e),null)}else u.forEach((function(e){var n=r.queryToTagMap.get(t.makeQueryKey_(e));r.listenProvider_.stopListening(t.queryForListening_(e),n)}));this.removeTags_(u)}return a},t.prototype.calcCompleteEventCache=function(t,e){var n=this.pendingWriteTree_,i=this.syncPointTree_.findOnPath(t,(function(e,n){var i=_n.relativePath(e,t),r=n.getCompleteServerCache(i);if(r)return r}));return n.calcCompleteEventCache(t,i,e,!0)},t.prototype.collectDistinctViewsForSubTree_=function(t){return t.fold((function(t,e,n){if(e&&e.hasCompleteView())return[e.getCompleteView()];var i=[];return e&&(i=e.getQueryViews()),un(n,(function(t,e){i=i.concat(e)})),i}))},t.prototype.removeTags_=function(e){for(var n=0;n<e.length;++n){var i=e[n];if(!i.getQueryParams().loadsAllData()){var r=t.makeQueryKey_(i),s=this.queryToTagMap.get(r);this.queryToTagMap.delete(r),this.tagToQueryMap.delete(s)}}},t.queryForListening_=function(t){return t.getQueryParams().loadsAllData()&&!t.getQueryParams().isDefault()?t.getRef():t},t.prototype.setupListener_=function(e,n){var i=e.path,r=this.tagForQuery_(e),s=this.createListenerForView_(n),o=this.listenProvider_.startListening(t.queryForListening_(e),r,s.hashFn,s.onComplete),a=this.syncPointTree_.subtree(i);if(r)x.assert(!a.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var c=a.fold((function(t,e,n){if(!t.isEmpty()&&e&&e.hasCompleteView())return[e.getCompleteView().getQuery()];var i=[];return e&&(i=i.concat(e.getQueryViews().map((function(t){return t.getQuery()})))),un(n,(function(t,e){i=i.concat(e)})),i})),u=0;u<c.length;++u){var h=c[u];this.listenProvider_.stopListening(t.queryForListening_(h),this.tagForQuery_(h))}return o},t.prototype.createListenerForView_=function(t){var e=this,n=t.getQuery(),i=this.tagForQuery_(n);return{hashFn:function(){return(t.getServerCache()||fi.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return i?e.applyTaggedListenComplete(n.path,i):e.applyListenComplete(n.path);var r=function(t,e){var n="Unknown Error";"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===t?n="Client doesn't have permission to access the desired data.":"unavailable"===t&&(n="The service is unavailable");var i=new Error(t+" at "+e.path.toString()+": "+n);return i.code=t.toUpperCase(),i}(t,n);return e.removeEventRegistration(n,null,r)}}},t.makeQueryKey_=function(t){return t.path.toString()+"$"+t.queryIdentifier()},t.parseQueryKey_=function(t){var e=t.indexOf("$");return x.assert(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new _n(t.substr(0,e))}},t.prototype.queryKeyForTag_=function(t){return this.tagToQueryMap.get(t)},t.prototype.tagForQuery_=function(e){var n=t.makeQueryKey_(e);return this.queryToTagMap.get(n)},t.getNextQueryTag_=function(){return t.nextQueryTag_++},t.prototype.applyTaggedOperation_=function(t,e){var n=this.syncPointTree_.get(t);x.assert(n,"Missing sync point for query tag that we're tracking");var i=this.pendingWriteTree_.childWrites(t);return n.applyOperation(e,i,null)},t.prototype.applyOperationToSyncPoints_=function(t){return this.applyOperationHelper_(t,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(_n.Empty))},t.prototype.applyOperationHelper_=function(t,e,n,i){if(t.path.isEmpty())return this.applyOperationDescendantsHelper_(t,e,n,i);var r=e.get(_n.Empty);null==n&&null!=r&&(n=r.getCompleteServerCache(_n.Empty));var s=[],o=t.path.getFront(),a=t.operationForChild(o),c=e.children.get(o);if(c&&a){var u=n?n.getImmediateChild(o):null,h=i.child(o);s=s.concat(this.applyOperationHelper_(a,c,u,h))}return r&&(s=s.concat(r.applyOperation(t,i,n))),s},t.prototype.applyOperationDescendantsHelper_=function(t,e,n,i){var r=this,s=e.get(_n.Empty);null==n&&null!=s&&(n=s.getCompleteServerCache(_n.Empty));var o=[];return e.children.inorderTraversal((function(e,s){var a=n?n.getImmediateChild(e):null,c=i.child(e),u=t.operationForChild(e);u&&(o=o.concat(r.applyOperationDescendantsHelper_(u,s,a,c)))})),s&&(o=o.concat(s.applyOperation(t,i,n))),o},t.nextQueryTag_=1,t}(),ar=function(){function t(){this.rootNode_=fi.EMPTY_NODE}return t.prototype.getNode=function(t){return this.rootNode_.getChild(t)},t.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)},t}(),cr=function(){function t(){this.counters_={}}return t.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),x.contains(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e},t.prototype.get=function(){return x.deepCopy(this.counters_)},t}(),ur=function(){function t(){}return t.getCollection=function(t){var e=t.toString();return this.collections_[e]||(this.collections_[e]=new cr),this.collections_[e]},t.getOrCreateReporter=function(t,e){var n=t.toString();return this.reporters_[n]||(this.reporters_[n]=e()),this.reporters_[n]},t.collections_={},t.reporters_={},t}(),hr=function(){function t(t){this.collection_=t,this.last_=null}return t.prototype.get=function(){var t=this.collection_.get(),e=v({},t);return this.last_&&un(this.last_,(function(t,n){e[t]=e[t]-n})),this.last_=t,e},t}(),lr=function(){function t(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new hr(t);var n=1e4+2e4*Math.random();fn(this.reportStats_.bind(this),Math.floor(n))}return t.prototype.includeStat=function(t){this.statsToReport_[t]=!0},t.prototype.reportStats_=function(){var t=this,e=this.statsListener_.get(),n={},i=!1;un(e,(function(e,r){r>0&&x.contains(t.statsToReport_,e)&&(n[e]=r,i=!0)})),i&&this.server_.reportStats(n),fn(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},t}(),pr=function(){function t(){this.eventLists_=[],this.recursionDepth_=0}return t.prototype.queueEvents=function(t){for(var e=null,n=0;n<t.length;n++){var i=t[n],r=i.getPath();null===e||r.equals(e.getPath())||(this.eventLists_.push(e),e=null),null===e&&(e=new dr(r)),e.add(i)}e&&this.eventLists_.push(e)},t.prototype.raiseEventsAtPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_((function(e){return e.equals(t)}))},t.prototype.raiseEventsForChangedPath=function(t,e){this.queueEvents(e),this.raiseQueuedEventsMatchingPredicate_((function(e){return e.contains(t)||t.contains(e)}))},t.prototype.raiseQueuedEventsMatchingPredicate_=function(t){this.recursionDepth_++;for(var e=!0,n=0;n<this.eventLists_.length;n++){var i=this.eventLists_[n];if(i)t(i.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):e=!1}e&&(this.eventLists_=[]),this.recursionDepth_--},t}(),dr=function(){function t(t){this.path_=t,this.events_=[]}return t.prototype.add=function(t){this.events_.push(t)},t.prototype.raise=function(){for(var t=0;t<this.events_.length;t++){var e=this.events_[t];if(null!==e){this.events_[t]=null;var n=e.getEventRunner();Ye&&Ze("event: "+e.toString()),dn(n)}}},t.prototype.getPath=function(){return this.path_},t}(),fr=function(){function t(t){this.allowedEvents_=t,this.listeners_={},x.assert(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}return t.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Array.isArray(this.listeners_[t]))for(var i=C(this.listeners_[t]),r=0;r<i.length;r++)i[r].callback.apply(i[r].context,e)},t.prototype.on=function(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});var i=this.getInitialEvent(t);i&&e.apply(n,i)},t.prototype.off=function(t,e,n){this.validateEventType_(t);for(var i=this.listeners_[t]||[],r=0;r<i.length;r++)if(i[r].callback===e&&(!n||n===i[r].context))return void i.splice(r,1)},t.prototype.validateEventType_=function(t){x.assert(this.allowedEvents_.find((function(e){return e===t})),"Unknown event: "+t)},t}(),_r=function(t){function e(){var e,n,i=t.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(n="visibilitychange",e="hidden"):void 0!==document.mozHidden?(n="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(n="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(n="webkitvisibilitychange",e="webkitHidden")),i.visible_=!0,n&&document.addEventListener(n,(function(){var t=!document[e];t!==i.visible_&&(i.visible_=t,i.trigger("visible",t))}),!1),i}return _(e,t),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return x.assert("visible"===t,"Unknown event type: "+t),[this.visible_]},e}(fr),vr=function(t){function e(){var e=t.call(this,["online"])||this;return e.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||x.isMobileCordova()||(window.addEventListener("online",(function(){e.online_||(e.online_=!0,e.trigger("online",!0))}),!1),window.addEventListener("offline",(function(){e.online_&&(e.online_=!1,e.trigger("online",!1))}),!1)),e}return _(e,t),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return x.assert("online"===t,"Unknown event type: "+t),[this.online_]},e.prototype.currentlyOnline=function(){return this.online_},e}(fr),mr=function(){function t(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return t.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},t.prototype.handleResponse=function(t,e){var n=this;this.pendingResponses[t]=e;for(var i=function(){var t=r.pendingResponses[r.currentResponseNum];delete r.pendingResponses[r.currentResponseNum];for(var e=function(e){t[e]&&dn((function(){n.onMessage_(t[e])}))},i=0;i<t.length;++i)e(i);if(r.currentResponseNum===r.closeAfterResponse)return r.onClose&&(r.onClose(),r.onClose=null),"break";r.currentResponseNum++},r=this;this.pendingResponses[this.currentResponseNum];){if("break"===i())break}},t}(),gr=function(){function t(t,e,n,i,r){this.connId=t,this.repoInfo=e,this.applicationId=n,this.transportSessionId=i,this.lastSessionId=r,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=$e(t),this.stats_=ur.getCollection(e),this.urlFn=function(t){return e.connectionURL("long_polling",t)}}return t.prototype.open=function(t,e){var n=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new mr(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null}),Math.floor(3e4)),function(t){if(x.isNodeSdk()||"complete"===document.readyState)t();else{var e=!1,n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((function(){if(!n.isClosed_){n.scriptTagHolder=new yr((function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=w(t,5),r=i[0],s=i[1],o=i[2];i[3],i[4];if(n.incrementIncomingBytes_(t),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,"start"===r)n.id=s,n.password=o;else{if("close"!==r)throw new Error("Unrecognized command received: "+r);s?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(s,(function(){n.onClosed_()}))):n.onClosed_()}}),(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=w(t,2),r=i[0],s=i[1];n.incrementIncomingBytes_(t),n.myPacketOrderer.handleResponse(r,s)}),(function(){n.onClosed_()}),n.urlFn);var t={start:"t"};t.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=n.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",n.transportSessionId&&(t.s=n.transportSessionId),n.lastSessionId&&(t.ls=n.lastSessionId),n.applicationId&&(t.p=n.applicationId),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(t.r="f");var e=n.urlFn(t);n.log_("Connecting via long-poll to "+e),n.scriptTagHolder.addTag(e,(function(){}))}}))},t.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},t.forceAllow=function(){t.forceAllow_=!0},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){return!x.isNodeSdk()&&(!!t.forceAllow_||!(t.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))},t.prototype.markConnectionHealthy=function(){},t.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},t.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},t.prototype.send=function(t){var e=x.stringify(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var n=x.base64Encode(e),i=cn(n,1840),r=0;r<i.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[r]),this.curSegmentNum++},t.prototype.addDisconnectPingFrame=function(t,e){if(!x.isNodeSdk()){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},t.prototype.incrementIncomingBytes_=function(t){var e=x.stringify(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},t}(),yr=function(){function t(e,n,i,r){if(this.onDisconnect=i,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,x.isNodeSdk())this.commandCB=e,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=Qe(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=t.createIFrame_();var s="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length))s='<script>document.domain="'+document.domain+'";<\/script>';var o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(t){Ze("frame writing exception"),t.stack&&Ze(t.stack),Ze(t)}}}return t.createIFrame_=function(){var t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||Ze("No IE domain setting required")}catch(n){var e=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+e+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t},t.prototype.close=function(){var t=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout((function(){null!==t.myIFrame&&(document.body.removeChild(t.myIFrame),t.myIFrame=null)}),Math.floor(0)));var e=this.onDisconnect;e&&(this.onDisconnect=null,e())},t.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},t.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;for(var e=this.urlFn(t),n="",i=0;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;var r=this.pendingSegs.shift();n=n+"&seg"+i+"="+r.seg+"&ts"+i+"="+r.ts+"&d"+i+"="+r.d,i++}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0}return!1},t.prototype.enqueueSegment=function(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()},t.prototype.addLongPollTag_=function(t,e){var n=this;this.outstandingRequests.add(e);var i=function(){n.outstandingRequests.delete(e),n.newRequest_()},r=setTimeout(i,Math.floor(25e3));this.addTag(t,(function(){clearTimeout(r),i()}))},t.prototype.addTag=function(t,e){var n=this;x.isNodeSdk()?this.doNodeLongPoll(t,e):setTimeout((function(){try{if(!n.sendNewPolls)return;var i=n.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=t,i.onload=i.onreadystatechange=function(){var t=i.readyState;t&&"loaded"!==t&&"complete"!==t||(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),e())},i.onerror=function(){Ze("Long-poll script failed to load: "+t),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(i)}catch(t){}}),Math.floor(1))},t}(),br="";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var wr=null;"undefined"!=typeof MozWebSocket?wr=MozWebSocket:"undefined"!=typeof WebSocket&&(wr=WebSocket);var Cr=function(){function t(e,n,i,r,s){this.connId=e,this.applicationId=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=$e(this.connId),this.stats_=ur.getCollection(n),this.connURL=t.connectionURL_(n,r,s)}return t.connectionURL_=function(t,e,n){var i={v:"5"};return!x.isNodeSdk()&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf("firebaseio.com")&&(i.r="f"),e&&(i.s=e),n&&(i.ls=n),t.connectionURL("websocket",i)},t.prototype.open=function(t,e){var n=this;this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Be.set("previous_websocket_failure",!0);try{if(x.isNodeSdk()){var i=x.CONSTANTS.NODE_ADMIN?"AdminNode":"Node",r={headers:{"User-Agent":"Firebase/5/"+br+"/"+we.platform+"/"+i,"X-Firebase-GMPID":this.applicationId||""}},s=we.env,o=0===this.connURL.indexOf("wss://")?s.HTTPS_PROXY||s.https_proxy:s.HTTP_PROXY||s.http_proxy;o&&(r.proxy={origin:o}),this.mySock=new wr(this.connURL,[],r)}else{r={headers:{"X-Firebase-GMPID":this.applicationId||""}};this.mySock=new wr(this.connURL,[],r)}}catch(t){this.log_("Error instantiating WebSocket.");var a=t.message||t.data;return a&&this.log_(a),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(t){n.handleIncomingFrame(t)},this.mySock.onerror=function(t){n.log_("WebSocket error.  Closing connection.");var e=t.message||t.data;e&&n.log_(e),n.onClosed_()}},t.prototype.start=function(){},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){var e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==wr&&!t.forceDisallow_},t.previouslyFailed=function(){return Be.isInMemoryStorage||!0===Be.get("previous_websocket_failure")},t.prototype.markConnectionHealthy=function(){Be.remove("previous_websocket_failure")},t.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length===this.totalFrames){var e=this.frames.join("");this.frames=null;var n=x.jsonEval(e);this.onMessage(n)}},t.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[]},t.prototype.extractFrameCount_=function(t){if(x.assert(null===this.frames,"We already have a frame buffer"),t.length<=6){var e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t},t.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{var n=this.extractFrameCount_(e);null!==n&&this.appendFrame_(n)}}},t.prototype.send=function(t){this.resetKeepAlive();var e=x.stringify(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var n=cn(e,16384);n.length>1&&this.sendString_(String(n.length));for(var i=0;i<n.length;i++)this.sendString_(n[i])},t.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},t.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},t.prototype.resetKeepAlive=function(){var t=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((function(){t.mySock&&t.sendString_("0"),t.resetKeepAlive()}),Math.floor(45e3))},t.prototype.sendString_=function(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},t.responsesRequiredToBeHealthy=2,t.healthyTimeout=3e4,t}(),xr=function(){function t(t){this.initTransports_(t)}return Object.defineProperty(t,"ALL_TRANSPORTS",{get:function(){return[gr,Cr]},enumerable:!1,configurable:!0}),t.prototype.initTransports_=function(e){var n,i,r=Cr&&Cr.isAvailable(),s=r&&!Cr.previouslyFailed();if(e.webSocketOnly&&(r||en("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[Cr];else{var o=this.transports_=[];try{for(var a=b(t.ALL_TRANSPORTS),c=a.next();!c.done;c=a.next()){var u=c.value;u&&u.isAvailable()&&o.push(u)}}catch(t){n={error:t}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}}},t.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},t.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},t}(),Tr=function(){function t(t,e,n,i,r,s,o,a){this.id=t,this.repoInfo_=e,this.applicationId_=n,this.onMessage_=i,this.onReady_=r,this.onDisconnect_=s,this.onKill_=o,this.lastSessionId=a,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=$e("c:"+this.id+":"),this.transportManager_=new xr(e),this.log_("Connection created"),this.start_()}return t.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,void 0,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((function(){t.conn_&&t.conn_.open(n,i)}),Math.floor(0));var r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=fn((function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&t.conn_.bytesReceived>102400?(t.log_("Connection exceeded healthy timeout but has received "+t.conn_.bytesReceived+" bytes.  Marking connection healthy."),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&t.conn_.bytesSent>10240?t.log_("Connection exceeded healthy timeout but has sent "+t.conn_.bytesSent+" bytes.  Leaving connection alive."):(t.log_("Closing unhealthy connection after timeout."),t.close()))}),Math.floor(r)))},t.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},t.prototype.disconnReceiver_=function(t){var e=this;return function(n){t===e.conn_?e.onConnectionLost_(n):t===e.secondaryConn_?(e.log_("Secondary connection lost."),e.onSecondaryConnectionLost_()):e.log_("closing an old connection")}},t.prototype.connReceiver_=function(t){var e=this;return function(n){2!==e.state_&&(t===e.rx_?e.onPrimaryMessageReceived_(n):t===e.secondaryConn_?e.onSecondaryMessageReceived_(n):e.log_("message on old connection"))}},t.prototype.sendRequest=function(t){var e={t:"d",d:t};this.sendData_(e)},t.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},t.prototype.onSecondaryControl_=function(t){if("t"in t){var e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},t.prototype.onSecondaryMessageReceived_=function(t){var e=on("t",t),n=on("d",t);if("c"===e)this.onSecondaryControl_(n);else{if("d"!==e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}},t.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},t.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},t.prototype.onPrimaryMessageReceived_=function(t){var e=on("t",t),n=on("d",t);"c"===e?this.onControl_(n):"d"===e&&this.onDataMessage_(n)},t.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t)},t.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},t.prototype.onControl_=function(t){var e=on("t",t);if("d"in t){var n=t.d;if("h"===e)this.onHandshake_(n);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?Je("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Je("Unknown control packet command: "+e)}},t.prototype.onHandshake_=function(t){var e=t.ts,n=t.v,i=t.h;this.sessionId=t.s,this.repoInfo_.updateHost(i),0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==n&&en("Protocol version mismatch detected"),this.tryStartUpgrade_())},t.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)},t.prototype.startUpgrade_=function(t){var e=this;this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,i),fn((function(){e.secondaryConn_&&(e.log_("Timed out trying to upgrade."),e.secondaryConn_.close())}),Math.floor(6e4))},t.prototype.onReset_=function(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.updateHost(t),1===this.state_?this.close():(this.closeConnections_(),this.start_())},t.prototype.onConnectionEstablished_=function(t,e){var n=this;this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):fn((function(){n.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))},t.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},t.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()},t.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Be.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},t.prototype.onConnectionShutdown_=function(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()},t.prototype.sendData_=function(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)},t.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},t.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},t}(),Sr=function(){function t(){}return t.prototype.put=function(t,e,n,i){},t.prototype.merge=function(t,e,n,i){},t.prototype.refreshAuthToken=function(t){},t.prototype.onDisconnectPut=function(t,e,n){},t.prototype.onDisconnectMerge=function(t,e,n){},t.prototype.onDisconnectCancel=function(t,e){},t.prototype.reportStats=function(t){},t}(),Er=function(t){function e(n,i,r,s,o,a,c){var u=t.call(this)||this;if(u.repoInfo_=n,u.applicationId_=i,u.onDataUpdate_=r,u.onConnectStatus_=s,u.onServerInfoUpdate_=o,u.authTokenProvider_=a,u.authOverride_=c,u.id=e.nextPersistentConnectionId_++,u.log_=$e("p:"+u.id+":"),u.interruptReasons_={},u.listens=new Map,u.outstandingPuts_=[],u.outstandingPutCount_=0,u.onDisconnectRequestQueue_=[],u.connected_=!1,u.reconnectDelay_=1e3,u.maxReconnectDelay_=3e5,u.securityDebugCallback_=null,u.lastSessionId=null,u.establishConnectionTimer_=null,u.visible_=!1,u.requestCBHash_={},u.requestNumber_=0,u.realtime_=null,u.authToken_=null,u.forceTokenRefresh_=!1,u.invalidAuthTokenCount_=0,u.firstConnection_=!0,u.lastConnectionAttemptTime_=null,u.lastConnectionEstablishedTime_=null,c&&!x.isNodeSdk())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return u.scheduleConnect_(0),_r.getInstance().on("visible",u.onVisible_,u),-1===n.host.indexOf("fblocal")&&vr.getInstance().on("online",u.onOnline_,u),u}return _(e,t),e.prototype.sendRequest=function(t,e,n){var i=++this.requestNumber_,r={r:i,a:t,b:e};this.log_(x.stringify(r)),x.assert(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),n&&(this.requestCBHash_[i]=n)},e.prototype.listen=function(t,e,n,i){var r=t.queryIdentifier(),s=t.path.toString();this.log_("Listen called for "+s+" "+r),this.listens.has(s)||this.listens.set(s,new Map),x.assert(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),x.assert(!this.listens.get(s).has(r),"listen() called twice for same path/queryId.");var o={onComplete:i,hashFn:e,query:t,tag:n};this.listens.get(s).set(r,o),this.connected_&&this.sendListen_(o)},e.prototype.sendListen_=function(t){var n=this,i=t.query,r=i.path.toString(),s=i.queryIdentifier();this.log_("Listen on "+r+" for "+s);var o={p:r};t.tag&&(o.q=i.queryObject(),o.t=t.tag),o.h=t.hashFn(),this.sendRequest("q",o,(function(o){var a=o.d,c=o.s;e.warnOnListenWarnings_(a,i),(n.listens.get(r)&&n.listens.get(r).get(s))===t&&(n.log_("listen response",o),"ok"!==c&&n.removeListen_(r,s),t.onComplete&&t.onComplete(c,a))}))},e.warnOnListenWarnings_=function(t,e){if(t&&"object"==typeof t&&x.contains(t,"w")){var n=x.safeGet(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var i='".indexOn": "'+e.getQueryParams().getIndex().toString()+'"',r=e.path.toString();en("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+i+" at "+r+" to your security rules for better performance.")}}},e.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(function(){})),this.reduceReconnectDelayIfAdminCredential_(t)},e.prototype.reduceReconnectDelayIfAdminCredential_=function(t){(t&&40===t.length||x.isAdmin(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},e.prototype.tryAuth=function(){var t=this;if(this.connected_&&this.authToken_){var e=this.authToken_,n=x.isValidFormat(e)?"auth":"gauth",i={cred:e};null===this.authOverride_?i.noauth=!0:"object"==typeof this.authOverride_&&(i.authvar=this.authOverride_),this.sendRequest(n,i,(function(n){var i=n.s,r=n.d||"error";t.authToken_===e&&("ok"===i?t.invalidAuthTokenCount_=0:t.onAuthRevoked_(i,r))}))}},e.prototype.unlisten=function(t,e){var n=t.path.toString(),i=t.queryIdentifier();this.log_("Unlisten called for "+n+" "+i),x.assert(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,i)&&this.connected_&&this.sendUnlisten_(n,i,t.queryObject(),e)},e.prototype.sendUnlisten_=function(t,e,n,i){this.log_("Unlisten on "+t+" for "+e);var r={p:t};i&&(r.q=n,r.t=i),this.sendRequest("n",r)},e.prototype.onDisconnectPut=function(t,e,n){this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})},e.prototype.onDisconnectMerge=function(t,e,n){this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})},e.prototype.onDisconnectCancel=function(t,e){this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})},e.prototype.sendOnDisconnect_=function(t,e,n,i){var r={p:e,d:n};this.log_("onDisconnect "+t,r),this.sendRequest(t,r,(function(t){i&&setTimeout((function(){i(t.s,t.d)}),Math.floor(0))}))},e.prototype.put=function(t,e,n,i){this.putInternal("p",t,e,n,i)},e.prototype.merge=function(t,e,n,i){this.putInternal("m",t,e,n,i)},e.prototype.putInternal=function(t,e,n,i,r){var s={p:e,d:n};void 0!==r&&(s.h=r),this.outstandingPuts_.push({action:t,request:s,onComplete:i}),this.outstandingPutCount_++;var o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+e)},e.prototype.sendPut_=function(t){var e=this,n=this.outstandingPuts_[t].action,i=this.outstandingPuts_[t].request,r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,i,(function(i){e.log_(n+" response",i),delete e.outstandingPuts_[t],e.outstandingPutCount_--,0===e.outstandingPutCount_&&(e.outstandingPuts_=[]),r&&r(i.s,i.d)}))},e.prototype.reportStats=function(t){var e=this;if(this.connected_){var n={c:t};this.log_("reportStats",n),this.sendRequest("s",n,(function(t){if("ok"!==t.s){var n=t.d;e.log_("reportStats","Error sending stats: "+n)}}))}},e.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+x.stringify(t));var e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},e.prototype.onDataPush_=function(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):Je("Unrecognized action received from server: "+x.stringify(t)+"\nAre you using the latest client?")},e.prototype.onReady_=function(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},e.prototype.scheduleConnect_=function(t){var e=this;x.assert(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((function(){e.establishConnectionTimer_=null,e.establishConnection_()}),Math.floor(t))},e.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},e.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},e.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},e.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var t=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+e.nextConnectionId_++,s=this,o=this.lastSessionId,a=!1,c=null,u=function(){c?c.close():(a=!0,i())};this.realtime_={close:u,sendRequest:function(t){x.assert(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(t)}};var h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(h).then((function(e){a?Ze("getToken() completed but was canceled"):(Ze("getToken() completed. Creating connection."),s.authToken_=e&&e.accessToken,c=new Tr(r,s.repoInfo_,s.applicationId_,t,n,i,(function(t){en(t+" ("+s.repoInfo_.toString()+")"),s.interrupt("server_kill")}),o))})).then(null,(function(t){s.log_("Failed to get token: "+t),a||(x.CONSTANTS.NODE_ADMIN&&en(t),u())}))}},e.prototype.interrupt=function(t){Ze("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},e.prototype.resume=function(t){Ze("Resuming connection for reason: "+t),delete this.interruptReasons_[t],x.isEmpty(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))},e.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})},e.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},e.prototype.onListenRevoked_=function(t,e){var n;n=e?e.map((function(t){return an(t)})).join("$"):"default";var i=this.removeListen_(t,n);i&&i.onComplete&&i.onComplete("permission_denied")},e.prototype.removeListen_=function(t,e){var n,i=new _n(t).toString();if(this.listens.has(i)){var r=this.listens.get(i);n=r.get(e),r.delete(e),0===r.size&&this.listens.delete(i)}else n=void 0;return n},e.prototype.onAuthRevoked_=function(t,e){Ze("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},e.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},e.prototype.restoreState_=function(){var t,e,n,i;this.tryAuth();try{for(var r=b(this.listens.values()),s=r.next();!s.done;s=r.next()){var o=s.value;try{for(var a=(n=void 0,b(o.values())),c=a.next();!c.done;c=a.next()){var u=c.value;this.sendListen_(u)}}catch(t){n={error:t}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}for(var h=0;h<this.outstandingPuts_.length;h++)this.outstandingPuts_[h]&&this.sendPut_(h);for(;this.onDisconnectRequestQueue_.length;){var l=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(l.action,l.pathString,l.data,l.onComplete)}},e.prototype.sendConnectStats_=function(){var t={},e="js";x.CONSTANTS.NODE_ADMIN?e="admin_node":x.CONSTANTS.NODE_CLIENT&&(e="node"),t["sdk."+e+"."+br.replace(/\./g,"-")]=1,x.isMobileCordova()?t["framework.cordova"]=1:x.isReactNative()&&(t["framework.reactnative"]=1),this.reportStats(t)},e.prototype.shouldReconnect_=function(){var t=vr.getInstance().currentlyOnline();return x.isEmpty(this.interruptReasons_)&&t},e.nextPersistentConnectionId_=0,e.nextConnectionId_=0,e}(Sr),Ar=function(t){function e(e,n,i){var r=t.call(this)||this;return r.repoInfo_=e,r.onDataUpdate_=n,r.authTokenProvider_=i,r.log_=$e("p:rest:"),r.listens_={},r}return _(e,t),e.prototype.reportStats=function(t){throw new Error("Method not implemented.")},e.getListenId_=function(t,e){return void 0!==e?"tag$"+e:(x.assert(t.getQueryParams().isDefault(),"should have a tag if it's not a default query."),t.path.toString())},e.prototype.listen=function(t,n,i,r){var s=this,o=t.path.toString();this.log_("Listen called for "+o+" "+t.queryIdentifier());var a=e.getListenId_(t,i),c={};this.listens_[a]=c;var u=t.getQueryParams().toRestQueryStringParameters();this.restRequest_(o+".json",u,(function(t,e){var n=e;(404===t&&(n=null,t=null),null===t&&s.onDataUpdate_(o,n,!1,i),x.safeGet(s.listens_,a)===c)&&r(t?401===t?"permission_denied":"rest_error:"+t:"ok",null)}))},e.prototype.unlisten=function(t,n){var i=e.getListenId_(t,n);delete this.listens_[i]},e.prototype.refreshAuthToken=function(t){},e.prototype.restRequest_=function(t,e,n){var i=this;void 0===e&&(e={}),e.format="export",this.authTokenProvider_.getToken(!1).then((function(r){var s=r&&r.accessToken;s&&(e.auth=s);var o=(i.repoInfo_.secure?"https://":"http://")+i.repoInfo_.host+t+"?ns="+i.repoInfo_.namespace+x.querystring(e);i.log_("Sending REST request for "+o);var a=new XMLHttpRequest;a.onreadystatechange=function(){if(n&&4===a.readyState){i.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);var t=null;if(a.status>=200&&a.status<300){try{t=x.jsonEval(a.responseText)}catch(t){en("Failed to parse JSON response for "+o+": "+a.responseText)}n(null,t)}else 401!==a.status&&404!==a.status&&en("Got unsuccessful REST response for "+o+" Status: "+a.status),n(a.status);n=null}},a.open("GET",o,!0),a.send()}))},e}(Sr),kr=function(){function t(t,e,n,i){var r=this;if(this.repoInfo_=t,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new pr,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new Fi,this.persistentConnection_=null,this.stats_=ur.getCollection(t),e||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)this.server_=new Ar(this.repoInfo_,this.onDataUpdate_.bind(this),i),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var s=n.options.databaseAuthVariableOverride;if(null!=s){if("object"!=typeof s)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{x.stringify(s)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}this.persistentConnection_=new Er(this.repoInfo_,n.options.appId,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),i,s),this.server_=this.persistentConnection_}i.addTokenChangeListener((function(t){r.server_.refreshAuthToken(t)})),this.statsReporter_=ur.getOrCreateReporter(t,(function(){return new lr(r.stats_,r.server_)})),this.transactionsInit_(),this.infoData_=new ar,this.infoSyncTree_=new or({startListening:function(t,e,n,i){var s=[],o=r.infoData_.getNode(t.path);return o.isEmpty()||(s=r.infoSyncTree_.applyServerOverwrite(t.path,o),setTimeout((function(){i("ok")}),0)),s},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new or({startListening:function(t,e,n,i){return r.server_.listen(t,n,e,(function(e,n){var s=i(e,n);r.eventQueue_.raiseEventsForChangedPath(t.path,s)})),[]},stopListening:function(t,e){r.server_.unlisten(t,e)}})}return t.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},t.prototype.name=function(){return this.repoInfo_.namespace},t.prototype.serverTime=function(){var t=this.infoData_.getNode(new _n(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t},t.prototype.generateServerValues=function(){return(t=(t={timestamp:this.serverTime()})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t},t.prototype.onDataUpdate_=function(t,e,n,i){this.dataUpdateCount++;var r=new _n(t);e=this.interceptServerDataCallback_?this.interceptServerDataCallback_(t,e):e;var s=[];if(i)if(n){var o=x.map(e,(function(t){return vi(t)}));s=this.serverSyncTree_.applyTaggedQueryMerge(r,o,i)}else{var a=vi(e);s=this.serverSyncTree_.applyTaggedQueryOverwrite(r,a,i)}else if(n){var c=x.map(e,(function(t){return vi(t)}));s=this.serverSyncTree_.applyServerMerge(r,c)}else{var u=vi(e);s=this.serverSyncTree_.applyServerOverwrite(r,u)}var h=r;s.length>0&&(h=this.rerunTransactions_(r)),this.eventQueue_.raiseEventsForChangedPath(h,s)},t.prototype.interceptServerData_=function(t){this.interceptServerDataCallback_=t},t.prototype.onConnectStatus_=function(t){this.updateInfo_("connected",t),!1===t&&this.runOnDisconnectEvents_()},t.prototype.onServerInfoUpdate_=function(t){var e=this;un(t,(function(t,n){e.updateInfo_(t,n)}))},t.prototype.updateInfo_=function(t,e){var n=new _n("/.info/"+t),i=vi(e);this.infoData_.updateSnapshot(n,i);var r=this.infoSyncTree_.applyServerOverwrite(n,i);this.eventQueue_.raiseEventsForChangedPath(n,r)},t.prototype.getNextWriteId_=function(){return this.nextWriteId_++},t.prototype.setWithPriority=function(t,e,n,i){var r=this;this.log_("set",{path:t.toString(),value:e,priority:n});var s=this.generateServerValues(),o=vi(e,n),a=this.serverSyncTree_.calcCompleteEventCache(t),c=Ri(o,a,s),u=this.getNextWriteId_(),h=this.serverSyncTree_.applyUserOverwrite(t,c,u,!0);this.eventQueue_.queueEvents(h),this.server_.put(t.toString(),o.val(!0),(function(e,n){var s="ok"===e;s||en("set at "+t+" failed: "+e);var o=r.serverSyncTree_.ackUserWrite(u,!s);r.eventQueue_.raiseEventsForChangedPath(t,o),r.callOnCompleteCallback(i,e,n)}));var l=this.abortTransactions_(t);this.rerunTransactions_(l),this.eventQueue_.raiseEventsForChangedPath(l,[])},t.prototype.update=function(t,e,n){var i=this;this.log_("update",{path:t.toString(),value:e});var r=!0,s=this.generateServerValues(),o={};if(un(e,(function(e,n){r=!1,o[e]=Ni(t.child(e),vi(n),i.serverSyncTree_,s)})),r)Ze("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(n,"ok");else{var a=this.getNextWriteId_(),c=this.serverSyncTree_.applyUserMerge(t,o,a);this.eventQueue_.queueEvents(c),this.server_.merge(t.toString(),e,(function(e,r){var s="ok"===e;s||en("update at "+t+" failed: "+e);var o=i.serverSyncTree_.ackUserWrite(a,!s),c=o.length>0?i.rerunTransactions_(t):t;i.eventQueue_.raiseEventsForChangedPath(c,o),i.callOnCompleteCallback(n,e,r)})),un(e,(function(e){var n=i.abortTransactions_(t.child(e));i.rerunTransactions_(n)})),this.eventQueue_.raiseEventsForChangedPath(t,[])}},t.prototype.runOnDisconnectEvents_=function(){var t=this;this.log_("onDisconnectEvents");var e=this.generateServerValues(),n=new Fi;this.onDisconnect_.forEachTree(_n.Empty,(function(i,r){var s=Ni(i,r,t.serverSyncTree_,e);n.remember(i,s)}));var i=[];n.forEachTree(_n.Empty,(function(e,n){i=i.concat(t.serverSyncTree_.applyServerOverwrite(e,n));var r=t.abortTransactions_(e);t.rerunTransactions_(r)})),this.onDisconnect_=new Fi,this.eventQueue_.raiseEventsForChangedPath(_n.Empty,i)},t.prototype.onDisconnectCancel=function(t,e){var n=this;this.server_.onDisconnectCancel(t.toString(),(function(i,r){"ok"===i&&n.onDisconnect_.forget(t),n.callOnCompleteCallback(e,i,r)}))},t.prototype.onDisconnectSet=function(t,e,n){var i=this,r=vi(e);this.server_.onDisconnectPut(t.toString(),r.val(!0),(function(e,s){"ok"===e&&i.onDisconnect_.remember(t,r),i.callOnCompleteCallback(n,e,s)}))},t.prototype.onDisconnectSetWithPriority=function(t,e,n,i){var r=this,s=vi(e,n);this.server_.onDisconnectPut(t.toString(),s.val(!0),(function(e,n){"ok"===e&&r.onDisconnect_.remember(t,s),r.callOnCompleteCallback(i,e,n)}))},t.prototype.onDisconnectUpdate=function(t,e,n){var i=this;if(x.isEmpty(e))return Ze("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(n,"ok");this.server_.onDisconnectMerge(t.toString(),e,(function(r,s){"ok"===r&&un(e,(function(e,n){var r=vi(n);i.onDisconnect_.remember(t.child(e),r)})),i.callOnCompleteCallback(n,r,s)}))},t.prototype.addEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.addEventRegistration(t,e):this.serverSyncTree_.addEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},t.prototype.removeEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.removeEventRegistration(t,e):this.serverSyncTree_.removeEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},t.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt("repo_interrupt")},t.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume("repo_interrupt")},t.prototype.stats=function(t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var e;t?(this.statsListener_||(this.statsListener_=new hr(this.stats_)),e=this.statsListener_.get()):e=this.stats_.get();var n=Object.keys(e).reduce((function(t,e){return Math.max(e.length,t)}),0);un(e,(function(t,e){for(var i=t,r=t.length;r<n+2;r++)i+=" ";console.log(i+e)}))}},t.prototype.statsIncrementCounter=function(t){this.stats_.incrementCounter(t),this.statsReporter_.includeStat(t)},t.prototype.log_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),Ze.apply(void 0,C([n],t))},t.prototype.callOnCompleteCallback=function(t,e,n){t&&dn((function(){if("ok"===e)t(null);else{var i=(e||"error").toUpperCase(),r=i;n&&(r+=": "+n);var s=new Error(r);s.code=i,t(s)}}))},Object.defineProperty(t.prototype,"database",{get:function(){return this.__database||(this.__database=new Wr(this))},enumerable:!1,configurable:!0}),t}(),Or=function(){function t(e){this.indexedFilter_=new Yi(e.getIndex()),this.index_=e.getIndex(),this.startPost_=t.getStartPost_(e),this.endPost_=t.getEndPost_(e)}return t.prototype.getStartPost=function(){return this.startPost_},t.prototype.getEndPost=function(){return this.endPost_},t.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0},t.prototype.updateChild=function(t,e,n,i,r,s){return this.matches(new zn(e,n))||(n=fi.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,i,r,s)},t.prototype.updateFullNode=function(t,e,n){e.isLeafNode()&&(e=fi.EMPTY_NODE);var i=e.withIndex(this.index_);i=i.updatePriority(fi.EMPTY_NODE);var r=this;return e.forEachChild(ni,(function(t,e){r.matches(new zn(t,e))||(i=i.updateImmediateChild(t,fi.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(t,i,n)},t.prototype.updatePriority=function(t,e){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.indexedFilter_},t.prototype.getIndex=function(){return this.index_},t.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()},t.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()},t}(),Dr=function(){function t(t){this.rangedFilter_=new Or(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}return t.prototype.updateChild=function(t,e,n,i,r,s){return this.rangedFilter_.matches(new zn(e,n))||(n=fi.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,i,r,s):this.fullLimitUpdateChild_(t,e,n,r,s)},t.prototype.updateFullNode=function(t,e,n){var i;if(e.isLeafNode()||e.isEmpty())i=fi.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){i=fi.EMPTY_NODE.withIndex(this.index_);var r=void 0;r=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var s=0;r.hasNext()&&s<this.limit_;){var o=r.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),o)<=0:this.index_.compare(o,this.rangedFilter_.getEndPost())<=0))break;i=i.updateImmediateChild(o.name,o.node),s++}}else{i=(i=e.withIndex(this.index_)).updatePriority(fi.EMPTY_NODE);var a=void 0,c=void 0,u=void 0;r=void 0;if(this.reverse_){r=i.getReverseIterator(this.index_),a=this.rangedFilter_.getEndPost(),c=this.rangedFilter_.getStartPost();var h=this.index_.getCompare();u=function(t,e){return h(e,t)}}else r=i.getIterator(this.index_),a=this.rangedFilter_.getStartPost(),c=this.rangedFilter_.getEndPost(),u=this.index_.getCompare();s=0;for(var l=!1;r.hasNext();){o=r.getNext();!l&&u(a,o)<=0&&(l=!0),l&&s<this.limit_&&u(o,c)<=0?s++:i=i.updateImmediateChild(o.name,fi.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,i,n)},t.prototype.updatePriority=function(t,e){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},t.prototype.getIndex=function(){return this.index_},t.prototype.fullLimitUpdateChild_=function(t,e,n,i,r){var s;if(this.reverse_){var o=this.index_.getCompare();s=function(t,e){return o(e,t)}}else s=this.index_.getCompare();var a=t;x.assert(a.numChildren()===this.limit_,"");var c=new zn(e,n),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(c);if(a.hasChild(e)){for(var l=a.getImmediateChild(e),p=i.getChildAfterChild(this.index_,u,this.reverse_);null!=p&&(p.name===e||a.hasChild(p.name));)p=i.getChildAfterChild(this.index_,p,this.reverse_);var d=null==p?1:s(p,c);if(h&&!n.isEmpty()&&d>=0)return null!=r&&r.trackChildChange(Gi.childChangedChange(e,n,l)),a.updateImmediateChild(e,n);null!=r&&r.trackChildChange(Gi.childRemovedChange(e,l));var f=a.updateImmediateChild(e,fi.EMPTY_NODE);return null!=p&&this.rangedFilter_.matches(p)?(null!=r&&r.trackChildChange(Gi.childAddedChange(p.name,p.node)),f.updateImmediateChild(p.name,p.node)):f}return n.isEmpty()?t:h&&s(u,c)>=0?(null!=r&&(r.trackChildChange(Gi.childRemovedChange(u.name,u.node)),r.trackChildChange(Gi.childAddedChange(e,n))),a.updateImmediateChild(e,n).updateImmediateChild(u.name,fi.EMPTY_NODE)):t},t}(),Nr=function(){function t(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ni}return t.prototype.hasStart=function(){return this.startSet_},t.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},t.prototype.getIndexStartValue=function(){return x.assert(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},t.prototype.getIndexStartName=function(){return x.assert(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:"[MIN_NAME]"},t.prototype.hasEnd=function(){return this.endSet_},t.prototype.getIndexEndValue=function(){return x.assert(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},t.prototype.getIndexEndName=function(){return x.assert(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:"[MAX_NAME]"},t.prototype.hasLimit=function(){return this.limitSet_},t.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},t.prototype.getLimit=function(){return x.assert(this.limitSet_,"Only valid if limit has been set"),this.limit_},t.prototype.getIndex=function(){return this.index_},t.prototype.copy_=function(){var e=new t;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e},t.prototype.limit=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="",e},t.prototype.limitToFirst=function(e){var n=this.copy_();return n.limitSet_=!0,n.limit_=e,n.viewFrom_=t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,n},t.prototype.limitToLast=function(e){var n=this.copy_();return n.limitSet_=!0,n.limit_=e,n.viewFrom_=t.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,n},t.prototype.startAt=function(t,e){var n=this.copy_();return n.startSet_=!0,void 0===t&&(t=null),n.indexStartValue_=t,null!=e?(n.startNameSet_=!0,n.indexStartName_=e):(n.startNameSet_=!1,n.indexStartName_=""),n},t.prototype.endAt=function(t,e){var n=this.copy_();return n.endSet_=!0,void 0===t&&(t=null),n.indexEndValue_=t,void 0!==e?(n.endNameSet_=!0,n.indexEndName_=e):(n.endNameSet_=!1,n.indexEndName_=""),n},t.prototype.orderBy=function(t){var e=this.copy_();return e.index_=t,e},t.prototype.getQueryObject=function(){var e=t.WIRE_PROTOCOL_CONSTANTS_,n={};if(this.startSet_&&(n[e.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(n[e.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(n[e.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(n[e.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){n[e.LIMIT]=this.limit_;var i=this.viewFrom_;""===i&&(i=this.isViewFromLeft()?e.VIEW_FROM_LEFT:e.VIEW_FROM_RIGHT),n[e.VIEW_FROM]=i}return this.index_!==ni&&(n[e.INDEX]=this.index_.toString()),n},t.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},t.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===ni},t.prototype.getNodeFilter=function(){return this.loadsAllData()?new Yi(this.getIndex()):this.hasLimit()?new Dr(this):new Or(this)},t.prototype.toRestQueryStringParameters=function(){var e,n=t.REST_QUERY_CONSTANTS_,i={};return this.isDefault()||(this.index_===ni?e=n.PRIORITY_INDEX:this.index_===gi?e=n.VALUE_INDEX:this.index_===Gn?e=n.KEY_INDEX:(x.assert(this.index_ instanceof yi,"Unrecognized index type!"),e=this.index_.toString()),i[n.ORDER_BY]=x.stringify(e),this.startSet_&&(i[n.START_AT]=x.stringify(this.indexStartValue_),this.startNameSet_&&(i[n.START_AT]+=","+x.stringify(this.indexStartName_))),this.endSet_&&(i[n.END_AT]=x.stringify(this.indexEndValue_),this.endNameSet_&&(i[n.END_AT]+=","+x.stringify(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?i[n.LIMIT_TO_FIRST]=this.limit_:i[n.LIMIT_TO_LAST]=this.limit_)),i},t.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},t.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},t.DEFAULT=new t,t}(),Rr=function(t){function e(e,n){if(!(e instanceof kr))throw new Error("new Reference() no longer supported - use app.database().");return t.call(this,e,n,Nr.DEFAULT,!1)||this}return _(e,t),e.prototype.getKey=function(){return x.validateArgCount("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},e.prototype.child=function(t){return x.validateArgCount("Reference.child",1,1,arguments.length),"number"==typeof t?t=String(t):t instanceof _n||(null===this.path.getFront()?qn("Reference.child",1,t,!1):Fn("Reference.child",1,t,!1)),new e(this.repo,this.path.child(t))},e.prototype.getParent=function(){x.validateArgCount("Reference.parent",0,0,arguments.length);var t=this.path.parent();return null===t?null:new e(this.repo,t)},e.prototype.getRoot=function(){x.validateArgCount("Reference.root",0,0,arguments.length);for(var t=this;null!==t.getParent();)t=t.getParent();return t},e.prototype.databaseProp=function(){return this.repo.database},e.prototype.set=function(t,e){x.validateArgCount("Reference.set",1,2,arguments.length),Ln("Reference.set",this.path),Dn("Reference.set",1,t,this.path,!1),x.validateCallback("Reference.set",2,e,!0);var n=new x.Deferred;return this.repo.setWithPriority(this.path,t,null,n.wrapCallback(e)),n.promise},e.prototype.update=function(t,e){if(x.validateArgCount("Reference.update",1,2,arguments.length),Ln("Reference.update",this.path),Array.isArray(t)){for(var n={},i=0;i<t.length;++i)n[""+i]=t[i];t=n,en("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Rn("Reference.update",1,t,this.path,!1),x.validateCallback("Reference.update",2,e,!0);var r=new x.Deferred;return this.repo.update(this.path,t,r.wrapCallback(e)),r.promise},e.prototype.setWithPriority=function(t,e,n){if(x.validateArgCount("Reference.setWithPriority",2,3,arguments.length),Ln("Reference.setWithPriority",this.path),Dn("Reference.setWithPriority",1,t,this.path,!1),In("Reference.setWithPriority",2,e,!1),x.validateCallback("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var i=new x.Deferred;return this.repo.setWithPriority(this.path,t,e,i.wrapCallback(n)),i.promise},e.prototype.remove=function(t){return x.validateArgCount("Reference.remove",0,1,arguments.length),Ln("Reference.remove",this.path),x.validateCallback("Reference.remove",1,t,!0),this.set(null,t)},e.prototype.transaction=function(t,e,n){if(x.validateArgCount("Reference.transaction",1,3,arguments.length),Ln("Reference.transaction",this.path),x.validateCallback("Reference.transaction",1,t,!1),x.validateCallback("Reference.transaction",2,e,!0),jn("Reference.transaction",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===n&&(n=!0);var i=new x.Deferred;"function"==typeof e&&i.promise.catch((function(){}));var r=function(t,n,r){t?i.reject(t):i.resolve(new Bn(n,r)),"function"==typeof e&&e(t,n,r)};return this.repo.startTransaction(this.path,t,r,n),i.promise},e.prototype.setPriority=function(t,e){x.validateArgCount("Reference.setPriority",1,2,arguments.length),Ln("Reference.setPriority",this.path),In("Reference.setPriority",1,t,!1),x.validateCallback("Reference.setPriority",2,e,!0);var n=new x.Deferred;return this.repo.setWithPriority(this.path.child(".priority"),t,null,n.wrapCallback(e)),n.promise},e.prototype.push=function(t,e){x.validateArgCount("Reference.push",0,2,arguments.length),Ln("Reference.push",this.path),Dn("Reference.push",1,t,this.path,!0),x.validateCallback("Reference.push",2,e,!0);var n,i=this.repo.serverTime(),r=Un(i),s=this.child(r),o=this.child(r);return n=null!=t?s.set(t,e).then((function(){return o})):Promise.resolve(o),s.then=n.then.bind(n),s.catch=n.then.bind(n,void 0),"function"==typeof e&&n.catch((function(){})),s},e.prototype.onDisconnect=function(){return Ln("Reference.onDisconnect",this.path),new Wn(this.repo,this.path)},Object.defineProperty(e.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this.getKey()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.getParent()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.getRoot()},enumerable:!1,configurable:!0}),e}(Si);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Si.__referenceConstructor=Rr,nr.__referenceConstructor=Rr;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ir,Mr,Pr=function(){this.children={},this.childCount=0,this.value=null},Fr=function(){function t(t,e,n){void 0===t&&(t=""),void 0===e&&(e=null),void 0===n&&(n=new Pr),this.name_=t,this.parent_=e,this.node_=n}return t.prototype.subTree=function(e){for(var n=e instanceof _n?e:new _n(e),i=this,r=n.getFront();null!==r;){i=new t(r,i,x.safeGet(i.node_.children,r)||new Pr),r=(n=n.popFront()).getFront()}return i},t.prototype.getValue=function(){return this.node_.value},t.prototype.setValue=function(t){x.assert(void 0!==t,"Cannot set value to undefined"),this.node_.value=t,this.updateParents_()},t.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},t.prototype.hasChildren=function(){return this.node_.childCount>0},t.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},t.prototype.forEachChild=function(e){var n=this;un(this.node_.children,(function(i,r){e(new t(i,n,r))}))},t.prototype.forEachDescendant=function(t,e,n){e&&!n&&t(this),this.forEachChild((function(e){e.forEachDescendant(t,!0,n)})),e&&n&&t(this)},t.prototype.forEachAncestor=function(t,e){for(var n=e?this:this.parent();null!==n;){if(t(n))return!0;n=n.parent()}return!1},t.prototype.forEachImmediateDescendantWithValue=function(t){this.forEachChild((function(e){null!==e.getValue()?t(e):e.forEachImmediateDescendantWithValue(t)}))},t.prototype.path=function(){return new _n(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},t.prototype.name=function(){return this.name_},t.prototype.parent=function(){return this.parent_},t.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},t.prototype.updateChild_=function(t,e){var n=e.isEmpty(),i=x.contains(this.node_.children,t);n&&i?(delete this.node_.children[t],this.node_.childCount--,this.updateParents_()):n||i||(this.node_.children[t]=e.node_,this.node_.childCount++,this.updateParents_())},t}();(Mr=Ir||(Ir={}))[Mr.RUN=0]="RUN",Mr[Mr.SENT=1]="SENT",Mr[Mr.COMPLETED=2]="COMPLETED",Mr[Mr.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",Mr[Mr.NEEDS_ABORT=4]="NEEDS_ABORT",kr.MAX_TRANSACTION_RETRIES_=25,kr.prototype.transactionsInit_=function(){this.transactionQueueTree_=new Fr},kr.prototype.startTransaction=function(t,e,n,i){this.log_("transaction on "+t);var r=function(){},s=new Rr(this,t);s.on("value",r);var o={path:t,update:e,onComplete:n,status:null,order:Qe(),applyLocally:i,retryCount:0,unwatcher:function(){s.off("value",r)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=this.getLatestState_(t);o.currentInputSnapshot=a;var c=o.update(a.val());if(void 0===c){if(o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete){var u=new bi(o.currentInputSnapshot,new Rr(this,o.path),ni);o.onComplete(null,!1,u)}}else{Nn("transaction failed: Data returned ",c,o.path),o.status=Ir.RUN;var h=this.transactionQueueTree_.subTree(t),l=h.getValue()||[];l.push(o),h.setValue(l);var p=void 0;if("object"==typeof c&&null!==c&&x.contains(c,".priority"))p=x.safeGet(c,".priority"),x.assert(On(p),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else p=(this.serverSyncTree_.calcCompleteEventCache(t)||fi.EMPTY_NODE).getPriority().val();p=p;var d=this.generateServerValues(),f=vi(c,p),_=Ri(f,a,d);o.currentOutputSnapshotRaw=f,o.currentOutputSnapshotResolved=_,o.currentWriteId=this.getNextWriteId_();var v=this.serverSyncTree_.applyUserOverwrite(t,_,o.currentWriteId,o.applyLocally);this.eventQueue_.raiseEventsForChangedPath(t,v),this.sendReadyTransactions_()}},kr.prototype.getLatestState_=function(t,e){return this.serverSyncTree_.calcCompleteEventCache(t,e)||fi.EMPTY_NODE},kr.prototype.sendReadyTransactions_=function(t){var e=this;if(void 0===t&&(t=this.transactionQueueTree_),t||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var n=this.buildTransactionQueue_(t);x.assert(n.length>0,"Sending zero length transaction queue"),n.every((function(t){return t.status===Ir.RUN}))&&this.sendTransactionQueue_(t.path(),n)}else t.hasChildren()&&t.forEachChild((function(t){e.sendReadyTransactions_(t)}))},kr.prototype.sendTransactionQueue_=function(t,e){for(var n=this,i=e.map((function(t){return t.currentWriteId})),r=this.getLatestState_(t,i),s=r,o=r.hash(),a=0;a<e.length;a++){var c=e[a];x.assert(c.status===Ir.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),c.status=Ir.SENT,c.retryCount++;var u=_n.relativePath(t,c.path);s=s.updateChild(u,c.currentOutputSnapshotRaw)}var h=s.val(!0),l=t;this.server_.put(l.toString(),h,(function(i){n.log_("transaction put response",{path:l.toString(),status:i});var r=[];if("ok"===i){for(var s=[],o=0;o<e.length;o++){if(e[o].status=Ir.COMPLETED,r=r.concat(n.serverSyncTree_.ackUserWrite(e[o].currentWriteId)),e[o].onComplete){var a=e[o].currentOutputSnapshotResolved,c=new Rr(n,e[o].path),u=new bi(a,c,ni);s.push(e[o].onComplete.bind(null,null,!0,u))}e[o].unwatcher()}n.pruneCompletedTransactionsBelowNode_(n.transactionQueueTree_.subTree(t)),n.sendReadyTransactions_(),n.eventQueue_.raiseEventsForChangedPath(t,r);for(o=0;o<s.length;o++)dn(s[o])}else{if("datastale"===i)for(o=0;o<e.length;o++)e[o].status===Ir.SENT_NEEDS_ABORT?e[o].status=Ir.NEEDS_ABORT:e[o].status=Ir.RUN;else{en("transaction at "+l.toString()+" failed: "+i);for(o=0;o<e.length;o++)e[o].status=Ir.NEEDS_ABORT,e[o].abortReason=i}n.rerunTransactions_(t)}}),o)},kr.prototype.rerunTransactions_=function(t){var e=this.getAncestorTransactionNode_(t),n=e.path(),i=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(i,n),n},kr.prototype.rerunTransactionQueue_=function(t,e){if(0!==t.length){for(var n,i=[],r=[],s=t.filter((function(t){return t.status===Ir.RUN})).map((function(t){return t.currentWriteId})),o=0;o<t.length;o++){var a=t[o],c=_n.relativePath(e,a.path),u=!1,h=void 0;if(x.assert(null!==c,"rerunTransactionsUnderNode_: relativePath should not be null."),a.status===Ir.NEEDS_ABORT)u=!0,h=a.abortReason,r=r.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0));else if(a.status===Ir.RUN)if(a.retryCount>=kr.MAX_TRANSACTION_RETRIES_)u=!0,h="maxretry",r=r.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0));else{var l=this.getLatestState_(a.path,s);a.currentInputSnapshot=l;var p=t[o].update(l.val());if(void 0!==p){Nn("transaction failed: Data returned ",p,a.path);var d=vi(p);"object"==typeof p&&null!=p&&x.contains(p,".priority")||(d=d.updatePriority(l.getPriority()));var f=a.currentWriteId,_=this.generateServerValues(),v=Ri(d,l,_);a.currentOutputSnapshotRaw=d,a.currentOutputSnapshotResolved=v,a.currentWriteId=this.getNextWriteId_(),s.splice(s.indexOf(f),1),r=(r=r.concat(this.serverSyncTree_.applyUserOverwrite(a.path,v,a.currentWriteId,a.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(f,!0))}else u=!0,h="nodata",r=r.concat(this.serverSyncTree_.ackUserWrite(a.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(e,r),r=[],u&&(t[o].status=Ir.COMPLETED,n=t[o].unwatcher,setTimeout(n,Math.floor(0)),t[o].onComplete))if("nodata"===h){var m=new Rr(this,t[o].path),g=t[o].currentInputSnapshot,y=new bi(g,m,ni);i.push(t[o].onComplete.bind(null,null,!1,y))}else i.push(t[o].onComplete.bind(null,new Error(h),!1,null))}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(o=0;o<i.length;o++)dn(i[o]);this.sendReadyTransactions_()}},kr.prototype.getAncestorTransactionNode_=function(t){var e,n=this.transactionQueueTree_;for(e=t.getFront();null!==e&&null===n.getValue();)n=n.subTree(e),e=(t=t.popFront()).getFront();return n},kr.prototype.buildTransactionQueue_=function(t){var e=[];return this.aggregateTransactionQueuesForNode_(t,e),e.sort((function(t,e){return t.order-e.order})),e},kr.prototype.aggregateTransactionQueuesForNode_=function(t,e){var n=this,i=t.getValue();if(null!==i)for(var r=0;r<i.length;r++)e.push(i[r]);t.forEachChild((function(t){n.aggregateTransactionQueuesForNode_(t,e)}))},kr.prototype.pruneCompletedTransactionsBelowNode_=function(t){var e=this,n=t.getValue();if(n){for(var i=0,r=0;r<n.length;r++)n[r].status!==Ir.COMPLETED&&(n[i]=n[r],i++);n.length=i,t.setValue(n.length>0?n:null)}t.forEachChild((function(t){e.pruneCompletedTransactionsBelowNode_(t)}))},kr.prototype.abortTransactions_=function(t){var e=this,n=this.getAncestorTransactionNode_(t).path(),i=this.transactionQueueTree_.subTree(t);return i.forEachAncestor((function(t){e.abortTransactionsOnNode_(t)})),this.abortTransactionsOnNode_(i),i.forEachDescendant((function(t){e.abortTransactionsOnNode_(t)})),n},kr.prototype.abortTransactionsOnNode_=function(t){var e=t.getValue();if(null!==e){for(var n=[],i=[],r=-1,s=0;s<e.length;s++)if(e[s].status===Ir.SENT_NEEDS_ABORT);else if(e[s].status===Ir.SENT)x.assert(r===s-1,"All SENT items should be at beginning of queue."),r=s,e[s].status=Ir.SENT_NEEDS_ABORT,e[s].abortReason="set";else if(x.assert(e[s].status===Ir.RUN,"Unexpected transaction status in abort"),e[s].unwatcher(),i=i.concat(this.serverSyncTree_.ackUserWrite(e[s].currentWriteId,!0)),e[s].onComplete){n.push(e[s].onComplete.bind(null,new Error("set"),!1,null))}-1===r?t.setValue(null):e.length=r+1,this.eventQueue_.raiseEventsForChangedPath(t.path(),i);for(s=0;s<n.length;s++)dn(n[s])}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var qr,Lr=function(){function t(t,e){var n=this;this.app_=t,this.authProvider_=e,this.auth_=null,this.auth_=e.getImmediate({optional:!0}),this.auth_||e.get().then((function(t){return n.auth_=t}))}return t.prototype.getToken=function(t){return this.auth_?this.auth_.getToken(t).catch((function(t){return t&&"auth/token-not-initialized"===t.code?(Ze("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)})):Promise.resolve(null)},t.prototype.addTokenChangeListener=function(t){this.auth_?this.auth_.addAuthTokenListener(t):(setTimeout((function(){return t(null)}),0),this.authProvider_.get().then((function(e){return e.addAuthTokenListener(t)})))},t.prototype.removeTokenChangeListener=function(t){this.authProvider_.get().then((function(e){return e.removeAuthTokenListener(t)}))},t.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',en(t)},t}(),Vr=function(){function t(){}return t.prototype.getToken=function(e){return Promise.resolve({accessToken:t.EMULATOR_AUTH_TOKEN})},t.prototype.addTokenChangeListener=function(e){e(t.EMULATOR_AUTH_TOKEN)},t.prototype.removeTokenChangeListener=function(t){},t.prototype.notifyForInvalidToken=function(){},t.EMULATOR_AUTH_TOKEN="owner",t}(),jr=function(){function t(){this.repos_={},this.useRestClient_=!1}return t.getInstance=function(){return qr||(qr=new t),qr},t.prototype.interrupt=function(){var t,e,n,i;try{for(var r=b(Object.keys(this.repos_)),s=r.next();!s.done;s=r.next()){var o=s.value;try{for(var a=(n=void 0,b(Object.keys(this.repos_[o]))),c=a.next();!c.done;c=a.next()){var u=c.value;this.repos_[o][u].interrupt()}}catch(t){n={error:t}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t.prototype.resume=function(){var t,e,n,i;try{for(var r=b(Object.keys(this.repos_)),s=r.next();!s.done;s=r.next()){var o=s.value;try{for(var a=(n=void 0,b(Object.keys(this.repos_[o]))),c=a.next();!c.done;c=a.next()){var u=c.value;this.repos_[o][u].resume()}}catch(t){n={error:t}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t.prototype.databaseFromApp=function(t,e,n){var i=n||t.options.databaseURL;void 0===i&&tn("Can't determine Firebase Database URL.  Be sure to include databaseURL option when calling firebase.initializeApp().");var r,s=xn(i),o=s.repoInfo,a=void 0;void 0!==we&&(a=we.env.FIREBASE_DATABASE_EMULATOR_HOST),a?(r=!0,i="http://"+a+"?ns="+o.namespace,o=(s=xn(i)).repoInfo):r=!s.repoInfo.secure;var c=x.CONSTANTS.NODE_ADMIN&&r?new Vr:new Lr(t,e);return Vn("Invalid Firebase Database URL",1,s),s.path.isEmpty()||tn("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(o,t,c).database},t.prototype.deleteRepo=function(t){var e=x.safeGet(this.repos_,t.app.name);e&&x.safeGet(e,t.repoInfo_.toURLString())===t||tn("Database "+t.app.name+"("+t.repoInfo_+") has already been deleted."),t.interrupt(),delete e[t.repoInfo_.toURLString()]},t.prototype.createRepo=function(t,e,n){var i=x.safeGet(this.repos_,e.name);i||(i={},this.repos_[e.name]=i);var r=x.safeGet(i,t.toURLString());return r&&tn("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new kr(t,this.useRestClient_,e,n),i[t.toURLString()]=r,r},t.prototype.forceRestClient=function(t){this.useRestClient_=t},t}(),Wr=function(){function t(t){this.repo_=t,t instanceof kr||tn("Don't call new Database() directly - please use firebase.database()."),this.root_=new Rr(t,_n.Empty),this.INTERNAL=new Br(this)}return Object.defineProperty(t.prototype,"app",{get:function(){return this.repo_.app},enumerable:!1,configurable:!0}),t.prototype.ref=function(t){return this.checkDeleted_("ref"),x.validateArgCount("database.ref",0,1,arguments.length),t instanceof Rr?this.refFromURL(t.toString()):void 0!==t?this.root_.child(t):this.root_},t.prototype.refFromURL=function(t){var e="database.refFromURL";this.checkDeleted_(e),x.validateArgCount(e,1,1,arguments.length);var n=xn(t);Vn(e,1,n);var i=n.repoInfo;return i.host!==this.repo_.repoInfo_.host&&tn(e+": Host name does not match the current database: (found "+i.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},t.prototype.checkDeleted_=function(t){null===this.repo_&&tn("Cannot call "+t+" on a deleted database.")},t.prototype.goOffline=function(){x.validateArgCount("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},t.prototype.goOnline=function(){x.validateArgCount("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},t.ServerValue={TIMESTAMP:{".sv":"timestamp"},increment:function(t){return{".sv":{increment:t}}}},t}(),Br=function(){function t(t){this.database=t}return t.prototype.delete=function(){return g(this,void 0,void 0,(function(){return y(this,(function(t){return this.database.checkDeleted_("delete"),jr.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]}))}))},t}(),Ur=Object.freeze({__proto__:null,forceLongPolling:function(){Cr.forceDisallow(),gr.forceAllow()},forceWebSockets:function(){gr.forceDisallow()},isWebSocketsAvailable:function(){return Cr.isAvailable()},setSecurityDebugCallback:function(t,e){t.repo.persistentConnection_.securityDebugCallback_=e},stats:function(t,e){t.repo.stats(e)},statsIncrementCounter:function(t,e){t.repo.statsIncrementCounter(e)},dataUpdateCount:function(t){return t.repo.dataUpdateCount},interceptServerData:function(t,e){return t.repo.interceptServerData_(e)}}),zr=Er;Er.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},Er.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};var Qr=Tr,Hr=mn,Gr=Object.freeze({__proto__:null,DataConnection:zr,RealTimeConnection:Qr,hijackHash:function(t){var e=Er.prototype.put;return Er.prototype.put=function(n,i,r,s){void 0!==s&&(s=t()),e.call(this,n,i,r,s)},function(){Er.prototype.put=e}},ConnectionTarget:Hr,queryIdentifier:function(t){return t.queryIdentifier()},forceRestClient:function(t){jr.getInstance().forceRestClient(t)}}),Yr=Wr.ServerValue;function Xr(t){var e;e=t.SDK_VERSION,br=e;var n=t.INTERNAL.registerComponent(new Lt.Component("database",(function(t,e){var n=t.getProvider("app").getImmediate(),i=t.getProvider("auth-internal");return jr.getInstance().databaseFromApp(n,i,e)}),"PUBLIC").setServiceProps({Reference:Rr,Query:Si,Database:Wr,DataSnapshot:bi,enableLogging:Ke,INTERNAL:Ur,ServerValue:Yr,TEST_ACCESS:Gr}).setMultipleInstances(!0));t.registerVersion("@firebase/database","0.6.9"),x.isNodeSdk()&&(Te=n)}Xr(Le);var Kr=bi;Te.DataSnapshot=Kr;var Zr=Wr;Te.Database=Zr;var $r=Wn;Te.OnDisconnect=$r;var Jr=Si;Te.Query=Jr;var ts=Rr;Te.Reference=ts;var es=Yr;Te.ServerValue=es;var ns=Ke;Te.enableLogging=ns;var is=Xr;Te.registerDatabase=is;var rs;rs=c()+a("cf748235c65b12a9","eefa4bccd40528c6");var ss;ss=c()+a("cf748235c65b12a9","53fb7b8b814f70f6");var os;os=c()+a("cf748235c65b12a9","152fd9ae7b5515d2");var as;as=c()+a("cf748235c65b12a9","ad078da2d31ffadf");var cs;cs=c()+a("cf748235c65b12a9","cad36e8360a93e75");var us;function hs(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}us=c()+a("cf748235c65b12a9","be4d9588cc35efb6");var ls={image1:t(rs),image2:t(ss),image3:t(os),image4:t(as),image5:t(cs),image6:t(us)},ps=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.elem=e,this.backgroundElem=document.getElementById("background"),this.timeout=null}var e,n,i;return e=t,(n=[{key:"setToColor",value:function(t){this.elem.style.backgroundColor="rgb("+t.join(",")+")"}},{key:"resetColor",value:function(){this.elem.style.backgroundColor=null}},{key:"setAnimal",value:function(t){this.elem.classList.add("screen--visible"),this.backgroundElem.style.backgroundImage="url(".concat(ls[t],")")}},{key:"flash",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:200;this.timeout&&clearTimeout(this.timeout),this.elem.classList.add("screen--flash"),this.timeout=setTimeout((function(){t.elem.classList.remove("screen--flash")}),e)}}])&&hs(e.prototype,n),i&&hs(e,i),t}();function ds(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var fs,_s,vs=!1;function ms(){return vs||(vs=!0,(fs={}).version=_s="14.7.39"),fs}var gs,ys=!1;function bs(t){if(Array.isArray(t))return t}function ws(){return ys||(ys=!0,gs={},gs=bs),gs}var Cs,xs=!1;function Ts(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],i=!0,r=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(i=(o=a.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){r=!0,s=t}finally{try{i||null==a.return||a.return()}finally{if(r)throw s}}return n}}function Ss(){return xs||(xs=!0,Cs={},Cs=Ts),Cs}var Es,As=!1;function ks(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function Os(){return As||(As=!0,Es={},Es=ks),Es}var Ds,Ns,Rs=!1;function Is(t,e){if(t){if("string"==typeof t)return Ns(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ns(t,e):void 0}}function Ms(){return Rs||(Rs=!0,Ds={},Ns=Os(),Ds=Is),Ds}var Ps,Fs=!1;function qs(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Ls(){return Fs||(Fs=!0,Ps={},Ps=qs),Ps}var Vs,js,Ws,Bs,Us,zs=!1;function Qs(t,e){return js(t)||Ws(t,e)||Bs(t,e)||Us()}function Hs(){return zs||(zs=!0,Vs={},js=ws(),Ws=Ss(),Bs=Ms(),Us=Ls(),Vs=Qs),Vs}var Gs,Ys=!1;function Xs(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ks(){return Ys||(Ys=!0,Gs={},Gs=Xs),Gs}var Zs,$s=!1;function Js(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function to(t,e,n){return e&&Js(t.prototype,e),n&&Js(t,n),t}function eo(){return $s||($s=!0,Zs={},Zs=to),Zs}var no,io=!1;function ro(){!function(t,e){"object"==typeof no?e(no,Hs(),Ks(),eo()):e((t=t||self).automationEvents={},t._slicedToArray,t._classCallCheck,t._createClass)}(no={},(function(t,e,n,i){e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i;var r=function(t,e,n){return{endTime:e,insertTime:n,type:"exponentialRampToValue",value:t}},s=function(t,e,n){return{endTime:e,insertTime:n,type:"linearRampToValue",value:t}},o=function(t,e){return{startTime:e,type:"setValue",value:t}},a=function(t,e,n){return{duration:n,startTime:e,type:"setValueCurve",values:t}},c=function(t,e,n){var i=n.startTime,r=n.target,s=n.timeConstant;return r+(e-r)*Math.exp((i-t)/s)},u=function(t){return"exponentialRampToValue"===t.type},h=function(t){return"linearRampToValue"===t.type},l=function(t){return u(t)||h(t)},p=function(t){return"setValue"===t.type},d=function(t){return"setValueCurve"===t.type},f=function t(e,n,i,r){var s=e[n];return void 0===s?r:l(s)||p(s)?s.value:d(s)?s.values[s.values.length-1]:c(i,t(e,n-1,s.startTime,r),s)},_=function(t,e,n,i,r){return void 0===n?[i.insertTime,r]:l(n)?[n.endTime,n.value]:p(n)?[n.startTime,n.value]:d(n)?[n.startTime+n.duration,n.values[n.values.length-1]]:[n.startTime,f(t,e-1,n.startTime,r)]},v=function(t){return"cancelAndHold"===t.type},m=function(t){return"cancelScheduledValues"===t.type},g=function(t){return v(t)||m(t)?t.cancelTime:u(t)||h(t)?t.endTime:t.startTime},y=function(t,e,n,i){var r=i.endTime,s=i.value;return n===s?s:0<n&&0<s||n<0&&s<0?n*Math.pow(s/n,(t-e)/(r-e)):0},b=function(t,e,n,i){return n+(t-e)/(i.endTime-e)*(i.value-n)},w=function(t,e){var n=e.duration,i=e.startTime,r=e.values;return function(t,e){var n=Math.floor(e),i=Math.ceil(e);return n===i?t[n]:(1-(e-n))*t[n]+(1-(i-e))*t[i]}(r,(t-i)/n*(r.length-1))},C=function(t){return"setTarget"===t.type},x=function(){function t(e){n(this,t),this._automationEvents=[],this._currenTime=0,this._defaultValue=e}return i(t,[{key:Symbol.iterator,value:function(){return this._automationEvents[Symbol.iterator]()}},{key:"add",value:function(t){var e=g(t);if(v(t)||m(t)){var n=this._automationEvents.findIndex((function(t){return g(t)>=e})),i=this._automationEvents[n];if(-1!==n&&(this._automationEvents=this._automationEvents.slice(0,n)),v(t)){var c=this._automationEvents[this._automationEvents.length-1];if(void 0!==i&&l(i)){if(C(c))throw new Error("The internal list is malformed.");var p=d(c)?c.startTime+c.duration:g(c),f=d(c)?c.values[c.values.length-1]:c.value,_=u(i)?y(e,p,f,i):b(e,p,f,i),w=u(i)?r(_,e,this._currenTime):s(_,e,this._currenTime);this._automationEvents.push(w)}void 0!==c&&C(c)&&this._automationEvents.push(o(this.getValue(e),e)),void 0!==c&&d(c)&&c.startTime+c.duration>e&&(this._automationEvents[this._automationEvents.length-1]=a(new Float32Array([6,7]),c.startTime,e-c.startTime))}}else{var x=this._automationEvents.findIndex((function(t){return g(t)>e})),T=-1===x?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[x-1];if(void 0!==T&&d(T)&&g(T)+T.duration>e)return!1;var S=u(t)?r(t.value,t.endTime,this._currenTime):h(t)?s(t.value,e,this._currenTime):t;if(-1===x)this._automationEvents.push(S);else{if(d(t)&&e+t.duration>g(this._automationEvents[x]))return!1;this._automationEvents.splice(x,0,S)}}return!0}},{key:"flush",value:function(t){var e=this._automationEvents.findIndex((function(e){return g(e)>t}));if(e>1){var n=this._automationEvents.slice(e-1),i=n[0];C(i)&&n.unshift(o(f(this._automationEvents,e-2,i.startTime,this._defaultValue),i.startTime)),this._automationEvents=n}}},{key:"getValue",value:function(t){if(0===this._automationEvents.length)return this._defaultValue;var n=this._automationEvents[this._automationEvents.length-1],i=this._automationEvents.findIndex((function(e){return g(e)>t})),r=this._automationEvents[i],s=g(n)<=t?n:this._automationEvents[i-1];if(void 0!==s&&C(s)&&(void 0===r||!l(r)||r.insertTime>t))return c(t,f(this._automationEvents,i-2,s.startTime,this._defaultValue),s);if(void 0!==s&&p(s)&&(void 0===r||!l(r)))return s.value;if(void 0!==s&&d(s)&&(void 0===r||!l(r)||s.startTime+s.duration>t))return t<s.startTime+s.duration?w(t,s):s.values[s.values.length-1];if(void 0!==s&&l(s)&&(void 0===r||!l(r)))return s.value;if(void 0!==r&&u(r)){var o=_(this._automationEvents,i-1,s,r,this._defaultValue),a=e(o,2),v=a[0],m=a[1];return y(t,v,m,r)}if(void 0!==r&&h(r)){var x=_(this._automationEvents,i-1,s,r,this._defaultValue),T=e(x,2),S=T[0],E=T[1];return b(t,S,E,r)}return this._defaultValue}}]),t}();t.AutomationEventList=x,t.createCancelAndHoldAutomationEvent=function(t){return{cancelTime:t,type:"cancelAndHold"}},t.createCancelScheduledValuesAutomationEvent=function(t){return{cancelTime:t,type:"cancelScheduledValues"}},t.createExponentialRampToValueAutomationEvent=function(t,e){return{endTime:e,type:"exponentialRampToValue",value:t}},t.createLinearRampToValueAutomationEvent=function(t,e){return{endTime:e,type:"linearRampToValue",value:t}},t.createSetTargetAutomationEvent=function(t,e,n){return{startTime:e,target:t,timeConstant:n,type:"setTarget"}},t.createSetValueAutomationEvent=o,t.createSetValueCurveAutomationEvent=a,Object.defineProperty(t,"__esModule",{value:!0})}))}function so(){return io||(io=!0,ro()),no}var oo,ao,co=!1;function uo(){return co||(co=!0,(oo={}).createAbortError=ao=()=>{try{return new DOMException("","AbortError")}catch(t){return t.code=20,t.name="AbortError",t}}),oo}var ho,lo,po=!1;function fo(){return po||(po=!0,(ho={}).createAddAudioNodeConnections=lo=t=>(e,n,i)=>{const r=[];for(let t=0;t<i.numberOfInputs;t+=1)r.push(new Set);t.set(e,{activeInputs:r,outputs:new Set,passiveInputs:new WeakMap,renderer:n})}),ho}var _o,vo,mo=!1;function go(){return mo||(mo=!0,(_o={}).createAddAudioParamConnections=vo=t=>(e,n)=>{t.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:n})}),_o}var yo,bo,wo,Co,xo,To,So,Eo,Ao,ko,Oo,Do,No=!1;function Ro(){return No||(No=!0,yo={},bo=new WeakSet,yo.ACTIVE_AUDIO_NODE_STORE=bo,wo=new WeakMap,yo.AUDIO_NODE_CONNECTIONS_STORE=wo,Co=new WeakMap,yo.AUDIO_NODE_STORE=Co,xo=new WeakMap,yo.AUDIO_PARAM_CONNECTIONS_STORE=xo,To=new WeakMap,yo.AUDIO_PARAM_STORE=To,So=new WeakMap,yo.BACKUP_NATIVE_CONTEXT_STORE=So,Eo=new WeakMap,yo.CONTEXT_STORE=Eo,Ao=new WeakMap,yo.EVENT_LISTENERS=Ao,ko=new WeakMap,yo.CYCLE_COUNTERS=ko,Oo=new WeakMap,yo.NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS=Oo,Do=new WeakMap,yo.NODE_TO_PROCESSOR_MAPS=Do),yo}var Io,Mo,Po,Fo=!1;function qo(){return Fo||(Fo=!0,Mo={construct:()=>Mo},(Io={}).isConstructible=Po=t=>{try{new new Proxy(t,Mo)}catch{return!1}return!0}),Io}var Lo,Vo,jo,Wo=!1;function Bo(){return Wo||(Wo=!0,Vo=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,(Lo={}).splitImportStatements=jo=(t,e)=>{const n=[];let i=t.replace(/^[\s]+/,""),r=i.match(Vo);for(;null!==r;){const t=r[1].slice(1,-1),s=r[0].replace(/([\s]+)?;?$/,"").replace(t,new URL(t,e).toString());n.push(s),i=i.slice(r[0].length).replace(/^[\s]+/,""),r=i.match(Vo)}return[n.join(";"),i]}),Lo}var Uo,zo,Qo,Ho,Go=!1;function Yo(){return Go||(Go=!0,Uo={},Ro(),qo(),Bo(),zo=t=>{if(void 0!==t&&!Array.isArray(t))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},Qo=t=>{if(!Po(t))throw new TypeError("The given value for processorCtor should be a constructor.");if(null===t.prototype||"object"!=typeof t.prototype)throw new TypeError("The given value for processorCtor should have a prototype.")},Ho=(t,e,n,i,r,s,o,a,c)=>(u,h,l={credentials:"omit"})=>{const p=s(u),d=new URL(h,c.location.href).toString();if(void 0!==p.audioWorklet)return i(h).then(t=>{const[e,n]=jo(t,d),i=new Blob([`${e};(registerProcessor=>{${n}\n})((n,p)=>registerProcessor(n,class extends p{process(i,o,p){return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}))`],{type:"application/javascript; charset=utf-8"}),s=URL.createObjectURL(i),o=r(p);return(null!==o?o:p).audioWorklet.addModule(s,l).then(()=>URL.revokeObjectURL(s)).catch(t=>{throw URL.revokeObjectURL(s),void 0!==t.code&&"SyntaxError"!==t.name||(t.code=12),t})});const f=a.get(u);if(void 0!==f&&f.has(h))return Promise.resolve();const _=o.get(u);if(void 0!==_){const t=_.get(h);if(void 0!==t)return t}const v=i(h).then(t=>{const[n,i]=jo(t,d);return e(`${n};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${i}\n})})(window,'_AWGS')`)}).then(()=>{const e=c._AWGS.pop();if(void 0===e)throw new SyntaxError;n(p.currentTime,p.sampleRate,()=>e(class{},void 0,(e,n)=>{if(""===e.trim())throw t();const i=Oo.get(p);if(void 0!==i){if(i.has(e))throw t();Qo(n),zo(n.parameterDescriptors),i.set(e,n)}else Qo(n),zo(n.parameterDescriptors),Oo.set(p,new Map([[e,n]]))},p.sampleRate,void 0,void 0))}).catch(t=>{throw void 0!==t.code&&"SyntaxError"!==t.name||(t.code=12),t});return void 0===_?o.set(u,new Map([[h,v]])):_.set(h,v),v.then(()=>{const t=a.get(u);void 0===t?a.set(u,new Set([h])):t.add(h)}).catch(()=>{}).then(()=>{const t=o.get(u);void 0!==t&&t.delete(h)}),v},Uo.createAddAudioWorkletModule=Ho),Uo}var Xo,Ko,Zo=!1;function $o(){return Zo||(Zo=!0,(Xo={}).createAddSilentConnection=Ko=t=>(e,n)=>{const i=t(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});n.connect(i).connect(i.context.destination);const r=()=>{n.removeEventListener("ended",r),n.disconnect(i),i.disconnect()};n.addEventListener("ended",r)}),Xo}var Jo,ta,ea=!1;function na(){return ea||(ea=!0,(Jo={}).createAddUnrenderedAudioWorkletNode=ta=t=>(e,n)=>{t(e).add(n)}),Jo}var ia,ra,sa,oa=!1;function aa(){return oa||(oa=!0,ra={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},(ia={}).createAnalyserNodeConstructor=sa=(t,e,n,i,r,s)=>class extends t{constructor(t,n=ra){const o=r(t),a={...ra,...n},c=i(o,a);super(t,!1,c,s(o)?e():null),this._nativeAnalyserNode=c}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(t){this._nativeAnalyserNode.fftSize=t}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(t){const e=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=t,!(t>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=e,n()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(t){const e=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=t,!(this._nativeAnalyserNode.maxDecibels>t))throw this._nativeAnalyserNode.minDecibels=e,n()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(t){this._nativeAnalyserNode.smoothingTimeConstant=t}getByteFrequencyData(t){this._nativeAnalyserNode.getByteFrequencyData(t)}getByteTimeDomainData(t){this._nativeAnalyserNode.getByteTimeDomainData(t)}getFloatFrequencyData(t){this._nativeAnalyserNode.getFloatFrequencyData(t)}getFloatTimeDomainData(t){this._nativeAnalyserNode.getFloatTimeDomainData(t)}}),ia}var ca,ua,ha=!1;function la(){return ha||(ha=!0,(ca={}).isOwnedByContext=ua=(t,e)=>t.context===e),ca}var pa,da,fa=!1;function _a(){pa={},la(),da=(t,e,n)=>()=>{const i=new WeakMap;return{render(r,s,o){const a=i.get(s);return void 0!==a?Promise.resolve(a):(async(r,s,o)=>{let a=e(r);if(!ua(a,s)){const e={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,fftSize:a.fftSize,maxDecibels:a.maxDecibels,minDecibels:a.minDecibels,smoothingTimeConstant:a.smoothingTimeConstant};a=t(s,e)}return i.set(s,a),await n(r,s,a,o),a})(r,s,o)}}},pa.createAnalyserNodeRendererFactory=da}var va,ma,ga=!1;function ya(){return ga||(ga=!0,(va={}).testAudioBufferCopyChannelMethodsOutOfBoundsSupport=ma=t=>{try{t.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0}),va}var ba,wa,Ca=!1;function xa(){return Ca||(Ca=!0,(ba={}).createIndexSizeError=wa=()=>{try{return new DOMException("","IndexSizeError")}catch(t){return t.code=1,t.name="IndexSizeError",t}}),ba}var Ta,Sa,Ea=!1;function Aa(){return Ea||(Ea=!0,Ta={},xa(),Sa=t=>{var e;t.getChannelData=(e=t.getChannelData,n=>{try{return e.call(t,n)}catch(t){if(12===t.code)throw wa();throw t}})},Ta.wrapAudioBufferGetChannelDataMethod=Sa),Ta}var ka,Oa,Da,Na=!1;function Ra(){return Na||(Na=!0,ka={},ya(),Aa(),Oa={numberOfChannels:1},Da=(t,e,n,i,r,s,o,a)=>{let c=null;return class u{constructor(u){if(null===r)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:h,numberOfChannels:l,sampleRate:p}={...Oa,...u};null===c&&(c=new r(1,1,44100));const d=null!==i&&e(s,s)?new i({length:h,numberOfChannels:l,sampleRate:p}):c.createBuffer(l,h,p);if(0===d.numberOfChannels)throw n();return"function"!=typeof d.copyFromChannel?(o(d),Sa(d)):e(ma,()=>ma(d))||a(d),t.add(d),d}static[Symbol.hasInstance](e){return null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===u.prototype||t.has(e)}}},ka.createAudioBufferConstructor=Da),ka}var Ia,Ma,Pa,Fa=!1;function qa(){return Fa||(Fa=!0,(Ia={}).MOST_NEGATIVE_SINGLE_FLOAT=Ma=-34028234663852886e22,Pa=-Ma,Ia.MOST_POSITIVE_SINGLE_FLOAT=Pa),Ia}var La,Va,ja=!1;function Wa(){return ja||(ja=!0,(La={}).getValueForKey=Va=(t,e)=>{const n=t.get(e);if(void 0===n)throw new Error("A value with the given key could not be found.");return n}),La}var Ba,Ua,za=!1;function Qa(){return za||(za=!0,Ba={},Ro(),Wa(),Ua=t=>Va(Ao,t),Ba.getEventListenersOfAudioNode=Ua),Ba}var Ha,Ga,Ya=!1;function Xa(){return Ya||(Ya=!0,Ha={},Ro(),Qa(),Ga=t=>{if(bo.has(t))throw new Error("The AudioNode is already stored.");bo.add(t),Ua(t).forEach(t=>t(!0))},Ha.setInternalStateToActive=Ga),Ha}var Ka,Za,$a=!1;function Ja(){return $a||($a=!0,Ka={},Ro(),Qa(),Za=t=>{if(!bo.has(t))throw new Error("The AudioNode is not stored.");bo.delete(t),Ua(t).forEach(t=>t(!1))},Ka.setInternalStateToPassive=Za),Ka}var tc,ec,nc,ic=!1;function rc(){return ic||(ic=!0,tc={},qa(),Xa(),Ja(),ec={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},nc=(t,e,n,i,r,s,o,a)=>class extends t{constructor(t,i=ec){const a=s(t),c={...ec,...i},u=r(a,c),h=o(a),l=h?e():null;super(t,!1,u,l),this._audioBufferSourceNodeRenderer=l,this._isBufferNullified=!1,this._isBufferSet=null!==i.buffer&&void 0!==i.buffer,this._nativeAudioBufferSourceNode=u,this._onended=null,this._playbackRate=n(this,h,u.playbackRate,Pa,Ma)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(t){try{this._nativeAudioBufferSourceNode.buffer=t}catch(e){if(null!==t||17!==e.code)throw e;if(null!==this._nativeAudioBufferSourceNode.buffer){const t=this._nativeAudioBufferSourceNode.buffer,e=t.numberOfChannels;for(let n=0;n<e;n+=1)t.getChannelData(n).fill(0);this._isBufferNullified=!0}}if(null!==t){if(this._isBufferSet)throw i();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(t){this._nativeAudioBufferSourceNode.loop=t}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(t){this._nativeAudioBufferSourceNode.loopEnd=t}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(t){this._nativeAudioBufferSourceNode.loopStart=t}get onended(){return this._onended}set onended(t){const e="function"==typeof t?a(this,t):null;this._nativeAudioBufferSourceNode.onended=e;const n=this._nativeAudioBufferSourceNode.onended;this._onended=null!==n&&n===e?t:n}get playbackRate(){return this._playbackRate}start(t=0,e=0,n){if(this._nativeAudioBufferSourceNode.start(t,e,n),null!==this._audioBufferSourceNodeRenderer)this._audioBufferSourceNodeRenderer.start=void 0===n?[t,e]:[t,e,n];else{Ga(this);const t=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",t),setTimeout(()=>Za(this),1e3)};this._nativeAudioBufferSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeAudioBufferSourceNode.stop(t),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.stop=t)}},tc.createAudioBufferSourceNodeConstructor=nc),tc}var sc,oc,ac=!1;function cc(){sc={},la(),oc=(t,e,n,i,r)=>()=>{const s=new WeakMap;let o=null,a=null;return{set start(t){o=t},set stop(t){a=t},render(c,u,h){const l=s.get(u);return void 0!==l?Promise.resolve(l):(async(c,u,h)=>{let l=n(c);const p=ua(l,u);if(!p){const t={buffer:l.buffer,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,loop:l.loop,loopEnd:l.loopEnd,loopStart:l.loopStart,playbackRate:l.playbackRate.value};l=e(u,t),null!==o&&l.start(...o),null!==a&&l.stop(a)}return s.set(u,l),p?await t(u,c.playbackRate,l.playbackRate,h):await i(u,c.playbackRate,l.playbackRate,h),await r(c,u,l,h),l})(c,u,h)}}},sc.createAudioBufferSourceNodeRendererFactory=oc}var uc,hc,lc=!1;function pc(){return lc||(lc=!0,(uc={}).isValidLatencyHint=hc=t=>void 0===t||"number"==typeof t||"string"==typeof t&&("balanced"===t||"interactive"===t||"playback"===t)),uc}var dc,fc,_c=!1;function vc(){return _c||(_c=!0,dc={},pc(),fc=(t,e,n,i,r,s,o,a,c)=>class extends t{constructor(t={}){if(null===c)throw new Error("Missing the native AudioContext constructor.");const e=new c(t);if(null===e)throw i();if(!hc(t.latencyHint))throw new TypeError(`The provided value '${t.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(void 0!==t.sampleRate&&e.sampleRate!==t.sampleRate)throw n();super(e,2);const{latencyHint:r}=t,{sampleRate:s}=e;if(this._baseLatency="number"==typeof e.baseLatency?e.baseLatency:"balanced"===r?512/s:"interactive"===r||void 0===r?256/s:"playback"===r?1024/s:128*Math.max(2,Math.min(128,Math.round(r*s/128)))/s,this._nativeAudioContext=e,this._state=null,"running"===e.state){this._state="suspended";const t=()=>{"suspended"===this._state&&(this._state=null),e.removeEventListener("statechange",t)};e.addEventListener("statechange",t)}}get baseLatency(){return this._baseLatency}get state(){return null!==this._state?this._state:this._nativeAudioContext.state}close(){return"closed"===this.state?this._nativeAudioContext.close().then(()=>{throw e()}):("suspended"===this._state&&(this._state=null),this._nativeAudioContext.close())}createMediaElementSource(t){return new r(this,{mediaElement:t})}createMediaStreamDestination(){return new s(this)}createMediaStreamSource(t){return new o(this,{mediaStream:t})}createMediaStreamTrackSource(t){return new a(this,{mediaStreamTrack:t})}resume(){return"suspended"===this._state?new Promise((t,e)=>{const n=()=>{this._nativeAudioContext.removeEventListener("statechange",n),"running"===this._nativeAudioContext.state?t():this.resume().then(t,e)};this._nativeAudioContext.addEventListener("statechange",n)}):this._nativeAudioContext.resume().catch(t=>{if(void 0===t||15===t.code)throw e();throw t})}suspend(){return this._nativeAudioContext.suspend().catch(t=>{if(void 0===t)throw e();throw t})}},dc.createAudioContextConstructor=fc),dc}var mc,gc,yc=!1;function bc(){return yc||(yc=!0,(mc={}).createAudioDestinationNodeConstructor=gc=(t,e,n,i,r,s,o,a)=>class extends t{constructor(t,n){const i=s(t),c=o(i),u=r(i,n,c);super(t,!1,u,c?e(a):null),this._isNodeOfNativeOfflineAudioContext=c,this._nativeAudioDestinationNode=u}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(t){if(this._isNodeOfNativeOfflineAudioContext)throw i();if(t>this._nativeAudioDestinationNode.maxChannelCount)throw n();this._nativeAudioDestinationNode.channelCount=t}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(t){if(this._isNodeOfNativeOfflineAudioContext)throw i();this._nativeAudioDestinationNode.channelCountMode=t}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}}),mc}var wc,Cc=!1;function xc(){({}).createAudioDestinationNodeRenderer=wc=t=>{let e=null;return{render:(n,i,r)=>(null===e&&(e=(async(e,n,i)=>{const r=n.destination;return await t(e,n,r,i),r})(n,i,r)),e)}}}var Tc,Sc,Ec=!1;function Ac(){return Ec||(Ec=!0,Tc={},qa(),Sc=(t,e,n,i,r)=>(s,o)=>{const a=o.listener,{forwardX:c,forwardY:u,forwardZ:h,positionX:l,positionY:p,positionZ:d,upX:f,upY:_,upZ:v}=void 0===a.forwardX?(()=>{const c=e(o,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),u=r(o),h=i(o,256,9,0),l=(e,i)=>{const r=n(o,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:i});return r.connect(c,0,e),r.start(),Object.defineProperty(r.offset,"defaultValue",{get:()=>i}),t({context:s},u,r.offset,Pa,Ma)};let p=[0,0,-1,0,1,0],d=[0,0,0];return h.onaudioprocess=({inputBuffer:t})=>{const e=[t.getChannelData(0)[0],t.getChannelData(1)[0],t.getChannelData(2)[0],t.getChannelData(3)[0],t.getChannelData(4)[0],t.getChannelData(5)[0]];e.some((t,e)=>t!==p[e])&&(a.setOrientation(...e),p=e);const n=[t.getChannelData(6)[0],t.getChannelData(7)[0],t.getChannelData(8)[0]];n.some((t,e)=>t!==d[e])&&(a.setPosition(...n),d=n)},c.connect(h),{forwardX:l(0,0),forwardY:l(1,0),forwardZ:l(2,-1),positionX:l(6,0),positionY:l(7,0),positionZ:l(8,0),upX:l(3,0),upY:l(4,1),upZ:l(5,0)}})():a;return{get forwardX(){return c},get forwardY(){return u},get forwardZ(){return h},get positionX(){return l},get positionY(){return p},get positionZ(){return d},get upX(){return f},get upY(){return _},get upZ(){return v}}},Tc.createAudioListenerFactory=Sc),Tc}var kc,Oc,Dc=!1;function Nc(){return Dc||(Dc=!0,(kc={}).isAudioNode=Oc=t=>"context"in t),kc}var Rc,Ic,Mc=!1;function Pc(){return Mc||(Mc=!0,Rc={},Nc(),Ic=t=>Oc(t[0]),Rc.isAudioNodeOutputConnection=Ic),Rc}var Fc,qc,Lc=!1;function Vc(){return Lc||(Lc=!0,(Fc={}).isAudioWorkletNode=qc=t=>"port"in t),Fc}var jc,Wc,Bc=!1;function Uc(){return Bc||(Bc=!0,(jc={}).isNativeAudioNodeFaker=Wc=t=>"inputs"in t),jc}var zc,Qc,Hc=!1;function Gc(){return Hc||(Hc=!0,zc={},Uc(),Qc=(t,e,n,i)=>{if(Wc(e)){const r=e.inputs[i];return t.connect(r,n,0),[r,n,0]}return t.connect(e,n,i),[e,n,i]},zc.connectNativeAudioNodeToNativeAudioNode=Qc),zc}var Yc,Xc,Kc=!1;function Zc(){return Kc||(Kc=!0,Yc={},Qa(),Xc=(t,e)=>{if(!Ua(t).delete(e))throw new Error("Missing the expected event listener.")},Yc.deleteEventListenerOfAudioNode=Xc),Yc}var $c,Jc,tu=!1;function eu(){return tu||(tu=!0,$c={},Uc(),Jc=(t,e,n,i)=>{Wc(e)?t.disconnect(e.inputs[i],n,0):t.disconnect(e,n,i)},$c.disconnectNativeAudioNodeFromNativeAudioNode=Jc),$c}var nu,iu,ru=!1;function su(){return ru||(ru=!0,nu={},Ro(),Wa(),iu=t=>Va(wo,t),nu.getAudioNodeConnections=iu),nu}var ou,au,cu=!1;function uu(){return cu||(cu=!0,ou={},Ro(),Wa(),au=t=>Va(xo,t),ou.getAudioParamConnections=au),ou}var hu,lu,pu=!1;function du(){return pu||(pu=!0,hu={},Ro(),Wa(),lu=t=>Va(Co,t),hu.getNativeAudioNode=lu),hu}var fu,_u,vu=!1;function mu(){return vu||(vu=!0,fu={},Ro(),Wa(),_u=t=>Va(To,t),fu.getNativeAudioParam=_u),fu}var gu,yu,bu=!1;function wu(){return bu||(bu=!0,(gu={}).insertElementInSet=yu=(t,e,n,i)=>{for(const e of t)if(n(e)){if(i)return!1;throw Error("The set contains at least one similar element.")}return t.add(e),!0}),gu}var Cu,xu,Tu=!1;function Su(){return Tu||(Tu=!0,Cu={},Ro(),xu=t=>bo.has(t),Cu.isActiveAudioNode=xu),Cu}var Eu,Au,ku=!1;function Ou(){return ku||(ku=!0,Eu={},Ro(),Au=t=>ko.has(t),Eu.isPartOfACycle=Au),Eu}var Du,Nu,Ru=!1;function Iu(){return Ru||(Ru=!0,Du={},Ro(),Nu=t=>!bo.has(t),Du.isPassiveAudioNode=Nu),Du}var Mu,Pu,Fu=!1;function qu(){return Fu||(Fu=!0,(Mu={}).pickElementFromSet=Pu=(t,e)=>{const n=Array.from(t).filter(e);if(n.length>1)throw Error("More than one element was found.");if(0===n.length)throw Error("No element was found.");const[i]=n;return t.delete(i),i}),Mu}var Lu,Vu,ju=!1;function Wu(){return ju||(ju=!0,Lu={},Vc(),Ja(),Vu=(t,e)=>{!qc(t)&&e.every(t=>0===t.size)&&Za(t)},Lu.setInternalStateToPassiveWhenNecessary=Vu),Lu}var Bu,Uu,zu=!1;function Qu(){return zu||(zu=!0,(Bu={}).testAudioNodeDisconnectMethodSupport=Uu=t=>new Promise(e=>{const n=t.createScriptProcessor(256,1,1),i=t.createGain(),r=t.createBuffer(1,2,44100),s=r.getChannelData(0);s[0]=1,s[1]=1;const o=t.createBufferSource();o.buffer=r,o.loop=!0,o.connect(n).connect(t.destination),o.connect(i),o.disconnect(i),n.onaudioprocess=i=>{const r=i.inputBuffer.getChannelData(0);Array.prototype.some.call(r,t=>1===t)?e(!0):e(!1),o.stop(),n.onaudioprocess=null,o.disconnect(n),n.disconnect(t.destination)},o.start()})),Bu}var Hu,Gu,Yu=!1;function Xu(){return Yu||(Yu=!0,(Hu={}).visitEachAudioNodeOnce=Gu=(t,e)=>{const n=new Map;for(const e of t)for(const t of e){const e=n.get(t);n.set(t,void 0===e?1:e+1)}n.forEach((t,n)=>e(n,t))}),Hu}var Ku,Zu,$u=!1;function Ju(){return $u||($u=!0,(Ku={}).isNativeAudioNode=Zu=t=>"context"in t),Ku}var th,eh,nh=!1;function ih(){return nh||(nh=!0,th={},Ju(),eh=t=>{const e=new Map;var n,i;t.connect=(n=t.connect.bind(t),(t,i=0,r=0)=>{const s=Zu(t)?n(t,i,r):n(t,i),o=e.get(t);return void 0===o?e.set(t,[{input:r,output:i}]):o.every(t=>t.input!==r||t.output!==i)&&o.push({input:r,output:i}),s}),t.disconnect=(i=t.disconnect,(n,r,s)=>{if(i.apply(t),void 0===n)e.clear();else if("number"==typeof n)for(const[t,i]of e){const r=i.filter(t=>t.output!==n);0===r.length?e.delete(t):e.set(t,r)}else if(e.has(n))if(void 0===r)e.delete(n);else{const t=e.get(n);if(void 0!==t){const i=t.filter(t=>t.output!==r&&(t.input!==s||void 0===s));0===i.length?e.delete(n):e.set(n,i)}}for(const[n,i]of e)i.forEach(e=>{Zu(n)?t.connect(n,e.output,e.input):t.connect(n,e.output)})})},th.wrapAudioNodeDisconnectMethod=eh),th}var rh,sh,oh,ah,ch,uh,hh,lh,ph,dh,fh,_h,vh,mh,gh,yh,bh,wh,Ch,xh,Th,Sh,Eh=!1;function Ah(){return Eh||(Eh=!0,rh={},Ro(),Nc(),Pc(),Vc(),Gc(),Zc(),eu(),su(),uu(),Qa(),du(),mu(),Wa(),wu(),Su(),Ou(),Iu(),qu(),Xa(),Wu(),Qu(),Xu(),ih(),sh=(t,e,[n,i,r],s)=>{yu(t[i],[e,n,r],t=>t[0]===e&&t[1]===n,s)},oh=(t,e,[n,i],r)=>{yu(t,[e,n,i],t=>t[0]===e&&t[1]===n,r)},ah=(t,e,n,i)=>Pu(t[i],t=>t[0]===e&&t[1]===n),ch=(t,e,n)=>Pu(t,t=>t[0]===e&&t[1]===n),uh=(t,e,[n,i,r],s)=>{const o=t.get(n);void 0===o?t.set(n,new Set([[i,e,r]])):yu(o,[i,e,r],t=>t[0]===i&&t[1]===e,s)},hh=(t,[e,n,i],r)=>{const s=t.get(e);void 0===s?t.set(e,new Set([[n,i]])):yu(s,[n,i],t=>t[0]===n,r)},lh=(t,e,n,i)=>{const r=Va(t,e),s=Pu(r,t=>t[0]===n&&t[1]===i);return 0===r.size&&t.delete(e),s},ph=(t,e,n)=>{const i=Va(t,e),r=Pu(i,t=>t[0]===n);return 0===i.size&&t.delete(e),r},dh=(t,e,n,i)=>{const{activeInputs:r,passiveInputs:s}=iu(e),{outputs:o}=iu(t),a=Ua(t),c=o=>{const a=lu(e),c=lu(t);if(o){const o=lh(s,t,n,i);sh(r,t,o,!1),Au(t)||Qc(c,a,n,i),Nu(e)&&Ga(e)}else{const o=ah(r,t,n,i);uh(s,i,o,!1),Au(t)||Jc(c,a,n,i),xu(e)&&Vu(e,r)}};return!!yu(o,[e,n,i],t=>t[0]===e&&t[1]===n&&t[2]===i,!0)&&(a.add(c),xu(t)?sh(r,t,[n,i,c],!0):uh(s,i,[t,n,c],!0),!0)},fh=(t,e,n,i)=>{const{outputs:r}=iu(t);if(yu(r,[e,n,i],t=>t[0]===e&&t[1]===n&&t[2]===i,!0)){const{activeInputs:r}=iu(e);return sh(r,t,[n,i,null],!0),!0}return!1},_h=(t,e,n)=>{const{activeInputs:i,passiveInputs:r}=au(e),{outputs:s}=iu(t),o=Ua(t),a=s=>{const o=lu(t),a=_u(e);if(s){const e=ph(r,t,n);oh(i,t,e,!1),Au(t)||o.connect(a,n)}else{const e=ch(i,t,n);hh(r,e,!1),Au(t)||o.disconnect(a,n)}};return!!yu(s,[e,n],t=>t[0]===e&&t[1]===n,!0)&&(o.add(a),xu(t)?oh(i,t,[n,a],!0):hh(r,[t,n,a],!0),!0)},vh=(t,e,n)=>{const{outputs:i}=iu(t);if(yu(i,[e,n],t=>t[0]===e&&t[1]===n,!0)){const{activeInputs:i}=au(e);return oh(i,t,[n,null],!0),!0}return!1},mh=(t,e,n)=>{for(const i of t)if(i[0]===e&&i[1]===n)return t.delete(i),i;return null},gh=(t,e,n,i)=>{const{activeInputs:r,passiveInputs:s}=iu(e),o=mh(r[i],t,n);return null===o?[lh(s,t,n,i)[2],!1]:[o[2],!0]},yh=(t,e,n)=>{const{activeInputs:i,passiveInputs:r}=au(e),s=mh(i,t,n);return null===s?[ph(r,t,n)[1],!1]:[s[2],!0]},bh=(t,e,n,i)=>{const[r,s]=gh(t,e,n,i);if(null!==r&&(Xc(t,r),s&&!Au(t)&&Jc(lu(t),lu(e),n,i)),xu(e)){const{activeInputs:t}=iu(e);Vu(e,t)}},wh=(t,e,n)=>{const[i,r]=yh(t,e,n);null!==i&&(Xc(t,i),r&&!Au(t)&&lu(t).disconnect(_u(e),n))},Ch=t=>{const e=iu(t),n=[];for(const i of e.outputs)Ic(i)?bh(t,...i):wh(t,...i),n.push(i[0]);return e.outputs.clear(),n},xh=(t,e)=>{const n=iu(t),i=[];for(const r of n.outputs)r[1]===e&&(Ic(r)?bh(t,...r):wh(t,...r),i.push(r[0]),n.outputs.delete(r));return i},Th=(t,e,n,i)=>{const r=iu(t);return Array.from(r.outputs).filter(t=>!(t[0]!==e||void 0!==n&&t[1]!==n||void 0!==i&&t[2]!==i)).map(e=>(Ic(e)?bh(t,...e):wh(t,...e),r.outputs.delete(e),e[0]))},Sh=(t,e,n,i,r,s,o,a,c,u,h,l,p,d,f)=>class extends u{constructor(e,i,r,s){super(r),this._context=e,this._nativeAudioNode=r;const o=h(e);l(o)&&!0!==n(Uu,()=>Uu(o))&&eh(r),Co.set(this,r),Ao.set(this,new Set),i&&Ga(this),t(this,s,r)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(t){this._nativeAudioNode.channelCount=t}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(t){this._nativeAudioNode.channelCountMode=t}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(t){this._nativeAudioNode.channelInterpretation=t}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(t,n=0,a=0){if(n<0||n>=this._nativeAudioNode.numberOfOutputs)throw r();const u=h(this._context),l=f(u);if(p(t)||d(t))throw s();if(Oc(t)){const r=lu(t);try{const i=Qc(this._nativeAudioNode,r,n,a);if(l||Nu(this)?this._nativeAudioNode.disconnect(...i):Nu(t)&&Ga(t),qc(t)){const t=e.get(r);if(void 0===t){const t=u.createGain();t.connect(i[0],0,i[2]),e.set(r,new Map([[a,t]]))}else if(void 0===t.get(a)){const e=u.createGain();e.connect(i[0],0,i[2]),t.set(a,e)}}}catch(t){if(12===t.code)throw s();throw t}if(l?fh(this,t,n,a):dh(this,t,n,a)){const e=c([this],t);Gu(e,i(l))}return t}const _=_u(t);if("playbackRate"===_.name)throw o();try{this._nativeAudioNode.connect(_,n),(l||Nu(this))&&this._nativeAudioNode.disconnect(_,n)}catch(t){if(12===t.code)throw s();throw t}if(l?vh(this,t,n):_h(this,t,n)){const e=c([this],t);Gu(e,i(l))}}disconnect(t,e,n){let i;if(void 0===t)i=Ch(this);else if("number"==typeof t){if(t<0||t>=this.numberOfOutputs)throw r();i=xh(this,t)}else{if(void 0!==e&&(e<0||e>=this.numberOfOutputs))throw r();if(Oc(t)&&void 0!==n&&(n<0||n>=t.numberOfInputs))throw r();if(i=Th(this,t,e,n),0===i.length)throw s()}for(const t of i){const e=c([this],t);Gu(e,a)}}},rh.createAudioNodeConstructor=Sh),rh}var kh,Oh,Dh=!1;function Nh(){return Dh||(Dh=!0,kh={},so(),Oh=(t,e,n,i,r,s,o,a,c,u,h,l)=>(p,d,f,_=null,v=null)=>{const m=new no.AutomationEventList(f.defaultValue),g=d?i(m):null,y={get defaultValue(){return f.defaultValue},get maxValue(){return null===_?f.maxValue:_},get minValue(){return null===v?f.minValue:v},get value(){return f.value},set value(t){f.value=t,y.setValueAtTime(t,p.context.currentTime)},cancelAndHoldAtTime(t){if("function"==typeof f.cancelAndHoldAtTime)null===g&&m.flush(p.context.currentTime),m.add(r(t)),f.cancelAndHoldAtTime(t);else{const e=Array.from(m).pop();null===g&&m.flush(p.context.currentTime),m.add(r(t));const n=Array.from(m).pop();f.cancelScheduledValues(t),e!==n&&void 0!==n&&("exponentialRampToValue"===n.type?f.exponentialRampToValueAtTime(n.value,n.endTime):"linearRampToValue"===n.type?f.linearRampToValueAtTime(n.value,n.endTime):"setValue"===n.type?f.setValueAtTime(n.value,n.startTime):"setValueCurve"===n.type&&f.setValueCurveAtTime(n.values,n.startTime,n.duration))}return y},cancelScheduledValues:t=>(null===g&&m.flush(p.context.currentTime),m.add(s(t)),f.cancelScheduledValues(t),y),exponentialRampToValueAtTime:(t,e)=>(null===g&&m.flush(p.context.currentTime),m.add(o(t,e)),f.exponentialRampToValueAtTime(t,e),y),linearRampToValueAtTime:(t,e)=>(null===g&&m.flush(p.context.currentTime),m.add(a(t,e)),f.linearRampToValueAtTime(t,e),y),setTargetAtTime:(t,e,n)=>(null===g&&m.flush(p.context.currentTime),m.add(c(t,e,n)),f.setTargetAtTime(t,e,n),y),setValueAtTime:(t,e)=>(null===g&&m.flush(p.context.currentTime),m.add(u(t,e)),f.setValueAtTime(t,e),y),setValueCurveAtTime(t,e,n){if(null!==l&&"webkitAudioContext"===l.name){const i=e+n,r=p.context.sampleRate,s=Math.ceil(e*r),o=Math.floor(i*r),a=o-s,c=new Float32Array(a);for(let i=0;i<a;i+=1){const o=(t.length-1)/n*((s+i)/r-e),a=Math.floor(o),u=Math.ceil(o);c[i]=a===u?t[a]:(1-(o-a))*t[a]+(1-(u-o))*t[u]}null===g&&m.flush(p.context.currentTime),m.add(h(c,e,n)),f.setValueCurveAtTime(c,e,n);const u=o/r;u<i&&y.setValueAtTime(c[c.length-1],u),y.setValueAtTime(t[t.length-1],i)}else null===g&&m.flush(p.context.currentTime),m.add(h(t,e,n)),f.setValueCurveAtTime(t,e,n);return y}};return n.set(y,f),e.set(y,p),t(y,g),y},kh.createAudioParamFactory=Oh),kh}var Rh,Ih,Mh=!1;function Ph(){return Mh||(Mh=!0,(Rh={}).createAudioParamRenderer=Ih=t=>({replay(e){for(const n of t)if("exponentialRampToValue"===n.type){const{endTime:t,value:i}=n;e.exponentialRampToValueAtTime(i,t)}else if("linearRampToValue"===n.type){const{endTime:t,value:i}=n;e.linearRampToValueAtTime(i,t)}else if("setTarget"===n.type){const{startTime:t,target:i,timeConstant:r}=n;e.setTargetAtTime(i,t,r)}else if("setValue"===n.type){const{startTime:t,value:i}=n;e.setValueAtTime(i,t)}else{if("setValueCurve"!==n.type)throw new Error("Can't apply an unknown automation.");{const{duration:t,startTime:i,values:r}=n;e.setValueCurveAtTime(r,i,t)}}}})),Rh}var Fh,qh,Lh=!1;function Vh(){return Lh||(Lh=!0,Fh={},qh=class{constructor(t){this._map=new Map(t)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(t,e=null){return this._map.forEach((n,i)=>t.call(e,n,i,this))}get(t){return this._map.get(t)}has(t){return this._map.has(t)}keys(){return this._map.keys()}values(){return this._map.values()}},Fh.ReadOnlyMap=qh),Fh}var jh,Wh,Bh,Uh,zh,Qh=!1;function Hh(){return Qh||(Qh=!0,jh={},Ro(),Vh(),Wh={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,outputChannelCount:void 0,parameterData:{},processorOptions:{}},Bh=t=>{const e=[];for(let n=0;n<t;n+=1)e.push(1);return e},Uh=t=>({...t,outputChannelCount:void 0!==t.outputChannelCount?t.outputChannelCount:1===t.numberOfInputs&&1===t.numberOfOutputs?[t.channelCount]:Bh(t.numberOfOutputs)}),zh=(t,e,n,i,r,s,o,a,c)=>class extends e{constructor(e,c,u=Wh){const h=s(e),l=o(h),p=Uh({...Wh,...u}),d=Oo.get(h),f=void 0===d?void 0:d.get(c),_=r(h,l?null:e.baseLatency,a,c,f,p);super(e,!0,_,l?i(c,p,f):null);const v=[];_.parameters.forEach((t,e)=>{const i=n(this,l,t);v.push([e,i])}),this._nativeAudioWorkletNode=_,this._onprocessorerror=null,this._parameters=new qh(v),l&&t(h,this)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(t){const e="function"==typeof t?c(this,t):null;this._nativeAudioWorkletNode.onprocessorerror=e;const n=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=null!==n&&n===e?t:n}get parameters(){return null===this._parameters?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}},jh.createAudioWorkletNodeConstructor=zh),jh}var Gh,Yh=!1;function Xh(t,e,n,i,r){if("function"==typeof t.copyFromChannel)0===e[n].byteLength&&(e[n]=new Float32Array(128)),t.copyFromChannel(e[n],i,r);else{const s=t.getChannelData(i);if(0===e[n].byteLength)e[n]=s.slice(r,r+128);else{const t=new Float32Array(s.buffer,r*Float32Array.BYTES_PER_ELEMENT,128);e[n].set(t)}}}function Kh(){return Yh||(Yh=!0,(Gh={}).copyFromChannel=Xh),Gh}var Zh,$h,Jh=!1;function tl(){return Jh||(Jh=!0,(Zh={}).copyToChannel=$h=(t,e,n,i,r)=>{"function"==typeof t.copyToChannel?0!==e[n].byteLength&&t.copyToChannel(e[n],i,r):0!==e[n].byteLength&&t.getChannelData(i).set(e[n],r)}),Zh}var el,nl,il=!1;function rl(){return il||(il=!0,(el={}).createNestedArrays=nl=(t,e)=>{const n=[];for(let i=0;i<t;i+=1){const t=[],r="number"==typeof e?e:e[i];for(let e=0;e<r;e+=1)t.push(new Float32Array(128));n.push(t)}return n}),el}var sl,ol,al=!1;function cl(){return al||(al=!0,sl={},Ro(),du(),Wa(),ol=(t,e)=>{const n=Va(Do,t),i=lu(e);return Va(n,i)},sl.getAudioWorkletProcessor=ol),sl}var ul,hl,ll,pl=!1;function dl(){ul={},Kh(),tl(),rl(),su(),cl(),la(),hl=async(t,e,n,i,r,s)=>{const o=null===e?128*Math.ceil(t.context.length/128):e.length,a=i.channelCount*i.numberOfInputs,c=i.outputChannelCount.reduce((t,e)=>t+e,0),u=0===c?null:n.createBuffer(c,o,n.sampleRate);if(void 0===r)throw new Error("Missing the processor constructor.");const h=iu(t),l=await ol(n,t),p=nl(i.numberOfInputs,i.channelCount),d=nl(i.numberOfOutputs,i.outputChannelCount),f=Array.from(t.parameters.keys()).reduce((t,e)=>({...t,[e]:new Float32Array(128)}),{});for(let c=0;c<o;c+=128){if(i.numberOfInputs>0&&null!==e)for(let t=0;t<i.numberOfInputs;t+=1)for(let n=0;n<i.channelCount;n+=1)Xh(e,p[t],n,n,c);void 0!==r.parameterDescriptors&&null!==e&&r.parameterDescriptors.forEach(({name:t},n)=>{Xh(e,f,t,a+n,c)});for(let t=0;t<i.numberOfInputs;t+=1)for(let e=0;e<i.outputChannelCount[t];e+=1)0===d[t][e].byteLength&&(d[t][e]=new Float32Array(128));try{const t=p.map((t,e)=>0===h.activeInputs[e].size?[]:t),e=s(c/n.sampleRate,n.sampleRate,()=>l.process(t,d,f));if(null!==u)for(let t=0,e=0;t<i.numberOfOutputs;t+=1){for(let n=0;n<i.outputChannelCount[t];n+=1)$h(u,d[t],n,e+n,c);e+=i.outputChannelCount[t]}if(!e)break}catch(e){t.dispatchEvent(new ErrorEvent("processorerror",{error:e}));break}}return u},ll=(t,e,n,i,r,s,o,a,c,u,h,l,p,d,f,_)=>(v,m,g)=>{const y=new WeakMap;let b=null;return{render(w,C,x){a(C,w);const T=y.get(C);return void 0!==T?Promise.resolve(T):(async(a,w,C)=>{let x=h(a),T=null;const S=ua(x,w);if(null===l){const t=m.outputChannelCount.reduce((t,e)=>t+e,0),n=r(w,{channelCount:Math.max(1,t),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,t)}),s=[];for(let t=0;t<a.numberOfOutputs;t+=1)s.push(i(w,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:m.outputChannelCount[t]}));const u=o(w,{channelCount:m.channelCount,channelCountMode:m.channelCountMode,channelInterpretation:m.channelInterpretation,gain:1});u.connect=e.bind(null,s),u.disconnect=c.bind(null,s),T=[n,s,u]}else S||(x=new l(w,v));if(y.set(w,null===T?x:T[2]),null!==T){if(null===b){if(void 0===g)throw new Error("Missing the processor constructor.");if(null===p)throw new Error("Missing the native OfflineAudioContext constructor.");const t=a.channelCount*a.numberOfInputs,e=void 0===g.parameterDescriptors?0:g.parameterDescriptors.length,n=t+e,c=async()=>{const c=new p(n,128*Math.ceil(a.context.length/128),w.sampleRate),u=[],h=[];for(let t=0;t<m.numberOfInputs;t+=1)u.push(o(c,{channelCount:m.channelCount,channelCountMode:m.channelCountMode,channelInterpretation:m.channelInterpretation,gain:1})),h.push(r(c,{channelCount:m.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:m.channelCount}));const l=await Promise.all(Array.from(a.parameters.values()).map(async t=>{const e=s(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:t.value});return await d(c,t,e.offset,C),e})),v=i(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,t+e)});for(let t=0;t<m.numberOfInputs;t+=1){u[t].connect(h[t]);for(let e=0;e<m.channelCount;e+=1)h[t].connect(v,e,t*m.channelCount+e)}for(const[e,n]of l.entries())n.connect(v,0,t+e),n.start(0);return v.connect(c.destination),await Promise.all(u.map(t=>f(a,c,t,C))),_(c)};b=hl(a,0===n?null:await c(),w,m,g,u)}const t=await b,e=n(w,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[c,h,l]=T;null!==t&&(e.buffer=t,e.start(0)),e.connect(c);for(let t=0,e=0;t<a.numberOfOutputs;t+=1){const n=h[t];for(let i=0;i<m.outputChannelCount[t];i+=1)c.connect(n,e+i,i);e+=m.outputChannelCount[t]}return l}if(S)for(const[e,n]of a.parameters.entries())await t(w,n,x.parameters.get(e),C);else for(const[t,e]of a.parameters.entries())await d(w,e,x.parameters.get(t),C);return await f(a,w,x,C),x})(w,C,x)}}},ul.createAudioWorkletNodeRendererFactory=ll}var fl,_l,vl=!1;function ml(){return vl||(vl=!0,(fl={}).createBaseAudioContextConstructor=_l=(t,e,n,i,r,s,o,a,c,u,h,l,p,d,f,_,v,m,g,y)=>class extends f{constructor(e,n){super(e,n),this._nativeContext=e,this._audioWorklet=void 0===t?void 0:{addModule:(e,n)=>t(this,e,n)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new r(this)}createBuffer(t,e,i){return new n({length:e,numberOfChannels:t,sampleRate:i})}createBufferSource(){return new i(this)}createChannelMerger(t=6){return new s(this,{numberOfInputs:t})}createChannelSplitter(t=6){return new o(this,{numberOfOutputs:t})}createConstantSource(){return new a(this)}createConvolver(){return new c(this)}createDelay(t=1){return new h(this,{maxDelayTime:t})}createDynamicsCompressor(){return new l(this)}createGain(){return new p(this)}createIIRFilter(t,e){return new d(this,{feedback:e,feedforward:t})}createOscillator(){return new _(this)}createPanner(){return new v(this)}createPeriodicWave(t,e,n={disableNormalization:!1}){return new m(this,{...n,imag:e,real:t})}createStereoPanner(){return new g(this)}createWaveShaper(){return new y(this)}decodeAudioData(t,e,n){return u(this._nativeContext,t).then(t=>("function"==typeof e&&e(t),t)).catch(t=>{throw"function"==typeof n&&n(t),t})}}),fl}var gl,yl,bl,wl=!1;function Cl(){return wl||(wl=!0,gl={},qa(),yl={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},bl=(t,e,n,i,r,s,o)=>class extends t{constructor(t,i=yl){const a=s(t),c={...yl,...i},u=r(a,c),h=o(a);super(t,!1,u,h?n():null),this._Q=e(this,h,u.Q,Pa,Ma),this._detune=e(this,h,u.detune,1200*Math.log2(Pa),-1200*Math.log2(Pa)),this._frequency=e(this,h,u.frequency,t.sampleRate/2,0),this._gain=e(this,h,u.gain,40*Math.log10(Pa),Ma),this._nativeBiquadFilterNode=u}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(t){this._nativeBiquadFilterNode.type=t}getFrequencyResponse(t,e,n){if(this._nativeBiquadFilterNode.getFrequencyResponse(t,e,n),t.length!==e.length||e.length!==n.length)throw i()}},gl.createBiquadFilterNodeConstructor=bl),gl}var xl,Tl,Sl=!1;function El(){xl={},la(),Tl=(t,e,n,i,r)=>()=>{const s=new WeakMap;return{render(o,a,c){const u=s.get(a);return void 0!==u?Promise.resolve(u):(async(o,a,c)=>{let u=n(o);const h=ua(u,a);if(!h){const t={Q:u.Q.value,channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,detune:u.detune.value,frequency:u.frequency.value,gain:u.gain.value,type:u.type};u=e(a,t)}return s.set(a,u),h?(await t(a,o.Q,u.Q,c),await t(a,o.detune,u.detune,c),await t(a,o.frequency,u.frequency,c),await t(a,o.gain,u.gain,c)):(await i(a,o.Q,u.Q,c),await i(a,o.detune,u.detune,c),await i(a,o.frequency,u.frequency,c),await i(a,o.gain,u.gain,c)),await r(o,a,u,c),u})(o,a,c)}}},xl.createBiquadFilterNodeRendererFactory=Tl}var Al,kl,Ol=!1;function Dl(){return Ol||(Ol=!0,(Al={}).createCacheTestResult=kl=(t,e)=>(n,i)=>{const r=e.get(n);if(void 0!==r)return r;const s=t.get(n);if(void 0!==s)return s;try{const r=i();return r instanceof Promise?(t.set(n,r),r.catch(()=>!1).then(i=>(t.delete(n),e.set(n,i),i))):(e.set(n,r),r)}catch{return e.set(n,!1),!1}}),Al}var Nl,Rl,Il,Ml=!1;function Pl(){return Ml||(Ml=!0,Rl={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},(Nl={}).createChannelMergerNodeConstructor=Il=(t,e,n,i,r)=>class extends t{constructor(t,s=Rl){const o=i(t),a={...Rl,...s};super(t,!1,n(o,a),r(o)?e():null)}}),Nl}var Fl,ql,Ll=!1;function Vl(){Fl={},la(),ql=(t,e,n)=>()=>{const i=new WeakMap;return{render(r,s,o){const a=i.get(s);return void 0!==a?Promise.resolve(a):(async(r,s,o)=>{let a=e(r);if(!ua(a,s)){const e={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfInputs:a.numberOfInputs};a=t(s,e)}return i.set(s,a),await n(r,s,a,o),a})(r,s,o)}}},Fl.createChannelMergerNodeRendererFactory=ql}var jl,Wl,Bl,Ul,zl=!1;function Ql(){return zl||(zl=!0,Wl={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},Bl=t=>({...t,channelCount:t.numberOfOutputs}),(jl={}).createChannelSplitterNodeConstructor=Ul=(t,e,n,i,r)=>class extends t{constructor(t,s=Wl){const o=i(t),a=Bl({...Wl,...s});super(t,!1,n(o,a),r(o)?e():null)}}),jl}var Hl,Gl,Yl=!1;function Xl(){Hl={},la(),Gl=(t,e,n)=>()=>{const i=new WeakMap;return{render(r,s,o){const a=i.get(s);return void 0!==a?Promise.resolve(a):(async(r,s,o)=>{let a=e(r);if(!ua(a,s)){const e={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfOutputs:a.numberOfOutputs};a=t(s,e)}return i.set(s,a),await n(r,s,a,o),a})(r,s,o)}}},Hl.createChannelSplitterNodeRendererFactory=Gl}var Kl,Zl,$l=!1;function Jl(){return $l||($l=!0,(Kl={}).createConnectAudioParam=Zl=t=>(e,n,i,r)=>t(n,e,i,r)),Kl}var tp,ep,np=!1;function ip(){return np||(np=!0,tp={},Ju(),ep=t=>(e,n,i=0,r=0)=>{const s=e[i];if(void 0===s)throw t();return Zu(n)?s.connect(n,0,r):s.connect(n,0)},tp.createConnectMultipleOutputs=ep),tp}var rp,sp,op=!1;function ap(){return op||(op=!0,(rp={}).createConnectedNativeAudioBufferSourceNodeFactory=sp=t=>(e,n)=>{const i=t(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),r=e.createBuffer(1,2,e.sampleRate);return i.buffer=r,i.loop=!0,i.connect(n),i.start(),()=>{i.stop(),i.disconnect(n)}}),rp}var cp,up,hp,lp=!1;function pp(){return lp||(lp=!0,cp={},qa(),Xa(),Ja(),up={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},hp=(t,e,n,i,r,s,o)=>class extends t{constructor(t,o=up){const a=r(t),c={...up,...o},u=i(a,c),h=s(a),l=h?n():null;super(t,!1,u,l),this._constantSourceNodeRenderer=l,this._nativeConstantSourceNode=u,this._offset=e(this,h,u.offset,Pa,Ma),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(t){const e="function"==typeof t?o(this,t):null;this._nativeConstantSourceNode.onended=e;const n=this._nativeConstantSourceNode.onended;this._onended=null!==n&&n===e?t:n}start(t=0){if(this._nativeConstantSourceNode.start(t),null!==this._constantSourceNodeRenderer)this._constantSourceNodeRenderer.start=t;else{Ga(this);const t=()=>{this._nativeConstantSourceNode.removeEventListener("ended",t),setTimeout(()=>Za(this),1e3)};this._nativeConstantSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeConstantSourceNode.stop(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.stop=t)}},cp.createConstantSourceNodeConstructor=hp),cp}var dp,fp,_p=!1;function vp(){dp={},la(),fp=(t,e,n,i,r)=>()=>{const s=new WeakMap;let o=null,a=null;return{set start(t){o=t},set stop(t){a=t},render(c,u,h){const l=s.get(u);return void 0!==l?Promise.resolve(l):(async(c,u,h)=>{let l=n(c);const p=ua(l,u);if(!p){const t={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,offset:l.offset.value};l=e(u,t),null!==o&&l.start(o),null!==a&&l.stop(a)}return s.set(u,l),p?await t(u,c.offset,l.offset,h):await i(u,c.offset,l.offset,h),await r(c,u,l,h),l})(c,u,h)}}},dp.createConstantSourceNodeRendererFactory=fp}var mp,gp,yp=!1;function bp(){return yp||(yp=!0,(mp={}).createConvertNumberToUnsignedLong=gp=t=>e=>(t[0]=e,t[0])),mp}var wp,Cp,xp,Tp=!1;function Sp(){return Tp||(Tp=!0,Cp={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},(wp={}).createConvolverNodeConstructor=xp=(t,e,n,i,r)=>class extends t{constructor(t,s=Cp){const o=i(t),a={...Cp,...s},c=n(o,a);super(t,!1,c,r(o)?e():null),this._isBufferNullified=!1,this._nativeConvolverNode=c}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(t){if(this._nativeConvolverNode.buffer=t,null===t&&null!==this._nativeConvolverNode.buffer){const t=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=t.createBuffer(1,1,t.sampleRate),this._isBufferNullified=!0}else this._isBufferNullified=!1}get normalize(){return this._nativeConvolverNode.normalize}set normalize(t){this._nativeConvolverNode.normalize=t}}),wp}var Ep,Ap,kp=!1;function Op(){Ep={},Uc(),la(),Ap=(t,e,n)=>()=>{const i=new WeakMap;return{render(r,s,o){const a=i.get(s);return void 0!==a?Promise.resolve(a):(async(r,s,o)=>{let a=e(r);if(!ua(a,s)){const e={buffer:a.buffer,channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,disableNormalization:!a.normalize};a=t(s,e)}return i.set(s,a),Wc(a)?await n(r,s,a.inputs[0],o):await n(r,s,a,o),a})(r,s,o)}}},Ep.createConvolverNodeRendererFactory=Ap}var Dp,Np,Rp=!1;function Ip(){return Rp||(Rp=!0,(Dp={}).createCreateNativeOfflineAudioContext=Np=(t,e)=>(n,i,r)=>{if(null===e)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(n,i,r)}catch(e){if("IndexSizeError"===e.name||"SyntaxError"===e.name)throw t();throw e}}),Dp}var Mp,Pp,Fp=!1;function qp(){return Fp||(Fp=!0,(Mp={}).createDataCloneError=Pp=()=>{try{return new DOMException("","DataCloneError")}catch(t){return t.code=25,t.name="DataCloneError",t}}),Mp}var Lp,Vp,jp=!1;function Wp(){return jp||(jp=!0,(Lp={}).detachArrayBuffer=Vp=t=>{const{port1:e}=new MessageChannel;e.postMessage(t,[t])}),Lp}var Bp,Up,zp=!1;function Qp(){return zp||(zp=!0,Bp={},Wp(),Aa(),Up=(t,e,n,i,r,s,o,a,c,u,h,l,p)=>(d,f)=>{const _=o(d)?d:s(d);if(r.has(f)){const t=n();return Promise.reject(t)}try{r.add(f)}catch{}return e(h,()=>h(_))?("closed"===_.state&&null!==c&&a(_)?new c(1,1,_.sampleRate):_).decodeAudioData(f).catch(t=>{if(t instanceof DOMException&&"NotSupportedError"===t.name)throw new TypeError;throw t}).then(n=>(e(u,()=>u(n))||p(n),t.add(n),n)):new Promise((e,n)=>{const r=()=>{try{Vp(f)}catch{}},s=t=>{n(t),r()};try{_.decodeAudioData(f,n=>{"function"!=typeof n.copyFromChannel&&(l(n),Sa(n)),t.add(n),r(),e(n)},t=>{s(null===t?i():t)})}catch(t){s(t)}})},Bp.createDecodeAudioData=Up),Bp}var Hp,Gp,Yp=!1;function Xp(){return Yp||(Yp=!0,Hp={},Pc(),Gp=(t,e,n,i,r,s,o,a)=>(c,u)=>{const h=e.get(c);if(void 0===h)throw new Error("Missing the expected cycle count.");const l=s(c.context),p=a(l);if(h===u){if(e.delete(c),!p&&o(c)){const e=i(c),{outputs:s}=n(c);for(const n of s)if(Ic(n)){const r=i(n[0]);t(e,r,n[1],n[2])}else{const t=r(n[0]);e.connect(t,n[1])}}}else e.set(c,h-u)},Hp.createDecrementCycleCounter=Gp),Hp}var Kp,Zp,$p,Jp=!1;function td(){return Jp||(Jp=!0,Zp={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},(Kp={}).createDelayNodeConstructor=$p=(t,e,n,i,r,s)=>class extends t{constructor(t,o=Zp){const a=r(t),c={...Zp,...o},u=i(a,c),h=s(a);super(t,!1,u,h?n(c.maxDelayTime):null),this._delayTime=e(this,h,u.delayTime,c.maxDelayTime,0)}get delayTime(){return this._delayTime}}),Kp}var ed,nd,id=!1;function rd(){ed={},la(),nd=(t,e,n,i,r)=>s=>{const o=new WeakMap;return{render(a,c,u){const h=o.get(c);return void 0!==h?Promise.resolve(h):(async(a,c,u)=>{let h=n(a);const l=ua(h,c);if(!l){const t={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,delayTime:h.delayTime.value,maxDelayTime:s};h=e(c,t)}return o.set(c,h),l?await t(c,a.delayTime,h.delayTime,u):await i(c,a.delayTime,h.delayTime,u),await r(a,c,h,u),h})(a,c,u)}}},ed.createDelayNodeRendererFactory=nd}var sd,od,ad=!1;function cd(){return ad||(ad=!0,(sd={}).createDeleteUnrenderedAudioWorkletNode=od=t=>(e,n)=>{t(e).delete(n)}),sd}var ud,hd,ld=!1;function pd(){return ld||(ld=!0,(ud={}).isDelayNode=hd=t=>"delayTime"in t),ud}var dd,fd,_d=!1;function vd(){return _d||(_d=!0,dd={},Nc(),pd(),fd=(t,e,n)=>function i(r,s){const o=Oc(s)?s:n(t,s);if(hd(o))return[];if(r[0]===o)return[r];if(r.includes(o))return[];const{outputs:a}=e(o);return Array.from(a).map(t=>i([...r,o],t[0])).reduce((t,e)=>t.concat(e),[])},dd.createDetectCycles=fd),dd}var md,gd,yd,bd=!1;function wd(){return bd||(bd=!0,md={},Ju(),gd=(t,e,n)=>{const i=e[n];if(void 0===i)throw t();return i},yd=t=>(e,n,i,r=0)=>void 0===n?e.forEach(t=>t.disconnect()):"number"==typeof n?gd(t,e,n).disconnect():Zu(n)?void 0===i?e.forEach(t=>t.disconnect(n)):void 0===r?gd(t,e,i).disconnect(n,0):gd(t,e,i).disconnect(n,0,r):void 0===i?e.forEach(t=>t.disconnect(n)):gd(t,e,i).disconnect(n,0),md.createDisconnectMultipleOutputs=yd),md}var Cd,xd,Td,Sd=!1;function Ed(){return Sd||(Sd=!0,xd={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},(Cd={}).createDynamicsCompressorNodeConstructor=Td=(t,e,n,i,r,s,o)=>class extends t{constructor(t,r=xd){const a=s(t),c={...xd,...r},u=i(a,c),h=o(a);super(t,!1,u,h?n():null),this._attack=e(this,h,u.attack,1,0),this._knee=e(this,h,u.knee,40,0),this._nativeDynamicsCompressorNode=u,this._ratio=e(this,h,u.ratio,20,1),this._release=e(this,h,u.release,1,0),this._threshold=e(this,h,u.threshold,0,-100)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(t){const e=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=t,t>2)throw this._nativeDynamicsCompressorNode.channelCount=e,r()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(t){const e=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=t,"max"===t)throw this._nativeDynamicsCompressorNode.channelCountMode=e,r()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return"number"==typeof this._nativeDynamicsCompressorNode.reduction.value?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}}),Cd}var Ad,kd,Od=!1;function Dd(){Ad={},la(),kd=(t,e,n,i,r)=>()=>{const s=new WeakMap;return{render(o,a,c){const u=s.get(a);return void 0!==u?Promise.resolve(u):(async(o,a,c)=>{let u=n(o);const h=ua(u,a);if(!h){const t={attack:u.attack.value,channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,knee:u.knee.value,ratio:u.ratio.value,release:u.release.value,threshold:u.threshold.value};u=e(a,t)}return s.set(a,u),h?(await t(a,o.attack,u.attack,c),await t(a,o.knee,u.knee,c),await t(a,o.ratio,u.ratio,c),await t(a,o.release,u.release,c),await t(a,o.threshold,u.threshold,c)):(await i(a,o.attack,u.attack,c),await i(a,o.knee,u.knee,c),await i(a,o.ratio,u.ratio,c),await i(a,o.release,u.release,c),await i(a,o.threshold,u.threshold,c)),await r(o,a,u,c),u})(o,a,c)}}},Ad.createDynamicsCompressorNodeRendererFactory=kd}var Nd,Rd,Id=!1;function Md(){return Id||(Id=!0,(Nd={}).createEncodingError=Rd=()=>{try{return new DOMException("","EncodingError")}catch(t){return t.code=0,t.name="EncodingError",t}}),Nd}var Pd,Fd,qd=!1;function Ld(){return qd||(qd=!0,(Pd={}).createEvaluateSource=Fd=t=>e=>new Promise((n,i)=>{if(null===t)return void i(new SyntaxError);const r=t.document.head;if(null===r)i(new SyntaxError);else{const s=t.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o),c=t.onerror,u=()=>{t.onerror=c,URL.revokeObjectURL(a)};t.onerror=(e,n,r,s,o)=>n===a||n===t.location.href&&1===r&&1===s?(u(),i(o),!1):null!==c?c(e,n,r,s,o):void 0,s.onerror=()=>{u(),i(new SyntaxError)},s.onload=()=>{u(),n()},s.src=a,s.type="module",r.appendChild(s)}})),Pd}var Vd,jd,Wd=!1;function Bd(){return Wd||(Wd=!0,(Vd={}).createEventTargetConstructor=jd=t=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(e,n,i){if(null!==n){let r=this._listeners.get(n);void 0===r&&(r=t(this,n),"function"==typeof n&&this._listeners.set(n,r)),this._nativeEventTarget.addEventListener(e,r,i)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,e,n){const i=null===e?void 0:this._listeners.get(e);this._nativeEventTarget.removeEventListener(t,void 0===i?null:i,n)}}),Vd}var Ud,zd,Qd=!1;function Hd(){return Qd||(Qd=!0,(Ud={}).createExposeCurrentFrameAndCurrentTime=zd=t=>(e,n,i)=>{Object.defineProperties(t,{currentFrame:{configurable:!0,get:()=>Math.round(e*n)},currentTime:{configurable:!0,get:()=>e}});try{return i()}finally{null!==t&&(delete t.currentFrame,delete t.currentTime)}}),Ud}var Gd,Yd,Xd=!1;function Kd(){return Xd||(Xd=!0,(Gd={}).createFetchSource=Yd=t=>async e=>{try{const t=await fetch(e);if(t.ok)return t.text()}catch{}throw t()}),Gd}var Zd,$d,Jd,tf=!1;function ef(){return tf||(tf=!0,Zd={},qa(),$d={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},Jd=(t,e,n,i,r,s)=>class extends t{constructor(t,o=$d){const a=r(t),c={...$d,...o},u=i(a,c),h=s(a);super(t,!1,u,h?n():null),this._gain=e(this,h,u.gain,Pa,Ma)}get gain(){return this._gain}},Zd.createGainNodeConstructor=Jd),Zd}var nf,rf,sf=!1;function of(){nf={},la(),rf=(t,e,n,i,r)=>()=>{const s=new WeakMap;return{render(o,a,c){const u=s.get(a);return void 0!==u?Promise.resolve(u):(async(o,a,c)=>{let u=n(o);const h=ua(u,a);if(!h){const t={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,gain:u.gain.value};u=e(a,t)}return s.set(a,u),h?await t(a,o.gain,u.gain,c):await i(a,o.gain,u.gain,c),await r(o,a,u,c),u})(o,a,c)}}},nf.createGainNodeRendererFactory=rf}var af,cf,uf=!1;function hf(){return uf||(uf=!0,(af={}).createGetAudioNodeRenderer=cf=t=>e=>{const n=t(e);if(null===n.renderer)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return n.renderer}),af}var lf,pf,df=!1;function ff(){return df||(df=!0,(lf={}).createGetAudioParamRenderer=pf=t=>e=>{const n=t(e);if(null===n.renderer)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return n.renderer}),lf}var _f,vf,mf=!1;function gf(){return mf||(mf=!0,_f={},Ro(),vf=(t,e,n)=>i=>{if("closed"===i.state&&null!==e&&"webkitAudioContext"!==e.name){if(!t(i)){const t=So.get(i);if(void 0!==t)return t;const n=new e;return So.set(i,n),n}{const t=So.get(i);if(void 0!==t)return t;if(null!==n){const t=new n(1,1,44100);return So.set(i,t),t}}}return null},_f.createGetBackupNativeContext=vf),_f}var yf,bf,wf=!1;function Cf(){return wf||(wf=!0,(yf={}).createInvalidStateError=bf=()=>{try{return new DOMException("","InvalidStateError")}catch(t){return t.code=11,t.name="InvalidStateError",t}}),yf}var xf,Tf,Sf=!1;function Ef(){return Sf||(Sf=!0,xf={},Cf(),Tf=t=>e=>{const n=t.get(e);if(void 0===n)throw bf();return n},xf.createGetNativeContext=Tf),xf}var Af,kf,Of=!1;function Df(){return Of||(Of=!0,(Af={}).createGetUnrenderedAudioWorkletNodes=kf=t=>e=>{const n=t.get(e);if(void 0===n)throw new Error("The context has no set of AudioWorkletNodes.");return n}),Af}var Nf,Rf,If=!1;function Mf(){return If||(If=!0,(Nf={}).createInvalidAccessError=Rf=()=>{try{return new DOMException("","InvalidAccessError")}catch(t){return t.code=15,t.name="InvalidAccessError",t}}),Nf}var Pf,Ff,qf=!1;function Lf(){return qf||(qf=!0,Pf={},Mf(),Ff=t=>{var e;t.getFrequencyResponse=(e=t.getFrequencyResponse,(n,i,r)=>{if(n.length!==i.length||i.length!==r.length)throw Rf();return e.call(t,n,i,r)})},Pf.wrapIIRFilterNodeGetFrequencyResponseMethod=Ff),Pf}var Vf,jf,Wf,Bf=!1;function Uf(){return Bf||(Bf=!0,Vf={},Lf(),jf={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},Wf=(t,e,n,i,r)=>class extends t{constructor(t,s){const o=i(t),a=r(o),c={...jf,...s},u=e(o,a?null:t.baseLatency,c);super(t,!1,u,a?n(c.feedback,c.feedforward):null),Ff(u),this._nativeIIRFilterNode=u}getFrequencyResponse(t,e,n){return this._nativeIIRFilterNode.getFrequencyResponse(t,e,n)}},Vf.createIIRFilterNodeConstructor=Wf),Vf}var zf,Qf,Hf=!1;function Gf(){return Hf||(Hf=!0,(zf={}).filterBuffer=Qf=(t,e,n,i,r,s,o,a,c,u,h)=>{const l=u.length;let p=a;for(let a=0;a<l;a+=1){let l=n[0]*u[a];for(let e=1;e<r;e+=1){const i=p-e&c-1;l+=n[e]*s[i],l-=t[e]*o[i]}for(let t=r;t<i;t+=1)l+=n[t]*s[p-t&c-1];for(let n=r;n<e;n+=1)l-=t[n]*o[p-n&c-1];s[p]=u[a],o[p]=l,p=p+1&c-1,h[a]=l}return p}),zf}var Yf,Xf,Kf,Zf=!1;function $f(){Yf={},Gf(),la(),Xf=(t,e,n,i)=>{const r=n.length,s=i.length,o=Math.min(r,s);if(1!==n[0]){for(let t=0;t<r;t+=1)i[t]/=n[0];for(let t=1;t<s;t+=1)n[t]/=n[0]}const a=new Float32Array(32),c=new Float32Array(32),u=e.createBuffer(t.numberOfChannels,t.length,t.sampleRate),h=t.numberOfChannels;for(let e=0;e<h;e+=1){const h=t.getChannelData(e),l=u.getChannelData(e);a.fill(0),c.fill(0),Qf(n,r,i,s,o,a,c,0,32,h,l)}return u},Kf=(t,e,n,i,r,s)=>(o,a)=>{const c=new WeakMap;let u=null;return{render(h,l,p){const d=c.get(l);return void 0!==d?Promise.resolve(d):(async(h,l,p)=>{let d=null,f=n(h);const _=ua(f,l);if(void 0===l.createIIRFilter?d=t(l,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):_||(f=e(l,t=>t.createIIRFilter(a,o))),c.set(l,null===d?f:d),null!==d){if(null===u){if(null===i)throw new Error("Missing the native OfflineAudioContext constructor.");const t=new i(h.context.destination.channelCount,h.context.length,l.sampleRate);u=(async()=>{await r(h,t,t.destination,p);const e=await s(t);return Xf(e,l,o,a)})()}const t=await u;return d.buffer=t,d.start(0),d}return await r(h,l,f,p),f})(h,l,p)}}},Yf.createIIRFilterNodeRendererFactory=Kf}var Jf,t_,e_=!1;function n_(){return e_||(e_=!0,Jf={},Pc(),t_=(t,e,n,i,r,s)=>o=>(a,c)=>{const u=t.get(a);if(void 0===u){if(!o&&s(a)){const t=i(a),{outputs:s}=n(a);for(const n of s)if(Ic(n)){const r=i(n[0]);e(t,r,n[1],n[2])}else{const e=r(n[0]);t.disconnect(e,n[1])}}t.set(a,c)}else t.set(a,u+c)},Jf.createIncrementCycleCounterFactory=t_),Jf}var i_,r_,s_=!1;function o_(){return s_||(s_=!0,(i_={}).createIsAnyAudioContext=r_=(t,e)=>n=>{const i=t.get(n);return e(i)||e(n)}),i_}var a_,c_,u_=!1;function h_(){return u_||(u_=!0,(a_={}).createIsAnyAudioNode=c_=(t,e)=>n=>t.has(n)||e(n)),a_}var l_,p_,d_=!1;function f_(){return d_||(d_=!0,(l_={}).createIsAnyAudioParam=p_=(t,e)=>n=>t.has(n)||e(n)),l_}var __,v_,m_=!1;function g_(){return m_||(m_=!0,(__={}).createIsAnyOfflineAudioContext=v_=(t,e)=>n=>{const i=t.get(n);return e(i)||e(n)}),__}var y_,b_,w_=!1;function C_(){return w_||(w_=!0,(y_={}).createIsNativeAudioContext=b_=t=>e=>null!==t&&e instanceof t),y_}var x_,T_,S_=!1;function E_(){return S_||(S_=!0,(x_={}).createIsNativeAudioNode=T_=t=>e=>null!==t&&"function"==typeof t.AudioNode&&e instanceof t.AudioNode),x_}var A_,k_,O_=!1;function D_(){return O_||(O_=!0,(A_={}).createIsNativeAudioParam=k_=t=>e=>null!==t&&"function"==typeof t.AudioParam&&e instanceof t.AudioParam),A_}var N_,R_,I_=!1;function M_(){return I_||(I_=!0,(N_={}).createIsNativeContext=R_=(t,e)=>n=>t(n)||e(n)),N_}var P_,F_,q_=!1;function L_(){return q_||(q_=!0,(P_={}).createIsNativeOfflineAudioContext=F_=t=>e=>null!==t&&e instanceof t),P_}var V_,j_,W_=!1;function B_(){return W_||(W_=!0,(V_={}).createIsSecureContext=j_=t=>null!==t&&t.isSecureContext),V_}var U_,z_,Q_=!1;function H_(){return Q_||(Q_=!0,(U_={}).createIsSupportedPromise=z_=async(t,e,n,i,r,s,o,a,c,u,h,l,p,d)=>!!(t(e,e)&&t(n,n)&&t(r,r)&&t(s,s)&&t(a,a)&&t(c,c)&&t(u,u)&&t(h,h)&&t(l,l))&&(await Promise.all([t(i,i),t(o,o),t(p,p),t(d,d)])).every(t=>t)),U_}var G_,Y_,X_=!1;function K_(){return X_||(X_=!0,(G_={}).createMediaElementAudioSourceNodeConstructor=Y_=(t,e,n,i)=>class extends t{constructor(t,r){const s=n(t),o=e(s,r);if(i(s))throw TypeError();super(t,!0,o,null),this._mediaElement=r.mediaElement,this._nativeMediaElementAudioSourceNode=o}get mediaElement(){return void 0===this._nativeMediaElementAudioSourceNode.mediaElement?this._mediaElement:this._nativeMediaElementAudioSourceNode.mediaElement}}),G_}var Z_,$_,J_,tv=!1;function ev(){return tv||(tv=!0,$_={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},(Z_={}).createMediaStreamAudioDestinationNodeConstructor=J_=(t,e,n,i)=>class extends t{constructor(t,r=$_){const s=n(t);if(i(s))throw new TypeError;const o={...$_,...r},a=e(s,o);super(t,!1,a,null),this._nativeMediaStreamAudioDestinationNode=a}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}}),Z_}var nv,iv,rv=!1;function sv(){return rv||(rv=!0,(nv={}).createMediaStreamAudioSourceNodeConstructor=iv=(t,e,n,i)=>class extends t{constructor(t,r){const s=n(t),o=e(s,r);if(i(s))throw new TypeError;super(t,!0,o,null),this._nativeMediaStreamAudioSourceNode=o}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}}),nv}var ov,av,cv=!1;function uv(){return cv||(cv=!0,(ov={}).createMediaStreamTrackAudioSourceNodeConstructor=av=(t,e,n)=>class extends t{constructor(t,i){const r=n(t);super(t,!0,e(r,i),null)}}),ov}var hv,lv,pv=!1;function dv(){return pv||(pv=!0,hv={},pc(),lv=(t,e,n,i,r)=>class extends i{constructor(t={}){if(null===r)throw new Error("Missing the native AudioContext constructor.");const i=new r(t);if(null===i)throw n();if(!hc(t.latencyHint))throw new TypeError(`The provided value '${t.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(void 0!==t.sampleRate&&i.sampleRate!==t.sampleRate)throw e();super(i,2);const{latencyHint:s}=t,{sampleRate:o}=i;if(this._baseLatency="number"==typeof i.baseLatency?i.baseLatency:"balanced"===s?512/o:"interactive"===s||void 0===s?256/o:"playback"===s?1024/o:128*Math.max(2,Math.min(128,Math.round(s*o/128)))/o,this._nativeAudioContext=i,this._state=null,"running"===i.state){this._state="suspended";const t=()=>{"suspended"===this._state&&(this._state=null),i.removeEventListener("statechange",t)};i.addEventListener("statechange",t)}}get baseLatency(){return this._baseLatency}get state(){return null!==this._state?this._state:this._nativeAudioContext.state}close(){return"closed"===this.state?this._nativeAudioContext.close().then(()=>{throw t()}):("suspended"===this._state&&(this._state=null),this._nativeAudioContext.close())}resume(){return"suspended"===this._state?new Promise((t,e)=>{const n=()=>{this._nativeAudioContext.removeEventListener("statechange",n),"running"===this._nativeAudioContext.state?t():this.resume().then(t,e)};this._nativeAudioContext.addEventListener("statechange",n)}):this._nativeAudioContext.resume().catch(e=>{if(void 0===e||15===e.code)throw t();throw e})}suspend(){return this._nativeAudioContext.suspend().catch(e=>{if(void 0===e)throw t();throw e})}},hv.createMinimalAudioContextConstructor=lv),hv}var fv,_v,vv=!1;function mv(){return vv||(vv=!0,fv={},Ro(),_v=(t,e,n,i,r,s)=>class extends n{constructor(n,s){super(n),this._nativeContext=n,Eo.set(this,n);const o=n.sampleRate;Object.defineProperty(n,"sampleRate",{get:()=>o}),i(n)&&r.set(n,new Set),this._destination=new t(this,s),this._listener=e(this,n),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(t){const e="function"==typeof t?s(this,t):null;this._nativeContext.onstatechange=e;const n=this._nativeContext.onstatechange;this._onstatechange=null!==n&&n===e?t:n}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},fv.createMinimalBaseAudioContextConstructor=_v),fv}var gv,yv,bv=!1;function wv(){return bv||(bv=!0,(gv={}).testPromiseSupport=yv=t=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const n=t.decodeAudioData(e.buffer,()=>{});return void 0!==n&&(n.catch(()=>{}),!0)}catch{}return!1}),gv}var Cv,xv,Tv,Sv=!1;function Ev(){return Sv||(Sv=!0,Cv={},wv(),xv={numberOfChannels:1},Tv=(t,e,n,i,r)=>class extends i{constructor(e){const{length:i,numberOfChannels:r,sampleRate:s}={...xv,...e},o=n(r,i,s);t(yv,()=>yv(o))||o.addEventListener("statechange",(()=>{let t=0;const e=n=>{"running"===this._state&&(t>0?(o.removeEventListener("statechange",e),n.stopImmediatePropagation(),this._waitForThePromiseToSettle(n)):t+=1)};return e})()),super(o,r),this._length=i,this._nativeOfflineAudioContext=o,this._state=null}get length(){return void 0===this._nativeOfflineAudioContext.length?this._length:this._nativeOfflineAudioContext.length}get state(){return null===this._state?this._nativeOfflineAudioContext.state:this._state}startRendering(){return"running"===this._state?Promise.reject(e()):(this._state="running",r(this.destination,this._nativeOfflineAudioContext).then(t=>(this._state=null,t)).catch(t=>{throw this._state=null,t}))}_waitForThePromiseToSettle(t){null===this._state?this._nativeOfflineAudioContext.dispatchEvent(t):setTimeout(()=>this._waitForThePromiseToSettle(t))}},Cv.createMinimalOfflineAudioContextConstructor=Tv),Cv}var Av,kv,Ov=!1;function Dv(){return Ov||(Ov=!0,(Av={}).createMonitorConnections=kv=(t,e)=>(n,i,r)=>{const s=new Set;var o,a;return n.connect=(o=n.connect,(r,a=0,c=0)=>{const u=0===s.size;if(e(r))return o.call(n,r,a,c),t(s,[r,a,c],t=>t[0]===r&&t[1]===a&&t[2]===c,!0),u&&i(),r;o.call(n,r,a),t(s,[r,a],t=>t[0]===r&&t[1]===a,!0),u&&i()}),n.disconnect=(a=n.disconnect,(t,i,o)=>{const c=s.size>0;if(void 0===t)a.apply(n),s.clear();else if("number"==typeof t){a.call(n,t);for(const e of s)e[1]===t&&s.delete(e)}else{e(t)?a.call(n,t,i,o):a.call(n,t,i);for(const e of s)e[0]!==t||void 0!==i&&e[1]!==i||void 0!==o&&e[2]!==o||s.delete(e)}const u=0===s.size;c&&u&&r()}),n}),Av}var Nv,Rv,Iv=!1;function Mv(){return Iv||(Iv=!0,(Nv={}).assignNativeAudioNodeOption=Rv=(t,e,n)=>{const i=e[n];void 0!==i&&i!==t[n]&&(t[n]=i)}),Nv}var Pv,Fv,qv=!1;function Lv(){return qv||(qv=!0,Pv={},Mv(),Fv=(t,e)=>{Rv(t,e,"channelCount"),Rv(t,e,"channelCountMode"),Rv(t,e,"channelInterpretation")},Pv.assignNativeAudioNodeOptions=Fv),Pv}var Vv,jv,Wv=!1;function Bv(){return Wv||(Wv=!0,(Vv={}).testAnalyserNodeGetFloatTimeDomainDataMethodSupport=jv=t=>"function"==typeof t.getFloatTimeDomainData),Vv}var Uv,zv,Qv=!1;function Hv(){return Qv||(Qv=!0,(Uv={}).wrapAnalyserNodeGetFloatTimeDomainDataMethod=zv=t=>{t.getFloatTimeDomainData=e=>{const n=new Uint8Array(e.length);t.getByteTimeDomainData(n);const i=Math.max(n.length,t.fftSize);for(let t=0;t<i;t+=1)e[t]=.0078125*(n[t]-128);return e}}),Uv}var Gv,Yv,Xv=!1;function Kv(){return Xv||(Xv=!0,Gv={},Mv(),Lv(),Bv(),Hv(),Yv=(t,e,n)=>(i,r)=>{const s=n(i,t=>t.createAnalyser());if(Fv(s,r),!(r.maxDecibels>r.minDecibels))throw e();return Rv(s,r,"fftSize"),Rv(s,r,"maxDecibels"),Rv(s,r,"minDecibels"),Rv(s,r,"smoothingTimeConstant"),t(jv,()=>jv(s))||zv(s),s},Gv.createNativeAnalyserNodeFactory=Yv),Gv}var Zv,$v,Jv=!1;function tm(){return Jv||(Jv=!0,(Zv={}).createNativeAudioBufferConstructor=$v=t=>null===t?null:t.hasOwnProperty("AudioBuffer")?t.AudioBuffer:null),Zv}var em,nm,im=!1;function rm(){return im||(im=!0,(em={}).assignNativeAudioNodeAudioParamValue=nm=(t,e,n)=>{const i=e[n];void 0!==i&&i!==t[n].value&&(t[n].value=i)}),em}var sm,om,am=!1;function cm(){return am||(am=!0,sm={},Cf(),om=t=>{t.start=(e=>{let n=!1;return(i=0,r=0,s)=>{if(n)throw bf();e.call(t,i,r,s),n=!0}})(t.start)},sm.wrapAudioBufferSourceNodeStartMethodConsecutiveCalls=om),sm}var um,hm,lm=!1;function pm(){return lm||(lm=!0,(um={}).wrapAudioBufferSourceNodeStartMethodDurationParameter=hm=(t,e)=>{let n=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY;var r,s;t.start=(r=t.start,s=t.stop,(o=0,a=0,c=Number.POSITIVE_INFINITY)=>{if(r.call(t,o,a),c>=0&&c<Number.POSITIVE_INFINITY){const r=Math.max(o,e.currentTime),a=c/t.playbackRate.value;n=r+a,s.call(t,Math.min(n,i))}}),t.stop=(r=>(s=0)=>{i=Math.max(s,e.currentTime),r.call(t,Math.min(n,i))})(t.stop)}),um}var dm,fm,_m=!1;function vm(){return _m||(_m=!0,(dm={}).wrapAudioScheduledSourceNodeStartMethodNegativeParameters=fm=t=>{var e;t.start=(e=t.start,(n=0,i=0,r)=>{if("number"==typeof r&&r<0||i<0||n<0)throw new RangeError("The parameters can't be negative.");e.call(t,n,i,r)})}),dm}var mm,gm,ym=!1;function bm(){return ym||(ym=!0,(mm={}).wrapAudioScheduledSourceNodeStopMethodNegativeParameters=gm=t=>{var e;t.stop=(e=t.stop,(n=0)=>{if(n<0)throw new RangeError("The parameter can't be negative.");e.call(t,n)})}),mm}var wm,Cm,xm=!1;function Tm(){return xm||(xm=!0,wm={},rm(),Mv(),Lv(),cm(),pm(),vm(),bm(),Cm=(t,e,n,i,r,s,o,a,c,u,h,l,p)=>(d,f)=>{const _=n(d,t=>t.createBufferSource());return Fv(_,f),nm(_,f,"playbackRate"),Rv(_,f,"buffer"),Rv(_,f,"loop"),Rv(_,f,"loopEnd"),Rv(_,f,"loopStart"),e(i,()=>i(d))||om(_),e(r,r)||hm(_,d),e(s,()=>s(d))||h(_),e(o,()=>o(d))||l(_,d),e(a,()=>a(d))||fm(_),e(c,()=>c(d))||p(_,d),e(u,()=>u(d))||gm(_),t(d,_),_},wm.createNativeAudioBufferSourceNodeFactory=Cm),wm}var Sm,Em,Am=!1;function km(){return Am||(Am=!0,(Sm={}).createNativeAudioContextConstructor=Em=t=>null===t?null:t.hasOwnProperty("AudioContext")?t.AudioContext:t.hasOwnProperty("webkitAudioContext")?t.webkitAudioContext:null),Sm}var Om,Dm,Nm=!1;function Rm(){return Nm||(Nm=!0,(Om={}).createNativeAudioDestinationNodeFactory=Dm=(t,e)=>(n,i,r)=>{const s=n.destination;if(s.channelCount!==i)try{s.channelCount=i}catch{}r&&"explicit"!==s.channelCountMode&&(s.channelCountMode="explicit"),0===s.maxChannelCount&&Object.defineProperty(s,"maxChannelCount",{value:i});const o=t(n,{channelCount:i,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,gain:1});return e(o,"channelCount",t=>()=>t.call(o),t=>e=>{t.call(o,e);try{s.channelCount=e}catch(t){if(e>s.maxChannelCount)throw t}}),e(o,"channelCountMode",t=>()=>t.call(o),t=>e=>{t.call(o,e),s.channelCountMode=e}),e(o,"channelInterpretation",t=>()=>t.call(o),t=>e=>{t.call(o,e),s.channelInterpretation=e}),Object.defineProperty(o,"maxChannelCount",{get:()=>s.maxChannelCount}),o.connect(s),o}),Om}var Im,Mm,Pm=!1;function Fm(){return Pm||(Pm=!0,(Im={}).createNativeAudioNodeFactory=Mm=t=>(e,n)=>{const i=t(e);return n(null!==i?i:e)}),Im}var qm,Lm,Vm=!1;function jm(){return Vm||(Vm=!0,(qm={}).createNativeAudioWorkletNodeConstructor=Lm=t=>null===t?null:t.hasOwnProperty("AudioWorkletNode")?t.AudioWorkletNode:null),qm}var Wm,Bm,Um=!1;function zm(){return Um||(Um=!0,(Wm={}).testClonabilityOfAudioWorkletNodeOptions=Bm=t=>{const{port1:e}=new MessageChannel;try{e.postMessage(t)}finally{e.close()}}),Wm}var Qm,Hm,Gm=!1;function Ym(){return Gm||(Gm=!0,Qm={},zm(),Hm=(t,e,n,i,r,s)=>(o,a,c,u,h,l)=>{if(null!==c)try{const n=e(o,t=>new c(t,u,l)),r=new Map;let a=null;if(Object.defineProperties(n,{channelCount:{get:()=>l.channelCount,set:()=>{throw t()}},channelCountMode:{get:()=>"explicit",set:()=>{throw t()}},onprocessorerror:{get:()=>a,set:t=>{"function"==typeof a&&n.removeEventListener("processorerror",a),a="function"==typeof t?t:null,"function"==typeof a&&n.addEventListener("processorerror",a)}}}),n.addEventListener=(d=n.addEventListener,(...t)=>{if("processorerror"===t[0]){const e="function"==typeof t[1]?t[1]:"object"==typeof t[1]&&null!==t[1]&&"function"==typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==e){const n=r.get(t[1]);void 0!==n?t[1]=n:(t[1]=n=>{e(new ErrorEvent(t[0],{...n,error:new Error}))},r.set(e,t[1]))}}return d.call(n,t[0],t[1],t[2])}),n.removeEventListener=(p=n.removeEventListener,(...t)=>{if("processorerror"===t[0]){const e=r.get(t[1]);void 0!==e&&(r.delete(t[1]),t[1]=e)}return p.call(n,t[0],t[1],t[2])}),0!==l.numberOfOutputs){const t=i(o,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return n.connect(t).connect(t.context.destination),s(n,()=>t.disconnect(),()=>t.connect(t.context.destination))}return n}catch(t){if(11===t.code)throw r();throw t}var p,d;if(void 0===h)throw r();return Bm(l),n(o,a,h,l)},Qm.createNativeAudioWorkletNodeFactory=Hm),Qm}var Xm,Km,Zm=!1;function $m(){return Zm||(Zm=!0,(Xm={}).computeBufferSize=Km=(t,e)=>null===t?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(t*e)))))),Xm}var Jm,tg,eg=!1;function ng(){return eg||(eg=!0,(Jm={}).cloneAudioWorkletNodeOptions=tg=t=>new Promise((e,n)=>{const{port1:i,port2:r}=new MessageChannel;i.onmessage=({data:t})=>{i.close(),r.close(),e(t)},i.onmessageerror=({data:t})=>{i.close(),r.close(),n(t)},r.postMessage(t)})),Jm}var ig,rg,sg=!1;function og(){return sg||(sg=!0,ig={},ng(),rg=async(t,e)=>new t(await tg(e)),ig.createAudioWorkletProcessorPromise=rg),ig}var ag,cg,ug=!1;function hg(){return ug||(ug=!0,ag={},Ro(),og(),cg=(t,e,n,i)=>{let r=Do.get(t);void 0===r&&(r=new WeakMap,Do.set(t,r));const s=rg(n,i);return r.set(e,s),s},ag.createAudioWorkletProcessor=cg),ag}var lg,pg,dg=!1;function fg(){return dg||(dg=!0,lg={},qa(),$m(),Kh(),tl(),hg(),rl(),Vh(),pg=(t,e,n,i,r,s,o,a,c,u,h,l,p)=>(d,f,_,v)=>{if(0===v.numberOfInputs&&0===v.numberOfOutputs)throw u();if(void 0!==v.outputChannelCount){if(v.outputChannelCount.some(t=>t<1))throw u();if(v.outputChannelCount.length!==v.numberOfOutputs)throw n()}if("explicit"!==v.channelCountMode)throw u();const m=v.channelCount*v.numberOfInputs,g=v.outputChannelCount.reduce((t,e)=>t+e,0),y=void 0===_.parameterDescriptors?0:_.parameterDescriptors.length;if(m+y>6||g>6)throw u();const b=new MessageChannel,w=[],C=[];for(let t=0;t<v.numberOfInputs;t+=1)w.push(a(d,{channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,gain:1})),C.push(s(d,{channelCount:v.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:v.channelCount}));const x=[];if(void 0!==_.parameterDescriptors)for(const{defaultValue:t,maxValue:e,minValue:n,name:i}of _.parameterDescriptors){const r=o(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:void 0!==v.parameterData[i]?v.parameterData[i]:void 0===t?0:t});Object.defineProperties(r.offset,{defaultValue:{get:()=>void 0===t?0:t},maxValue:{get:()=>void 0===e?Pa:e},minValue:{get:()=>void 0===n?Ma:n}}),x.push(r)}const T=r(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,m+y)}),S=Km(f,d.sampleRate),E=c(d,S,m+y,Math.max(1,g)),A=s(d,{channelCount:Math.max(1,g),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,g)}),k=[];for(let t=0;t<v.numberOfOutputs;t+=1)k.push(r(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:v.outputChannelCount[t]}));for(let t=0;t<v.numberOfInputs;t+=1){w[t].connect(C[t]);for(let e=0;e<v.channelCount;e+=1)C[t].connect(T,e,t*v.channelCount+e)}const O=new qh(void 0===_.parameterDescriptors?[]:_.parameterDescriptors.map(({name:t},e)=>{const n=x[e];return n.connect(T,0,m+e),n.start(0),[t,n.offset]}));T.connect(E);let D=v.channelInterpretation,N=null;const R=0===v.numberOfOutputs?[E]:k,I={get bufferSize(){return S},get channelCount(){return v.channelCount},set channelCount(t){throw i()},get channelCountMode(){return v.channelCountMode},set channelCountMode(t){throw i()},get channelInterpretation(){return D},set channelInterpretation(t){for(const e of w)e.channelInterpretation=t;D=t},get context(){return E.context},get inputs(){return w},get numberOfInputs(){return v.numberOfInputs},get numberOfOutputs(){return v.numberOfOutputs},get onprocessorerror(){return N},set onprocessorerror(t){"function"==typeof N&&I.removeEventListener("processorerror",N),N="function"==typeof t?t:null,"function"==typeof N&&I.addEventListener("processorerror",N)},get parameters(){return O},get port(){return b.port2},addEventListener:(...t)=>E.addEventListener(t[0],t[1],t[2]),connect:e.bind(null,R),disconnect:h.bind(null,R),dispatchEvent:(...t)=>E.dispatchEvent(t[0]),removeEventListener:(...t)=>E.removeEventListener(t[0],t[1],t[2])},M=new Map;var P,F;b.port1.addEventListener=(P=b.port1.addEventListener,(...t)=>{if("message"===t[0]){const e="function"==typeof t[1]?t[1]:"object"==typeof t[1]&&null!==t[1]&&"function"==typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==e){const n=M.get(t[1]);void 0!==n?t[1]=n:(t[1]=t=>{l(d.currentTime,d.sampleRate,()=>e(t))},M.set(e,t[1]))}}return P.call(b.port1,t[0],t[1],t[2])}),b.port1.removeEventListener=(F=b.port1.removeEventListener,(...t)=>{if("message"===t[0]){const e=M.get(t[1]);void 0!==e&&(M.delete(t[1]),t[1]=e)}return F.call(b.port1,t[0],t[1],t[2])});let q=null;Object.defineProperty(b.port1,"onmessage",{get:()=>q,set:t=>{"function"==typeof q&&b.port1.removeEventListener("message",q),q="function"==typeof t?t:null,"function"==typeof q&&(b.port1.addEventListener("message",q),b.port1.start())}}),_.prototype.port=b.port1;let L=null;cg(d,I,_,v).then(t=>L=t);const V=nl(v.numberOfInputs,v.channelCount),j=nl(v.numberOfOutputs,v.outputChannelCount),W=void 0===_.parameterDescriptors?[]:_.parameterDescriptors.reduce((t,{name:e})=>({...t,[e]:new Float32Array(128)}),{});let B=!0;const U=()=>{v.numberOfOutputs>0&&E.disconnect(A);for(let t=0,e=0;t<v.numberOfOutputs;t+=1){const n=k[t];for(let i=0;i<v.outputChannelCount[t];i+=1)A.disconnect(n,e+i,i);e+=v.outputChannelCount[t]}};E.onaudioprocess=({inputBuffer:e,outputBuffer:n})=>{if(null!==L)for(let i=0;i<S;i+=128){for(let t=0;t<v.numberOfInputs;t+=1)for(let n=0;n<v.channelCount;n+=1)Xh(e,V[t],n,n,i);void 0!==_.parameterDescriptors&&_.parameterDescriptors.forEach(({name:t},n)=>{Xh(e,W,t,m+n,i)});for(let t=0;t<v.numberOfInputs;t+=1)for(let e=0;e<v.outputChannelCount[t];e+=1)0===j[t][e].byteLength&&(j[t][e]=new Float32Array(128));try{const e=V.map((e,n)=>{const i=t.get(I);return void 0===i||void 0===i.get(n)?[]:e}),r=l(d.currentTime+i/d.sampleRate,d.sampleRate,()=>L.process(e,j,W));B=r;for(let t=0,e=0;t<v.numberOfOutputs;t+=1){for(let r=0;r<v.outputChannelCount[t];r+=1)$h(n,j[t],r,e+r,i);e+=v.outputChannelCount[t]}}catch(t){B=!1,I.dispatchEvent(new ErrorEvent("processorerror",{error:t}))}if(!B){for(let t=0;t<v.numberOfInputs;t+=1){w[t].disconnect(C[t]);for(let e=0;e<v.channelCount;e+=1)C[i].disconnect(T,e,t*v.channelCount+e)}if(void 0!==_.parameterDescriptors){const t=_.parameterDescriptors.length;for(let e=0;e<t;e+=1){const t=x[e];t.disconnect(T,0,m+e),t.stop()}}T.disconnect(E),E.onaudioprocess=null,z?U():G();break}}};let z=!1;const Q=a(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),H=()=>E.connect(Q).connect(Q.context.destination),G=()=>{E.disconnect(Q),Q.disconnect()};return H(),p(I,()=>{if(B){G(),v.numberOfOutputs>0&&E.connect(A);for(let t=0,e=0;t<v.numberOfOutputs;t+=1){const n=k[t];for(let i=0;i<v.outputChannelCount[t];i+=1)A.connect(n,e+i,i);e+=v.outputChannelCount[t]}}z=!0},()=>{B&&(H(),U()),z=!1})},lg.createNativeAudioWorkletNodeFakerFactory=pg),lg}var _g,vg,mg=!1;function gg(){return mg||(mg=!0,_g={},rm(),Mv(),Lv(),vg=t=>(e,n)=>{const i=t(e,t=>t.createBiquadFilter());return Fv(i,n),nm(i,n,"Q"),nm(i,n,"detune"),nm(i,n,"frequency"),nm(i,n,"gain"),Rv(i,n,"type"),i},_g.createNativeBiquadFilterNodeFactory=vg),_g}var yg,bg,wg=!1;function Cg(){return wg||(wg=!0,yg={},Lv(),bg=(t,e)=>(n,i)=>{const r=t(n,t=>t.createChannelMerger(i.numberOfInputs));return 1!==r.channelCount&&"explicit"!==r.channelCountMode&&e(n,r),Fv(r,i),r},yg.createNativeChannelMergerNodeFactory=bg),yg}var xg,Tg,Sg=!1;function Eg(){return Sg||(Sg=!0,xg={},Cf(),Tg=t=>{const e=t.numberOfOutputs;Object.defineProperty(t,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw bf()}}),Object.defineProperty(t,"channelCountMode",{get:()=>"explicit",set:t=>{if("explicit"!==t)throw bf()}}),Object.defineProperty(t,"channelInterpretation",{get:()=>"discrete",set:t=>{if("discrete"!==t)throw bf()}})},xg.wrapChannelSplitterNode=Tg),xg}var Ag,kg,Og=!1;function Dg(){return Og||(Og=!0,Ag={},Lv(),Eg(),kg=t=>(e,n)=>{const i=t(e,t=>t.createChannelSplitter(n.numberOfOutputs));return Fv(i,n),Tg(i),i},Ag.createNativeChannelSplitterNodeFactory=kg),Ag}var Ng,Rg,Ig=!1;function Mg(){return Ig||(Ig=!0,Ng={},rm(),Lv(),vm(),bm(),Rg=(t,e,n,i,r,s)=>(o,a)=>{if(void 0===o.createConstantSource)return i(o,a);const c=n(o,t=>t.createConstantSource());return Fv(c,a),nm(c,a,"offset"),e(r,()=>r(o))||fm(c),e(s,()=>s(o))||gm(c),t(o,c),c},Ng.createNativeConstantSourceNodeFactory=Rg),Ng}var Pg,Fg,qg=!1;function Lg(){return qg||(qg=!0,(Pg={}).interceptConnections=Fg=(t,e)=>(t.connect=e.connect.bind(e),t.disconnect=e.disconnect.bind(e),t)),Pg}var Vg,jg,Wg=!1;function Bg(){return Wg||(Wg=!0,Vg={},Lg(),jg=(t,e,n,i)=>(r,{offset:s,...o})=>{const a=r.createBuffer(1,2,r.sampleRate),c=e(r,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),u=n(r,{...o,gain:s}),h=a.getChannelData(0);h[0]=1,h[1]=1,c.buffer=a,c.loop=!0;const l={get bufferSize(){},get channelCount(){return u.channelCount},set channelCount(t){u.channelCount=t},get channelCountMode(){return u.channelCountMode},set channelCountMode(t){u.channelCountMode=t},get channelInterpretation(){return u.channelInterpretation},set channelInterpretation(t){u.channelInterpretation=t},get context(){return u.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return u.numberOfOutputs},get offset(){return u.gain},get onended(){return c.onended},set onended(t){c.onended=t},addEventListener:(...t)=>c.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>c.dispatchEvent(t[0]),removeEventListener:(...t)=>c.removeEventListener(t[0],t[1],t[2]),start(t=0){c.start.call(c,t)},stop(t=0){c.stop.call(c,t)}};return t(r,c),i(Fg(l,u),()=>c.connect(u),()=>c.disconnect(u))},Vg.createNativeConstantSourceNodeFakerFactory=jg),Vg}var Ug,zg,Qg=!1;function Hg(){return Qg||(Qg=!0,Ug={},Mv(),Lv(),zg=(t,e,n,i)=>(r,s)=>{const o=t(r,t=>t.createConvolver());try{o.channelCount=1}catch(t){return e(r,s)}if(Fv(o,s),s.disableNormalization===o.normalize&&(o.normalize=!s.disableNormalization),Rv(o,s,"buffer"),s.channelCount>2)throw n();if(i(o,"channelCount",t=>()=>t.call(o),t=>e=>{if(e>2)throw n();return t.call(o,e)}),"max"===s.channelCountMode)throw n();return i(o,"channelCountMode",t=>()=>t.call(o),t=>e=>{if("max"===e)throw n();return t.call(o,e)}),o},Ug.createNativeConvolverNodeFactory=zg),Ug}var Gg,Yg,Xg=!1;function Kg(){return Xg||(Xg=!0,Gg={},Lv(),Lg(),Yg=(t,e,n)=>(i,{buffer:r,channelCount:s,channelCountMode:o,channelInterpretation:a,disableNormalization:c})=>{const u=t(i,t=>t.createConvolver());Fv(u,{channelCount:Math.max(s,2),channelCountMode:"max"===o?o:"clamped-max",channelInterpretation:a});const h=e(i,{channelCount:s,channelCountMode:o,channelInterpretation:a,gain:1}),l={get buffer(){return u.buffer},set buffer(t){u.buffer=t},get bufferSize(){},get channelCount(){return h.channelCount},set channelCount(t){t>2&&(u.channelCount=t),h.channelCount=t},get channelCountMode(){return h.channelCountMode},set channelCountMode(t){"max"===t&&(u.channelCountMode=t),h.channelCountMode=t},get channelInterpretation(){return u.channelInterpretation},set channelInterpretation(t){u.channelInterpretation=t,h.channelInterpretation=t},get context(){return u.context},get inputs(){return[u]},get numberOfInputs(){return u.numberOfInputs},get numberOfOutputs(){return u.numberOfOutputs},get normalize(){return u.normalize},set normalize(t){u.normalize=t},addEventListener:(...t)=>u.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>u.dispatchEvent(t[0]),removeEventListener:(...t)=>u.removeEventListener(t[0],t[1],t[2])};return c===l.normalize&&(l.normalize=!c),r!==l.buffer&&(l.buffer=r),n(Fg(l,h),()=>u.connect(h),()=>u.disconnect(h))},Gg.createNativeConvolverNodeFakerFactory=Yg),Gg}var Zg,$g,Jg=!1;function ty(){return Jg||(Jg=!0,Zg={},rm(),Lv(),$g=t=>(e,n)=>{const i=t(e,t=>t.createDelay(n.maxDelayTime));return Fv(i,n),nm(i,n,"delayTime"),i},Zg.createNativeDelayNodeFactory=$g),Zg}var ey,ny,iy=!1;function ry(){return iy||(iy=!0,ey={},rm(),Lv(),ny=(t,e)=>(n,i)=>{const r=t(n,t=>t.createDynamicsCompressor());if(Fv(r,i),i.channelCount>2)throw e();if("max"===i.channelCountMode)throw e();return nm(r,i,"attack"),nm(r,i,"knee"),nm(r,i,"ratio"),nm(r,i,"release"),nm(r,i,"threshold"),r},ey.createNativeDynamicsCompressorNodeFactory=ny),ey}var sy,oy,ay=!1;function cy(){return ay||(ay=!0,sy={},rm(),Lv(),oy=t=>(e,n)=>{const i=t(e,t=>t.createGain());return Fv(i,n),nm(i,n,"gain"),i},sy.createNativeGainNodeFactory=oy),sy}var uy,hy,ly=!1;function py(){return ly||(ly=!0,uy={},Lv(),hy=(t,e)=>(n,i,r)=>{if(void 0===n.createIIRFilter)return e(n,i,r);const s=t(n,t=>t.createIIRFilter(r.feedforward,r.feedback));return Fv(s,r),s},uy.createNativeIIRFilterNodeFactory=hy),uy}var dy,fy,_y=!1;function vy(t,e){const n=e[0]*e[0]+e[1]*e[1];return[(t[0]*e[0]+t[1]*e[1])/n,(t[1]*e[0]-t[0]*e[1])/n]}function my(t,e){let n=[0,0];for(let s=t.length-1;s>=0;s-=1)r=e,n=[(i=n)[0]*r[0]-i[1]*r[1],i[0]*r[1]+i[1]*r[0]],n[0]+=t[s];var i,r;return n}function gy(){return _y||(_y=!0,dy={},$m(),Gf(),Lg(),fy=(t,e,n,i)=>(r,s,{channelCount:o,channelCountMode:a,channelInterpretation:c,feedback:u,feedforward:h})=>{const l=Km(s,r.sampleRate),p=u.length,d=h.length,f=Math.min(p,d);if(0===u.length||u.length>20)throw i();if(0===u[0])throw e();if(0===h.length||h.length>20)throw i();if(0===h[0])throw e();if(1!==u[0]){for(let t=0;t<d;t+=1)h[t]/=u[0];for(let t=1;t<p;t+=1)u[t]/=u[0]}const _=n(r,l,o,o);_.channelCount=o,_.channelCountMode=a,_.channelInterpretation=c;const v=[],m=[],g=[];for(let t=0;t<o;t+=1){v.push(0);const t=new Float32Array(32),e=new Float32Array(32);t.fill(0),e.fill(0),m.push(t),g.push(e)}_.onaudioprocess=t=>{const e=t.inputBuffer,n=t.outputBuffer,i=e.numberOfChannels;for(let t=0;t<i;t+=1){const i=e.getChannelData(t),r=n.getChannelData(t);v[t]=Qf(u,p,h,d,f,m[t],g[t],v[t],32,i,r)}};const y=r.sampleRate/2;return Fg({get bufferSize(){return l},get channelCount(){return _.channelCount},set channelCount(t){_.channelCount=t},get channelCountMode(){return _.channelCountMode},set channelCountMode(t){_.channelCountMode=t},get channelInterpretation(){return _.channelInterpretation},set channelInterpretation(t){_.channelInterpretation=t},get context(){return _.context},get inputs(){return[_]},get numberOfInputs(){return _.numberOfInputs},get numberOfOutputs(){return _.numberOfOutputs},addEventListener:(...t)=>_.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>_.dispatchEvent(t[0]),getFrequencyResponse(e,n,i){if(e.length!==n.length||n.length!==i.length)throw t();const r=e.length;for(let t=0;t<r;t+=1){const r=-Math.PI*(e[t]/y),s=[Math.cos(r),Math.sin(r)],o=vy(my(h,s),my(u,s));n[t]=Math.sqrt(o[0]*o[0]+o[1]*o[1]),i[t]=Math.atan2(o[1],o[0])}},removeEventListener:(...t)=>_.removeEventListener(t[0],t[1],t[2])},_)},dy.createNativeIIRFilterNodeFakerFactory=fy),dy}var yy,by,wy=!1;function Cy(){return wy||(wy=!0,(yy={}).createNativeMediaElementAudioSourceNodeFactory=by=t=>(e,n)=>t(e,t=>t.createMediaElementSource(n.mediaElement))),yy}var xy,Ty,Sy=!1;function Ey(){return Sy||(Sy=!0,xy={},Lv(),Ty=(t,e)=>(n,i)=>{if(void 0===n.createMediaStreamDestination)throw e();const r=t(n,t=>t.createMediaStreamDestination());return Fv(r,i),1===r.numberOfOutputs&&Object.defineProperty(r,"numberOfOutputs",{get:()=>0}),r},xy.createNativeMediaStreamAudioDestinationNodeFactory=Ty),xy}var Ay,ky,Oy=!1;function Dy(){return Oy||(Oy=!0,(Ay={}).createNativeMediaStreamAudioSourceNodeFactory=ky=t=>(e,{mediaStream:n})=>{const i=n.getAudioTracks(),r=t(e,t=>{const e=i.sort((t,e)=>t.id<e.id?-1:t.id>e.id?1:0).slice(0,1);return t.createMediaStreamSource(new MediaStream(e))});return Object.defineProperty(r,"mediaStream",{value:n}),r}),Ay}var Ny,Ry,Iy=!1;function My(){return Iy||(Iy=!0,(Ny={}).createNativeMediaStreamTrackAudioSourceNodeFactory=Ry=(t,e,n)=>(i,{mediaStreamTrack:r})=>"function"==typeof i.createMediaStreamTrackSource?e(i,t=>t.createMediaStreamTrackSource(r)):e(i,e=>{const i=new MediaStream([r]),s=e.createMediaStreamSource(i);if("audio"!==r.kind)throw t();if(n(e))throw new TypeError;return s})),Ny}var Py,Fy,qy=!1;function Ly(){return qy||(qy=!0,(Py={}).createNativeOfflineAudioContextConstructor=Fy=t=>null===t?null:t.hasOwnProperty("OfflineAudioContext")?t.OfflineAudioContext:t.hasOwnProperty("webkitOfflineAudioContext")?t.webkitOfflineAudioContext:null),Py}var Vy,jy,Wy=!1;function By(){return Wy||(Wy=!0,Vy={},rm(),Mv(),Lv(),vm(),bm(),jy=(t,e,n,i,r,s,o)=>(a,c)=>{const u=n(a,t=>t.createOscillator());return Fv(u,c),nm(u,c,"detune"),nm(u,c,"frequency"),void 0!==c.periodicWave?u.setPeriodicWave(c.periodicWave):Rv(u,c,"type"),e(i,()=>i(a))||fm(u),e(r,()=>r(a))||o(u,a),e(s,()=>s(a))||gm(u),t(a,u),u},Vy.createNativeOscillatorNodeFactory=jy),Vy}var Uy,zy,Qy=!1;function Hy(){return Qy||(Qy=!0,Uy={},rm(),Mv(),Lv(),zy=(t,e)=>(n,i)=>{const r=t(n,t=>t.createPanner());return void 0===r.orientationX?e(n,i):(Fv(r,i),nm(r,i,"orientationX"),nm(r,i,"orientationY"),nm(r,i,"orientationZ"),nm(r,i,"positionX"),nm(r,i,"positionY"),nm(r,i,"positionZ"),Rv(r,i,"coneInnerAngle"),Rv(r,i,"coneOuterAngle"),Rv(r,i,"coneOuterGain"),Rv(r,i,"distanceModel"),Rv(r,i,"maxDistance"),Rv(r,i,"panningModel"),Rv(r,i,"refDistance"),Rv(r,i,"rolloffFactor"),r)},Uy.createNativePannerNodeFactory=zy),Uy}var Gy,Yy,Xy=!1;function Ky(){return Xy||(Xy=!0,Gy={},Lv(),Lg(),Yy=(t,e,n,i,r,s,o,a,c,u)=>(h,{coneInnerAngle:l,coneOuterAngle:p,coneOuterGain:d,distanceModel:f,maxDistance:_,orientationX:v,orientationY:m,orientationZ:g,panningModel:y,positionX:b,positionY:w,positionZ:C,refDistance:x,rolloffFactor:T,...S})=>{const E=n(h,t=>t.createPanner());if(S.channelCount>2)throw a();if("max"===S.channelCountMode)throw a();Fv(E,S);const A={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},k=i(h,{...A,channelInterpretation:"speakers",numberOfInputs:6}),O=r(h,{...S,gain:1}),D=r(h,{...A,gain:1}),N=r(h,{...A,gain:0}),R=r(h,{...A,gain:0}),I=r(h,{...A,gain:0}),M=r(h,{...A,gain:0}),P=r(h,{...A,gain:0}),F=s(h,256,6,1),q=o(h,{...A,curve:new Float32Array([1,1]),oversample:"none"});let L=[v,m,g],V=[b,w,C];F.onaudioprocess=({inputBuffer:t})=>{const e=[t.getChannelData(0)[0],t.getChannelData(1)[0],t.getChannelData(2)[0]];e.some((t,e)=>t!==L[e])&&(E.setOrientation(...e),L=e);const n=[t.getChannelData(3)[0],t.getChannelData(4)[0],t.getChannelData(5)[0]];n.some((t,e)=>t!==V[e])&&(E.setPosition(...n),V=n)},Object.defineProperty(N.gain,"defaultValue",{get:()=>0}),Object.defineProperty(R.gain,"defaultValue",{get:()=>0}),Object.defineProperty(I.gain,"defaultValue",{get:()=>0}),Object.defineProperty(M.gain,"defaultValue",{get:()=>0}),Object.defineProperty(P.gain,"defaultValue",{get:()=>0});const j={get bufferSize(){},get channelCount(){return E.channelCount},set channelCount(t){if(t>2)throw a();O.channelCount=t,E.channelCount=t},get channelCountMode(){return E.channelCountMode},set channelCountMode(t){if("max"===t)throw a();O.channelCountMode=t,E.channelCountMode=t},get channelInterpretation(){return E.channelInterpretation},set channelInterpretation(t){O.channelInterpretation=t,E.channelInterpretation=t},get coneInnerAngle(){return E.coneInnerAngle},set coneInnerAngle(t){E.coneInnerAngle=t},get coneOuterAngle(){return E.coneOuterAngle},set coneOuterAngle(t){E.coneOuterAngle=t},get coneOuterGain(){return E.coneOuterGain},set coneOuterGain(t){if(t<0||t>1)throw e();E.coneOuterGain=t},get context(){return E.context},get distanceModel(){return E.distanceModel},set distanceModel(t){E.distanceModel=t},get inputs(){return[O]},get maxDistance(){return E.maxDistance},set maxDistance(t){if(t<0)throw new RangeError;E.maxDistance=t},get numberOfInputs(){return E.numberOfInputs},get numberOfOutputs(){return E.numberOfOutputs},get orientationX(){return D.gain},get orientationY(){return N.gain},get orientationZ(){return R.gain},get panningModel(){return E.panningModel},set panningModel(t){if(E.panningModel=t,E.panningModel!==t&&"HRTF"===t)throw a()},get positionX(){return I.gain},get positionY(){return M.gain},get positionZ(){return P.gain},get refDistance(){return E.refDistance},set refDistance(t){if(t<0)throw new RangeError;E.refDistance=t},get rolloffFactor(){return E.rolloffFactor},set rolloffFactor(t){if(t<0)throw new RangeError;E.rolloffFactor=t},addEventListener:(...t)=>O.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>O.dispatchEvent(t[0]),removeEventListener:(...t)=>O.removeEventListener(t[0],t[1],t[2])};return l!==j.coneInnerAngle&&(j.coneInnerAngle=l),p!==j.coneOuterAngle&&(j.coneOuterAngle=p),d!==j.coneOuterGain&&(j.coneOuterGain=d),f!==j.distanceModel&&(j.distanceModel=f),_!==j.maxDistance&&(j.maxDistance=_),v!==j.orientationX.value&&(j.orientationX.value=v),m!==j.orientationY.value&&(j.orientationY.value=m),g!==j.orientationZ.value&&(j.orientationZ.value=g),y!==j.panningModel&&(j.panningModel=y),b!==j.positionX.value&&(j.positionX.value=b),w!==j.positionY.value&&(j.positionY.value=w),C!==j.positionZ.value&&(j.positionZ.value=C),x!==j.refDistance&&(j.refDistance=x),T!==j.rolloffFactor&&(j.rolloffFactor=T),1===L[0]&&0===L[1]&&0===L[2]||E.setOrientation(...L),0===V[0]&&0===V[1]&&0===V[2]||E.setPosition(...V),u(Fg(j,E),()=>{O.connect(E),t(O,q,0,0),q.connect(D).connect(k,0,0),q.connect(N).connect(k,0,1),q.connect(R).connect(k,0,2),q.connect(I).connect(k,0,3),q.connect(M).connect(k,0,4),q.connect(P).connect(k,0,5),k.connect(F).connect(h.destination)},()=>{O.disconnect(E),c(O,q,0,0),q.disconnect(D),D.disconnect(k),q.disconnect(N),N.disconnect(k),q.disconnect(R),R.disconnect(k),q.disconnect(I),I.disconnect(k),q.disconnect(M),M.disconnect(k),q.disconnect(P),P.disconnect(k),k.disconnect(F),F.disconnect(h.destination)})},Gy.createNativePannerNodeFakerFactory=Yy),Gy}var Zy,$y,Jy=!1;function tb(){return Jy||(Jy=!0,(Zy={}).createNativePeriodicWaveFactory=$y=t=>(e,{disableNormalization:n,imag:i,real:r})=>{const s=t(e),o=new Float32Array(i),a=new Float32Array(r);return null!==s?s.createPeriodicWave(a,o,{disableNormalization:n}):e.createPeriodicWave(a,o,{disableNormalization:n})}),Zy}var eb,nb,ib=!1;function rb(){return ib||(ib=!0,(eb={}).createNativeScriptProcessorNodeFactory=nb=t=>(e,n,i,r)=>t(e,t=>t.createScriptProcessor(n,i,r))),eb}var sb,ob,ab=!1;function cb(){return ab||(ab=!0,sb={},rm(),Lv(),ob=(t,e,n)=>(i,r)=>t(i,t=>{const s=r.channelCountMode;if("clamped-max"===s)throw n();if(void 0===i.createStereoPanner)return e(i,r);const o=t.createStereoPanner();return Fv(o,r),nm(o,r,"pan"),Object.defineProperty(o,"channelCountMode",{get:()=>s,set:t=>{if(t!==s)throw n()}}),o}),sb.createNativeStereoPannerNodeFactory=ob),sb}var ub,hb,lb=!1;function pb(){ub={},Lg(),hb=(t,e,n,i,r,s)=>{const o=new Float32Array([1,1]),a=Math.PI/2,c={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...c,oversample:"none"},h=(t,s,h,l,p)=>{if(1===s)return((t,e,r,s)=>{const h=new Float32Array(16385),l=new Float32Array(16385);for(let t=0;t<16385;t+=1){const e=t/16384*a;h[t]=Math.cos(e),l[t]=Math.sin(e)}const p=n(t,{...c,gain:0}),d=i(t,{...u,curve:h}),f=i(t,{...u,curve:o}),_=n(t,{...c,gain:0}),v=i(t,{...u,curve:l});return{connectGraph(){e.connect(p),e.connect(f.inputs[0]),e.connect(_),f.connect(r),r.connect(d.inputs[0]),r.connect(v.inputs[0]),d.connect(p.gain),v.connect(_.gain),p.connect(s,0,0),_.connect(s,0,1)},disconnectGraph(){e.disconnect(p),e.disconnect(f.inputs[0]),e.disconnect(_),f.disconnect(r),r.disconnect(d.inputs[0]),r.disconnect(v.inputs[0]),d.disconnect(p.gain),v.disconnect(_.gain),p.disconnect(s,0,0),_.disconnect(s,0,1)}}})(t,h,l,p);if(2===s)return((t,r,s,h)=>{const l=new Float32Array(16385),p=new Float32Array(16385),d=new Float32Array(16385),f=new Float32Array(16385),_=Math.floor(8192.5);for(let t=0;t<16385;t+=1)if(t>_){const e=(t-_)/(16384-_)*a;l[t]=Math.cos(e),p[t]=Math.sin(e),d[t]=0,f[t]=1}else{const e=t/(16384-_)*a;l[t]=1,p[t]=0,d[t]=Math.cos(e),f[t]=Math.sin(e)}const v=e(t,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),m=n(t,{...c,gain:0}),g=i(t,{...u,curve:l}),y=n(t,{...c,gain:0}),b=i(t,{...u,curve:p}),w=i(t,{...u,curve:o}),C=n(t,{...c,gain:0}),x=i(t,{...u,curve:d}),T=n(t,{...c,gain:0}),S=i(t,{...u,curve:f});return{connectGraph(){r.connect(v),r.connect(w.inputs[0]),v.connect(m,1),v.connect(y,1),v.connect(C,1),v.connect(T,1),w.connect(s),s.connect(g.inputs[0]),s.connect(b.inputs[0]),s.connect(x.inputs[0]),s.connect(S.inputs[0]),g.connect(m.gain),b.connect(y.gain),x.connect(C.gain),S.connect(T.gain),m.connect(h,0,0),C.connect(h,0,0),y.connect(h,0,1),T.connect(h,0,1)},disconnectGraph(){r.disconnect(v),r.disconnect(w.inputs[0]),v.disconnect(m,1),v.disconnect(y,1),v.disconnect(C,1),v.disconnect(T,1),w.disconnect(s),s.disconnect(g.inputs[0]),s.disconnect(b.inputs[0]),s.disconnect(x.inputs[0]),s.disconnect(S.inputs[0]),g.disconnect(m.gain),b.disconnect(y.gain),x.disconnect(C.gain),S.disconnect(T.gain),m.disconnect(h,0,0),C.disconnect(h,0,0),y.disconnect(h,0,1),T.disconnect(h,0,1)}}})(t,h,l,p);throw r()};return(e,{channelCount:i,channelCountMode:o,pan:a,...c})=>{if("max"===o)throw r();const u=t(e,{...c,channelCount:1,channelCountMode:o,numberOfInputs:2}),l=n(e,{...c,channelCount:i,channelCountMode:o,gain:1}),p=n(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:a});let{connectGraph:d,disconnectGraph:f}=h(e,i,l,p,u);Object.defineProperty(p.gain,"defaultValue",{get:()=>0});const _={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(t){l.channelCount!==t&&(v&&f(),({connectGraph:d,disconnectGraph:f}=h(e,t,l,p,u)),v&&d()),l.channelCount=t},get channelCountMode(){return l.channelCountMode},set channelCountMode(t){if("clamped-max"===t||"max"===t)throw r();l.channelCountMode=t},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(t){l.channelInterpretation=t},get context(){return l.context},get inputs(){return[l]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get pan(){return p.gain},addEventListener:(...t)=>l.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>l.dispatchEvent(t[0]),removeEventListener:(...t)=>l.removeEventListener(t[0],t[1],t[2])};let v=!1;return s(Fg(_,u),()=>{d(),v=!0},()=>{f(),v=!1})}},ub.createNativeStereoPannerNodeFakerFactory=hb}var db,fb,_b=!1;function vb(){return _b||(_b=!0,db={},Mv(),Lv(),fb=(t,e,n,i,r,s,o)=>(a,c)=>{const u=n(a,t=>t.createWaveShaper());try{return u.curve=new Float32Array([1]),i(a,c)}catch{}Fv(u,c);const h=c.curve;if(null!==h&&h.length<2)throw e();Rv(u,c,"curve"),Rv(u,c,"oversample");let l=null,p=!1;return o(u,"curve",t=>()=>t.call(u),e=>n=>(e.call(u,n),p&&(r(n)&&null===l?l=t(a,u):r(n)||null===l||(l(),l=null)),n)),s(u,()=>{p=!0,r(u.curve)&&(l=t(a,u))},()=>{p=!1,null!==l&&(l(),l=null)})},db.createNativeWaveShaperNodeFactory=fb),db}var mb,gb,yb=!1;function bb(){return yb||(yb=!0,mb={},Lv(),Lg(),gb=(t,e,n,i,r,s)=>(o,{curve:a,oversample:c,...u})=>{const h=n(o,t=>t.createWaveShaper()),l=n(o,t=>t.createWaveShaper());Fv(h,u),Fv(l,u);const p=i(o,{...u,gain:1}),d=i(o,{...u,gain:-1}),f=i(o,{...u,gain:1}),_=i(o,{...u,gain:-1});let v=null,m=!1,g=null;const y={get bufferSize(){},get channelCount(){return h.channelCount},set channelCount(t){p.channelCount=t,d.channelCount=t,h.channelCount=t,f.channelCount=t,l.channelCount=t,_.channelCount=t},get channelCountMode(){return h.channelCountMode},set channelCountMode(t){p.channelCountMode=t,d.channelCountMode=t,h.channelCountMode=t,f.channelCountMode=t,l.channelCountMode=t,_.channelCountMode=t},get channelInterpretation(){return h.channelInterpretation},set channelInterpretation(t){p.channelInterpretation=t,d.channelInterpretation=t,h.channelInterpretation=t,f.channelInterpretation=t,l.channelInterpretation=t,_.channelInterpretation=t},get context(){return h.context},get curve(){return g},set curve(n){if(null!==a&&a.length<2)throw e();if(null===n)h.curve=n,l.curve=n;else{const t=n.length,e=new Float32Array(t+2-t%2),i=new Float32Array(t+2-t%2);e[0]=n[0],i[0]=-n[t-1];const r=Math.ceil((t+1)/2),s=(t+1)/2-1;for(let o=1;o<r;o+=1){const a=o/r*s,c=Math.floor(a),u=Math.ceil(a);e[o]=c===u?n[c]:(1-(a-c))*n[c]+(1-(u-a))*n[u],i[o]=c===u?-n[t-1-c]:-(1-(a-c))*n[t-1-c]-(1-(u-a))*n[t-1-u]}e[r]=t%2==1?n[r-1]:(n[r-2]+n[r-1])/2,h.curve=e,l.curve=i}g=n,m&&(r(g)&&null===v?v=t(o,p):null!==v&&(v(),v=null))},get inputs(){return[p]},get numberOfInputs(){return h.numberOfInputs},get numberOfOutputs(){return h.numberOfOutputs},get oversample(){return h.oversample},set oversample(t){h.oversample=t,l.oversample=t},addEventListener:(...t)=>p.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>p.dispatchEvent(t[0]),removeEventListener:(...t)=>p.removeEventListener(t[0],t[1],t[2])};return a!==y.curve&&(y.curve=a),c!==y.oversample&&(y.oversample=c),s(Fg(y,f),()=>{p.connect(h).connect(f),p.connect(d).connect(l).connect(_).connect(f),m=!0,r(g)&&(v=t(o,p))},()=>{p.disconnect(h),h.disconnect(f),p.disconnect(d),d.disconnect(l),l.disconnect(_),_.disconnect(f),m=!1,null!==v&&(v(),v=null)})},mb.createNativeWaveShaperNodeFakerFactory=gb),mb}var wb,Cb,xb=!1;function Tb(){return xb||(xb=!0,(wb={}).createNotSupportedError=Cb=()=>{try{return new DOMException("","NotSupportedError")}catch(t){return t.code=9,t.name="NotSupportedError",t}}),wb}var Sb,Eb,Ab,kb=!1;function Ob(){return kb||(kb=!0,Sb={},wv(),Eb={numberOfChannels:1},Ab=(t,e,n,i,r)=>class extends t{constructor(t,n,r){let s;if("number"==typeof t&&void 0!==n&&void 0!==r)s={length:n,numberOfChannels:t,sampleRate:r};else{if("object"!=typeof t)throw new Error("The given parameters are not valid.");s=t}const{length:o,numberOfChannels:a,sampleRate:c}={...Eb,...s},u=i(a,o,c);e(yv,()=>yv(u))||u.addEventListener("statechange",(()=>{let t=0;const e=n=>{"running"===this._state&&(t>0?(u.removeEventListener("statechange",e),n.stopImmediatePropagation(),this._waitForThePromiseToSettle(n)):t+=1)};return e})()),super(u,a),this._length=o,this._nativeOfflineAudioContext=u,this._state=null}get length(){return void 0===this._nativeOfflineAudioContext.length?this._length:this._nativeOfflineAudioContext.length}get state(){return null===this._state?this._nativeOfflineAudioContext.state:this._state}startRendering(){return"running"===this._state?Promise.reject(n()):(this._state="running",r(this.destination,this._nativeOfflineAudioContext).then(t=>(this._state=null,t)).catch(t=>{throw this._state=null,t}))}_waitForThePromiseToSettle(t){null===this._state?this._nativeOfflineAudioContext.dispatchEvent(t):setTimeout(()=>this._waitForThePromiseToSettle(t))}},Sb.createOfflineAudioContextConstructor=Ab),Sb}var Db,Nb,Rb,Ib=!1;function Mb(){return Ib||(Ib=!0,Db={},Xa(),Ja(),Nb={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,type:"sine"},Rb=(t,e,n,i,r,s,o,a)=>class extends t{constructor(t,n=Nb){const a=s(t),c={...Nb,...n},u=i(a,c),h=o(a),l=h?r():null,p=t.sampleRate/2;super(t,!1,u,l),this._detune=e(this,h,u.detune,153600,-153600),this._frequency=e(this,h,u.frequency,p,-p),this._nativeOscillatorNode=u,this._onended=null,this._oscillatorNodeRenderer=l,null!==this._oscillatorNodeRenderer&&void 0!==c.periodicWave&&(this._oscillatorNodeRenderer.periodicWave=c.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(t){const e="function"==typeof t?a(this,t):null;this._nativeOscillatorNode.onended=e;const n=this._nativeOscillatorNode.onended;this._onended=null!==n&&n===e?t:n}get type(){return this._nativeOscillatorNode.type}set type(t){if(this._nativeOscillatorNode.type=t,"custom"===t)throw n();null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(t){this._nativeOscillatorNode.setPeriodicWave(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=t)}start(t=0){if(this._nativeOscillatorNode.start(t),null!==this._oscillatorNodeRenderer)this._oscillatorNodeRenderer.start=t;else{Ga(this);const t=()=>{this._nativeOscillatorNode.removeEventListener("ended",t),setTimeout(()=>Za(this),1e3)};this._nativeOscillatorNode.addEventListener("ended",t)}}stop(t=0){this._nativeOscillatorNode.stop(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.stop=t)}},Db.createOscillatorNodeConstructor=Rb),Db}var Pb,Fb,qb=!1;function Lb(){Pb={},la(),Fb=(t,e,n,i,r)=>()=>{const s=new WeakMap;let o=null,a=null,c=null;return{set periodicWave(t){o=t},set start(t){a=t},set stop(t){c=t},render(u,h,l){const p=s.get(h);return void 0!==p?Promise.resolve(p):(async(u,h,l)=>{let p=n(u);const d=ua(p,h);if(!d){const t={channelCount:p.channelCount,channelCountMode:p.channelCountMode,channelInterpretation:p.channelInterpretation,detune:p.detune.value,frequency:p.frequency.value,periodicWave:null===o?void 0:o,type:p.type};p=e(h,t),null!==a&&p.start(a),null!==c&&p.stop(c)}return s.set(h,p),d?(await t(h,u.detune,p.detune,l),await t(h,u.frequency,p.frequency,l)):(await i(h,u.detune,p.detune,l),await i(h,u.frequency,p.frequency,l)),await r(u,h,p,l),p})(u,h,l)}}},Pb.createOscillatorNodeRendererFactory=Fb}var Vb,jb,Wb,Bb=!1;function Ub(){return Bb||(Bb=!0,Vb={},qa(),jb={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},Wb=(t,e,n,i,r,s)=>class extends t{constructor(t,o=jb){const a=r(t),c={...jb,...o},u=n(a,c),h=s(a);super(t,!1,u,h?i():null),this._nativePannerNode=u,this._orientationX=e(this,h,u.orientationX,Pa,Ma),this._orientationY=e(this,h,u.orientationY,Pa,Ma),this._orientationZ=e(this,h,u.orientationZ,Pa,Ma),this._positionX=e(this,h,u.positionX,Pa,Ma),this._positionY=e(this,h,u.positionY,Pa,Ma),this._positionZ=e(this,h,u.positionZ,Pa,Ma)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(t){this._nativePannerNode.coneInnerAngle=t}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(t){this._nativePannerNode.coneOuterAngle=t}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(t){this._nativePannerNode.coneOuterGain=t}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(t){this._nativePannerNode.distanceModel=t}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(t){this._nativePannerNode.maxDistance=t}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(t){this._nativePannerNode.panningModel=t}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(t){this._nativePannerNode.refDistance=t}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(t){this._nativePannerNode.rolloffFactor=t}},Vb.createPannerNodeConstructor=Wb),Vb}var zb,Qb,Hb=!1;function Gb(){zb={},Uc(),la(),Qb=(t,e,n,i,r,s,o,a,c,u)=>()=>{const h=new WeakMap;let l=null;return{render(p,d,f){const _=h.get(d);return void 0!==_?Promise.resolve(_):(async(p,d,f)=>{let _=null,v=s(p);const m={channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation},g={...m,coneInnerAngle:v.coneInnerAngle,coneOuterAngle:v.coneOuterAngle,coneOuterGain:v.coneOuterGain,distanceModel:v.distanceModel,maxDistance:v.maxDistance,panningModel:v.panningModel,refDistance:v.refDistance,rolloffFactor:v.rolloffFactor},y=ua(v,d);if("bufferSize"in v)_=i(d,{...m,gain:1});else if(!y){const t={...g,orientationX:v.orientationX.value,orientationY:v.orientationY.value,orientationZ:v.orientationZ.value,positionX:v.positionX.value,positionY:v.positionY.value,positionZ:v.positionZ.value};v=r(d,t)}if(h.set(d,null===_?v:_),null!==_){if(null===l){if(null===o)throw new Error("Missing the native OfflineAudioContext constructor.");const t=new o(6,p.context.length,d.sampleRate),i=e(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});i.connect(t.destination),l=(async()=>{const e=await Promise.all([p.orientationX,p.orientationY,p.orientationZ,p.positionX,p.positionY,p.positionZ].map(async(e,i)=>{const r=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:0===i?1:0});return await a(t,e,r.offset,f),r}));for(let t=0;t<6;t+=1)e[t].connect(i,0,t),e[t].start(0);return u(t)})()}const t=await l,s=i(d,{...m,gain:1});await c(p,d,s,f);const h=[];for(let e=0;e<t.numberOfChannels;e+=1)h.push(t.getChannelData(e));let v=[h[0][0],h[1][0],h[2][0]],y=[h[3][0],h[4][0],h[5][0]],b=i(d,{...m,gain:1}),w=r(d,{...g,orientationX:v[0],orientationY:v[1],orientationZ:v[2],positionX:y[0],positionY:y[1],positionZ:y[2]});s.connect(b).connect(w.inputs[0]),w.connect(_);for(let e=128;e<t.length;e+=128){const t=[h[0][e],h[1][e],h[2][e]],n=[h[3][e],h[4][e],h[5][e]];if(t.some((t,e)=>t!==v[e])||n.some((t,e)=>t!==y[e])){v=t,y=n;const o=e/d.sampleRate;b.gain.setValueAtTime(0,o),b=i(d,{...m,gain:0}),w=r(d,{...g,orientationX:v[0],orientationY:v[1],orientationZ:v[2],positionX:y[0],positionY:y[1],positionZ:y[2]}),b.gain.setValueAtTime(1,o),s.connect(b).connect(w.inputs[0]),w.connect(_)}}return _}return y?(await t(d,p.orientationX,v.orientationX,f),await t(d,p.orientationY,v.orientationY,f),await t(d,p.orientationZ,v.orientationZ,f),await t(d,p.positionX,v.positionX,f),await t(d,p.positionY,v.positionY,f),await t(d,p.positionZ,v.positionZ,f)):(await a(d,p.orientationX,v.orientationX,f),await a(d,p.orientationY,v.orientationY,f),await a(d,p.orientationZ,v.orientationZ,f),await a(d,p.positionX,v.positionX,f),await a(d,p.positionY,v.positionY,f),await a(d,p.positionZ,v.positionZ,f)),Wc(v)?await c(p,d,v.inputs[0],f):await c(p,d,v,f),v})(p,d,f)}}},zb.createPannerNodeRendererFactory=Qb}var Yb,Xb,Kb,Zb=!1;function $b(){return Zb||(Zb=!0,Xb={disableNormalization:!1},(Yb={}).createPeriodicWaveConstructor=Kb=(t,e,n)=>class i{constructor(i,r){const s=e(i),o={...Xb,...r},a=t(s,o);return n.add(a),a}static[Symbol.hasInstance](t){return null!==t&&"object"==typeof t&&Object.getPrototypeOf(t)===i.prototype||n.has(t)}}),Yb}var Jb,tw,ew=!1;function nw(){return ew||(ew=!0,(Jb={}).createRenderAutomation=tw=(t,e)=>(n,i,r,s)=>(t(i).replay(r),e(i,n,r,s))),Jb}var iw,rw,sw=!1;function ow(){return sw||(sw=!0,(iw={}).createRenderInputsOfAudioNode=rw=(t,e,n)=>async(i,r,s,o)=>{const a=t(i),c=[...o,i];await Promise.all(a.activeInputs.map((t,o)=>Array.from(t).filter(([t])=>!c.includes(t)).map(async([t,a])=>{const u=e(t),h=await u.render(t,r,c),l=i.context.destination;n(t)||i===l&&n(i)||h.connect(s,a,o)})).reduce((t,e)=>[...t,...e],[]))}),iw}var aw,cw,uw=!1;function hw(){return uw||(uw=!0,(aw={}).createRenderInputsOfAudioParam=cw=(t,e,n)=>async(i,r,s,o)=>{const a=e(i);await Promise.all(Array.from(a.activeInputs).map(async([e,i])=>{const a=t(e),c=await a.render(e,r,o);n(e)||c.connect(s,i)}))}),aw}var lw,pw,dw=!1;function fw(){return dw||(dw=!0,lw={},wv(),pw=(t,e,n,i)=>r=>t(yv,()=>yv(r))?Promise.resolve(t(i,i)).then(t=>{if(!t){const t=n(r,512,0,1);r.oncomplete=()=>{t.onaudioprocess=null,t.disconnect()},t.onaudioprocess=()=>r.currentTime,t.connect(r.destination)}return r.startRendering()}):new Promise(t=>{const n=e(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});r.oncomplete=e=>{n.disconnect(),t(e.renderedBuffer)},n.connect(r.destination),r.startRendering()}),lw.createRenderNativeOfflineAudioContext=pw),lw}var _w,vw,mw=!1;function gw(){return mw||(mw=!0,_w={},Aa(),vw=(t,e,n,i,r,s,o,a)=>{const c=[];return(u,h)=>n(u).render(u,h,c).then(()=>Promise.all(Array.from(i(h)).map(t=>n(t).render(t,h,c)))).then(()=>r(h)).then(n=>("function"!=typeof n.copyFromChannel?(o(n),Sa(n)):e(s,()=>s(n))||a(n),t.add(n),n))},_w.createStartRendering=vw),_w}var yw,bw,ww,Cw=!1;function xw(){return Cw||(Cw=!0,bw={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},(yw={}).createStereoPannerNodeConstructor=ww=(t,e,n,i,r,s)=>class extends t{constructor(t,o=bw){const a=r(t),c={...bw,...o},u=n(a,c),h=s(a);super(t,!1,u,h?i():null),this._pan=e(this,h,u.pan,1,-1)}get pan(){return this._pan}}),yw}var Tw,Sw,Ew=!1;function Aw(){Tw={},Uc(),la(),Sw=(t,e,n,i,r)=>()=>{const s=new WeakMap;return{render(o,a,c){const u=s.get(a);return void 0!==u?Promise.resolve(u):(async(o,a,c)=>{let u=n(o);const h=ua(u,a);if(!h){const t={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,pan:u.pan.value};u=e(a,t)}return s.set(a,u),h?await t(a,o.pan,u.pan,c):await i(a,o.pan,u.pan,c),Wc(u)?await r(o,a,u.inputs[0],c):await r(o,a,u,c),u})(o,a,c)}}},Tw.createStereoPannerNodeRendererFactory=Sw}var kw,Ow,Dw=!1;function Nw(){return Dw||(Dw=!0,(kw={}).createTestAudioBufferConstructorSupport=Ow=t=>()=>{if(null===t)return!1;try{new t({length:1,sampleRate:44100})}catch{return!1}return!0}),kw}var Rw,Iw,Mw=!1;function Pw(){return Mw||(Mw=!0,(Rw={}).createTestAudioBufferCopyChannelMethodsSubarraySupport=Iw=t=>()=>{if(null===t)return!1;const e=new t(1,1,44100).createBuffer(1,1,44100);if(void 0===e.copyToChannel)return!0;const n=new Float32Array(2);try{e.copyFromChannel(n,0,0)}catch{return!1}return!0}),Rw}var Fw,qw,Lw=!1;function Vw(){return Lw||(Lw=!0,(Fw={}).createTestAudioBufferSourceNodeStartMethodConsecutiveCallsSupport=qw=t=>e=>{const n=t(e,t=>t.createBufferSource());n.start();try{n.start()}catch{return!0}return!1}),Fw}var jw,Ww,Bw=!1;function Uw(){return Bw||(Bw=!0,(jw={}).createTestAudioBufferSourceNodeStartMethodDurationParameterSupport=Ww=t=>()=>{if(null===t)return Promise.resolve(!1);const e=new t(1,1,44100),n=e.createBuffer(1,1,e.sampleRate),i=e.createBufferSource();return n.getChannelData(0)[0]=1,i.buffer=n,i.start(0,0,0),i.connect(e.destination),new Promise(t=>{e.oncomplete=({renderedBuffer:e})=>{t(0===e.getChannelData(0)[0])},e.startRendering()})}),jw}var zw,Qw,Hw=!1;function Gw(){return Hw||(Hw=!0,(zw={}).createTestAudioBufferSourceNodeStartMethodOffsetClampingSupport=Qw=t=>e=>{const n=t(e,t=>t.createBufferSource()),i=e.createBuffer(1,1,44100);n.buffer=i;try{n.start(0,1)}catch{return!1}return!0}),zw}var Yw,Xw,Kw=!1;function Zw(){return Kw||(Kw=!0,(Yw={}).createTestAudioBufferSourceNodeStopMethodNullifiedBufferSupport=Xw=t=>e=>{const n=t(e,t=>t.createBufferSource());n.start();try{n.stop()}catch{return!1}return!0}),Yw}var $w,Jw,tC=!1;function eC(){return tC||(tC=!0,($w={}).createTestAudioContextCloseMethodSupport=Jw=t=>()=>{if(null===t)return!1;if(void 0!==t.prototype&&void 0!==t.prototype.close)return!0;const e=new t,n=void 0!==e.close;try{e.close()}catch{}return n}),$w}var nC,iC,rC=!1;function sC(){return rC||(rC=!0,(nC={}).createTestAudioContextDecodeAudioDataMethodTypeErrorSupport=iC=t=>()=>{if(null===t)return Promise.resolve(!1);const e=new t(1,1,44100);return new Promise(t=>{let n=!0;const i=i=>{n&&(n=!1,e.startRendering(),t(i instanceof TypeError))};let r;try{r=e.decodeAudioData(null,()=>{},i)}catch(t){i(t)}void 0!==r&&r.catch(i)})}),nC}var oC,aC,cC=!1;function uC(){return cC||(cC=!0,(oC={}).createTestAudioContextOptionsSupport=aC=t=>()=>{if(null===t)return!1;let e;try{e=new t({latencyHint:"balanced"})}catch{return!1}return e.close(),!0}),oC}var hC,lC,pC=!1;function dC(){return pC||(pC=!0,(hC={}).createTestAudioNodeConnectMethodSupport=lC=t=>()=>{if(null===t)return!1;const e=new t(1,1,44100).createGain(),n=e.connect(e)===e;return e.disconnect(e),n}),hC}var fC,_C,vC=!1;function mC(){return vC||(vC=!0,(fC={}).createTestAudioScheduledSourceNodeStartMethodNegativeParametersSupport=_C=t=>e=>{const n=t(e,t=>t.createOscillator());try{n.start(-1)}catch(t){return t instanceof RangeError}return!1}),fC}var gC,yC,bC=!1;function wC(){return bC||(bC=!0,(gC={}).createTestAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport=yC=t=>e=>{const n=e.createBuffer(1,1,44100),i=t(e,t=>t.createBufferSource());i.buffer=n,i.start(),i.stop();try{return i.stop(),!0}catch{return!1}}),gC}var CC,xC,TC=!1;function SC(){return TC||(TC=!0,(CC={}).createTestAudioScheduledSourceNodeStopMethodNegativeParametersSupport=xC=t=>e=>{const n=t(e,t=>t.createOscillator());try{n.stop(-1)}catch(t){return t instanceof RangeError}return!1}),CC}var EC,AC,kC=!1;function OC(){return kC||(kC=!0,(EC={}).createTestAudioWorkletProcessorNoOutputsSupport=AC=(t,e)=>async()=>{if(null===t)return!0;if(null===e)return!1;const n=new Blob(['class A extends AudioWorkletProcessor{process(){this.port.postMessage(0)}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),i=new e(1,128,3200),r=URL.createObjectURL(n);let s=!1;try{await i.audioWorklet.addModule(r);const e=i.createGain(),n=new t(i,"a",{numberOfOutputs:0});n.port.onmessage=()=>s=!0,e.connect(n),await i.startRendering()}catch{}finally{URL.revokeObjectURL(r)}return s}),EC}var DC,NC,RC=!1;function IC(){return RC||(RC=!0,(DC={}).createTestChannelMergerNodeChannelCountSupport=NC=(t,e)=>()=>{if(null===e)return!1;const n=new e(1,1,44100),i=t(n,t=>t.createChannelMerger());if("max"===i.channelCountMode)return!0;try{i.channelCount=2}catch{return!0}return!1}),DC}var MC,PC,FC=!1;function qC(){return FC||(FC=!0,(MC={}).createTestConstantSourceNodeAccurateSchedulingSupport=PC=(t,e)=>()=>{if(null===e)return!1;const n=new e(1,1,44100);return void 0===n.createConstantSource||t(n,t=>t.createConstantSource()).offset.maxValue!==Number.POSITIVE_INFINITY}),MC}var LC,VC,jC=!1;function WC(){return jC||(jC=!0,(LC={}).createTestConvolverNodeBufferReassignabilitySupport=VC=t=>()=>{if(null===t)return!1;const e=new t(1,1,44100),n=e.createConvolver();n.buffer=e.createBuffer(1,1,e.sampleRate);try{n.buffer=e.createBuffer(1,1,e.sampleRate)}catch{return!1}return!0}),LC}var BC,UC,zC=!1;function QC(){return zC||(zC=!0,(BC={}).createTestIsSecureContextSupport=UC=t=>()=>null!==t&&t.hasOwnProperty("isSecureContext")),BC}var HC,GC,YC=!1;function XC(){return YC||(YC=!0,(HC={}).createTestMediaStreamAudioSourceNodeMediaStreamWithoutAudioTrackSupport=GC=t=>()=>{if(null===t)return!1;const e=new t;try{return e.createMediaStreamSource(new MediaStream),!1}catch(t){return!0}}),HC}var KC,ZC,$C=!1;function JC(){return $C||($C=!0,(KC={}).createTestOfflineAudioContextCurrentTimeSupport=ZC=(t,e)=>()=>{if(null===e)return Promise.resolve(!1);const n=new e(1,1,44100),i=t(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(t=>{n.oncomplete=()=>{i.disconnect(),t(0!==n.currentTime)},n.startRendering()})}),KC}var tx,ex,nx=!1;function ix(){return nx||(nx=!0,(tx={}).createTestStereoPannerNodeDefaultValueSupport=ex=t=>()=>{if(null===t)return Promise.resolve(!1);const e=new t(1,1,44100);if(void 0===e.createStereoPanner)return Promise.resolve(!0);if(void 0===e.createConstantSource)return Promise.resolve(!0);const n=e.createConstantSource(),i=e.createStereoPanner();return n.channelCount=1,n.offset.value=1,i.channelCount=1,n.start(),n.connect(i).connect(e.destination),e.startRendering().then(t=>1!==t.getChannelData(0)[0])}),tx}var rx,sx,ox=!1;function ax(){return ox||(ox=!0,(rx={}).createUnknownError=sx=()=>{try{return new DOMException("","UnknownError")}catch(t){return t.name="UnknownError",t}}),rx}var cx,ux,hx,lx=!1;function px(){return lx||(lx=!0,ux={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},(cx={}).createWaveShaperNodeConstructor=hx=(t,e,n,i,r,s)=>class extends t{constructor(t,e=ux){const o=r(t),a={...ux,...e},c=n(o,a);super(t,!0,c,s(o)?i():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=c}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(t){if(null===t)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(t.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=t}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(t){this._nativeWaveShaperNode.oversample=t}}),cx}var dx,fx,_x=!1;function vx(){dx={},Uc(),la(),fx=(t,e,n)=>()=>{const i=new WeakMap;return{render(r,s,o){const a=i.get(s);return void 0!==a?Promise.resolve(a):(async(r,s,o)=>{let a=e(r);if(!ua(a,s)){const e={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,curve:a.curve,oversample:a.oversample};a=t(s,e)}return i.set(s,a),Wc(a)?await n(r,s,a.inputs[0],o):await n(r,s,a,o),a})(r,s,o)}}},dx.createWaveShaperNodeRendererFactory=fx}var mx,gx,yx=!1;function bx(){return yx||(yx=!0,(mx={}).createWindow=gx=()=>"undefined"==typeof window?null:window),mx}var wx,Cx,xx=!1;function Tx(){return xx||(xx=!0,(wx={}).createWrapAudioBufferCopyChannelMethods=Cx=(t,e)=>n=>{n.copyFromChannel=(i,r,s=0)=>{const o=t(s),a=t(r);if(a>=n.numberOfChannels)throw e();const c=n.length,u=n.getChannelData(a),h=i.length;for(let t=o<0?-o:0;t+o<c&&t<h;t+=1)i[t]=u[t+o]},n.copyToChannel=(i,r,s=0)=>{const o=t(s),a=t(r);if(a>=n.numberOfChannels)throw e();const c=n.length,u=n.getChannelData(a),h=i.length;for(let t=o<0?-o:0;t+o<c&&t<h;t+=1)u[t+o]=i[t]}}),wx}var Sx,Ex,Ax=!1;function kx(){return Ax||(Ax=!0,(Sx={}).createWrapAudioBufferCopyChannelMethodsOutOfBounds=Ex=t=>e=>{var n,i;e.copyFromChannel=(n=e.copyFromChannel,(i,r,s=0)=>{const o=t(s),a=t(r);if(o<e.length)return n.call(e,i,a,o)}),e.copyToChannel=(i=e.copyToChannel,(n,r,s=0)=>{const o=t(s),a=t(r);if(o<e.length)return i.call(e,n,a,o)})}),Sx}var Ox,Dx,Nx=!1;function Rx(){return Nx||(Nx=!0,(Ox={}).createWrapAudioBufferSourceNodeStopMethodNullifiedBuffer=Dx=t=>(e,n)=>{const i=n.createBuffer(1,1,n.sampleRate);null===e.buffer&&(e.buffer=i),t(e,"buffer",t=>()=>{const n=t.call(e);return n===i?null:n},t=>n=>t.call(e,null===n?i:n))}),Ox}var Ix,Mx,Px=!1;function Fx(){return Px||(Px=!0,Ix={},Lg(),Mx=t=>(e,n)=>{const i=t(n,t=>t.createGain());e.connect(i);const r=(s=e.disconnect,()=>{s.call(e,i),e.removeEventListener("ended",r)});var s;e.addEventListener("ended",r),Fg(e,i),e.stop=(t=>{let n=!1;return(r=0)=>{if(n)try{t.call(e,r)}catch{i.gain.setValueAtTime(0,r)}else t.call(e,r),n=!0}})(e.stop)},Ix.createWrapAudioScheduledSourceNodeStopMethodConsecutiveCalls=Mx),Ix}var qx,Lx,Vx=!1;function jx(){return Vx||(Vx=!0,(qx={}).createWrapChannelMergerNode=Lx=(t,e,n)=>(i,r)=>{r.channelCount=1,r.channelCountMode="explicit",Object.defineProperty(r,"channelCount",{get:()=>1,set:()=>{throw t()}}),Object.defineProperty(r,"channelCountMode",{get:()=>"explicit",set:()=>{throw t()}});const s=e(i,t=>t.createBufferSource());n(r,()=>{const t=r.numberOfInputs;for(let e=0;e<t;e+=1)s.connect(r,0,e)},()=>s.disconnect(r))}),qx}var Wx,Bx,Ux=!1;function zx(){return Ux||(Ux=!0,(Wx={}).isDCCurve=Bx=t=>{if(null===t)return!1;const e=t.length;return e%2!=0?0!==t[Math.floor(e/2)]:t[e/2-1]+t[e/2]!==0}),Wx}var Qx,Hx,Gx=!1;function Yx(){return Gx||(Gx=!0,(Qx={}).overwriteAccessors=Hx=(t,e,n,i)=>{let r=Object.getPrototypeOf(t);for(;!r.hasOwnProperty(e);)r=Object.getPrototypeOf(r);const{get:s,set:o}=Object.getOwnPropertyDescriptor(r,e);Object.defineProperty(t,e,{get:n(s),set:i(o)})}),Qx}var Xx,Kx,Zx=!1;function $x(){return Zx||(Zx=!0,(Xx={}).testTransferablesSupport=Kx=()=>new Promise(t=>{const e=new ArrayBuffer(0),{port1:n,port2:i}=new MessageChannel;n.onmessage=({data:e})=>t(null!==e),i.postMessage(e,[e])})),Xx}var Jx,tT,eT=!1;function nT(){return eT||(eT=!0,(Jx={}).wrapAudioBufferSourceNodeStartMethodOffsetClamping=tT=t=>{var e;t.start=(e=t.start,(n=0,i=0,r)=>{const s=t.buffer,o=null===s?i:Math.min(s.duration,i);null!==s&&o>s.duration-.5/t.context.sampleRate?e.call(t,n,0,0):e.call(t,n,o,r)})}),Jx}var iT,rT,sT=!1;function oT(){return sT||(sT=!0,(iT={}).wrapEventListener=rT=(t,e)=>n=>{const i={value:t};return Object.defineProperties(n,{currentTarget:i,target:i}),"function"==typeof e?e.call(t,n):e.handleEvent.call(t,n)}),iT}var aT=!1;var cT=!1;var uT=!1;var hT=!1;var lT=!1;var pT=!1;var dT=!1;var fT=!1;var _T=!1;var vT=!1;var mT=!1;var gT=!1;var yT=!1;var bT=!1;var wT=!1;var CT=!1;var xT=!1;var TT=!1;var ST=!1;var ET=!1;var AT=!1;var kT=!1;var OT=!1;var DT=!1;var NT=!1;var RT=!1;var IT=!1;var MT=!1;var PT=!1;var FT=!1;var qT=!1;var LT=!1;var VT=!1;var jT=!1;var WT=!1;var BT=!1;var UT=!1;var zT=!1;var QT=!1;var HT=!1;var GT=!1;var YT=!1;var XT=!1;var KT=!1;var ZT=!1;var $T=!1;var JT=!1;var tS=!1;var eS=!1;var nS=!1;var iS=!1;var rS=!1;var sS=!1;var oS=!1;var aS=!1;var cS=!1;var uS=!1;var hS=!1;var lS=!1;var pS=!1;var dS=!1;var fS=!1;var _S=!1;var vS=!1;var mS=!1;var gS=!1;var yS=!1;var bS=!1;var wS=!1;var CS=!1;var xS=!1;var TS=!1;var SS=!1;var ES=!1;var AS=!1;var kS=!1;var OS=!1;var DS=!1;var NS=!1;var RS=!1;var IS=!1;var MS=!1;var PS=!1;var FS,qS=!1;function LS(){e(FS={},(aT||(aT=!0),{})),e(FS,(cT||(cT=!0),{})),e(FS,(uT||(uT=!0),{})),e(FS,(hT||(hT=!0),{})),e(FS,(lT||(lT=!0),{})),e(FS,(pT||(pT=!0),{})),e(FS,(dT||(dT=!0),{})),e(FS,(fT||(fT=!0),{})),e(FS,(_T||(_T=!0),{})),e(FS,(vT||(vT=!0),{})),e(FS,(mT||(mT=!0),{})),e(FS,(gT||(gT=!0),{})),e(FS,(yT||(yT=!0),{})),e(FS,(bT||(bT=!0),{})),e(FS,(wT||(wT=!0),{})),e(FS,(CT||(CT=!0),{})),e(FS,(xT||(xT=!0),{})),e(FS,(TT||(TT=!0),{})),e(FS,(ST||(ST=!0),{})),e(FS,(ET||(ET=!0),{})),e(FS,(AT||(AT=!0),{})),e(FS,(kT||(kT=!0),{})),e(FS,(OT||(OT=!0),{})),e(FS,(DT||(DT=!0),{})),e(FS,(NT||(NT=!0),{})),e(FS,(RT||(RT=!0),{})),e(FS,(IT||(IT=!0),{})),e(FS,(MT||(MT=!0),{})),e(FS,(PT||(PT=!0),{})),e(FS,(FT||(FT=!0),{})),e(FS,(qT||(qT=!0),{})),e(FS,(LT||(LT=!0),{})),e(FS,(VT||(VT=!0),{})),e(FS,(jT||(jT=!0),{})),e(FS,(WT||(WT=!0),{})),e(FS,(BT||(BT=!0),{})),e(FS,(UT||(UT=!0),{})),e(FS,(zT||(zT=!0),{})),e(FS,(QT||(QT=!0),{})),e(FS,(HT||(HT=!0),{})),e(FS,(GT||(GT=!0),{})),e(FS,(YT||(YT=!0),{})),e(FS,(XT||(XT=!0),{})),e(FS,(KT||(KT=!0),{})),e(FS,(ZT||(ZT=!0),{})),e(FS,($T||($T=!0),{})),e(FS,(JT||(JT=!0),{})),e(FS,(tS||(tS=!0),{})),e(FS,(eS||(eS=!0),{})),e(FS,(nS||(nS=!0),{})),e(FS,(iS||(iS=!0),{})),e(FS,(rS||(rS=!0),{})),e(FS,(sS||(sS=!0),{})),e(FS,(oS||(oS=!0),{})),e(FS,(aS||(aS=!0),{})),e(FS,(cS||(cS=!0),{})),e(FS,(uS||(uS=!0),{})),e(FS,(hS||(hS=!0),{})),e(FS,(lS||(lS=!0),{})),e(FS,(pS||(pS=!0),{})),e(FS,(dS||(dS=!0),{})),e(FS,(fS||(fS=!0),{})),e(FS,(_S||(_S=!0),{})),e(FS,(vS||(vS=!0),{})),e(FS,(mS||(mS=!0),{})),e(FS,(gS||(gS=!0),{})),e(FS,(yS||(yS=!0),{})),e(FS,(bS||(bS=!0),{})),e(FS,(wS||(wS=!0),{})),e(FS,(CS||(CS=!0),{})),e(FS,(xS||(xS=!0),{})),e(FS,(TS||(TS=!0),{})),e(FS,(SS||(SS=!0),{})),e(FS,(ES||(ES=!0),{})),e(FS,(AS||(AS=!0),{})),e(FS,(kS||(kS=!0),{})),e(FS,(OS||(OS=!0),{})),e(FS,(DS||(DS=!0),{})),e(FS,(NS||(NS=!0),{})),e(FS,(RS||(RS=!0),{})),e(FS,(IS||(IS=!0),{})),e(FS,(MS||(MS=!0),{})),e(FS,(PS||(PS=!0),{}))}var VS=!1;var jS=!1;var WS=!1;var BS=!1;var US=!1;var zS=!1;var QS=!1;var HS=!1;var GS=!1;var YS=!1;var XS=!1;var KS=!1;var ZS=!1;var $S=!1;var JS=!1;var tE=!1;var eE=!1;var nE=!1;var iE=!1;var rE=!1;var sE=!1;var oE=!1;var aE=!1;var cE=!1;var uE=!1;var hE=!1;var lE=!1;var pE=!1;var dE=!1;var fE=!1;var _E=!1;var vE=!1;var mE=!1;var gE=!1;var yE=!1;var bE=!1;var wE=!1;var CE=!1;var xE=!1;var TE=!1;var SE=!1;var EE=!1;var AE=!1;var kE=!1;var OE=!1;var DE=!1;var NE=!1;var RE=!1;var IE=!1;var ME=!1;var PE=!1;var FE=!1;var qE=!1;var LE=!1;var VE=!1;var jE=!1;var WE=!1;var BE=!1;var UE=!1;var zE=!1;var QE=!1;var HE=!1;var GE=!1;var YE=!1;var XE=!1;var KE=!1;var ZE=!1;var $E=!1;var JE=!1;var tA=!1;var eA=!1;var nA=!1;var iA=!1;var rA=!1;var sA=!1;var oA=!1;var aA=!1;var cA=!1;var uA=!1;var hA=!1;var lA=!1;var pA=!1;var dA=!1;var fA=!1;var _A=!1;var vA=!1;var mA=!1;var gA=!1;var yA=!1;var bA=!1;var wA=!1;var CA=!1;var xA=!1;var TA=!1;var SA=!1;var EA=!1;var AA=!1;var kA=!1;var OA=!1;var DA=!1;var NA=!1;var RA=!1;var IA=!1;var MA=!1;var PA=!1;var FA=!1;var qA=!1;var LA=!1;var VA=!1;var jA=!1;var WA=!1;var BA=!1;var UA=!1;var zA=!1;var QA=!1;var HA=!1;var GA=!1;var YA=!1;var XA=!1;var KA=!1;var ZA=!1;var $A=!1;var JA=!1;var tk=!1;var ek=!1;var nk=!1;var ik=!1;var rk=!1;var sk=!1;var ok=!1;var ak=!1;var ck=!1;var uk=!1;var hk=!1;var lk=!1;var pk=!1;var dk=!1;var fk=!1;var _k=!1;var vk=!1;var mk=!1;var gk=!1;var yk=!1;var bk=!1;var wk=!1;var Ck=!1;var xk=!1;var Tk=!1;var Sk=!1;var Ek=!1;var Ak=!1;var kk=!1;var Ok=!1;var Dk=!1;var Nk=!1;var Rk=!1;var Ik=!1;var Mk=!1;var Pk=!1;var Fk=!1;var qk=!1;var Lk=!1;var Vk=!1;var jk=!1;var Wk=!1;var Bk=!1;var Uk=!1;var zk=!1;var Qk=!1;var Hk=!1;var Gk=!1;var Yk=!1;var Xk=!1;var Kk=!1;var Zk=!1;var $k=!1;var Jk=!1;var tO=!1;var eO=!1;var nO=!1;var iO=!1;var rO=!1;var sO=!1;var oO=!1;var aO=!1;var cO=!1;var uO=!1;var hO=!1;var lO=!1;var pO=!1;var dO=!1;var fO=!1;var _O=!1;var vO=!1;var mO=!1;var gO=!1;var yO=!1;var bO=!1;var wO=!1;var CO=!1;var xO=!1;var TO=!1;var SO=!1;var EO=!1;var AO=!1;var kO=!1;var OO=!1;var DO=!1;var NO=!1;var RO=!1;var IO=!1;var MO=!1;var PO=!1;var FO=!1;var qO=!1;var LO=!1;var VO=!1;var jO=!1;var WO=!1;var BO=!1;var UO=!1;var zO=!1;var QO=!1;var HO=!1;var GO=!1;var YO=!1;var XO=!1;var KO=!1;var ZO=!1;var $O=!1;var JO=!1;var tD=!1;var eD=!1;var nD=!1;var iD=!1;var rD=!1;var sD=!1;var oD=!1;var aD=!1;var cD=!1;var uD=!1;var hD=!1;var lD=!1;var pD=!1;var dD=!1;var fD=!1;var _D=!1;var vD=!1;var mD=!1;var gD=!1;var yD=!1;var bD=!1;var wD=!1;var CD=!1;var xD=!1;var TD=!1;var SD=!1;var ED=!1;var AD=!1;var kD=!1;var OD=!1;var DD=!1;var ND=!1;var RD=!1;var ID=!1;var MD=!1;var PD=!1;var FD=!1;var qD=!1;var LD=!1;var VD=!1;var jD=!1;var WD=!1;var BD=!1;var UD=!1;var zD=!1;var QD=!1;var HD=!1;var GD=!1;var YD=!1;var XD=!1;var KD=!1;var ZD=!1;var $D=!1;var JD=!1;var tN=!1;var eN=!1;var nN=!1;var iN=!1;var rN=!1;var sN=!1;var oN=!1;var aN=!1;var cN=!1;var uN=!1;var hN=!1;var lN=!1;var pN=!1;var dN=!1;var fN=!1;var _N=!1;var vN=!1;var mN=!1;var gN=!1;var yN=!1;var bN=!1;var wN=!1;var CN=!1;var xN=!1;var TN=!1;var SN=!1;var EN=!1;var AN=!1;var kN=!1;var ON=!1;var DN=!1;var NN=!1;var RN=!1;var IN=!1;var MN=!1;var PN=!1;var FN=!1;var qN=!1;var LN=!1;var VN=!1;var jN=!1;var WN=!1;var BN=!1;var UN=!1;var zN=!1;var QN=!1;var HN=!1;var GN=!1;var YN=!1;var XN=!1;var KN=!1;var ZN=!1;var $N=!1;var JN=!1;var tR=!1;var eR=!1;var nR=!1;var iR=!1;var rR=!1;var sR=!1;var oR=!1;var aR=!1;var cR=!1;var uR=!1;var hR=!1;var lR=!1;var pR=!1;var dR=!1;var fR=!1;var _R=!1;var vR=!1;var mR=!1;var gR=!1;var yR=!1;var bR=!1;var wR=!1;var CR=!1;var xR=!1;var TR=!1;var SR=!1;var ER=!1;var AR=!1;var kR=!1;var OR=!1;var DR=!1;var NR=!1;var RR=!1;var IR=!1;var MR=!1;var PR=!1;var FR=!1;var qR=!1;var LR=!1;var VR=!1;var jR=!1;var WR=!1;var BR=!1;var UR=!1;var zR=!1;var QR,HR=!1;function GR(){e(QR={},(VS||(VS=!0),{})),e(QR,(jS||(jS=!0),{})),e(QR,(WS||(WS=!0),{})),e(QR,(BS||(BS=!0),{})),e(QR,(US||(US=!0),{})),e(QR,(zS||(zS=!0),{})),e(QR,(QS||(QS=!0),{})),e(QR,(HS||(HS=!0),{})),e(QR,(GS||(GS=!0),{})),e(QR,(YS||(YS=!0),{})),e(QR,(XS||(XS=!0),{})),e(QR,(KS||(KS=!0),{})),e(QR,(ZS||(ZS=!0),{})),e(QR,($S||($S=!0),{})),e(QR,(JS||(JS=!0),{})),e(QR,(tE||(tE=!0),{})),e(QR,(eE||(eE=!0),{})),e(QR,(nE||(nE=!0),{})),e(QR,(iE||(iE=!0),{})),e(QR,(rE||(rE=!0),{})),e(QR,(sE||(sE=!0),{})),e(QR,(oE||(oE=!0),{})),e(QR,(aE||(aE=!0),{})),e(QR,(cE||(cE=!0),{})),e(QR,(uE||(uE=!0),{})),e(QR,(hE||(hE=!0),{})),e(QR,(lE||(lE=!0),{})),e(QR,(pE||(pE=!0),{})),e(QR,(dE||(dE=!0),{})),e(QR,(fE||(fE=!0),{})),e(QR,(_E||(_E=!0),{})),e(QR,(vE||(vE=!0),{})),e(QR,(mE||(mE=!0),{})),e(QR,(gE||(gE=!0),{})),e(QR,(yE||(yE=!0),{})),e(QR,(bE||(bE=!0),{})),e(QR,(wE||(wE=!0),{})),e(QR,(CE||(CE=!0),{})),e(QR,(xE||(xE=!0),{})),e(QR,(TE||(TE=!0),{})),e(QR,(SE||(SE=!0),{})),e(QR,(EE||(EE=!0),{})),e(QR,(AE||(AE=!0),{})),e(QR,(kE||(kE=!0),{})),e(QR,(OE||(OE=!0),{})),e(QR,(DE||(DE=!0),{})),e(QR,(NE||(NE=!0),{})),e(QR,(RE||(RE=!0),{})),e(QR,(IE||(IE=!0),{})),e(QR,(ME||(ME=!0),{})),e(QR,(PE||(PE=!0),{})),e(QR,(FE||(FE=!0),{})),e(QR,(qE||(qE=!0),{})),e(QR,(LE||(LE=!0),{})),e(QR,(VE||(VE=!0),{})),e(QR,(jE||(jE=!0),{})),e(QR,(WE||(WE=!0),{})),e(QR,(BE||(BE=!0),{})),e(QR,(UE||(UE=!0),{})),e(QR,(zE||(zE=!0),{})),e(QR,(QE||(QE=!0),{})),e(QR,(HE||(HE=!0),{})),e(QR,(GE||(GE=!0),{})),e(QR,(YE||(YE=!0),{})),e(QR,(XE||(XE=!0),{})),e(QR,(KE||(KE=!0),{})),e(QR,(ZE||(ZE=!0),{})),e(QR,($E||($E=!0),{})),e(QR,(JE||(JE=!0),{})),e(QR,(tA||(tA=!0),{})),e(QR,(eA||(eA=!0),{})),e(QR,(nA||(nA=!0),{})),e(QR,(iA||(iA=!0),{})),e(QR,(rA||(rA=!0),{})),e(QR,(sA||(sA=!0),{})),e(QR,(oA||(oA=!0),{})),e(QR,(aA||(aA=!0),{})),e(QR,(cA||(cA=!0),{})),e(QR,(uA||(uA=!0),{})),e(QR,(hA||(hA=!0),{})),e(QR,(lA||(lA=!0),{})),e(QR,(pA||(pA=!0),{})),e(QR,(dA||(dA=!0),{})),e(QR,(fA||(fA=!0),{})),e(QR,(_A||(_A=!0),{})),e(QR,(vA||(vA=!0),{})),e(QR,(mA||(mA=!0),{})),e(QR,(gA||(gA=!0),{})),e(QR,(yA||(yA=!0),{})),e(QR,(bA||(bA=!0),{})),e(QR,(wA||(wA=!0),{})),e(QR,(CA||(CA=!0),{})),e(QR,(xA||(xA=!0),{})),e(QR,(TA||(TA=!0),{})),e(QR,(SA||(SA=!0),{})),e(QR,(EA||(EA=!0),{})),e(QR,(AA||(AA=!0),{})),e(QR,(kA||(kA=!0),{})),e(QR,(OA||(OA=!0),{})),e(QR,(DA||(DA=!0),{})),e(QR,(NA||(NA=!0),{})),e(QR,(RA||(RA=!0),{})),e(QR,(IA||(IA=!0),{})),e(QR,(MA||(MA=!0),{})),e(QR,(PA||(PA=!0),{})),e(QR,(FA||(FA=!0),{})),e(QR,(qA||(qA=!0),{})),e(QR,(LA||(LA=!0),{})),e(QR,(VA||(VA=!0),{})),e(QR,(jA||(jA=!0),{})),e(QR,(WA||(WA=!0),{})),e(QR,(BA||(BA=!0),{})),e(QR,(UA||(UA=!0),{})),e(QR,(zA||(zA=!0),{})),e(QR,(QA||(QA=!0),{})),e(QR,(HA||(HA=!0),{})),e(QR,(GA||(GA=!0),{})),e(QR,(YA||(YA=!0),{})),e(QR,(XA||(XA=!0),{})),e(QR,(KA||(KA=!0),{})),e(QR,(ZA||(ZA=!0),{})),e(QR,($A||($A=!0),{})),e(QR,(JA||(JA=!0),{})),e(QR,(tk||(tk=!0),{})),e(QR,(ek||(ek=!0),{})),e(QR,(nk||(nk=!0),{})),e(QR,(ik||(ik=!0),{})),e(QR,(rk||(rk=!0),{})),e(QR,(sk||(sk=!0),{})),e(QR,(ok||(ok=!0),{})),e(QR,(ak||(ak=!0),{})),e(QR,(ck||(ck=!0),{})),e(QR,(uk||(uk=!0),{})),e(QR,(hk||(hk=!0),{})),e(QR,(lk||(lk=!0),{})),e(QR,(pk||(pk=!0),{})),e(QR,(dk||(dk=!0),{})),e(QR,(fk||(fk=!0),{})),e(QR,(_k||(_k=!0),{})),e(QR,(vk||(vk=!0),{})),e(QR,(mk||(mk=!0),{})),e(QR,(gk||(gk=!0),{})),e(QR,(yk||(yk=!0),{})),e(QR,(bk||(bk=!0),{})),e(QR,(wk||(wk=!0),{})),e(QR,(Ck||(Ck=!0),{})),e(QR,(xk||(xk=!0),{})),e(QR,(Tk||(Tk=!0),{})),e(QR,(Sk||(Sk=!0),{})),e(QR,(Ek||(Ek=!0),{})),e(QR,(Ak||(Ak=!0),{})),e(QR,(kk||(kk=!0),{})),e(QR,(Ok||(Ok=!0),{})),e(QR,(Dk||(Dk=!0),{})),e(QR,(Nk||(Nk=!0),{})),e(QR,(Rk||(Rk=!0),{})),e(QR,(Ik||(Ik=!0),{})),e(QR,(Mk||(Mk=!0),{})),e(QR,(Pk||(Pk=!0),{})),e(QR,(Fk||(Fk=!0),{})),e(QR,(qk||(qk=!0),{})),e(QR,(Lk||(Lk=!0),{})),e(QR,(Vk||(Vk=!0),{})),e(QR,(jk||(jk=!0),{})),e(QR,(Wk||(Wk=!0),{})),e(QR,(Bk||(Bk=!0),{})),e(QR,(Uk||(Uk=!0),{})),e(QR,(zk||(zk=!0),{})),e(QR,(Qk||(Qk=!0),{})),e(QR,(Hk||(Hk=!0),{})),e(QR,(Gk||(Gk=!0),{})),e(QR,(Yk||(Yk=!0),{})),e(QR,(Xk||(Xk=!0),{})),e(QR,(Kk||(Kk=!0),{})),e(QR,(Zk||(Zk=!0),{})),e(QR,($k||($k=!0),{})),e(QR,(Jk||(Jk=!0),{})),e(QR,(tO||(tO=!0),{})),e(QR,(eO||(eO=!0),{})),e(QR,(nO||(nO=!0),{})),e(QR,(iO||(iO=!0),{})),e(QR,(rO||(rO=!0),{})),e(QR,(sO||(sO=!0),{})),e(QR,(oO||(oO=!0),{})),e(QR,(aO||(aO=!0),{})),e(QR,(cO||(cO=!0),{})),e(QR,(uO||(uO=!0),{})),e(QR,(hO||(hO=!0),{})),e(QR,(lO||(lO=!0),{})),e(QR,(pO||(pO=!0),{})),e(QR,(dO||(dO=!0),{})),e(QR,(fO||(fO=!0),{})),e(QR,(_O||(_O=!0),{})),e(QR,(vO||(vO=!0),{})),e(QR,(mO||(mO=!0),{})),e(QR,(gO||(gO=!0),{})),e(QR,(yO||(yO=!0),{})),e(QR,(bO||(bO=!0),{})),e(QR,(wO||(wO=!0),{})),e(QR,(CO||(CO=!0),{})),e(QR,(xO||(xO=!0),{})),e(QR,(TO||(TO=!0),{})),e(QR,(SO||(SO=!0),{})),e(QR,(EO||(EO=!0),{})),e(QR,(AO||(AO=!0),{})),e(QR,(kO||(kO=!0),{})),e(QR,(OO||(OO=!0),{})),e(QR,(DO||(DO=!0),{})),e(QR,(NO||(NO=!0),{})),e(QR,(RO||(RO=!0),{})),e(QR,(IO||(IO=!0),{})),e(QR,(MO||(MO=!0),{})),e(QR,(PO||(PO=!0),{})),e(QR,(FO||(FO=!0),{})),e(QR,(qO||(qO=!0),{})),e(QR,(LO||(LO=!0),{})),e(QR,(VO||(VO=!0),{})),e(QR,(jO||(jO=!0),{})),e(QR,(WO||(WO=!0),{})),e(QR,(BO||(BO=!0),{})),e(QR,(UO||(UO=!0),{})),e(QR,(zO||(zO=!0),{})),e(QR,(QO||(QO=!0),{})),e(QR,(HO||(HO=!0),{})),e(QR,(GO||(GO=!0),{})),e(QR,(YO||(YO=!0),{})),e(QR,(XO||(XO=!0),{})),e(QR,(KO||(KO=!0),{})),e(QR,(ZO||(ZO=!0),{})),e(QR,($O||($O=!0),{})),e(QR,(JO||(JO=!0),{})),e(QR,(tD||(tD=!0),{})),e(QR,(eD||(eD=!0),{})),e(QR,(nD||(nD=!0),{})),e(QR,(iD||(iD=!0),{})),e(QR,(rD||(rD=!0),{})),e(QR,(sD||(sD=!0),{})),e(QR,(oD||(oD=!0),{})),e(QR,(aD||(aD=!0),{})),e(QR,(cD||(cD=!0),{})),e(QR,(uD||(uD=!0),{})),e(QR,(hD||(hD=!0),{})),e(QR,(lD||(lD=!0),{})),e(QR,(pD||(pD=!0),{})),e(QR,(dD||(dD=!0),{})),e(QR,(fD||(fD=!0),{})),e(QR,(_D||(_D=!0),{})),e(QR,(vD||(vD=!0),{})),e(QR,(mD||(mD=!0),{})),e(QR,(gD||(gD=!0),{})),e(QR,(yD||(yD=!0),{})),e(QR,(bD||(bD=!0),{})),e(QR,(wD||(wD=!0),{})),e(QR,(CD||(CD=!0),{})),e(QR,(xD||(xD=!0),{})),e(QR,(TD||(TD=!0),{})),e(QR,(SD||(SD=!0),{})),e(QR,(ED||(ED=!0),{})),e(QR,(AD||(AD=!0),{})),e(QR,(kD||(kD=!0),{})),e(QR,(OD||(OD=!0),{})),e(QR,(DD||(DD=!0),{})),e(QR,(ND||(ND=!0),{})),e(QR,(RD||(RD=!0),{})),e(QR,(ID||(ID=!0),{})),e(QR,(MD||(MD=!0),{})),e(QR,(PD||(PD=!0),{})),e(QR,(FD||(FD=!0),{})),e(QR,(qD||(qD=!0),{})),e(QR,(LD||(LD=!0),{})),e(QR,(VD||(VD=!0),{})),e(QR,(jD||(jD=!0),{})),e(QR,(WD||(WD=!0),{})),e(QR,(BD||(BD=!0),{})),e(QR,(UD||(UD=!0),{})),e(QR,(zD||(zD=!0),{})),e(QR,(QD||(QD=!0),{})),e(QR,(HD||(HD=!0),{})),e(QR,(GD||(GD=!0),{})),e(QR,(YD||(YD=!0),{})),e(QR,(XD||(XD=!0),{})),e(QR,(KD||(KD=!0),{})),e(QR,(ZD||(ZD=!0),{})),e(QR,($D||($D=!0),{})),e(QR,(JD||(JD=!0),{})),e(QR,(tN||(tN=!0),{})),e(QR,(eN||(eN=!0),{})),e(QR,(nN||(nN=!0),{})),e(QR,(iN||(iN=!0),{})),e(QR,(rN||(rN=!0),{})),e(QR,(sN||(sN=!0),{})),e(QR,(oN||(oN=!0),{})),e(QR,(aN||(aN=!0),{})),e(QR,(cN||(cN=!0),{})),e(QR,(uN||(uN=!0),{})),e(QR,(hN||(hN=!0),{})),e(QR,(lN||(lN=!0),{})),e(QR,(pN||(pN=!0),{})),e(QR,(dN||(dN=!0),{})),e(QR,(fN||(fN=!0),{})),e(QR,(_N||(_N=!0),{})),e(QR,(vN||(vN=!0),{})),e(QR,(mN||(mN=!0),{})),e(QR,(gN||(gN=!0),{})),e(QR,(yN||(yN=!0),{})),e(QR,(bN||(bN=!0),{})),e(QR,(wN||(wN=!0),{})),e(QR,(CN||(CN=!0),{})),e(QR,(xN||(xN=!0),{})),e(QR,(TN||(TN=!0),{})),e(QR,(SN||(SN=!0),{})),e(QR,(EN||(EN=!0),{})),e(QR,(AN||(AN=!0),{})),e(QR,(kN||(kN=!0),{})),e(QR,(ON||(ON=!0),{})),e(QR,(DN||(DN=!0),{})),e(QR,(NN||(NN=!0),{})),e(QR,(RN||(RN=!0),{})),e(QR,(IN||(IN=!0),{})),e(QR,(MN||(MN=!0),{})),e(QR,(PN||(PN=!0),{})),e(QR,(FN||(FN=!0),{})),e(QR,(qN||(qN=!0),{})),e(QR,(LN||(LN=!0),{})),e(QR,(VN||(VN=!0),{})),e(QR,(jN||(jN=!0),{})),e(QR,(WN||(WN=!0),{})),e(QR,(BN||(BN=!0),{})),e(QR,(UN||(UN=!0),{})),e(QR,(zN||(zN=!0),{})),e(QR,(QN||(QN=!0),{})),e(QR,(HN||(HN=!0),{})),e(QR,(GN||(GN=!0),{})),e(QR,(YN||(YN=!0),{})),e(QR,(XN||(XN=!0),{})),e(QR,(KN||(KN=!0),{})),e(QR,(ZN||(ZN=!0),{})),e(QR,($N||($N=!0),{})),e(QR,(JN||(JN=!0),{})),e(QR,(tR||(tR=!0),{})),e(QR,(eR||(eR=!0),{})),e(QR,(nR||(nR=!0),{})),e(QR,(iR||(iR=!0),{})),e(QR,(rR||(rR=!0),{})),e(QR,(sR||(sR=!0),{})),e(QR,(oR||(oR=!0),{})),e(QR,(aR||(aR=!0),{})),e(QR,(cR||(cR=!0),{})),e(QR,(uR||(uR=!0),{})),e(QR,(hR||(hR=!0),{})),e(QR,(lR||(lR=!0),{})),e(QR,(pR||(pR=!0),{})),e(QR,(dR||(dR=!0),{})),e(QR,(fR||(fR=!0),{})),e(QR,(_R||(_R=!0),{})),e(QR,(vR||(vR=!0),{})),e(QR,(mR||(mR=!0),{})),e(QR,(gR||(gR=!0),{})),e(QR,(yR||(yR=!0),{})),e(QR,(bR||(bR=!0),{})),e(QR,(wR||(wR=!0),{})),e(QR,(CR||(CR=!0),{})),e(QR,(xR||(xR=!0),{})),e(QR,(TR||(TR=!0),{})),e(QR,(SR||(SR=!0),{})),e(QR,(ER||(ER=!0),{})),e(QR,(AR||(AR=!0),{})),e(QR,(kR||(kR=!0),{})),e(QR,(OR||(OR=!0),{})),e(QR,(DR||(DR=!0),{})),e(QR,(NR||(NR=!0),{})),e(QR,(RR||(RR=!0),{})),e(QR,(IR||(IR=!0),{})),e(QR,(MR||(MR=!0),{})),e(QR,(PR||(PR=!0),{})),e(QR,(FR||(FR=!0),{})),e(QR,(qR||(qR=!0),{})),e(QR,(LR||(LR=!0),{})),e(QR,(VR||(VR=!0),{})),e(QR,(jR||(jR=!0),{})),e(QR,(WR||(WR=!0),{})),e(QR,(BR||(BR=!0),{})),e(QR,(UR||(UR=!0),{})),e(QR,(zR||(zR=!0),{}))}var YR,XR,KR,ZR,$R,JR,tI,eI,nI,iI,rI,sI,oI,aI,cI,uI,hI,lI,pI,dI,fI,_I,vI,mI,gI,yI,bI,wI,CI,xI,TI,SI,EI,AI,kI,OI,DI,NI,RI,II,MI,PI,FI,qI,LI,VI,jI,WI,BI,UI,zI,QI,HI,GI,YI,XI,KI,ZI,$I,JI,tM,eM,nM,iM,rM,sM,oM,aM,cM,uM,hM,lM,pM,dM,fM,_M,vM,mM,gM,yM,bM,wM,CM,xM,TM,SM,EM,AM,kM,OM,DM,NM,RM,IM,MM,PM,FM,qM,LM,VM,jM,WM,BM,UM,zM,QM,HM,GM,YM,XM,KM,ZM,$M,JM,tP,eP,nP,iP,rP,sP,oP,aP,cP,uP,hP,lP,pP,dP,fP,_P,vP=!1;function mP(){YR={},so(),uo(),fo(),go(),Yo(),$o(),na(),aa(),fa||(fa=!0,_a()),Ra(),rc(),ac||(ac=!0,cc()),vc(),bc(),Cc||(Cc=!0,xc()),Ac(),Ah(),Nh(),Ph(),Hh(),pl||(pl=!0,dl()),ml(),Cl(),Sl||(Sl=!0,El()),Dl(),Pl(),Ll||(Ll=!0,Vl()),Ql(),Yl||(Yl=!0,Xl()),Jl(),ip(),ap(),pp(),_p||(_p=!0,vp()),bp(),Sp(),kp||(kp=!0,Op()),Ip(),qp(),Qp(),Xp(),td(),id||(id=!0,rd()),cd(),vd(),wd(),Ed(),Od||(Od=!0,Dd()),Md(),Ld(),Bd(),Hd(),Kd(),ef(),sf||(sf=!0,of()),hf(),ff(),gf(),Ef(),Df(),Uf(),Zf||(Zf=!0,$f()),n_(),xa(),Mf(),Cf(),o_(),h_(),f_(),g_(),C_(),E_(),D_(),M_(),L_(),B_(),H_(),K_(),ev(),sv(),uv(),dv(),mv(),Ev(),Dv(),Kv(),tm(),Tm(),km(),Rm(),Fm(),jm(),Ym(),fg(),gg(),Cg(),Dg(),Mg(),Bg(),Hg(),Kg(),ty(),ry(),cy(),py(),gy(),Cy(),Ey(),Dy(),My(),Ly(),By(),Hy(),Ky(),tb(),rb(),cb(),lb||(lb=!0,pb()),vb(),bb(),Tb(),Ob(),Mb(),qb||(qb=!0,Lb()),Ub(),Hb||(Hb=!0,Gb()),$b(),nw(),ow(),hw(),fw(),gw(),xw(),Ew||(Ew=!0,Aw()),Nw(),Pw(),Vw(),Uw(),Gw(),Zw(),eC(),sC(),uC(),dC(),mC(),wC(),SC(),OC(),IC(),qC(),WC(),QC(),XC(),JC(),ix(),ax(),px(),_x||(_x=!0,vx()),bx(),Tx(),kx(),Rx(),Fx(),jx(),Ro(),Gc(),eu(),su(),uu(),du(),mu(),Wa(),wu(),Su(),zx(),Ou(),Yx(),ya(),wv(),$x(),nT(),oT(),e(YR,(qS||(qS=!0,LS()),FS)),e(YR,(HR||(HR=!0,GR()),QR)),XR=kl(new Map,new WeakMap),KR=gx(),ZR=Fy(KR),$R=F_(ZR),JR=Em(KR),tI=vf($R,JR,ZR),eI=Mm(tI),nI=Yv(XR,wa,eI),iI=cf(iu),rI=rw(iu,iI,Au),sI=da(nI,lu,rI),oI=new WeakMap,aI=Tf(Eo),cI=new WeakMap,uI=jd(rT),hI=b_(JR),lI=T_(KR),pI=k_(KR),dI=Sh(lo(wo),oI,XR,t_(ko,Jc,iu,lu,_u,xu),wa,Rf,Cb,Gp(Qc,ko,iu,lu,_u,aI,xu,$R),fd(cI,iu,Va),uI,aI,hI,lI,pI,$R),fI=sa(dI,sI,wa,nI,aI,$R),YR.AnalyserNode=fI,_I=new WeakSet,vI=$v(KR),mI=gp(new Uint32Array(1)),gI=Cx(mI,wa),yI=Ex(mI),bI=Da(_I,XR,Cb,vI,ZR,Ow(vI),gI,yI),YR.AudioBuffer=bI,wI=oy(eI),CI=Ko(wI),xI=_C(eI),TI=yC(eI),SI=xC(eI),EI=Mx(eI),AI=cw(iI,au,Au),kI=Zl(AI),OI=Cm(CI,XR,eI,qw(eI),Ww(ZR),Qw(eI),Xw(eI),xI,TI,SI,tT,Dx(Hx),EI),DI=tw(pf(au),AI),NI=oc(kI,OI,lu,DI,rI),RI=Oh(vo(xo),cI,To,Ih,no.createCancelAndHoldAutomationEvent,no.createCancelScheduledValuesAutomationEvent,no.createExponentialRampToValueAutomationEvent,no.createLinearRampToValueAutomationEvent,no.createSetTargetAutomationEvent,no.createSetValueAutomationEvent,no.createSetValueCurveAutomationEvent,JR),II=nc(dI,NI,RI,bf,OI,aI,$R,rT),YR.AudioBufferSourceNode=II,MI=gc(dI,wc,wa,bf,Dm(wI,Hx),aI,$R,rI),PI=vg(eI),FI=Tl(kI,PI,lu,DI,rI),qI=bl(dI,RI,FI,Rf,PI,aI,$R),YR.BiquadFilterNode=qI,LI=kv(yu,lI),VI=Lx(bf,eI,LI),jI=bg(eI,VI),WI=ql(jI,lu,rI),BI=Il(dI,WI,jI,aI,$R),YR.ChannelMergerNode=BI,UI=kg(eI),zI=Gl(UI,lu,rI),QI=Ul(dI,zI,UI,aI,$R),YR.ChannelSplitterNode=QI,HI=jg(CI,OI,wI,LI),GI=Rg(CI,XR,eI,HI,xI,SI),YI=fp(kI,GI,lu,DI,rI),XI=hp(dI,RI,YI,GI,aI,$R,rT),YR.ConstantSourceNode=XI,KI=Yg(eI,wI,LI),ZI=zg(eI,KI,Cb,Hx),$I=Ap(ZI,lu,rI),JI=xp(dI,$I,ZI,aI,$R),YR.ConvolverNode=JI,tM=$g(eI),eM=nd(kI,tM,lu,DI,rI),nM=$p(dI,RI,eM,tM,aI,$R),YR.DelayNode=nM,iM=ny(eI,Cb),rM=kd(kI,iM,lu,DI,rI),sM=Td(dI,RI,rM,iM,Cb,aI,$R),YR.DynamicsCompressorNode=sM,oM=rf(kI,wI,lu,DI,rI),aM=Jd(dI,RI,oM,wI,aI,$R),YR.GainNode=aM,cM=nb(eI),uM=fy(Rf,bf,cM,Cb),hM=pw(XR,wI,cM,ZC(wI,ZR)),lM=Kf(OI,eI,lu,ZR,rI,hM),pM=hy(eI,uM),dM=Wf(dI,pM,lM,aI,$R),YR.IIRFilterNode=dM,fM=Sc(RI,jI,GI,cM,$R),_M=new WeakMap,vM=_v(MI,fM,uI,$R,_M,rT),mM=jy(CI,XR,eI,xI,TI,SI,EI),gM=Fb(kI,mM,lu,DI,rI),yM=Rb(dI,RI,bf,mM,gM,aI,$R,rT),YR.OscillatorNode=yM,bM=sp(OI),wM=gb(bM,bf,eI,wI,Bx,LI),CM=fb(bM,bf,eI,wM,Bx,LI,Hx),xM=Yy(Qc,bf,eI,jI,wI,cM,CM,Cb,Jc,LI),TM=zy(eI,xM),SM=Qb(kI,jI,GI,wI,TM,lu,ZR,DI,rI,hM),EM=Wb(dI,RI,TM,SM,aI,$R),YR.PannerNode=EM,AM=$y(tI),kM=Kb(AM,aI,new WeakSet),YR.PeriodicWave=kM,OM=hb(jI,UI,wI,CM,Cb,LI),DM=ob(eI,OM,Cb),NM=Sw(kI,DM,lu,DI,rI),RM=ww(dI,RI,DM,NM,aI,$R),YR.StereoPannerNode=RM,IM=fx(CM,lu,rI),MM=hx(dI,bf,CM,IM,aI,$R),YR.WaveShaperNode=MM,PM=j_(KR),FM=zd(KR),qM=PM?Ho(Cb,Fd(KR),FM,Yd(ao),tI,aI,new WeakMap,new WeakMap,KR):void 0,YR.addAudioWorkletModule=qM,LM=R_(hI,$R),VM=Up(_I,XR,Pp,Rd,new WeakSet,aI,LM,$R,ZR,ma,yv,gI,yI),YR.decodeAudioData=VM,jM=_l(qM,fI,bI,II,qI,BI,QI,XI,JI,VM,nM,sM,aM,dM,vM,yM,EM,kM,RM,MM),WM=by(eI),BM=Y_(dI,WM,aI,$R),YR.MediaElementAudioSourceNode=BM,UM=Ty(eI,Cb),zM=J_(dI,UM,aI,$R),YR.MediaStreamAudioDestinationNode=zM,QM=ky(eI),HM=iv(dI,QM,aI,$R),YR.MediaStreamAudioSourceNode=HM,GM=Ry(bf,eI,$R),YM=av(dI,GM,aI),YR.MediaStreamTrackAudioSourceNode=YM,XM=fc(jM,bf,Cb,sx,BM,zM,HM,YM,JR),YR.AudioContext=XM,KM=kf(_M),ZM=ta(KM),$M=ep(wa),JM=od(KM),tP=yd(wa),eP=pg(oI,$M,wa,bf,jI,UI,GI,wI,cM,Cb,tP,FM,LI),nP=Hm(bf,eI,eP,wI,Cb,LI),iP=Lm(KR),rP=ll(kI,$M,OI,jI,UI,GI,wI,JM,tP,FM,lu,iP,ZR,DI,rI,hM),sP=PM?zh(ZM,dI,RI,rP,nP,aI,$R,iP,rT):void 0,YR.AudioWorkletNode=sP,oP=lv(bf,Cb,sx,vM,JR),YR.MinimalAudioContext=oP,aP=Np(Cb,ZR),cP=vw(_I,XR,iI,KM,hM,ma,gI,yI),uP=Tv(XR,bf,aP,vM,cP),YR.MinimalOfflineAudioContext=uP,hP=Ab(jM,XR,bf,aP,cP),YR.OfflineAudioContext=hP,lP=r_(Eo,hI),YR.isAnyAudioContext=lP,pP=c_(Co,lI),YR.isAnyAudioNode=pP,dP=p_(To,pI),YR.isAnyAudioParam=dP,fP=v_(Eo,$R),YR.isAnyOfflineAudioContext=fP,_P=()=>z_(XR,Iw(ZR),Jw(JR),iC(ZR),aC(JR),lC(ZR),AC(iP,ZR),NC(eI,ZR),PC(eI,ZR),VC(ZR),UC(KR),GC(JR),ex(ZR),Kx),YR.isSupported=_P}function gP(){return vP||(vP=!0,mP()),YR}var yP,bP,wP=!1;function CP(t,e){if(!t)throw new Error(e)}function xP(t,e,n=1/0){if(!(e<=t&&t<=n))throw new RangeError(`Value must be within [${e}, ${n}], got: ${t}`)}function TP(t){t.isOffline||"running"===t.state||AP('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}function SP(t){bP=t}function EP(...t){bP.log(...t)}function AP(...t){bP.warn(...t)}function kP(){return wP||(wP=!0,(yP={}).assert=CP,yP.assertRange=xP,yP.assertContextRunning=TP,bP=console,yP.setLogger=SP,yP.log=EP,yP.warn=AP),yP}var OP,DP=!1;function NP(t){return void 0===t}function RP(t){return!NP(t)}function IP(t){return"function"==typeof t}function MP(t){return"number"==typeof t}function PP(t){return"[object Object]"===Object.prototype.toString.call(t)&&t.constructor===Object}function FP(t){return"boolean"==typeof t}function qP(t){return Array.isArray(t)}function LP(t){return"string"==typeof t}function VP(t){return LP(t)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(t)}function jP(){return DP||(DP=!0,(OP={}).isUndef=NP,OP.isDefined=RP,OP.isFunction=IP,OP.isNumber=MP,OP.isObject=PP,OP.isBoolean=FP,OP.isArray=qP,OP.isString=LP,OP.isNote=VP),OP}var WP,BP,UP,zP=!1;function QP(t){return new XM(t)}function HP(t,e,n){return new hP(t,e,n)}function GP(t,e,n){return CP(RP(sP),"This node only works in a secure context (https or localhost)"),new sP(t,e,n)}function YP(){return zP||(zP=!0,WP={},gP(),kP(),jP(),gP(),WP.createAudioContext=QP,WP.createOfflineAudioContext=HP,BP="object"==typeof self?self:null,WP.theWindow=BP,UP=BP&&(BP.hasOwnProperty("AudioContext")||BP.hasOwnProperty("webkitAudioContext")),WP.hasAudioContext=UP,WP.createAudioWorkletNode=GP,WP.supported=_P),WP}var XP,KP,ZP=!1;function $P(){return ZP||(ZP=!0,XP={},KP=class{constructor(t,e,n){this._callback=t,this._type=e,this._updateInterval=n,this._createClock()}_createWorker(){const t=new Blob([`\n\t\t\t// the initial timeout time\n\t\t\tlet timeoutTime =  ${(1e3*this._updateInterval).toFixed(1)};\n\t\t\t// onmessage callback\n\t\t\tself.onmessage = function(msg){\n\t\t\t\ttimeoutTime = parseInt(msg.data);\n\t\t\t};\n\t\t\t// the tick function which posts a message\n\t\t\t// and schedules a new tick\n\t\t\tfunction tick(){\n\t\t\t\tsetTimeout(tick, timeoutTime);\n\t\t\t\tself.postMessage('tick');\n\t\t\t}\n\t\t\t// call tick initially\n\t\t\ttick();\n\t\t\t`],{type:"text/javascript"}),e=URL.createObjectURL(t),n=new Worker(e);n.onmessage=this._callback.bind(this),this._worker=n}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},1e3*this._updateInterval)}_createClock(){if("worker"===this._type)try{this._createWorker()}catch(t){this._type="timeout",this._createClock()}else"timeout"===this._type&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(t){this._updateInterval=Math.max(t,128/44100),"worker"===this._type&&this._worker.postMessage(Math.max(1e3*t,1))}get type(){return this._type}set type(t){this._disposeClock(),this._type=t,this._createClock()}dispose(){this._disposeClock()}},XP.Ticker=KP),XP}var JP,tF=!1;function eF(t){return dP(t)}function nF(t){return pP(t)}function iF(t){return fP(t)}function rF(t){return lP(t)}function sF(t){return t instanceof AudioBuffer}function oF(){return tF||(tF=!0,JP={},gP(),JP.isAudioParam=eF,JP.isAudioNode=nF,JP.isOfflineAudioContext=iF,JP.isAudioContext=rF,JP.isAudioBuffer=sF),JP}var aF,cF=!1;function uF(t,e){return"value"===t||eF(e)||nF(e)||sF(e)}function hF(t,...e){if(!e.length)return t;const n=e.shift();if(PP(t)&&PP(n))for(const e in n)uF(e,n[e])?t[e]=n[e]:PP(n[e])?(t[e]||Object.assign(t,{[e]:{}}),hF(t[e],n[e])):Object.assign(t,{[e]:n[e]});return hF(t,...e)}function lF(t,e){return t.length===e.length&&t.every((t,n)=>e[n]===t)}function pF(t,e,n=[],i){const r={},s=Array.from(e);if(PP(s[0])&&i&&!Reflect.has(s[0],i)){Object.keys(s[0]).some(e=>Reflect.has(t,e))||(hF(r,{[i]:s[0]}),n.splice(n.indexOf(i),1),s.shift())}if(1===s.length&&PP(s[0]))hF(r,s[0]);else for(let t=0;t<n.length;t++)RP(s[t])&&(r[n[t]]=s[t]);return hF(t,r)}function dF(t){return t.constructor.getDefaults()}function fF(t,e){return NP(t)?e:t}function _F(t,e){return e.forEach(e=>{Reflect.has(t,e)&&delete t[e]}),t}function vF(){return cF||(cF=!0,aF={},oF(),jP(),aF.deepMerge=hF,aF.deepEquals=lF,aF.optionsFromArguments=pF,aF.getDefaultsFromInstance=dF,aF.defaultArg=fF,aF.omitFromObject=_F),aF}var mF,gF,yF=!1;function bF(){return yF||(yF=!0,mF={},ms(),YP(),kP(),gF=class{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...t){(this.debug||BP&&this.toString()===BP.TONE_DEBUG_CLASS)&&EP(this,...t)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}},mF.Tone=gF,gF.version=_s),mF}var wF,CF,xF=!1;function TF(t,e){return t>e+CF}function SF(t,e){return TF(t,e)||AF(t,e)}function EF(t,e){return t+CF<e}function AF(t,e){return Math.abs(t-e)<CF}function kF(t,e,n){return Math.max(Math.min(t,n),e)}function OF(){return xF||(xF=!0,CF=1e-6,(wF={}).GT=TF,wF.GTE=SF,wF.LT=EF,wF.EQ=AF,wF.clamp=kF),wF}var DF,NF,RF=!1;function IF(){return RF||(RF=!0,DF={},bF(),vF(),kP(),OF(),NF=class t extends gF{constructor(){super(),this.name="Timeline",this._timeline=[];const e=pF(t.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(t){if(CP(Reflect.has(t,"time"),"Timeline: events must have a time attribute"),t.time=t.time.valueOf(),this.increasing&&this.length){const e=this._timeline[this.length-1];CP(SF(t.time,e.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(t)}else{const e=this._search(t.time);this._timeline.splice(e+1,0,t)}if(this.length>this.memory){const t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(t){const e=this._timeline.indexOf(t);return-1!==e&&this._timeline.splice(e,1),this}get(t,e="time"){const n=this._search(t,e);return-1!==n?this._timeline[n]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(t,e="time"){const n=this._search(t,e);return n+1<this._timeline.length?this._timeline[n+1]:null}getBefore(t){const e=this._timeline.length;if(e>0&&this._timeline[e-1].time<t)return this._timeline[e-1];const n=this._search(t);return n-1>=0?this._timeline[n-1]:null}cancel(t){if(this._timeline.length>1){let e=this._search(t);if(e>=0)if(AF(this._timeline[e].time,t)){for(let n=e;n>=0&&AF(this._timeline[n].time,t);n--)e=n;this._timeline=this._timeline.slice(0,e)}else this._timeline=this._timeline.slice(0,e+1);else this._timeline=[]}else 1===this._timeline.length&&SF(this._timeline[0].time,t)&&(this._timeline=[]);return this}cancelBefore(t){const e=this._search(t);return e>=0&&(this._timeline=this._timeline.slice(e+1)),this}previousEvent(t){const e=this._timeline.indexOf(t);return e>0?this._timeline[e-1]:null}_search(t,e="time"){if(0===this._timeline.length)return-1;let n=0;const i=this._timeline.length;let r=i;if(i>0&&this._timeline[i-1][e]<=t)return i-1;for(;n<r;){let i=Math.floor(n+(r-n)/2);const s=this._timeline[i],o=this._timeline[i+1];if(AF(s[e],t)){for(let n=i;n<this._timeline.length&&AF(this._timeline[n][e],t);n++)i=n;return i}if(EF(s[e],t)&&TF(o[e],t))return i;TF(s[e],t)?r=i:n=i+1}return-1}_iterate(t,e=0,n=this._timeline.length-1){this._timeline.slice(e,n+1).forEach(t)}forEach(t){return this._iterate(t),this}forEachBefore(t,e){const n=this._search(t);return-1!==n&&this._iterate(e,0,n),this}forEachAfter(t,e){const n=this._search(t);return this._iterate(e,n+1),this}forEachBetween(t,e,n){let i=this._search(t),r=this._search(e);return-1!==i&&-1!==r?(this._timeline[i].time!==t&&(i+=1),this._timeline[r].time===e&&(r-=1),this._iterate(n,i,r)):-1===i&&this._iterate(n,0,r),this}forEachFrom(t,e){let n=this._search(t);for(;n>=0&&this._timeline[n].time>=t;)n--;return this._iterate(e,n+1),this}forEachAtTime(t,e){const n=this._search(t);if(-1!==n&&AF(this._timeline[n].time,t)){let i=n;for(let e=n;e>=0&&AF(this._timeline[e].time,t);e--)i=e;this._iterate(t=>{e(t)},i,n)}return this}dispose(){return super.dispose(),this._timeline=[],this}},DF.Timeline=NF),DF}var MF,PF,FF,qF=!1;function LF(t){PF.push(t)}function VF(t){PF.forEach(e=>e(t))}function jF(t){FF.push(t)}function WF(t){FF.forEach(e=>e(t))}function BF(){return qF||(qF=!0,PF=[],(MF={}).onContextInit=LF,MF.initializeContext=VF,FF=[],MF.onContextClose=jF,MF.closeContext=WF),MF}var UF,zF,QF=!1;function HF(){return QF||(QF=!0,UF={},bF(),jP(),zF=class t extends gF{constructor(){super(...arguments),this.name="Emitter"}on(t,e){return t.split(/\W+/).forEach(t=>{NP(this._events)&&(this._events={}),this._events.hasOwnProperty(t)||(this._events[t]=[]),this._events[t].push(e)}),this}once(t,e){const n=(...i)=>{e(...i),this.off(t,n)};return this.on(t,n),this}off(t,e){return t.split(/\W+/).forEach(n=>{if(NP(this._events)&&(this._events={}),this._events.hasOwnProperty(t))if(NP(e))this._events[t]=[];else{const n=this._events[t];for(let t=0;t<n.length;t++)n[t]===e&&n.splice(t,1)}}),this}emit(t,...e){if(this._events&&this._events.hasOwnProperty(t)){const n=this._events[t].slice(0);for(let t=0,i=n.length;t<i;t++)n[t].apply(this,e)}return this}static mixin(e){["on","once","off","emit"].forEach(n=>{const i=Object.getOwnPropertyDescriptor(t.prototype,n);Object.defineProperty(e.prototype,n,i)})}dispose(){return super.dispose(),this._events=void 0,this}},UF.Emitter=zF),UF}var GF,YF,XF=!1;function KF(){return XF||(XF=!0,GF={},HF(),YF=class extends zF{constructor(){super(...arguments),this.isOffline=!1}},GF.BaseContext=YF),GF}var ZF,$F,JF=!1;function tq(){return JF||(JF=!0,ZF={},$P(),oF(),vF(),IF(),jP(),YP(),BF(),KF(),kP(),$F=class t extends YF{constructor(){super(),this.name="Context",this._constants=new Map,this._timeouts=new NF,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;const e=pF(t.getDefaults(),arguments,["context"]);e.context?this._context=e.context:this._context=QP({latencyHint:e.latencyHint}),this._ticker=new KP(this.emit.bind(this,"tick"),e.clockSource,e.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(e.latencyHint),this.lookAhead=e.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(VF(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(t,e,n){return this._context.createBuffer(t,e,n)}createChannelMerger(t){return this._context.createChannelMerger(t)}createChannelSplitter(t){return this._context.createChannelSplitter(t)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(t){return this._context.createDelay(t)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(t,e){return this._context.createIIRFilter(t,e)}createPanner(){return this._context.createPanner()}createPeriodicWave(t,e,n){return this._context.createPeriodicWave(t,e,n)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(t){return CP(rF(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(t)}createMediaStreamDestination(){return CP(rF(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(t){return this._context.decodeAudioData(t)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(t){CP(!this._initialized,"The listener cannot be set after initialization."),this._listener=t}get transport(){return this.initialize(),this._transport}set transport(t){CP(!this._initialized,"The transport cannot be set after initialization."),this._transport=t}get draw(){return this.initialize(),this._draw}set draw(t){CP(!this._initialized,"Draw cannot be set after initialization."),this._draw=t}get destination(){return this.initialize(),this._destination}set destination(t){CP(!this._initialized,"The destination cannot be set after initialization."),this._destination=t}createAudioWorkletNode(t,e){return GP(this.rawContext,t,e)}addAudioWorkletModule(t,e){return g(this,void 0,void 0,(function*(){CP(RP(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(e)||this._workletModules.set(e,this.rawContext.audioWorklet.addModule(t)),yield this._workletModules.get(e)}))}workletsAreReady(){return g(this,void 0,void 0,(function*(){const t=[];this._workletModules.forEach(e=>t.push(e)),yield Promise.all(t)}))}get updateInterval(){return this._ticker.updateInterval}set updateInterval(t){this._ticker.updateInterval=t}get clockSource(){return this._ticker.type}set clockSource(t){this._ticker.type=t}get latencyHint(){return this._latencyHint}_setLatencyHint(t){let e=0;if(this._latencyHint=t,LP(t))switch(t){case"interactive":e=.1;break;case"playback":e=.5;break;case"balanced":e=.25}this.lookAhead=e,this.updateInterval=e/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return"suspended"===this._context.state&&rF(this._context)?this._context.resume():Promise.resolve()}close(){return g(this,void 0,void 0,(function*(){rF(this._context)&&(yield this._context.close()),this._initialized&&WF(this)}))}getConstant(t){if(this._constants.has(t))return this._constants.get(t);{const e=this._context.createBuffer(1,128,this._context.sampleRate),n=e.getChannelData(0);for(let e=0;e<n.length;e++)n[e]=t;const i=this._context.createBufferSource();return i.channelCount=1,i.channelCountMode="explicit",i.buffer=e,i.loop=!0,i.start(0),this._constants.set(t,i),i}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(t=>this._constants[t].disconnect()),this}_timeoutLoop(){const t=this.now();let e=this._timeouts.peek();for(;this._timeouts.length&&e&&e.time<=t;)e.callback(),this._timeouts.shift(),e=this._timeouts.peek()}setTimeout(t,e){this._timeoutIds++;const n=this.now();return this._timeouts.add({callback:t,id:this._timeoutIds,time:n+e}),this._timeoutIds}clearTimeout(t){return this._timeouts.forEach(e=>{e.id===t&&this._timeouts.remove(e)}),this}clearInterval(t){return this.clearTimeout(t)}setInterval(t,e){const n=++this._timeoutIds,i=()=>{const r=this.now();this._timeouts.add({callback:()=>{t(),i()},id:n,time:r+e})};return i(),n}},ZF.Context=$F),ZF}var eq,nq,iq=!1;function rq(){return iq||(iq=!0,eq={},KF(),nq=class extends YF{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(t,e,n){return{}}createChannelMerger(t){return{}}createChannelSplitter(t){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(t){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(t,e){return{}}createPanner(){return{}}createPeriodicWave(t,e,n){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(t){return{}}createMediaStreamDestination(){return{}}decodeAudioData(t){return Promise.resolve({})}createAudioWorkletNode(t,e){return{}}get rawContext(){return{}}addAudioWorkletModule(t,e){return g(this,void 0,void 0,(function*(){return Promise.resolve()}))}resume(){return Promise.resolve()}setTimeout(t,e){return 0}clearTimeout(t){return this}setInterval(t,e){return 0}clearInterval(t){return this}getConstant(t){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(t){}get destination(){return{}}set destination(t){}now(){return 0}immediate(){return 0}},eq.DummyContext=nq),eq}var sq,oq,aq=!1;function cq(t,e){qP(e)?e.forEach(e=>cq(t,e)):Object.defineProperty(t,e,{enumerable:!0,writable:!1})}function uq(t,e){qP(e)?e.forEach(e=>uq(t,e)):Object.defineProperty(t,e,{writable:!0})}function hq(){return aq||(aq=!0,sq={},jP(),sq.readOnly=cq,sq.writable=uq,oq=()=>{},sq.noOp=oq),sq}var lq,pq,dq=!1;function fq(){return dq||(dq=!0,lq={},Eq(),bF(),oF(),vF(),hq(),jP(),kP(),pq=class t extends gF{constructor(){super(),this.name="ToneAudioBuffer",this.onload=oq;const e=pF(t.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,e.url&&sF(e.url)||e.url instanceof t?this.set(e.url):LP(e.url)&&this.load(e.url).catch(e.onerror)}static getDefaults(){return{onerror:oq,onload:oq,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:xq().sampleRate}set(e){return e instanceof t?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return g(this,void 0,void 0,(function*(){const n=t.load(e).then(t=>{this.set(t),this.onload(this)});t.downloads.push(n);try{yield n}finally{const e=t.downloads.indexOf(n);t.downloads.splice(e,1)}return this}))}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(t){const e=qP(t)&&t[0].length>0,n=e?t.length:1,i=e?t[0].length:t.length,r=xq(),s=r.createBuffer(n,i,r.sampleRate),o=e||1!==n?t:[t];for(let t=0;t<n;t++)s.copyToChannel(o[t],t);return this._buffer=s,this}toMono(t){if(MP(t))this.fromArray(this.toArray(t));else{let t=new Float32Array(this.length);const e=this.numberOfChannels;for(let n=0;n<e;n++){const e=this.toArray(n);for(let n=0;n<e.length;n++)t[n]+=e[n]}t=t.map(t=>t/e),this.fromArray(t)}return this}toArray(t){if(MP(t))return this.getChannelData(t);if(1===this.numberOfChannels)return this.toArray(0);{const t=[];for(let e=0;e<this.numberOfChannels;e++)t[e]=this.getChannelData(e);return t}}getChannelData(t){return this._buffer?this._buffer.getChannelData(t):new Float32Array(0)}slice(e,n=this.duration){const i=Math.floor(e*this.sampleRate),r=Math.floor(n*this.sampleRate);CP(i<r,"The start time must be less than the end time");const s=r-i,o=xq().createBuffer(this.numberOfChannels,s,this.sampleRate);for(let t=0;t<this.numberOfChannels;t++)o.copyToChannel(this.getChannelData(t).subarray(i,r),t);return new t(o)}_reverse(){if(this.loaded)for(let t=0;t<this.numberOfChannels;t++)this.getChannelData(t).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(t){this._reversed!==t&&(this._reversed=t,this._reverse())}static fromArray(e){return(new t).fromArray(e)}static fromUrl(e){return g(this,void 0,void 0,(function*(){const n=new t;return yield n.load(e)}))}static load(e){return g(this,void 0,void 0,(function*(){const n=e.match(/\[(.+\|?)+\]$/);if(n){const i=n[1].split("|");let r=i[0];for(const e of i)if(t.supportsType(e)){r=e;break}e=e.replace(n[0],r)}const i=""===t.baseUrl||t.baseUrl.endsWith("/")?t.baseUrl:t.baseUrl+"/",r=yield fetch(i+e);if(!r.ok)throw new Error("could not load url: "+e);const s=yield r.arrayBuffer();return yield xq().decodeAudioData(s)}))}static supportsType(t){const e=t.split("."),n=e[e.length-1];return""!==document.createElement("audio").canPlayType("audio/"+n)}static loaded(){return g(this,void 0,void 0,(function*(){for(yield Promise.resolve();t.downloads.length;)yield t.downloads[0]}))}},lq.ToneAudioBuffer=pq,pq.baseUrl="",pq.downloads=[]),lq}var _q,vq,mq=!1;function gq(){return mq||(mq=!0,_q={},YP(),tq(),oF(),fq(),vq=class extends $F{constructor(){super({clockSource:"offline",context:iF(arguments[0])?arguments[0]:HP(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:iF(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=iF(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(t){return g(this,void 0,void 0,(function*(){let e=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,e++;const n=Math.floor(this.sampleRate/128);t&&e%n==0&&(yield new Promise(t=>setTimeout(t,1)))}}))}render(t=!0){return g(this,void 0,void 0,(function*(){yield this.workletsAreReady(),yield this._renderClock(t);const e=yield this._context.startRendering();return new pq(e)}))}close(){return Promise.resolve()}},_q.OfflineContext=vq),_q}var yq,bq,wq,Cq=!1;function xq(){return wq===bq&&UP&&Tq(new $F),wq}function Tq(t){wq=rF(t)?new $F(t):iF(t)?new vq(t):t}function Sq(){return wq.resume()}function Eq(){return Cq||(Cq=!0,function(){if(yq={},ms(),YP(),tq(),rq(),gq(),oF(),bq=new nq,wq=bq,yq.getContext=xq,yq.setContext=Tq,yq.start=Sq,BP&&!BP.TONE_SILENCE_LOGGING){let t="v";"dev"===_s&&(t="");const e=` * Tone.js ${t}${_s} * `;console.log("%c"+e,"background: #000; color: #fff")}}()),yq}var Aq,kq,Oq=!1;function Dq(t){const e=.5*Math.PI;return Math.sin(t*e)}function Nq(t){return Math.pow(10,t/20)}function Rq(t){return Math.log(t)/Math.LN10*20}function Iq(t){return Math.pow(2,t/12)}function Mq(){return kq}function Pq(t){kq=t}function Fq(t){return Math.round(qq(t))}function qq(t){return 69+12*Math.log2(t/kq)}function Lq(t){return kq*Math.pow(2,(t-69)/12)}function Vq(){return Oq||(Oq=!0,(Aq={}).equalPowerScale=Dq,Aq.dbToGain=Nq,Aq.gainToDb=Rq,Aq.intervalToFrequencyRatio=Iq,kq=440,Aq.getA4=Mq,Aq.setA4=Pq,Aq.ftom=Fq,Aq.ftomf=qq,Aq.mtof=Lq),Aq}var jq,Wq,Bq=!1;function Uq(){return Bq||(Bq=!0,jq={},bF(),jP(),Wq=class t extends gF{constructor(t,e,n){super(),this.defaultUnits="s",this._val=e,this._units=n,this.context=t,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:t=>this._frequencyToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:t=>this._ticksToUnits(parseInt(t,10)),regexp:/^(\d+)i$/i},m:{method:t=>this._beatsToUnits(parseInt(t,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(t,e)=>{const n=parseInt(t,10),i="."===e?1.5:1;return 1===n?this._beatsToUnits(this._getTimeSignature())*i:this._beatsToUnits(4/n)*i},regexp:/^(\d+)n(\.?)$/i},number:{method:t=>this._expressions[this.defaultUnits].method.call(this,t),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:t=>this._secondsToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:t=>parseInt(t,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:t=>{const e=parseInt(t,10);return this._beatsToUnits(8/(3*Math.floor(e)))},regexp:/^(\d+)t$/i},tr:{method:(t,e,n)=>{let i=0;return t&&"0"!==t&&(i+=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(i+=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(i+=this._beatsToUnits(parseFloat(n)/4)),i},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof t&&this.fromType(this._val),NP(this._val))return this._noArg();if(LP(this._val)&&NP(this._units)){for(const t in this._expressions)if(this._expressions[t].regexp.test(this._val.trim())){this._units=t;break}}else if(PP(this._val)){let t=0;for(const e in this._val)if(RP(this._val[e])){const n=this._val[e];t+=new this.constructor(this.context,e).valueOf()*n}return t}if(RP(this._units)){const t=this._expressions[this._units],e=this._val.toString().trim().match(t.regexp);return e?t.method.apply(this,e.slice(1)):t.method.call(this,this._val)}return LP(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(t){return 1/t}_beatsToUnits(t){return 60/this._getBpm()*t}_secondsToUnits(t){return t}_ticksToUnits(t){return t*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(t){switch(this._units=void 0,this.defaultUnits){case"s":this._val=t.toSeconds();break;case"i":this._val=t.toTicks();break;case"hz":this._val=t.toFrequency();break;case"midi":this._val=t.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}},jq.TimeBaseClass=Wq),jq}var zq,Qq,Hq=!1;function Gq(t,e){return new Qq(xq(),t,e)}function Yq(){return Hq||(Hq=!0,zq={},Eq(),Vq(),Uq(),Qq=class t extends Wq{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:t=>this._now()+new this.constructor(this.context,t).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const n=new t(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(n))},regexp:/^@(.+)/}})}quantize(t,e=1){const n=new this.constructor(this.context,t).valueOf(),i=this.valueOf();return i+(Math.round(i/n)*n-i)*e}toNotation(){const e=this.toSeconds(),n=["1m"];for(let t=1;t<9;t++){const e=Math.pow(2,t);n.push(e+"n."),n.push(e+"n"),n.push(e+"t")}n.push("0");let i=n[0],r=new t(this.context,n[0]).toSeconds();return n.forEach(n=>{const s=new t(this.context,n).toSeconds();Math.abs(s-e)<Math.abs(r-e)&&(i=n,r=s)}),i}toBarsBeatsSixteenths(){const t=this._beatsToUnits(1);let e=this.valueOf()/t;e=parseFloat(e.toFixed(4));const n=Math.floor(e/this._getTimeSignature());let i=e%1*4;e=Math.floor(e)%this._getTimeSignature();const r=i.toString();return r.length>3&&(i=parseFloat(parseFloat(r).toFixed(3))),[n,e,i].join(":")}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.round(e*this._getPPQ())}toSeconds(){return this.valueOf()}toMidi(){return Fq(this.toFrequency())}_now(){return this.context.now()}},zq.TimeClass=Qq,zq.Time=Gq),zq}var Xq,Kq,Zq,$q,Jq=!1;function tL(t,e){return new Kq(xq(),t,e)}function eL(){return Jq||(Jq=!0,Xq={},Eq(),Vq(),Vq(),Yq(),Kq=class t extends Qq{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return Mq()}static set A4(t){Pq(t)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return"midi"===this.defaultUnits?e:t.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(e,n){const i=Zq[e.toLowerCase()]+12*(parseInt(n,10)+1);return"midi"===this.defaultUnits?i:t.mtof(i)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(t,e,n){let i=1;return t&&"0"!==t&&(i*=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(i*=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(i*=this._beatsToUnits(parseFloat(n)/4)),i}}})}transpose(e){return new t(this.context,this.valueOf()*Iq(e))}harmonize(t){return t.map(t=>this.transpose(t))}toMidi(){return Fq(this.valueOf())}toNote(){const e=this.toFrequency(),n=Math.log2(e/t.A4);let i=Math.round(12*n)+57;const r=Math.floor(i/12);return r<0&&(i+=-12*r),$q[i%12]+r.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.floor(e*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(t){return t}_ticksToUnits(t){return 1/(60*t/(this._getBpm()*this._getPPQ()))}_beatsToUnits(t){return 1/super._beatsToUnits(t)}_secondsToUnits(t){return 1/t}static mtof(t){return Lq(t)}static ftom(t){return Fq(t)}},Xq.FrequencyClass=Kq,Zq={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},$q=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],Xq.Frequency=tL),Xq}var nL,iL,rL=!1;function sL(t,e){return new iL(xq(),t,e)}function oL(){return rL||(rL=!0,nL={},Eq(),Yq(),iL=class extends Qq{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}},nL.TransportTimeClass=iL,nL.TransportTime=sL),nL}var aL,cL,uL=!1;function hL(){return uL||(uL=!0,aL={},Eq(),bF(),eL(),Yq(),oL(),vF(),jP(),cL=class t extends gF{constructor(){super();const e=pF(t.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:xq()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(t){return new Qq(this.context,t).toSeconds()}toFrequency(t){return new Kq(this.context,t).toFrequency()}toTicks(t){return new iL(this.context,t).toTicks()}_getPartialProperties(t){const e=this.get();return Object.keys(e).forEach(n=>{NP(t[n])&&delete e[n]}),e}get(){const e=dF(this);return Object.keys(e).forEach(n=>{if(Reflect.has(this,n)){const i=this[n];RP(i)&&RP(i.value)&&RP(i.setValueAtTime)?e[n]=i.value:i instanceof t?e[n]=i._getPartialProperties(e[n]):qP(i)||MP(i)||LP(i)||FP(i)?e[n]=i:delete e[n]}}),e}set(e){return Object.keys(e).forEach(n=>{Reflect.has(this,n)&&RP(this[n])&&(this[n]&&RP(this[n].value)&&RP(this[n].setValueAtTime)?this[n].value!==e[n]&&(this[n].value=e[n]):this[n]instanceof t?this[n].set(e[n]):this[n]=e[n])}),this}},aL.ToneWithContext=cL),aL}var lL,pL,dL=!1;function fL(){return dL||(dL=!0,lL={},IF(),kP(),pL=class extends NF{constructor(t="stopped"){super(),this.name="StateTimeline",this._initial=t,this.setStateAtTime(this._initial,0)}getValueAtTime(t){const e=this.get(t);return null!==e?e.state:this._initial}setStateAtTime(t,e,n){return xP(e,0),this.add(Object.assign({},n,{state:t,time:e})),this}getLastState(t,e){for(let n=this._search(e);n>=0;n--){const e=this._timeline[n];if(e.state===t)return e}}getNextState(t,e){const n=this._search(e);if(-1!==n)for(let e=n;e<this._timeline.length;e++){const n=this._timeline[e];if(n.state===t)return n}}},lL.StateTimeline=pL),lL}var _L,vL,mL=!1;function gL(){return mL||(mL=!0,_L={},Vq(),oF(),vF(),IF(),jP(),hL(),OF(),kP(),vL=class t extends cL{constructor(){super(pF(t.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;const e=pF(t.getDefaults(),arguments,["param","units","convert"]);for(CP(RP(e.param)&&(eF(e.param)||e.param instanceof t),"param must be an AudioParam");!eF(e.param);)e.param=e.param._param;this._swappable=!!RP(e.swappable)&&e.swappable,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new NF(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,RP(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(cL.getDefaults(),{convert:!0,units:"number"})}get value(){const t=this.now();return this.getValueAtTime(t)}set value(t){this.cancelScheduledValues(this.now()),this.setValueAtTime(t,this.now())}get minValue(){return RP(this._minValue)?this._minValue:"time"===this.units||"frequency"===this.units||"normalRange"===this.units||"positive"===this.units||"transportTime"===this.units||"ticks"===this.units||"bpm"===this.units||"hertz"===this.units||"samples"===this.units?0:"audioRange"===this.units?-1:"decibels"===this.units?-1/0:this._param.minValue}get maxValue(){return RP(this._maxValue)?this._maxValue:"normalRange"===this.units||"audioRange"===this.units?1:this._param.maxValue}_is(t,e){return this.units===e}_assertRange(t){return RP(this.maxValue)&&RP(this.minValue)&&xP(t,this._fromType(this.minValue),this._fromType(this.maxValue)),t}_fromType(t){return this.convert&&!this.overridden?this._is(t,"time")?this.toSeconds(t):this._is(t,"decibels")?Nq(t):this._is(t,"frequency")?this.toFrequency(t):t:this.overridden?0:t}_toType(t){return this.convert&&"decibels"===this.units?Rq(t):t}setValueAtTime(t,e){const n=this.toSeconds(e),i=this._fromType(t);return CP(isFinite(i)&&isFinite(n),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(i),this.log(this.units,"setValueAtTime",t,n),this._events.add({time:n,type:"setValueAtTime",value:i}),this._param.setValueAtTime(i,n),this}getValueAtTime(t){const e=Math.max(this.toSeconds(t),0),n=this._events.getAfter(e),i=this._events.get(e);let r=this._initialValue;if(null===i)r=this._initialValue;else if("setTargetAtTime"!==i.type||null!==n&&"setValueAtTime"!==n.type)if(null===n)r=i.value;else if("linearRampToValueAtTime"===n.type||"exponentialRampToValueAtTime"===n.type){let t=i.value;if("setTargetAtTime"===i.type){const e=this._events.getBefore(i.time);t=null===e?this._initialValue:e.value}r="linearRampToValueAtTime"===n.type?this._linearInterpolate(i.time,t,n.time,n.value,e):this._exponentialInterpolate(i.time,t,n.time,n.value,e)}else r=i.value;else{const t=this._events.getBefore(i.time);let n;n=null===t?this._initialValue:t.value,"setTargetAtTime"===i.type&&(r=this._exponentialApproach(i.time,n,i.value,i.constant,e))}return this._toType(r)}setRampPoint(t){t=this.toSeconds(t);let e=this.getValueAtTime(t);return this.cancelAndHoldAtTime(t),0===this._fromType(e)&&(e=this._toType(this._minOutput)),this.setValueAtTime(e,t),this}linearRampToValueAtTime(t,e){const n=this._fromType(t),i=this.toSeconds(e);return CP(isFinite(n)&&isFinite(i),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(n),this._events.add({time:i,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",t,i),this._param.linearRampToValueAtTime(n,i),this}exponentialRampToValueAtTime(t,e){let n=this._fromType(t);n=Math.max(this._minOutput,n),this._assertRange(n);const i=this.toSeconds(e);return CP(isFinite(n)&&isFinite(i),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({time:i,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",t,i),this._param.exponentialRampToValueAtTime(n,i),this}exponentialRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(t,n+this.toSeconds(e)),this}linearRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(t,n+this.toSeconds(e)),this}targetRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(t,n,e),this}exponentialApproachValueAtTime(t,e,n){e=this.toSeconds(e),n=this.toSeconds(n);const i=Math.log(n+1)/Math.log(200);return this.setTargetAtTime(t,e,i),this.cancelAndHoldAtTime(e+.9*n),this.linearRampToValueAtTime(t,e+n),this}setTargetAtTime(t,e,n){const i=this._fromType(t);CP(isFinite(n)&&n>0,"timeConstant must be a number greater than 0");const r=this.toSeconds(e);return this._assertRange(i),CP(isFinite(i)&&isFinite(r),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({constant:n,time:r,type:"setTargetAtTime",value:i}),this.log(this.units,"setTargetAtTime",t,r,n),this._param.setTargetAtTime(i,r,n),this}setValueCurveAtTime(t,e,n,i=1){n=this.toSeconds(n),e=this.toSeconds(e);const r=this._fromType(t[0])*i;this.setValueAtTime(this._toType(r),e);const s=n/(t.length-1);for(let n=1;n<t.length;n++){const r=this._fromType(t[n])*i;this.linearRampToValueAtTime(this._toType(r),e+n*s)}return this}cancelScheduledValues(t){const e=this.toSeconds(t);return CP(isFinite(e),"Invalid argument to cancelScheduledValues: "+JSON.stringify(t)),this._events.cancel(e),this._param.cancelScheduledValues(e),this.log(this.units,"cancelScheduledValues",e),this}cancelAndHoldAtTime(t){const e=this.toSeconds(t),n=this._fromType(this.getValueAtTime(e));CP(isFinite(e),"Invalid argument to cancelAndHoldAtTime: "+JSON.stringify(t)),this.log(this.units,"cancelAndHoldAtTime",e,"value="+n);const i=this._events.get(e),r=this._events.getAfter(e);return i&&AF(i.time,e)?r?(this._param.cancelScheduledValues(r.time),this._events.cancel(r.time)):(this._param.cancelAndHoldAtTime(e),this._events.cancel(e+this.sampleTime)):r&&(this._param.cancelScheduledValues(r.time),this._events.cancel(r.time),"linearRampToValueAtTime"===r.type?this.linearRampToValueAtTime(this._toType(n),e):"exponentialRampToValueAtTime"===r.type&&this.exponentialRampToValueAtTime(this._toType(n),e)),this._events.add({time:e,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,e),this}rampTo(t,e=.1,n){return"frequency"===this.units||"bpm"===this.units||"decibels"===this.units?this.exponentialRampTo(t,e,n):this.linearRampTo(t,e,n),this}apply(t){const e=this.context.currentTime;t.setValueAtTime(this.getValueAtTime(e),e);const n=this._events.get(e);if(n&&"setTargetAtTime"===n.type){const i=this._events.getAfter(n.time),r=i?i.time:e+2,s=(r-e)/10;for(let n=e;n<r;n+=s)t.linearRampToValueAtTime(this.getValueAtTime(n),n)}return this._events.forEachAfter(this.context.currentTime,e=>{"cancelScheduledValues"===e.type?t.cancelScheduledValues(e.time):"setTargetAtTime"===e.type?t.setTargetAtTime(e.value,e.time,e.constant):t[e.type](e.value,e.time)}),this}setParam(t){CP(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const e=this.input;return e.disconnect(this._param),this.apply(t),this._param=t,e.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(t,e,n,i,r){return n+(e-n)*Math.exp(-(r-t)/i)}_linearInterpolate(t,e,n,i,r){return e+(r-t)/(n-t)*(i-e)}_exponentialInterpolate(t,e,n,i,r){return e*Math.pow(i/e,(r-t)/(n-t))}},_L.Param=vL),_L}var yL,bL,wL=!1;function CL(...t){const e=t.shift();t.reduce((t,e)=>(t instanceof bL?t.connect(e):nF(t)&&xL(t,e),e),e)}function xL(t,e,n=0,i=0){for(CP(RP(t),"Cannot connect from undefined node"),CP(RP(e),"Cannot connect to undefined node"),(e instanceof bL||nF(e))&&CP(e.numberOfInputs>0,"Cannot connect to node with no inputs"),CP(t.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof bL||e instanceof vL;)RP(e.input)&&(e=e.input);for(;t instanceof bL;)RP(t.output)&&(t=t.output);eF(e)?t.connect(e,n):t.connect(e,n,i)}function TL(t,e,n=0,i=0){if(RP(e))for(;e instanceof bL;)e=e.input;for(;!nF(t);)RP(t.output)&&(t=t.output);eF(e)?t.disconnect(e,n):nF(e)?t.disconnect(e,n,i):t.disconnect()}function SL(){return wL||(wL=!0,yL={},oF(),jP(),gL(),hL(),kP(),bL=class t extends cL{constructor(){super(...arguments),this.name="ToneAudioNode",this._internalChannels=[]}get numberOfInputs(){return RP(this.input)?eF(this.input)||this.input instanceof vL?1:this.input.numberOfInputs:0}get numberOfOutputs(){return RP(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return RP(e)&&(e instanceof t||nF(e))}_getInternalNodes(){const t=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&t.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&t.push(this.output),t}_setChannelProperties(t){this._getInternalNodes().forEach(e=>{e.channelCount=t.channelCount,e.channelCountMode=t.channelCountMode,e.channelInterpretation=t.channelInterpretation})}_getChannelProperties(){const t=this._getInternalNodes();CP(t.length>0,"ToneAudioNode does not have any internal nodes");const e=t[0];return{channelCount:e.channelCount,channelCountMode:e.channelCountMode,channelInterpretation:e.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCount:t}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCountMode:t}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelInterpretation:t}))}connect(t,e=0,n=0){return xL(this,t,e,n),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return AP("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(t,e=0,n=0){return TL(this,t,e,n),this}chain(...t){return CL(this,...t),this}fan(...t){return t.forEach(t=>this.connect(t)),this}dispose(){return super.dispose(),RP(this.input)&&(this.input instanceof t?this.input.dispose():nF(this.input)&&this.input.disconnect()),RP(this.output)&&(this.output instanceof t?this.output.dispose():nF(this.output)&&this.output.disconnect()),this._internalChannels=[],this}},yL.ToneAudioNode=bL,yL.connectSeries=CL,yL.connect=xL,yL.disconnect=TL),yL}var EL,AL,kL=!1;function OL(){return kL||(kL=!0,EL={},gL(),vF(),hq(),SL(),AL=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;const e=pF(t.getDefaults(),arguments,["gain","units"]);this.gain=new vL({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),cq(this,"gain")}static getDefaults(){return Object.assign(bL.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}},EL.Gain=AL),EL}var DL,NL,RL=!1;function IL(){return RL||(RL=!0,DL={},OL(),SL(),hq(),kP(),NL=class extends bL{constructor(t){super(t),this.onended=oq,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new AL({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const e=this.toSeconds(t);return-1!==this._startTime&&e>=this._startTime&&(-1===this._stopTime||e<=this._stopTime)?"started":"stopped"},this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut,this._curve=t.curve,this.onended=t.onended}static getDefaults(){return Object.assign(bL.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:oq})}_startGain(t,e=1){CP(-1===this._startTime,"Source cannot be started more than once");const n=this.toSeconds(this._fadeIn);return this._startTime=t+n,this._startTime=Math.max(this._startTime,this.context.currentTime),n>0?(this._gainNode.gain.setValueAtTime(0,t),"linear"===this._curve?this._gainNode.gain.linearRampToValueAtTime(e,t+n):this._gainNode.gain.exponentialApproachValueAtTime(e,t,n)):this._gainNode.gain.setValueAtTime(e,t),this}stop(t){return this.log("stop",t),this._stopGain(this.toSeconds(t)),this}_stopGain(t){CP(-1!==this._startTime,"'start' must be called before 'stop'"),this.cancelStop();const e=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(t)+e,this._stopTime=Math.max(this._stopTime,this.context.currentTime),e>0?"linear"===this._curve?this._gainNode.gain.linearRampTo(0,e,t):this._gainNode.gain.targetRampTo(0,e,t):(this._gainNode.gain.cancelAndHoldAtTime(t),this._gainNode.gain.setValueAtTime(0,t)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const t="exponential"===this._curve?2*e:0;this._stopSource(this.now()+t),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==oq&&(this.onended(this),this.onended=oq,!this.context.isOffline)){const t=()=>this.dispose();void 0!==window.requestIdleCallback?window.requestIdleCallback(t):setTimeout(t,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),CP(-1!==this._startTime,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}},DL.OneShotSource=NL),DL}var ML,PL,FL=!1;function qL(){return FL||(FL=!0,ML={},SL(),gL(),vF(),IL(),PL=class t extends NL{constructor(){super(pF(t.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();const e=pF(t.getDefaults(),arguments,["offset"]);xL(this._source,this._gainNode),this.offset=new vL({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(NL.getDefaults(),{convert:!0,offset:1,units:"number"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._source.start(e),this}_stopSource(t){this._source.stop(t)}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}},ML.ToneConstantSource=PL),ML}var LL,VL,jL=!1;function WL(t,e,n,i){(e instanceof vL||eF(e)||e instanceof VL&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof VL&&(e.overridden=!0)),xL(t,e,n,i)}function BL(){return jL||(jL=!0,LL={},gL(),SL(),SL(),oF(),vF(),qL(),VL=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;const e=pF(t.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new PL({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(bL.getDefaults(),{convert:!0,units:"number",value:0})}connect(t,e=0,n=0){return WL(this,t,e,n),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(t,e){return this._param.setValueAtTime(t,e),this}getValueAtTime(t){return this._param.getValueAtTime(t)}setRampPoint(t){return this._param.setRampPoint(t),this}linearRampToValueAtTime(t,e){return this._param.linearRampToValueAtTime(t,e),this}exponentialRampToValueAtTime(t,e){return this._param.exponentialRampToValueAtTime(t,e),this}exponentialRampTo(t,e,n){return this._param.exponentialRampTo(t,e,n),this}linearRampTo(t,e,n){return this._param.linearRampTo(t,e,n),this}targetRampTo(t,e,n){return this._param.targetRampTo(t,e,n),this}exponentialApproachValueAtTime(t,e,n){return this._param.exponentialApproachValueAtTime(t,e,n),this}setTargetAtTime(t,e,n){return this._param.setTargetAtTime(t,e,n),this}setValueCurveAtTime(t,e,n,i){return this._param.setValueCurveAtTime(t,e,n,i),this}cancelScheduledValues(t){return this._param.cancelScheduledValues(t),this}cancelAndHoldAtTime(t){return this._param.cancelAndHoldAtTime(t),this}rampTo(t,e,n){return this._param.rampTo(t,e,n),this}get value(){return this._param.value}set value(t){this._param.value=t}get convert(){return this._param.convert}set convert(t){this._param.convert=t}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(t){this._param.overridden=t}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(t){return this._param.apply(t),this}},LL.Signal=VL,LL.connectSignal=WL),LL}var UL,zL,QL=!1;function HL(){return QL||(QL=!0,UL={},gL(),vF(),IF(),jP(),zL=class t extends vL{constructor(){super(pF(t.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new NF(1/0),this._multiplier=1;const e=pF(t.getDefaults(),arguments,["value"]);this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(vL.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(t,e,n){e=this.toSeconds(e),this.setRampPoint(e);const i=this._fromType(t),r=this._events.get(e),s=Math.round(Math.max(1/n,1));for(let t=0;t<=s;t++){const s=n*t+e,o=this._exponentialApproach(r.time,r.value,i,n,s);this.linearRampToValueAtTime(this._toType(o),s)}return this}setValueAtTime(t,e){const n=this.toSeconds(e);super.setValueAtTime(t,e);const i=this._events.get(n),r=this._events.previousEvent(i),s=this._getTicksUntilEvent(r,n);return i.ticks=Math.max(s,0),this}linearRampToValueAtTime(t,e){const n=this.toSeconds(e);super.linearRampToValueAtTime(t,e);const i=this._events.get(n),r=this._events.previousEvent(i),s=this._getTicksUntilEvent(r,n);return i.ticks=Math.max(s,0),this}exponentialRampToValueAtTime(t,e){e=this.toSeconds(e);const n=this._fromType(t),i=this._events.get(e),r=Math.round(Math.max(10*(e-i.time),1)),s=(e-i.time)/r;for(let t=0;t<=r;t++){const r=s*t+i.time,o=this._exponentialInterpolate(i.time,i.value,e,n,r);this.linearRampToValueAtTime(this._toType(o),r)}return this}_getTicksUntilEvent(t,e){if(null===t)t={ticks:0,time:0,type:"setValueAtTime",value:0};else if(NP(t.ticks)){const e=this._events.previousEvent(t);t.ticks=this._getTicksUntilEvent(e,t.time)}const n=this._fromType(this.getValueAtTime(t.time));let i=this._fromType(this.getValueAtTime(e));const r=this._events.get(e);return r&&r.time===e&&"setValueAtTime"===r.type&&(i=this._fromType(this.getValueAtTime(e-this.sampleTime))),.5*(e-t.time)*(n+i)+t.ticks}getTicksAtTime(t){const e=this.toSeconds(t),n=this._events.get(e);return Math.max(this._getTicksUntilEvent(n,e),0)}getDurationOfTicks(t,e){const n=this.toSeconds(e),i=this.getTicksAtTime(e);return this.getTimeOfTick(i+t)-n}getTimeOfTick(t){const e=this._events.get(t,"ticks"),n=this._events.getAfter(t,"ticks");if(e&&e.ticks===t)return e.time;if(e&&n&&"linearRampToValueAtTime"===n.type&&e.value!==n.value){const i=this._fromType(this.getValueAtTime(e.time)),r=(this._fromType(this.getValueAtTime(n.time))-i)/(n.time-e.time),s=Math.sqrt(Math.pow(i,2)-2*r*(e.ticks-t)),o=(-i+s)/r,a=(-i-s)/r;return(o>0?o:a)+e.time}return e?0===e.value?1/0:e.time+(t-e.ticks)/e.value:t/this._initialValue}ticksToTime(t,e){return this.getDurationOfTicks(t,e)}timeToTicks(t,e){const n=this.toSeconds(e),i=this.toSeconds(t),r=this.getTicksAtTime(n);return this.getTicksAtTime(n+i)-r}_fromType(t){return"bpm"===this.units&&this.multiplier?1/(60/t/this.multiplier):super._fromType(t)}_toType(t){return"bpm"===this.units&&this.multiplier?t/this.multiplier*60:super._toType(t)}get multiplier(){return this._multiplier}set multiplier(t){const e=this.value;this._multiplier=t,this.cancelScheduledValues(0),this.setValueAtTime(e,0)}},UL.TickParam=zL),UL}var GL,YL,XL=!1;function KL(){return XL||(XL=!0,GL={},BL(),vF(),HL(),YL=class t extends VL{constructor(){super(pF(t.getDefaults(),arguments,["value"])),this.name="TickSignal";const e=pF(t.getDefaults(),arguments,["value"]);this.input=this._param=new zL({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(VL.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(t,e){return this._param.ticksToTime(t,e)}timeToTicks(t,e){return this._param.timeToTicks(t,e)}getTimeOfTick(t){return this._param.getTimeOfTick(t)}getDurationOfTicks(t,e){return this._param.getDurationOfTicks(t,e)}getTicksAtTime(t){return this._param.getTicksAtTime(t)}get multiplier(){return this._param.multiplier}set multiplier(t){this._param.multiplier=t}dispose(){return super.dispose(),this._param.dispose(),this}},GL.TickSignal=YL),GL}var ZL,$L,JL=!1;function tV(){return JL||(JL=!0,ZL={},hL(),vF(),hq(),fL(),IF(),jP(),KL(),OF(),$L=class t extends cL{constructor(){super(pF(t.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new pL,this._tickOffset=new NF;const e=pF(t.getDefaults(),arguments,["frequency"]);this.frequency=new YL({context:this.context,units:e.units,value:e.frequency}),cq(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},cL.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(t,e){const n=this.toSeconds(t);return"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),RP(e)&&this.setTicksAtTime(e,n)),this}stop(t){const e=this.toSeconds(t);if("stopped"===this._state.getValueAtTime(e)){const t=this._state.get(e);t&&t.time>0&&(this._tickOffset.cancel(t.time),this._state.cancel(t.time))}return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this.setTicksAtTime(0,e),this}pause(t){const e=this.toSeconds(t);return"started"===this._state.getValueAtTime(e)&&this._state.setStateAtTime("paused",e),this}cancel(t){return t=this.toSeconds(t),this._state.cancel(t),this._tickOffset.cancel(t),this}getTicksAtTime(t){const e=this.toSeconds(t),n=this._state.getLastState("stopped",e),i={state:"paused",time:e};this._state.add(i);let r=n,s=0;return this._state.forEachBetween(n.time,e+this.sampleTime,t=>{let e=r.time;const n=this._tickOffset.get(t.time);n&&n.time>=r.time&&(s=n.ticks,e=n.time),"started"===r.state&&"started"!==t.state&&(s+=this.frequency.getTicksAtTime(t.time)-this.frequency.getTicksAtTime(e)),r=t}),this._state.remove(i),s}get ticks(){return this.getTicksAtTime(this.now())}set ticks(t){this.setTicksAtTime(t,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(t){const e=this.now(),n=this.frequency.timeToTicks(t,e);this.setTicksAtTime(n,e)}getSecondsAtTime(t){t=this.toSeconds(t);const e=this._state.getLastState("stopped",t),n={state:"paused",time:t};this._state.add(n);let i=e,r=0;return this._state.forEachBetween(e.time,t+this.sampleTime,t=>{let e=i.time;const n=this._tickOffset.get(t.time);n&&n.time>=i.time&&(r=n.seconds,e=n.time),"started"===i.state&&"started"!==t.state&&(r+=t.time-e),i=t}),this._state.remove(n),r}setTicksAtTime(t,e){return e=this.toSeconds(e),this._tickOffset.cancel(e),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(t,e),ticks:t,time:e}),this}getStateAtTime(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)}getTimeOfTick(t,e=this.now()){const n=this._tickOffset.get(e),i=this._state.get(e),r=Math.max(n.time,i.time),s=this.frequency.getTicksAtTime(r)+t-n.ticks;return this.frequency.getTimeOfTick(s)}forEachTickBetween(t,e,n){let i=this._state.get(t);this._state.forEachBetween(t,e,e=>{i&&"started"===i.state&&"started"!==e.state&&this.forEachTickBetween(Math.max(i.time,t),e.time-this.sampleTime,n),i=e});let r=null;if(i&&"started"===i.state){const s=Math.max(i.time,t),o=this.frequency.getTicksAtTime(s),a=o-this.frequency.getTicksAtTime(i.time);let c=Math.ceil(a)-a;c=AF(c,1)?0:c;let u=this.frequency.getTimeOfTick(o+c);for(;u<e;){try{n(u,Math.round(this.getTicksAtTime(u)))}catch(t){r=t;break}u+=this.frequency.getDurationOfTicks(1,u)}}if(r)throw r;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}},ZL.TickSource=$L),ZL}var eV,nV,iV=!1;function rV(){return iV||(iV=!0,eV={},hL(),vF(),HF(),hq(),fL(),tV(),kP(),nV=class t extends cL{constructor(){super(pF(t.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=oq,this._lastUpdate=0,this._state=new pL("stopped"),this._boundLoop=this._loop.bind(this);const e=pF(t.getDefaults(),arguments,["callback","frequency"]);this.callback=e.callback,this._tickSource=new $L({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,cq(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(cL.getDefaults(),{callback:oq,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(t,e){TP(this.context);const n=this.toSeconds(t);return this.log("start",n),"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),this._tickSource.start(n,e),n<this._lastUpdate&&this.emit("start",n,e)),this}stop(t){const e=this.toSeconds(t);return this.log("stop",e),this._state.cancel(e),this._state.setStateAtTime("stopped",e),this._tickSource.stop(e),e<this._lastUpdate&&this.emit("stop",e),this}pause(t){const e=this.toSeconds(t);return"started"===this._state.getValueAtTime(e)&&(this._state.setStateAtTime("paused",e),this._tickSource.pause(e),e<this._lastUpdate&&this.emit("pause",e)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(t){this._tickSource.ticks=t}get seconds(){return this._tickSource.seconds}set seconds(t){this._tickSource.seconds=t}getSecondsAtTime(t){return this._tickSource.getSecondsAtTime(t)}setTicksAtTime(t,e){return this._tickSource.setTicksAtTime(t,e),this}getTimeOfTick(t,e=this.now()){return this._tickSource.getTimeOfTick(t,e)}getTicksAtTime(t){return this._tickSource.getTicksAtTime(t)}nextTickTime(t,e){const n=this.toSeconds(e),i=this.getTicksAtTime(n);return this._tickSource.getTimeOfTick(i+t,n)}_loop(){const t=this._lastUpdate,e=this.now();this._lastUpdate=e,this.log("loop",t,e),t!==e&&(this._state.forEachBetween(t,e,t=>{switch(t.state){case"started":const e=this._tickSource.getTicksAtTime(t.time);this.emit("start",t.time,e);break;case"stopped":0!==t.time&&this.emit("stop",t.time);break;case"paused":this.emit("pause",t.time)}}),this._tickSource.forEachTickBetween(t,e,(t,e)=>{this.callback(t,e)}))}getStateAtTime(t){const e=this.toSeconds(t);return this._state.getValueAtTime(e)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}},eV.Clock=nV,zF.mixin(nV)),eV}var sV,oV,aV=!1;function cV(){return aV||(aV=!0,sV={},IF(),bF(),oV=class extends gF{constructor(t){super(),this.name="TimelineValue",this._timeline=new NF({memory:10}),this._initialValue=t}set(t,e){return this._timeline.add({value:t,time:e}),this}get(t){const e=this._timeline.get(t);return e?e.value:this._initialValue}},sV.TimelineValue=oV),sV}var uV,hV,lV=!1;function pV(t,e){return new hV(xq(),t,e)}function dV(){return lV||(lV=!0,uV={},Eq(),oL(),hV=class extends iL{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(t){return this._getPPQ()*t}_secondsToUnits(t){return Math.floor(t/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(t){return t}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}},uV.TicksClass=hV,uV.Ticks=pV),uV}var fV,_V,vV,mV=!1;function gV(){return mV||(mV=!0,fV={},bF(),jP(),kP(),_V=class extends gF{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(t){CP(RP(t.time),"Events must have a time property"),CP(RP(t.duration),"Events must have a duration parameter"),t.time=t.time.valueOf();let e=new vV(t.time,t.time+t.duration,t);for(null===this._root?this._root=e:this._root.insert(e),this._length++;null!==e;)e.updateHeight(),e.updateMax(),this._rebalance(e),e=e.parent;return this}remove(t){if(null!==this._root){const e=[];this._root.search(t.time,e);for(const n of e)if(n.event===t){this._removeNode(n),this._length--;break}}return this}get length(){return this._length}cancel(t){return this.forEachFrom(t,t=>this.remove(t)),this}_setRoot(t){this._root=t,null!==this._root&&(this._root.parent=null)}_replaceNodeInParent(t,e){null!==t.parent?(t.isLeftChild()?t.parent.left=e:t.parent.right=e,this._rebalance(t.parent)):this._setRoot(e)}_removeNode(t){if(null===t.left&&null===t.right)this._replaceNodeInParent(t,null);else if(null===t.right)this._replaceNodeInParent(t,t.left);else if(null===t.left)this._replaceNodeInParent(t,t.right);else{let e,n=null;if(t.getBalance()>0)if(null===t.left.right)e=t.left,e.right=t.right,n=e;else{for(e=t.left.right;null!==e.right;)e=e.right;e.parent&&(e.parent.right=e.left,n=e.parent,e.left=t.left,e.right=t.right)}else if(null===t.right.left)e=t.right,e.left=t.left,n=e;else{for(e=t.right.left;null!==e.left;)e=e.left;e.parent&&(e.parent.left=e.right,n=e.parent,e.left=t.left,e.right=t.right)}null!==t.parent?t.isLeftChild()?t.parent.left=e:t.parent.right=e:this._setRoot(e),n&&this._rebalance(n)}t.dispose()}_rotateLeft(t){const e=t.parent,n=t.isLeftChild(),i=t.right;i&&(t.right=i.left,i.left=t),null!==e?n?e.left=i:e.right=i:this._setRoot(i)}_rotateRight(t){const e=t.parent,n=t.isLeftChild(),i=t.left;i&&(t.left=i.right,i.right=t),null!==e?n?e.left=i:e.right=i:this._setRoot(i)}_rebalance(t){const e=t.getBalance();e>1&&t.left?t.left.getBalance()<0?this._rotateLeft(t.left):this._rotateRight(t):e<-1&&t.right&&(t.right.getBalance()>0?this._rotateRight(t.right):this._rotateLeft(t))}get(t){if(null!==this._root){const e=[];if(this._root.search(t,e),e.length>0){let t=e[0];for(let n=1;n<e.length;n++)e[n].low>t.low&&(t=e[n]);return t.event}}return null}forEach(t){if(null!==this._root){const e=[];this._root.traverse(t=>e.push(t)),e.forEach(e=>{e.event&&t(e.event)})}return this}forEachAtTime(t,e){if(null!==this._root){const n=[];this._root.search(t,n),n.forEach(t=>{t.event&&e(t.event)})}return this}forEachFrom(t,e){if(null!==this._root){const n=[];this._root.searchAfter(t,n),n.forEach(t=>{t.event&&e(t.event)})}return this}dispose(){return super.dispose(),null!==this._root&&this._root.traverse(t=>t.dispose()),this._root=null,this}},fV.IntervalTimeline=_V,vV=class{constructor(t,e,n){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=n,this.low=t,this.high=e,this.max=this.high}insert(t){t.low<=this.low?null===this.left?this.left=t:this.left.insert(t):null===this.right?this.right=t:this.right.insert(t)}search(t,e){t>this.max||(null!==this.left&&this.left.search(t,e),this.low<=t&&this.high>t&&e.push(this),this.low>t||null!==this.right&&this.right.search(t,e))}searchAfter(t,e){this.low>=t&&(e.push(this),null!==this.left&&this.left.searchAfter(t,e)),null!==this.right&&this.right.searchAfter(t,e)}traverse(t){t(this),null!==this.left&&this.left.traverse(t),null!==this.right&&this.right.traverse(t)}updateHeight(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let t=0;return null!==this.left&&null!==this.right?t=this.left.height-this.right.height:null!==this.left?t=this.left.height+1:null!==this.right&&(t=-(this.right.height+1)),t}isLeftChild(){return null!==this.parent&&this.parent.left===this}get left(){return this._left}set left(t){this._left=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(t){this._right=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}),fV}var yV,bV,wV=!1;function CV(){return wV||(wV=!0,yV={},hq(),bV=class t{constructor(e,n){this.id=t._eventId++;const i=Object.assign(t.getDefaults(),n);this.transport=e,this.callback=i.callback,this._once=i.once,this.time=i.time}static getDefaults(){return{callback:oq,once:!1,time:0}}invoke(t){this.callback&&(this.callback(t),this._once&&this.transport.clear(this.id))}dispose(){return this.callback=void 0,this}},yV.TransportEvent=bV,bV._eventId=0),yV}var xV,TV,SV=!1;function EV(){return SV||(SV=!0,xV={},dV(),CV(),TV=class t extends bV{constructor(e,n){super(e,n),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const i=Object.assign(t.getDefaults(),n);this.duration=new hV(e.context,i.duration).valueOf(),this._interval=new hV(e.context,i.interval).valueOf(),this._nextTick=i.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},bV.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(t){this._createEvents(t),super.invoke(t)}_createEvents(t){const e=this.transport.getTicksAtTime(t);e>=this.time&&e>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new hV(this.context,this._nextTick).toSeconds()))}_restart(t){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;const e=this.transport.getTicksAtTime(t);e>this.time&&(this._nextTick=this.time+Math.ceil((e-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new hV(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new hV(this.context,this._nextTick).toSeconds())}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}},xV.TransportRepeatEvent=TV),xV}var AV,kV,OV=!1;function DV(){return OV||(OV=!0,AV={},Yq(),cV(),BF(),OL(),hL(),dV(),oL(),vF(),HF(),hq(),gV(),IF(),jP(),rV(),CV(),EV(),kV=class t extends cL{constructor(){super(pF(t.getDefaults(),arguments)),this.name="Transport",this._loop=new oV(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new NF,this._repeatedEvents=new _V,this._syncedSignals=[],this._swingAmount=0;const e=pF(t.getDefaults(),arguments);this._ppq=e.ppq,this._clock=new nV({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),cq(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(cL.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(t,e){if(this._swingAmount>0&&e%this._ppq!=0&&e%(2*this._swingTicks)!=0){const n=e%(2*this._swingTicks)/(2*this._swingTicks),i=Math.sin(n*Math.PI)*this._swingAmount;t+=new hV(this.context,2*this._swingTicks/3).toSeconds()*i}this._loop.get(t)&&e>=this._loopEnd&&(this.emit("loopEnd",t),this._clock.setTicksAtTime(this._loopStart,t),e=this._loopStart,this.emit("loopStart",t,this._clock.getSecondsAtTime(t)),this.emit("loop",t)),this._timeline.forEachAtTime(e,e=>e.invoke(t))}schedule(t,e){const n=new bV(this,{callback:t,time:new iL(this.context,e).toTicks()});return this._addEvent(n,this._timeline)}scheduleRepeat(t,e,n,i=1/0){const r=new TV(this,{callback:t,duration:new Qq(this.context,i).toTicks(),interval:new Qq(this.context,e).toTicks(),time:new iL(this.context,n).toTicks()});return this._addEvent(r,this._repeatedEvents)}scheduleOnce(t,e){const n=new bV(this,{callback:t,once:!0,time:new iL(this.context,e).toTicks()});return this._addEvent(n,this._timeline)}clear(t){if(this._scheduledEvents.hasOwnProperty(t)){const e=this._scheduledEvents[t.toString()];e.timeline.remove(e.event),e.event.dispose(),delete this._scheduledEvents[t.toString()]}return this}_addEvent(t,e){return this._scheduledEvents[t.id.toString()]={event:t,timeline:e},e.add(t),t.id}cancel(t=0){const e=this.toTicks(t);return this._timeline.forEachFrom(e,t=>this.clear(t.id)),this._repeatedEvents.forEachFrom(e,t=>this.clear(t.id)),this}_bindClockEvents(){this._clock.on("start",(t,e)=>{e=new hV(this.context,e).toSeconds(),this.emit("start",t,e)}),this._clock.on("stop",t=>{this.emit("stop",t)}),this._clock.on("pause",t=>{this.emit("pause",t)})}get state(){return this._clock.getStateAtTime(this.now())}start(t,e){let n;return RP(e)&&(n=this.toTicks(e)),this._clock.start(t,n),this}stop(t){return this._clock.stop(t),this}pause(t){return this._clock.pause(t),this}toggle(t){return t=this.toSeconds(t),"started"!==this._clock.getStateAtTime(t)?this.start(t):this.stop(t),this}get timeSignature(){return this._timeSignature}set timeSignature(t){qP(t)&&(t=t[0]/t[1]*4),this._timeSignature=t}get loopStart(){return new Qq(this.context,this._loopStart,"i").toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t)}get loopEnd(){return new Qq(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t)}get loop(){return this._loop.get(this.now())}set loop(t){this._loop.set(t,this.now())}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get swing(){return this._swingAmount}set swing(t){this._swingAmount=t}get swingSubdivision(){return new hV(this.context,this._swingTicks).toNotation()}set swingSubdivision(t){this._swingTicks=this.toTicks(t)}get position(){const t=this.now(),e=this._clock.getTicksAtTime(t);return new hV(this.context,e).toBarsBeatsSixteenths()}set position(t){const e=this.toTicks(t);this.ticks=e}get seconds(){return this._clock.seconds}set seconds(t){const e=this.now(),n=this._clock.frequency.timeToTicks(t,e);this.ticks=n}get progress(){if(this.loop){const t=this.now();return(this._clock.getTicksAtTime(t)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}get ticks(){return this._clock.ticks}set ticks(t){if(this._clock.ticks!==t){const e=this.now();if("started"===this.state){const n=this._clock.getTicksAtTime(e),i=this._clock.getTimeOfTick(Math.ceil(n));this.emit("stop",i),this._clock.setTicksAtTime(t,i),this.emit("start",i,this._clock.getSecondsAtTime(i))}else this._clock.setTicksAtTime(t,e)}}getTicksAtTime(t){return Math.round(this._clock.getTicksAtTime(t))}getSecondsAtTime(t){return this._clock.getSecondsAtTime(t)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(t){this._clock.frequency.multiplier=t}nextSubdivision(t){if(t=this.toTicks(t),"started"!==this.state)return 0;{const e=this.now(),n=t-this.getTicksAtTime(e)%t;return this._clock.nextTickTime(n,e)}}syncSignal(t,e){if(!e){const n=this.now();if(0!==t.getValueAtTime(n)){const i=1/(60/this.bpm.getValueAtTime(n)/this.PPQ);e=t.getValueAtTime(n)/i}else e=0}const n=new AL(e);return this.bpm.connect(n),n.connect(t._param),this._syncedSignals.push({initial:t.value,ratio:n,signal:t}),t.value=0,this}unsyncSignal(t){for(let e=this._syncedSignals.length-1;e>=0;e--){const n=this._syncedSignals[e];n.signal===t&&(n.ratio.dispose(),n.signal.value=n.initial,this._syncedSignals.splice(e,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),uq(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}},AV.Transport=kV,zF.mixin(kV),LF(t=>{t.transport=new kV({context:t})}),jF(t=>{t.transport.dispose()})),AV}var NV,RV,IV=!1;function MV(){return IV||(IV=!0,NV={},gL(),vF(),hq(),SL(),RV=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments,["delayTime","maxDelay"])),this.name="Delay";const e=pF(t.getDefaults(),arguments,["delayTime","maxDelay"]),n=this.toSeconds(e.maxDelay);this._maxDelay=Math.max(n,this.toSeconds(e.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(n),this.delayTime=new vL({context:this.context,param:this._delayNode.delayTime,units:"time",value:e.delayTime,minValue:0,maxValue:this.maxDelay}),cq(this,"delayTime")}static getDefaults(){return Object.assign(bL.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}},NV.Delay=RV),NV}var PV,FV,qV=!1;function LV(){return qV||(qV=!0,PV={},OL(),SL(),vF(),hq(),FV=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments,["volume"])),this.name="Volume";const e=pF(t.getDefaults(),arguments,["volume"]);this.input=this.output=new AL({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,cq(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(bL.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(t){!this.mute&&t?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!t&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}},PV.Volume=FV),PV}var VV,jV,WV=!1;function BV(){return WV||(WV=!0,VV={},LV(),vF(),BF(),OL(),SL(),jV=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments)),this.name="Destination",this.input=new FV({context:this.context}),this.output=new AL({context:this.context}),this.volume=this.input.volume;const e=pF(t.getDefaults(),arguments);CL(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(bL.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(t){this.input.mute=t}chain(...t){return this.input.disconnect(),t.unshift(this.input),t.push(this.output),CL(...t),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}},VV.Destination=jV,LF(t=>{t.destination=new jV({context:t})}),jF(t=>{t.destination.dispose()})),VV}var UV,zV=!1;function QV(t,e,n=2,i=xq().sampleRate){return g(this,void 0,void 0,(function*(){const r=xq(),s=new vq(n,e,i);Tq(s),yield t(s);const o=s.render();Tq(r);const a=yield o;return new pq(a)}))}function HV(){return zV||(zV=!0,UV={},Eq(),gq(),fq(),UV.Offline=QV),UV}var GV,YV,XV=!1;function KV(){return XV||(XV=!0,GV={},bF(),vF(),hq(),jP(),fq(),kP(),YV=class t extends gF{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=pF(t.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach(t=>{this._loadingCount++;const n=e.urls[t];this.add(t,n,this._bufferLoaded.bind(this,e.onload),e.onerror)})}static getDefaults(){return{baseUrl:"",onerror:oq,onload:oq,urls:{}}}has(t){return this._buffers.has(t.toString())}get(t){return CP(this.has(t),"ToneAudioBuffers has no buffer named: "+t),this._buffers.get(t.toString())}_bufferLoaded(t){this._loadingCount--,0===this._loadingCount&&t&&t()}get loaded(){return Array.from(this._buffers).every(([t,e])=>e.loaded)}add(t,e,n=oq,i=oq){return LP(e)?this._buffers.set(t.toString(),new pq(this.baseUrl+e,n,i)):this._buffers.set(t.toString(),new pq(e,n,i)),this}dispose(){return super.dispose(),this._buffers.forEach(t=>t.dispose()),this._buffers.clear(),this}},GV.ToneAudioBuffers=YV),GV}var ZV,$V,JV=!1;function tj(t,e){return new $V(xq(),t,e)}function ej(){return JV||(JV=!0,ZV={},Eq(),Vq(),eL(),$V=class t extends Kq{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(t){return Fq(super._frequencyToUnits(t))}_ticksToUnits(t){return Fq(super._ticksToUnits(t))}_beatsToUnits(t){return Fq(super._beatsToUnits(t))}_secondsToUnits(t){return Fq(super._secondsToUnits(t))}toMidi(){return this.valueOf()}toFrequency(){return Lq(this.toMidi())}transpose(e){return new t(this.context,this.toMidi()+e)}},ZV.MidiClass=$V,ZV.Midi=tj),ZV}var nj,ij,rj=!1;function sj(){return rj||(rj=!0,nj={},hL(),IF(),BF(),ij=class extends cL{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new NF,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(t,e){return this._events.add({callback:t,time:this.toSeconds(e)}),1===this._events.length&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(t){return this._events.cancel(this.toSeconds(t)),this}_drawLoop(){const t=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=t;){const e=this._events.shift();e&&t-e.time<=this.expiration&&e.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}},nj.Draw=ij,LF(t=>{t.draw=new ij({context:t})}),jF(t=>{t.draw.dispose()})),nj}var oj=!1;var aj,cj=!1;function uj(){aj={},Vq(),vF(),oj||(oj=!0),kP(),e(aj,rV()),e(aj,DV()),e(aj,tq()),e(aj,KF()),e(aj,MV()),e(aj,BV()),e(aj,OL()),e(aj,HV()),e(aj,gq()),e(aj,gL()),e(aj,fq()),e(aj,KV()),e(aj,SL()),e(aj,eL()),e(aj,ej()),e(aj,Yq()),e(aj,dV()),e(aj,oL()),e(aj,sj()),e(aj,HF()),e(aj,gV()),e(aj,fL()),e(aj,IF()),e(aj,jP()),aj.mtof=Lq,aj.ftom=Fq,aj.intervalToFrequencyRatio=Iq,aj.gainToDb=Rq,aj.dbToGain=Nq,aj.defaultArg=fF,aj.optionsFromArguments=pF,aj.Unit=$cb0bc8cafec45fc48bf6b6c1a724b$exports={},aj.debug=yP}var hj,lj,pj=!1;function dj(){return pj||(pj=!0,hj={},LV(),BV(),DV(),SL(),vF(),hq(),fL(),jP(),kP(),OF(),lj=class extends bL{constructor(t){super(t),this.input=void 0,this._state=new pL("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=oq,this._syncedStop=oq,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new FV({context:this.context,mute:t.mute,volume:t.volume}),this.volume=this._volume.volume,cq(this,"volume"),this.onstop=t.onstop}static getDefaults(){return Object.assign(bL.getDefaults(),{mute:!1,onstop:oq,volume:0})}get state(){return this._synced?"started"===this.context.transport.state?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}_clampToCurrentTime(t){return this._synced?t:Math.max(t,this.context.currentTime)}start(t,e,n){let i=NP(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(i=this._clampToCurrentTime(i),this._synced||"started"!==this._state.getValueAtTime(i))if(this.log("start",i),this._state.setStateAtTime("started",i),this._synced){const t=this._state.get(i);t&&(t.offset=this.toSeconds(fF(e,0)),t.duration=n?this.toSeconds(n):void 0);const r=this.context.transport.schedule(t=>{this._start(t,e,n)},i);this._scheduled.push(r),"started"===this.context.transport.state&&this.context.transport.getSecondsAtTime(this.immediate())>i&&this._syncedStart(this.now(),this.context.transport.seconds)}else TP(this.context),this._start(i,e,n);else CP(TF(i,this._state.get(i).time),"Start time must be strictly greater than previous start time"),this._state.cancel(i),this._state.setStateAtTime("started",i),this.log("restart",i),this.restart(i,e,n);return this}stop(t){let e=NP(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(e=this._clampToCurrentTime(e),"started"===this._state.getValueAtTime(e)||RP(this._state.getNextState("started",e))){if(this.log("stop",e),this._synced){const t=this.context.transport.schedule(this._stop.bind(this),e);this._scheduled.push(t)}else this._stop(e);this._state.cancel(e),this._state.setStateAtTime("stopped",e)}return this}restart(t,e,n){return t=this.toSeconds(t),"started"===this._state.getValueAtTime(t)&&(this._state.cancel(t),this._restart(t,e,n)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(t,e)=>{if(e>0){const n=this._state.get(e);if(n&&"started"===n.state&&n.time!==e){const i=e-this.toSeconds(n.time);let r;n.duration&&(r=this.toSeconds(n.duration)-i),this._start(t,this.toSeconds(n.offset)+i,r)}}},this._syncedStop=t=>{const e=this.context.transport.getSecondsAtTime(Math.max(t-this.sampleTime,0));"started"===this._state.getValueAtTime(e)&&this._stop(t)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(t=>this.context.transport.clear(t)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=oq,this.unsync(),this._volume.dispose(),this._state.dispose(),this}},hj.Source=lj),hj}var fj,_j,vj=!1;function mj(){return vj||(vj=!0,fj={},SL(),gL(),fq(),vF(),hq(),jP(),kP(),IL(),OF(),_j=class t extends NL{constructor(){super(pF(t.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const e=pF(t.getDefaults(),arguments,["url","onload"]);xL(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new vL({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new pq(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(NL.getDefaults(),{url:new pq,loop:!1,loopEnd:0,loopStart:0,onload:oq,onerror:oq,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t}get curve(){return this._curve}set curve(t){this._curve=t}start(t,e,n,i=1){CP(this.buffer.loaded,"buffer is either not set or not loaded");const r=this.toSeconds(t);this._startGain(r,i),e=this.loop?fF(e,this.loopStart):fF(e,0);let s=Math.max(this.toSeconds(e),0);if(this.loop){const t=this.toSeconds(this.loopEnd)||this.buffer.duration,e=this.toSeconds(this.loopStart),n=t-e;SF(s,t)&&(s=(s-e)%n+e),AF(s,this.buffer.duration)&&(s=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,EF(s,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(r,s)),RP(n)){let t=this.toSeconds(n);t=Math.max(t,0),this.stop(r+t)}return this}_stopSource(t){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(t)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(t){this._source.loopStart=this.toSeconds(t)}get loopEnd(){return this._source.loopEnd}set loopEnd(t){this._source.loopEnd=this.toSeconds(t)}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._source.loop}set loop(t){this._source.loop=t,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}},fj.ToneBufferSource=_j),fj}var gj,yj,bj,wj,Cj=!1;function xj(){return Cj||(Cj=!0,gj={},fq(),vF(),kP(),dj(),mj(),yj=class t extends lj{constructor(){super(pF(t.getDefaults(),arguments,["type"])),this.name="Noise",this._source=null;const e=pF(t.getDefaults(),arguments,["type"]);this._playbackRate=e.playbackRate,this.type=e.type,this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut}static getDefaults(){return Object.assign(lj.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(t){if(CP(t in wj,"Noise: invalid type: "+t),this._type!==t&&(this._type=t,"started"===this.state)){const t=this.now();this._stop(t),this._start(t)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._source&&(this._source.playbackRate.value=t)}_start(t){const e=wj[this._type];this._source=new _j({url:e,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(t),Math.random()*(e.duration-.001))}_stop(t){this._source&&(this._source.stop(this.toSeconds(t)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(t){this._stop(t),this._start(t)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}},gj.Noise=yj,220500,2,bj={brown:null,pink:null,white:null},wj={get brown(){if(!bj.brown){const t=[];for(let e=0;e<2;e++){const n=new Float32Array(220500);t[e]=n;let i=0;for(let t=0;t<220500;t++){const e=2*Math.random()-1;n[t]=(i+.02*e)/1.02,i=n[t],n[t]*=3.5}}bj.brown=(new pq).fromArray(t)}return bj.brown},get pink(){if(!bj.pink){const t=[];for(let e=0;e<2;e++){const n=new Float32Array(220500);let i,r,s,o,a,c,u;t[e]=n,i=r=s=o=a=c=u=0;for(let t=0;t<220500;t++){const e=2*Math.random()-1;i=.99886*i+.0555179*e,r=.99332*r+.0750759*e,s=.969*s+.153852*e,o=.8665*o+.3104856*e,a=.55*a+.5329522*e,c=-.7616*c-.016898*e,n[t]=i+r+s+o+a+c+u+.5362*e,n[t]*=.11,u=.115926*e}}bj.pink=(new pq).fromArray(t)}return bj.pink},get white(){if(!bj.white){const t=[];for(let e=0;e<2;e++){const n=new Float32Array(220500);t[e]=n;for(let t=0;t<220500;t++)n[t]=2*Math.random()-1}bj.white=(new pq).fromArray(t)}return bj.white}}),gj}var Tj,Sj,Ej=!1;function Aj(){return Ej||(Ej=!0,Tj={},SL(),LV(),vF(),kP(),hq(),jP(),Sj=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments,["volume"])),this.name="UserMedia";const e=pF(t.getDefaults(),arguments,["volume"]);this._volume=this.output=new FV({context:this.context,volume:e.volume}),this.volume=this._volume.volume,cq(this,"volume"),this.mute=e.mute}static getDefaults(){return Object.assign(bL.getDefaults(),{mute:!1,volume:0})}open(e){return g(this,void 0,void 0,(function*(){CP(t.supported,"UserMedia is not supported"),"started"===this.state&&this.close();const n=yield t.enumerateDevices();MP(e)?this._device=n[e]:(this._device=n.find(t=>t.label===e||t.deviceId===e),!this._device&&n.length>0&&(this._device=n[0]),CP(RP(this._device),"No matching device "+e));const i={audio:{echoCancellation:!1,sampleRate:this.context.sampleRate,noiseSuppression:!1,mozNoiseSuppression:!1}};this._device&&(i.audio.deviceId=this._device.deviceId);const r=yield navigator.mediaDevices.getUserMedia(i);if(!this._stream){this._stream=r;const t=this.context.createMediaStreamSource(r);xL(t,this.output),this._mediaStream=t}return this}))}close(){return this._stream&&this._mediaStream&&(this._stream.getAudioTracks().forEach(t=>{t.stop()}),this._stream=void 0,this._mediaStream.disconnect(),this._mediaStream=void 0),this._device=void 0,this}static enumerateDevices(){return g(this,void 0,void 0,(function*(){return(yield navigator.mediaDevices.enumerateDevices()).filter(t=>"audioinput"===t.kind)}))}get state(){return this._stream&&this._stream.active?"started":"stopped"}get deviceId(){return this._device?this._device.deviceId:void 0}get groupId(){return this._device?this._device.groupId:void 0}get label(){return this._device?this._device.label:void 0}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}dispose(){return super.dispose(),this.close(),this._volume.dispose(),this.volume.dispose(),this}static get supported(){return RP(navigator.mediaDevices)&&RP(navigator.mediaDevices.getUserMedia)}},Tj.UserMedia=Sj),Tj}var kj,Oj=!1;function Dj(t,e){return g(this,void 0,void 0,(function*(){const n=e/t.context.sampleRate,i=new vq(1,n,t.context.sampleRate);new t.constructor(Object.assign(t.get(),{frequency:2/n,detune:0,context:i})).toDestination().start(0);return(yield i.render()).getChannelData(0)}))}function Nj(){return Oj||(Oj=!0,kj={},gq(),kj.generateWaveform=Dj),kj}var Rj,Ij,Mj=!1;function Pj(){return Mj||(Mj=!0,Rj={},SL(),gL(),vF(),IL(),hq(),Ij=class t extends NL{constructor(){super(pF(t.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const e=pF(t.getDefaults(),arguments,["frequency","type"]);xL(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new vL({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new vL({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),cq(this,["frequency","detune"])}static getDefaults(){return Object.assign(NL.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._oscillator.start(e),this}_stopSource(t){this._oscillator.stop(t)}setPeriodicWave(t){return this._oscillator.setPeriodicWave(t),this}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}},Rj.ToneOscillatorNode=Ij),Rj}var Fj,qj,Lj=!1;function Vj(){return Lj||(Lj=!0,Fj={},vF(),hq(),jP(),BL(),dj(),Nj(),Pj(),kP(),OF(),qj=class t extends lj{constructor(){super(pF(t.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const e=pF(t.getDefaults(),arguments,["frequency","type"]);this.frequency=new VL({context:this.context,units:"frequency",value:e.frequency}),cq(this,"frequency"),this.detune=new VL({context:this.context,units:"cents",value:e.detune}),cq(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&"custom"!==e.type&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign(lj.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(t){const e=this.toSeconds(t),n=new Ij({context:this.context,onended:()=>this.onstop(this)});this._oscillator=n,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(e)}_stop(t){const e=this.toSeconds(t);this._oscillator&&this._oscillator.stop(e)}_restart(t){const e=this.toSeconds(t);return this.log("restart",e),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(e),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if("custom"===this._type)return t._periodicWaveCache.find(t=>t.phase===this._phase&&lF(t.partials,this._partials));{const e=t._periodicWaveCache.find(t=>t.type===this._type&&t.phase===this._phase);return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;const n=-1!==["sine","square","sawtooth","triangle"].indexOf(e);if(0===this._phase&&n)this._wave=void 0,this._partialCount=0,null!==this._oscillator&&(this._oscillator.type=e);else{const n=this._getCachedPeriodicWave();if(RP(n)){const{partials:t,wave:e}=n;this._wave=e,this._partials=t,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}else{const[n,i]=this._getRealImaginary(e,this._phase),r=this.context.createPeriodicWave(n,i);this._wave=r,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),t._periodicWaveCache.push({imag:i,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:n,type:this._type,wave:this._wave}),t._periodicWaveCache.length>100&&t._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(t){this.partialCount&&"custom"!==this._type&&"custom"!==t?this.type=t+this.partialCount:this.type=t}get partialCount(){return this._partialCount}set partialCount(t){xP(t,0);let e=this._type;const n=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(n&&(e=n[1]),"custom"!==this._type)this.type=0===t?e:e+t.toString();else{const e=new Float32Array(t);this._partials.forEach((t,n)=>e[n]=t),this._partials=Array.from(e),this.type=this._type}}_getRealImaginary(t,e){let n=2048;const i=new Float32Array(n),r=new Float32Array(n);let s=1;if("custom"===t){if(s=this._partials.length+1,this._partialCount=this._partials.length,n=s,0===this._partials.length)return[i,r]}else{const e=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(t);e?(s=parseInt(e[2],10)+1,this._partialCount=parseInt(e[2],10),t=e[1],s=Math.max(s,2),n=s):this._partialCount=0,this._partials=[]}for(let o=1;o<n;++o){const n=2/(o*Math.PI);let a;switch(t){case"sine":a=o<=s?1:0,this._partials[o-1]=a;break;case"square":a=1&o?2*n:0,this._partials[o-1]=a;break;case"sawtooth":a=n*(1&o?1:-1),this._partials[o-1]=a;break;case"triangle":a=1&o?n*n*2*(o-1>>1&1?-1:1):0,this._partials[o-1]=a;break;case"custom":a=this._partials[o-1];break;default:throw new TypeError("Oscillator: invalid type: "+t)}0!==a?(i[o]=-a*Math.sin(e*o),r[o]=a*Math.cos(e*o)):(i[o]=0,r[o]=0)}return[i,r]}_inverseFFT(t,e,n){let i=0;const r=t.length;for(let s=0;s<r;s++)i+=t[s]*Math.cos(s*n)+e[s]*Math.sin(s*n);return i}getInitialValue(){const[t,e]=this._getRealImaginary(this._type,0);let n=0;const i=2*Math.PI;for(let r=0;r<32;r++)n=Math.max(this._inverseFFT(t,e,r/32*i),n);return kF(-this._inverseFFT(t,e,this._phase)/n,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(t){this._phase=t*Math.PI/180,this.type=this._type}asArray(t=1024){return g(this,void 0,void 0,(function*(){return Dj(this,t)}))}dispose(){return super.dispose(),null!==this._oscillator&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}},Fj.Oscillator=qj,qj._periodicWaveCache=[]),Fj}var jj,Wj,Bj=!1;function Uj(){return Bj||(Bj=!0,jj={},vF(),SL(),BL(),Wj=class t extends bL{constructor(){super(Object.assign(pF(t.getDefaults(),arguments,["context"])))}connect(t,e=0,n=0){return WL(this,t,e,n),this}},jj.SignalOperator=Wj),jj}var zj,Qj,Hj=!1;function Gj(){return Hj||(Hj=!0,zj={},vF(),jP(),kP(),BL(),Uj(),Qj=class t extends Wj{constructor(){super(Object.assign(pF(t.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;const e=pF(t.getDefaults(),arguments,["mapping","length"]);qP(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):IP(e.mapping)&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(VL.getDefaults(),{length:1024})}setMap(t,e=1024){const n=new Float32Array(e);for(let i=0,r=e;i<r;i++){const e=i/(r-1)*2-1;n[i]=t(e,i)}return this.curve=n,this}get curve(){return this._shaper.curve}set curve(t){this._shaper.curve=t}get oversample(){return this._shaper.oversample}set oversample(t){CP(["none","2x","4x"].some(e=>e.includes(t)),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.disconnect(),this}},zj.WaveShaper=Qj),zj}var Yj,Xj,Kj=!1;function Zj(){return Kj||(Kj=!0,Yj={},Uj(),Gj(),Xj=class extends Wj{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new Qj({context:this.context,mapping:t=>(t+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}},Yj.AudioToGain=Xj),Yj}var $j,Jj,tW=!1;function eW(){return tW||(tW=!0,$j={},OL(),vF(),BL(),Jj=class t extends VL{constructor(){super(Object.assign(pF(t.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;const e=pF(t.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new AL({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(VL.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}},$j.Multiply=Jj),$j}var nW,iW,rW=!1;function sW(){return rW||(rW=!0,nW={},OL(),vF(),hq(),Zj(),eW(),dj(),Vj(),Nj(),iW=class t extends lj{constructor(){super(pF(t.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new Xj({context:this.context}),this._modulationNode=new AL({context:this.context});const e=pF(t.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new qj({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new qj({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Jj({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),cq(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(qj.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){this._modulator.restart(t),this._carrier.restart(t)}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return g(this,void 0,void 0,(function*(){return Dj(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}},nW.AMOscillator=iW),nW}var oW,aW,cW=!1;function uW(){return cW||(cW=!0,oW={},OL(),vF(),hq(),eW(),BL(),dj(),Vj(),Nj(),aW=class t extends lj{constructor(){super(pF(t.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new AL({context:this.context,gain:0});const e=pF(t.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new qj({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new VL({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new qj({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Jj({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new Jj({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),cq(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(qj.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){return this._modulator.restart(t),this._carrier.restart(t),this}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return g(this,void 0,void 0,(function*(){return Dj(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}},oW.FMOscillator=aW),oW}var hW,lW,pW=!1;function dW(){return pW||(pW=!0,hW={},OL(),vF(),hq(),BL(),Gj(),dj(),Vj(),Nj(),lW=class t extends lj{constructor(){super(pF(t.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new AL({context:this.context,gain:0}),this._thresh=new Qj({context:this.context,mapping:t=>t<=0?-1:1});const e=pF(t.getDefaults(),arguments,["frequency","width"]);this.width=new VL({context:this.context,units:"audioRange",value:e.width}),this._triangle=new qj({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),cq(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(lj.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(t){t=this.toSeconds(t),this._triangle.start(t),this._widthGate.gain.setValueAtTime(1,t)}_stop(t){t=this.toSeconds(t),this._triangle.stop(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(0,t)}_restart(t){this._triangle.restart(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(1,t)}get phase(){return this._triangle.phase}set phase(t){this._triangle.phase=t}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(t){this._triangle.type=t}asArray(t=1024){return g(this,void 0,void 0,(function*(){return Dj(this,t)}))}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}},hW.PulseOscillator=lW),hW}var fW,_W,vW=!1;function mW(){return vW||(vW=!0,fW={},vF(),hq(),BL(),dj(),Vj(),Nj(),kP(),_W=class t extends lj{constructor(){super(pF(t.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];const e=pF(t.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new VL({context:this.context,units:"frequency",value:e.frequency}),this.detune=new VL({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,cq(this,["frequency","detune"])}static getDefaults(){return Object.assign(qj.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(t){t=this.toSeconds(t),this._forEach(e=>e.start(t))}_stop(t){t=this.toSeconds(t),this._forEach(e=>e.stop(t))}_restart(t){this._forEach(e=>e.restart(t))}_forEach(t){for(let e=0;e<this._oscillators.length;e++)t(this._oscillators[e],e)}get type(){return this._type}set type(t){this._type=t,this._forEach(e=>e.type=t)}get spread(){return this._spread}set spread(t){if(this._spread=t,this._oscillators.length>1){const e=-t/2,n=t/(this._oscillators.length-1);this._forEach((t,i)=>t.detune.value=e+n*i)}}get count(){return this._oscillators.length}set count(t){if(xP(t,1),this._oscillators.length!==t){this._forEach(t=>t.dispose()),this._oscillators=[];for(let e=0;e<t;e++){const n=new qj({context:this.context,volume:-6-1.1*t,type:this._type,phase:this._phase+e/t*360,partialCount:this._partialCount,onstop:0===e?()=>this.onstop(this):oq});"custom"===this.type&&(n.partials=this._partials),this.frequency.connect(n.frequency),this.detune.connect(n.detune),n.detune.overridden=!1,n.connect(this.output),this._oscillators[e]=n}this.spread=this._spread,"started"===this.state&&this._forEach(t=>t.start())}}get phase(){return this._phase}set phase(t){this._phase=t,this._forEach(e=>e.phase=t)}get baseType(){return this._oscillators[0].baseType}set baseType(t){this._forEach(e=>e.baseType=t),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this._type="custom",this._forEach(e=>e.partials=t))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(t){this._partialCount=t,this._forEach(e=>e.partialCount=t),this._type=this._oscillators[0].type}asArray(t=1024){return g(this,void 0,void 0,(function*(){return Dj(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(t=>t.dispose()),this}},fW.FatOscillator=_W),fW}var gW,yW,bW=!1;function wW(){return bW||(bW=!0,gW={},vF(),hq(),eW(),dj(),Vj(),Nj(),dW(),yW=class t extends lj{constructor(){super(pF(t.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new Jj({context:this.context,value:2});const e=pF(t.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new lW({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new qj({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),cq(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(lj.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(t){t=this.toSeconds(t),this._modulator.start(t),this._pulse.start(t)}_stop(t){t=this.toSeconds(t),this._modulator.stop(t),this._pulse.stop(t)}_restart(t){this._modulator.restart(t),this._pulse.restart(t)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(t){this._modulator.phase=t}asArray(t=1024){return g(this,void 0,void 0,(function*(){return Dj(this,t)}))}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}},gW.PWMOscillator=yW),gW}var CW,xW,TW,SW=!1;function EW(){return SW||(SW=!0,CW={},vF(),hq(),jP(),BL(),dj(),sW(),mW(),uW(),Vj(),Nj(),dW(),wW(),xW={am:iW,fat:_W,fm:aW,oscillator:qj,pulse:lW,pwm:yW},TW=class t extends lj{constructor(){super(pF(t.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";const e=pF(t.getDefaults(),arguments,["frequency","type"]);this.frequency=new VL({context:this.context,units:"frequency",value:e.frequency}),this.detune=new VL({context:this.context,units:"cents",value:e.detune}),cq(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(qj.getDefaults(),aW.getDefaults(),iW.getDefaults(),_W.getDefaults(),lW.getDefaults(),yW.getDefaults())}_start(t){this._oscillator.start(t)}_stop(t){this._oscillator.stop(t)}_restart(t){return this._oscillator.restart(t),this}get type(){let t="";return["am","fm","fat"].some(t=>this._sourceType===t)&&(t=this._sourceType),t+this._oscillator.type}set type(t){"fm"===t.substr(0,2)?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"am"===t.substr(0,2)?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"fat"===t.substr(0,3)?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(3)):"pwm"===t?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):"pulse"===t?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=t)}get partials(){return this._oscillator.partials}set partials(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=t)}get partialCount(){return this._oscillator.partialCount}set partialCount(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=t)}set(t){return Reflect.has(t,"type")&&t.type&&(this.type=t.type),super.set(t),this}_createNewOscillator(t){if(t!==this._sourceType){this._sourceType=t;const e=xW[t],n=this.now();if(this._oscillator){const t=this._oscillator;t.stop(n),this.context.setTimeout(()=>t.dispose(),this.blockTime)}this._oscillator=new e({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),"started"===this.state&&this._oscillator.start(n)}}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t}get sourceType(){return this._sourceType}set sourceType(t){let e="sine";"pwm"!==this._oscillator.type&&"pulse"!==this._oscillator.type&&(e=this._oscillator.type),"fm"===t?this.type="fm"+e:"am"===t?this.type="am"+e:"fat"===t?this.type="fat"+e:"oscillator"===t?this.type=e:"pulse"===t?this.type="pulse":"pwm"===t&&(this.type="pwm")}_getOscType(t,e){return t instanceof xW[e]}get baseType(){return this._oscillator.baseType}set baseType(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||"pulse"===t||"pwm"===t||(this._oscillator.baseType=t)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(t){this._getOscType(this._oscillator,"fat")&&MP(t)&&(this._oscillator.count=t)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(t){this._getOscType(this._oscillator,"fat")&&MP(t)&&(this._oscillator.spread=t)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(t){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&LP(t)&&(this._oscillator.modulationType=t)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(t=1024){return g(this,void 0,void 0,(function*(){return Dj(this,t)}))}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}},CW.OmniOscillator=TW),CW}var AW,kW,OW=!1;function DW(){return OW||(OW=!0,AW={},SL(),OL(),vF(),BL(),kW=class t extends VL{constructor(){super(Object.assign(pF(t.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Add",this._sum=new AL({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,CL(this._constantSource,this._sum)}static getDefaults(){return Object.assign(VL.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}},AW.Add=kW),AW}var NW,RW,IW=!1;function MW(){return IW||(IW=!0,NW={},vF(),DW(),eW(),Uj(),RW=class t extends Wj{constructor(){super(Object.assign(pF(t.getDefaults(),arguments,["min","max"]))),this.name="Scale";const e=pF(t.getDefaults(),arguments,["min","max"]);this._mult=this.input=new Jj({context:this.context,value:e.max-e.min}),this._add=this.output=new kW({context:this.context,value:e.min}),this._min=e.min,this._max=e.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(Wj.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(t){this._min=t,this._setRange()}get max(){return this._max}set max(t){this._max=t,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}},NW.Scale=RW),NW}var PW,FW,qW=!1;function LW(){return qW||(qW=!0,PW={},OL(),SL(),vF(),Uj(),FW=class t extends Wj{constructor(){super(Object.assign(pF(t.getDefaults(),arguments))),this.name="Zero",this._gain=new AL({context:this.context}),this.output=this._gain,this.input=void 0,xL(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),TL(this.context.getConstant(0),this._gain),this}},PW.Zero=FW),PW}var VW,jW,WW=!1;function BW(){return WW||(WW=!0,VW={},OL(),gL(),SL(),vF(),hq(),Zj(),MW(),BL(),LW(),Vj(),jW=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments,["frequency","min","max"])),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=vL.prototype._fromType,this._toType=vL.prototype._toType,this._is=vL.prototype._is,this._clampValue=vL.prototype._clampValue;const e=pF(t.getDefaults(),arguments,["frequency","min","max"]);this._oscillator=new qj({context:this.context,frequency:e.frequency,type:e.type}),this.frequency=this._oscillator.frequency,this._amplitudeGain=new AL({context:this.context,gain:e.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new VL({context:this.context,units:"audioRange",value:0}),this._zeros=new FW({context:this.context}),this._a2g=new Xj({context:this.context}),this._scaler=this.output=new RW({context:this.context,max:e.max,min:e.min}),this.units=e.units,this.min=e.min,this.max=e.max,this._oscillator.chain(this._a2g,this._amplitudeGain,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),cq(this,["amplitude","frequency"]),this.phase=e.phase}static getDefaults(){return Object.assign(bL.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,phase:0,type:"sine",units:"number"})}start(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(0,t),this._oscillator.start(t),this}stop(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(this._stoppedValue,t),this._oscillator.stop(t),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}get min(){return this._toType(this._scaler.min)}set min(t){t=this._fromType(t),this._scaler.min=t}get max(){return this._toType(this._scaler.max)}set max(t){t=this._fromType(t),this._scaler.max=t}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t,this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t,this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get units(){return this._units}set units(t){const e=this.min,n=this.max;this._units=t,this.min=e,this.max=n}get state(){return this._oscillator.state}connect(t,e,n){return(t instanceof vL||t instanceof VL)&&(this.convert=t.convert,this.units=t.units),WL(this,t,e,n),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}},VW.LFO=jW),VW}var UW,zW=!1;function QW(t,e=1/0){const n=new WeakMap;return function(i,r){Reflect.defineProperty(i,r,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(i){xP(i,t,e),n.set(this,i)}})}}function HW(t,e=1/0){const n=new WeakMap;return function(i,r){Reflect.defineProperty(i,r,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(i){xP(this.toSeconds(i),t,e),n.set(this,i)}})}}function GW(){return zW||(zW=!0,UW={},kP(),UW.range=QW,UW.timeRange=HW),UW}var YW,XW,KW=!1;function ZW(){return KW||(KW=!0,YW={},fq(),vF(),hq(),jP(),dj(),mj(),kP(),GW(),XW=class t extends lj{constructor(){super(pF(t.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const e=pF(t.getDefaults(),arguments,["url","onload"]);this._buffer=new pq({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(lj.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:oq,onerror:oq,playbackRate:1,reverse:!1})}load(t){return g(this,void 0,void 0,(function*(){return yield this._buffer.load(t),this._onload(),this}))}_onload(t=oq){t(),this.autostart&&this.start()}_onSourceEnd(t){this.onstop(this),this._activeSources.delete(t),0!==this._activeSources.size||this._synced||"started"!==this._state.getValueAtTime(this.now())||this._state.setStateAtTime("stopped",this.now())}start(t,e,n){return super.start(t,e,n),this}_start(t,e,n){e=this._loop?fF(e,this._loopStart):fF(e,0);let i=this.toSeconds(e);this._synced&&(i*=this._playbackRate);const r=n;n=fF(n,Math.max(this._buffer.duration-i,0));let s=this.toSeconds(n);s/=this._playbackRate,t=this.toSeconds(t);const o=new _j({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(t+s),this._state.setStateAtTime("stopped",t+s,{implicitEnd:!0})),this._activeSources.add(o),this._loop&&NP(r)?o.start(t,i):o.start(t,i,s-this.toSeconds(this.fadeOut))}_stop(t){const e=this.toSeconds(t);this._activeSources.forEach(t=>t.stop(e))}restart(t,e,n){return super.restart(t,e,n),this}_restart(t,e,n){this._stop(t),this._start(t,e,n)}seek(t,e){const n=this.toSeconds(e);if("started"===this._state.getValueAtTime(n)){const e=this.toSeconds(t);this._stop(n),this._start(n,e)}return this}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this.buffer.loaded&&xP(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach(e=>{e.loopStart=t})}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this.buffer.loaded&&xP(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach(e=>{e.loopEnd=t})}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._loop}set loop(t){if(this._loop!==t&&(this._loop=t,this._activeSources.forEach(e=>{e.loop=t}),t)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t;const e=this.now(),n=this._state.getNextState("stopped",e);n&&n.implicitEnd&&(this._state.cancel(n.time),this._activeSources.forEach(t=>t.cancelStop())),this._activeSources.forEach(n=>{n.playbackRate.setValueAtTime(t,e)})}get reverse(){return this._buffer.reverse}set reverse(t){this._buffer.reverse=t}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(t=>t.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}},YW.Player=XW,m([HW(0)],XW.prototype,"fadeIn",void 0),m([HW(0)],XW.prototype,"fadeOut",void 0)),YW}var $W,JW,tB=!1;function eB(){return tB||(tB=!0,$W={},LV(),KV(),SL(),vF(),kP(),hq(),dj(),ZW(),JW=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments,["urls","onload"],"urls")),this.name="Players",this.input=void 0,this._players=new Map;const e=pF(t.getDefaults(),arguments,["urls","onload"],"urls");this._volume=this.output=new FV({context:this.context,volume:e.volume}),this.volume=this._volume.volume,cq(this,"volume"),this._buffers=new YV({urls:e.urls,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.mute=e.mute,this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut}static getDefaults(){return Object.assign(lj.getDefaults(),{baseUrl:"",fadeIn:0,fadeOut:0,mute:!1,onload:oq,onerror:oq,urls:{},volume:0})}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t,this._players.forEach(e=>{e.fadeIn=t})}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t,this._players.forEach(e=>{e.fadeOut=t})}get state(){return Array.from(this._players).some(([t,e])=>"started"===e.state)?"started":"stopped"}has(t){return this._buffers.has(t)}player(t){if(CP(this.has(t),`No Player with the name ${t} exists on this object`),!this._players.has(t)){const e=new XW({context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,url:this._buffers.get(t)}).connect(this.output);this._players.set(t,e)}return this._players.get(t)}get loaded(){return this._buffers.loaded}add(t,e,n){return CP(!this._buffers.has(t),"A buffer with that name already exists on this object"),this._buffers.add(t,e,n),this}stopAll(t){return this._players.forEach(e=>e.stop(t)),this}dispose(){return super.dispose(),this._volume.dispose(),this.volume.dispose(),this._players.forEach(t=>t.dispose()),this._buffers.dispose(),this}},$W.Players=JW),$W}var nB,iB,rB=!1;function sB(){return rB||(rB=!0,nB={},dj(),hq(),fq(),vF(),rV(),mj(),Vq(),kP(),iB=class t extends lj{constructor(){super(pF(t.getDefaults(),arguments,["url","onload"])),this.name="GrainPlayer",this._loopStart=0,this._loopEnd=0,this._activeSources=[];const e=pF(t.getDefaults(),arguments,["url","onload"]);this.buffer=new pq({onload:e.onload,onerror:e.onerror,reverse:e.reverse,url:e.url}),this._clock=new nV({context:this.context,callback:this._tick.bind(this),frequency:1/e.grainSize}),this._playbackRate=e.playbackRate,this._grainSize=e.grainSize,this._overlap=e.overlap,this.detune=e.detune,this.overlap=e.overlap,this.loop=e.loop,this.playbackRate=e.playbackRate,this.grainSize=e.grainSize,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.reverse=e.reverse,this._clock.on("stop",this._onstop.bind(this))}static getDefaults(){return Object.assign(lj.getDefaults(),{onload:oq,onerror:oq,overlap:.1,grainSize:.2,playbackRate:1,detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1})}_start(t,e,n){e=fF(e,0),e=this.toSeconds(e),t=this.toSeconds(t);const i=1/this._clock.frequency.getValueAtTime(t);this._clock.start(t,e/i),n&&this.stop(t+this.toSeconds(n))}restart(t,e,n){return super.restart(t,e,n),this}_restart(t,e,n){this._stop(t),this._start(t,e,n)}_stop(t){this._clock.stop(t)}_onstop(t){this._activeSources.forEach(e=>{e.fadeOut=0,e.stop(t)}),this.onstop(this)}_tick(t){const e=this._clock.getTicksAtTime(t),n=e*this._grainSize;if(this.log("offset",n),!this.loop&&n>this.buffer.duration)return void this.stop(t);const i=n<this._overlap?0:this._overlap,r=new _j({context:this.context,url:this.buffer,fadeIn:i,fadeOut:this._overlap,loop:this.loop,loopStart:this._loopStart,loopEnd:this._loopEnd,playbackRate:Iq(this.detune/100)}).connect(this.output);r.start(t,this._grainSize*e),r.stop(t+this._grainSize/this.playbackRate),this._activeSources.push(r),r.onended=()=>{const t=this._activeSources.indexOf(r);-1!==t&&this._activeSources.splice(t,1)}}get playbackRate(){return this._playbackRate}set playbackRate(t){xP(t,.001),this._playbackRate=t,this.grainSize=this._grainSize}get loopStart(){return this._loopStart}set loopStart(t){this.buffer.loaded&&xP(this.toSeconds(t),0,this.buffer.duration),this._loopStart=this.toSeconds(t)}get loopEnd(){return this._loopEnd}set loopEnd(t){this.buffer.loaded&&xP(this.toSeconds(t),0,this.buffer.duration),this._loopEnd=this.toSeconds(t)}get reverse(){return this.buffer.reverse}set reverse(t){this.buffer.reverse=t}get grainSize(){return this._grainSize}set grainSize(t){this._grainSize=this.toSeconds(t),this._clock.frequency.setValueAtTime(this._playbackRate/this._grainSize,this.now())}get overlap(){return this._overlap}set overlap(t){const e=this.toSeconds(t);xP(e,0),this._overlap=e}get loaded(){return this.buffer.loaded}dispose(){return super.dispose(),this.buffer.dispose(),this._clock.dispose(),this._activeSources.forEach(t=>t.dispose()),this}},nB.GrainPlayer=iB),nB}var oB,aB=!1;function cB(){return aB||(aB=!0,e(oB={},xj()),e(oB,Aj()),e(oB,Vj()),e(oB,sW()),e(oB,uW()),e(oB,dW()),e(oB,mW()),e(oB,wW()),e(oB,EW()),e(oB,Pj()),e(oB,BW()),e(oB,mj()),e(oB,ZW()),e(oB,eB()),e(oB,sB())),oB}var uB,hB,lB=!1;function pB(){return lB||(lB=!0,uB={},Uj(),Gj(),hB=class extends Wj{constructor(){super(...arguments),this.name="Abs",this._abs=new Qj({context:this.context,mapping:t=>Math.abs(t)<.001?0:Math.abs(t)}),this.input=this._abs,this.output=this._abs}dispose(){return super.dispose(),this._abs.dispose(),this}},uB.Abs=hB),uB}var dB,fB,_B=!1;function vB(){return _B||(_B=!0,dB={},Uj(),Gj(),fB=class extends Wj{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new Qj({context:this.context,mapping:t=>2*Math.abs(t)-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}},dB.GainToAudio=fB),dB}var mB,gB,yB=!1;function bB(){return yB||(yB=!0,mB={},eW(),Uj(),gB=class extends Wj{constructor(){super(...arguments),this.name="Negate",this._multiply=new Jj({context:this.context,value:-1}),this.input=this._multiply,this.output=this._multiply}dispose(){return super.dispose(),this._multiply.dispose(),this}},mB.Negate=gB),mB}var wB,CB,xB=!1;function TB(){return xB||(xB=!0,wB={},SL(),OL(),vF(),bB(),BL(),CB=class t extends VL{constructor(){super(Object.assign(pF(t.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Subtract",this._sum=new AL({context:this.context}),this.input=this._sum,this.output=this._sum,this._neg=new gB({context:this.context}),this.subtrahend=this._param,CL(this._constantSource,this._neg,this._sum)}static getDefaults(){return Object.assign(VL.getDefaults(),{value:0})}dispose(){return super.dispose(),this._neg.dispose(),this._sum.dispose(),this}},wB.Subtract=CB),wB}var SB,EB,AB=!1;function kB(){return AB||(AB=!0,SB={},Uj(),eW(),Gj(),vF(),EB=class t extends Wj{constructor(){super(Object.assign(pF(t.getDefaults(),arguments))),this.name="GreaterThanZero",this._thresh=this.output=new Qj({context:this.context,length:127,mapping:t=>t<=0?0:1}),this._scale=this.input=new Jj({context:this.context,value:1e4}),this._scale.connect(this._thresh)}dispose(){return super.dispose(),this._scale.dispose(),this._thresh.dispose(),this}},SB.GreaterThanZero=EB),SB}var OB,DB,NB=!1;function RB(){return NB||(NB=!0,OB={},vF(),TB(),BL(),kB(),hq(),DB=class t extends VL{constructor(){super(Object.assign(pF(t.getDefaults(),arguments,["value"]))),this.name="GreaterThan",this.override=!1;const e=pF(t.getDefaults(),arguments,["value"]);this._subtract=this.input=new CB({context:this.context,value:e.value}),this._gtz=this.output=new EB({context:this.context}),this.comparator=this._param=this._subtract.subtrahend,cq(this,"comparator"),this._subtract.connect(this._gtz)}static getDefaults(){return Object.assign(VL.getDefaults(),{value:0})}dispose(){return super.dispose(),this._gtz.dispose(),this._subtract.dispose(),this.comparator.dispose(),this}},OB.GreaterThan=DB),OB}var IB,MB,PB=!1;function FB(){return PB||(PB=!0,IB={},Gj(),vF(),Uj(),MB=class t extends Wj{constructor(){super(Object.assign(pF(t.getDefaults(),arguments,["value"]))),this.name="Pow";const e=pF(t.getDefaults(),arguments,["value"]);this._exponentScaler=this.input=this.output=new Qj({context:this.context,mapping:this._expFunc(e.value),length:8192}),this._exponent=e.value}static getDefaults(){return Object.assign(Wj.getDefaults(),{value:1})}_expFunc(t){return e=>Math.pow(Math.abs(e),t)}get value(){return this._exponent}set value(t){this._exponent=t,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}},IB.Pow=MB),IB}var qB,LB,VB=!1;function jB(){return VB||(VB=!0,qB={},MW(),vF(),FB(),LB=class t extends RW{constructor(){super(Object.assign(pF(t.getDefaults(),arguments,["min","max","exponent"]))),this.name="ScaleExp";const e=pF(t.getDefaults(),arguments,["min","max","exponent"]);this.input=this._exp=new MB({context:this.context,value:e.exponent}),this._exp.connect(this._mult)}static getDefaults(){return Object.assign(RW.getDefaults(),{exponent:1})}get exponent(){return this._exp.value}set exponent(t){this._exp.value=t}dispose(){return super.dispose(),this._exp.dispose(),this}},qB.ScaleExp=LB),qB}var WB,BB,UB=!1;function zB(){return UB||(UB=!0,WB={},BL(),vF(),oL(),qL(),BB=class extends VL{constructor(){super(pF(VL.getDefaults(),arguments,["value","units"])),this.name="SyncedSignal",this.override=!1;const t=pF(VL.getDefaults(),arguments,["value","units"]);this._lastVal=t.value,this._synced=this.context.transport.scheduleRepeat(this._onTick.bind(this),"1i"),this._syncedCallback=this._anchorValue.bind(this),this.context.transport.on("start",this._syncedCallback),this.context.transport.on("pause",this._syncedCallback),this.context.transport.on("stop",this._syncedCallback),this._constantSource.disconnect(),this._constantSource.stop(0),this._constantSource=this.output=new PL({context:this.context,offset:t.value,units:t.units}).start(0),this.setValueAtTime(t.value,0)}_onTick(t){const e=super.getValueAtTime(this.context.transport.seconds);this._lastVal!==e&&(this._lastVal=e,this._constantSource.offset.setValueAtTime(e,t))}_anchorValue(t){const e=super.getValueAtTime(this.context.transport.seconds);this._lastVal=e,this._constantSource.offset.cancelAndHoldAtTime(t),this._constantSource.offset.setValueAtTime(e,t)}getValueAtTime(t){const e=new iL(this.context,t).toSeconds();return super.getValueAtTime(e)}setValueAtTime(t,e){const n=new iL(this.context,e).toSeconds();return super.setValueAtTime(t,n),this}linearRampToValueAtTime(t,e){const n=new iL(this.context,e).toSeconds();return super.linearRampToValueAtTime(t,n),this}exponentialRampToValueAtTime(t,e){const n=new iL(this.context,e).toSeconds();return super.exponentialRampToValueAtTime(t,n),this}setTargetAtTime(t,e,n){const i=new iL(this.context,e).toSeconds();return super.setTargetAtTime(t,i,n),this}cancelScheduledValues(t){const e=new iL(this.context,t).toSeconds();return super.cancelScheduledValues(e),this}setValueCurveAtTime(t,e,n,i){const r=new iL(this.context,e).toSeconds();return n=this.toSeconds(n),super.setValueCurveAtTime(t,r,n,i),this}cancelAndHoldAtTime(t){const e=new iL(this.context,t).toSeconds();return super.cancelAndHoldAtTime(e),this}setRampPoint(t){const e=new iL(this.context,t).toSeconds();return super.setRampPoint(e),this}exponentialRampTo(t,e,n){const i=new iL(this.context,n).toSeconds();return super.exponentialRampTo(t,e,i),this}linearRampTo(t,e,n){const i=new iL(this.context,n).toSeconds();return super.linearRampTo(t,e,i),this}targetRampTo(t,e,n){const i=new iL(this.context,n).toSeconds();return super.targetRampTo(t,e,i),this}dispose(){return super.dispose(),this.context.transport.clear(this._synced),this.context.transport.off("start",this._syncedCallback),this.context.transport.off("pause",this._syncedCallback),this.context.transport.off("stop",this._syncedCallback),this._constantSource.dispose(),this}},WB.SyncedSignal=BB),WB}var QB,HB=!1;function GB(){return HB||(HB=!0,e(QB={},DW()),e(QB,pB()),e(QB,Zj()),e(QB,vB()),e(QB,RB()),e(QB,kB()),e(QB,eW()),e(QB,bB()),e(QB,FB()),e(QB,BL()),e(QB,MW()),e(QB,jB()),e(QB,TB()),e(QB,zB()),e(QB,Gj()),e(QB,LW())),QB}var YB,XB,KB,ZB=!1;function $B(){return ZB||(ZB=!0,YB={},SL(),vF(),jP(),BL(),gq(),kP(),GW(),XB=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new VL({context:this.context,value:0}),this.output=this._sig,this.input=void 0;const e=pF(t.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(bL.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(t,e){if(LP(t))return t;{let n;for(n in KB)if(KB[n][e]===t)return n;return t}}_setCurve(t,e,n){if(LP(n)&&Reflect.has(KB,n)){const i=KB[n];PP(i)?"_decayCurve"!==t&&(this[t]=i[e]):this[t]=i}else{if(!qP(n)||"_decayCurve"===t)throw new Error("Envelope: invalid curve: "+n);this[t]=n}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(t){this._setCurve("_attackCurve","In",t)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(t){this._setCurve("_releaseCurve","Out",t)}get decayCurve(){return this._decayCurve}set decayCurve(t){CP(["linear","exponential"].some(e=>e===t),"Invalid envelope curve: "+t),this._decayCurve=t}triggerAttack(t,e=1){this.log("triggerAttack",t,e),t=this.toSeconds(t);let n=this.toSeconds(this.attack);const i=this.toSeconds(this.decay),r=this.getValueAtTime(t);if(r>0&&(n=(1-r)/(1/n)),n<this.sampleTime)this._sig.cancelScheduledValues(t),this._sig.setValueAtTime(e,t);else if("linear"===this._attackCurve)this._sig.linearRampTo(e,n,t);else if("exponential"===this._attackCurve)this._sig.targetRampTo(e,n,t);else{this._sig.cancelAndHoldAtTime(t);let i=this._attackCurve;for(let t=1;t<i.length;t++)if(i[t-1]<=r&&r<=i[t]){i=this._attackCurve.slice(t),i[0]=r;break}this._sig.setValueCurveAtTime(i,t,n,e)}if(i&&this.sustain<1){const r=e*this.sustain,s=t+n;this.log("decay",s),"linear"===this._decayCurve?this._sig.linearRampToValueAtTime(r,i+s):this._sig.exponentialApproachValueAtTime(r,s,i)}return this}triggerRelease(t){this.log("triggerRelease",t),t=this.toSeconds(t);const e=this.getValueAtTime(t);if(e>0){const n=this.toSeconds(this.release);n<this.sampleTime?this._sig.setValueAtTime(0,t):"linear"===this._releaseCurve?this._sig.linearRampTo(0,n,t):"exponential"===this._releaseCurve?this._sig.targetRampTo(0,n,t):(CP(qP(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(t),this._sig.setValueCurveAtTime(this._releaseCurve,t,n,e))}return this}getValueAtTime(t){return this._sig.getValueAtTime(t)}triggerAttackRelease(t,e,n=1){return e=this.toSeconds(e),this.triggerAttack(e,n),this.triggerRelease(e+this.toSeconds(t)),this}cancel(t){return this._sig.cancelScheduledValues(this.toSeconds(t)),this}connect(t,e=0,n=0){return WL(this,t,e,n),this}asArray(t=1024){return g(this,void 0,void 0,(function*(){const e=t/this.context.sampleRate,n=new vq(1,e,this.context.sampleRate),i=this.toSeconds(this.attack)+this.toSeconds(this.decay),r=i+this.toSeconds(this.release),s=.1*r,o=r+s,a=new this.constructor(Object.assign(this.get(),{attack:e*this.toSeconds(this.attack)/o,decay:e*this.toSeconds(this.decay)/o,release:e*this.toSeconds(this.release)/o,context:n}));return a._sig.toDestination(),a.triggerAttackRelease(e*(i+s)/o,0),(yield n.render()).getChannelData(0)}))}dispose(){return super.dispose(),this._sig.dispose(),this}},YB.Envelope=XB,m([HW(0)],XB.prototype,"attack",void 0),m([HW(0)],XB.prototype,"decay",void 0),m([QW(0,1)],XB.prototype,"sustain",void 0),m([HW(0)],XB.prototype,"release",void 0),KB=(()=>{let t,e;const n=[];for(t=0;t<128;t++)n[t]=Math.sin(t/127*(Math.PI/2));const i=[];for(t=0;t<127;t++){e=t/127;const n=Math.sin(e*(2*Math.PI)*6.4-Math.PI/2)+1;i[t]=n/10+.83*e}i[127]=1;const r=[];for(t=0;t<128;t++)r[t]=Math.ceil(t/127*5)/5;const s=[];for(t=0;t<128;t++)e=t/127,s[t]=.5*(1-Math.cos(Math.PI*e));const o=[];for(t=0;t<128;t++){e=t/127;const n=4*Math.pow(e,3)+.2,i=Math.cos(n*Math.PI*2*e);o[t]=Math.abs(i*(1-e))}function a(t){const e=new Array(t.length);for(let n=0;n<t.length;n++)e[n]=1-t[n];return e}return{bounce:{In:a(o),Out:o},cosine:{In:n,Out:(c=n,c.slice(0).reverse())},exponential:"exponential",linear:"linear",ripple:{In:i,Out:a(i)},sine:{In:s,Out:a(s)},step:{In:r,Out:a(r)}};var c})()),YB}var JB,tU,eU=!1;function nU(){return eU||(eU=!0,JB={},LV(),SL(),vF(),hq(),tU=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;const e=pF(t.getDefaults(),arguments);this._volume=this.output=new FV({context:this.context,volume:e.volume}),this.volume=this._volume.volume,cq(this,"volume")}static getDefaults(){return Object.assign(bL.getDefaults(),{volume:0})}sync(){return this._synced||(this._synced=!0,this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncMethod(t,e){const n=this["_original_"+t]=this[t];this[t]=(...t)=>{const i=t[e],r=this.context.transport.schedule(i=>{t[e]=i,n.apply(this,t)},i);this._scheduledEvents.push(r)}}unsync(){return this._scheduledEvents.forEach(t=>this.context.transport.clear(t)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(t,e,n,i){const r=this.toSeconds(n),s=this.toSeconds(e);return this.triggerAttack(t,r,i),this.triggerRelease(r+s),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}},JB.Instrument=tU),JB}var iU,rU,sU=!1;function oU(){return sU||(sU=!0,iU={},eL(),vF(),hq(),nU(),GW(),rU=class t extends tU{constructor(){super(pF(t.getDefaults(),arguments));const e=pF(t.getDefaults(),arguments);this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(tU.getDefaults(),{detune:0,onsilence:oq,portamento:0})}triggerAttack(t,e,n=1){this.log("triggerAttack",t,e,n);const i=this.toSeconds(e);return this._triggerEnvelopeAttack(i,n),this.setNote(t,i),this}triggerRelease(t){this.log("triggerRelease",t);const e=this.toSeconds(t);return this._triggerEnvelopeRelease(e),this}setNote(t,e){const n=this.toSeconds(e),i=t instanceof Kq?t.toFrequency():t;if(this.portamento>0&&this.getLevelAtTime(n)>.05){const t=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(i,t,n)}else this.frequency.setValueAtTime(i,n);return this}},iU.Monophonic=rU,m([HW(0)],rU.prototype,"portamento",void 0)),iU}var aU,cU,uU=!1;function hU(){return uU||(uU=!0,aU={},OL(),vF(),$B(),cU=class t extends XB{constructor(){super(pF(t.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new AL({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}},aU.AmplitudeEnvelope=cU),aU}var lU,pU,dU=!1;function fU(){return dU||(dU=!0,lU={},hU(),$B(),SL(),vF(),hq(),EW(),dj(),oU(),pU=class t extends rU{constructor(){super(pF(t.getDefaults(),arguments)),this.name="Synth";const e=pF(t.getDefaults(),arguments);this.oscillator=new TW(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new cU(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),cq(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(rU.getDefaults(),{envelope:Object.assign(_F(XB.getDefaults(),Object.keys(bL.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(_F(TW.getDefaults(),[...Object.keys(lj.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(t,e){if(this.envelope.triggerAttack(t,e),this.oscillator.start(t),0===this.envelope.sustain){const e=this.toSeconds(this.envelope.attack),n=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+e+n)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}},lU.Synth=pU),lU}var _U,vU,mU=!1;function gU(){return mU||(mU=!0,_U={},BL(),eW(),OL(),$B(),SL(),oU(),EW(),dj(),fU(),hq(),vF(),vU=class t extends rU{constructor(){super(pF(t.getDefaults(),arguments)),this.name="ModulationSynth";const e=pF(t.getDefaults(),arguments);this._carrier=new pU({context:this.context,oscillator:e.oscillator,envelope:e.envelope,onsilence:()=>this.onsilence(this),volume:-10}),this._modulator=new pU({context:this.context,oscillator:e.modulation,envelope:e.modulationEnvelope,volume:-10}),this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope,this.modulation=this._modulator.oscillator,this.modulationEnvelope=this._modulator.envelope,this.frequency=new VL({context:this.context,units:"frequency"}),this.detune=new VL({context:this.context,value:e.detune,units:"cents"}),this.harmonicity=new Jj({context:this.context,value:e.harmonicity,minValue:0}),this._modulationNode=new AL({context:this.context,gain:0}),cq(this,["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"])}static getDefaults(){return Object.assign(rU.getDefaults(),{harmonicity:3,oscillator:Object.assign(_F(TW.getDefaults(),[...Object.keys(lj.getDefaults()),"frequency","detune"]),{type:"sine"}),envelope:Object.assign(_F(XB.getDefaults(),Object.keys(bL.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),modulation:Object.assign(_F(TW.getDefaults(),[...Object.keys(lj.getDefaults()),"frequency","detune"]),{type:"square"}),modulationEnvelope:Object.assign(_F(XB.getDefaults(),Object.keys(bL.getDefaults())),{attack:.5,decay:0,sustain:1,release:.5})})}_triggerEnvelopeAttack(t,e){this._carrier._triggerEnvelopeAttack(t,e),this._modulator._triggerEnvelopeAttack(t,e)}_triggerEnvelopeRelease(t){return this._carrier._triggerEnvelopeRelease(t),this._modulator._triggerEnvelopeRelease(t),this}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this._carrier.dispose(),this._modulator.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._modulationNode.dispose(),this}},_U.ModulationSynth=vU),_U}var yU,bU,wU=!1;function CU(){return wU||(wU=!0,yU={},Zj(),vF(),gU(),bU=class t extends vU{constructor(){super(pF(t.getDefaults(),arguments)),this.name="AMSynth",this._modulationScale=new Xj({context:this.context}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output)}dispose(){return super.dispose(),this._modulationScale.dispose(),this}},yU.AMSynth=bU),yU}var xU,TU,SU=!1;function EU(){return SU||(SU=!0,xU={},SL(),vF(),gL(),kP(),TU=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments,["frequency","type"])),this.name="BiquadFilter";const e=pF(t.getDefaults(),arguments,["frequency","type"]);this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new vL({context:this.context,units:"number",value:e.Q,param:this._filter.Q}),this.frequency=new vL({context:this.context,units:"frequency",value:e.frequency,param:this._filter.frequency}),this.detune=new vL({context:this.context,units:"cents",value:e.detune,param:this._filter.detune}),this.gain=new vL({context:this.context,units:"gain",value:e.gain,param:this._filter.gain}),this.type=e.type}static getDefaults(){return Object.assign(bL.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(t){CP(-1!==["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(t),"Invalid filter type: "+t),this._filter.type=t}getFrequencyResponse(t=128){const e=new Float32Array(t);for(let n=0;n<t;n++){const i=19980*Math.pow(n/t,2)+20;e[n]=i}const n=new Float32Array(t),i=new Float32Array(t),r=this.context.createBiquadFilter();return r.type=this.type,r.Q.value=this.Q.value,r.frequency.value=this.frequency.value,r.gain.value=this.gain.value,r.getFrequencyResponse(e,n,i),n}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}},xU.BiquadFilter=TU),xU}var AU,kU,OU=!1;function DU(){return OU||(OU=!0,AU={},OL(),SL(),vF(),hq(),jP(),BL(),kP(),EU(),kU=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments,["frequency","type","rolloff"])),this.name="Filter",this.input=new AL({context:this.context}),this.output=new AL({context:this.context}),this._filters=[];const e=pF(t.getDefaults(),arguments,["frequency","type","rolloff"]);this._filters=[],this.Q=new VL({context:this.context,units:"positive",value:e.Q}),this.frequency=new VL({context:this.context,units:"frequency",value:e.frequency}),this.detune=new VL({context:this.context,units:"cents",value:e.detune}),this.gain=new VL({context:this.context,units:"decibels",value:e.gain}),this._type=e.type,this.rolloff=e.rolloff,cq(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(bL.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(t){CP(-1!==["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(t),"Invalid filter type: "+t),this._type=t,this._filters.forEach(e=>e.type=t)}get rolloff(){return this._rolloff}set rolloff(t){const e=MP(t)?t:parseInt(t,10),n=[-12,-24,-48,-96];let i=n.indexOf(e);CP(-1!==i,"rolloff can only be "+n.join(", ")),i+=1,this._rolloff=e,this.input.disconnect(),this._filters.forEach(t=>t.disconnect()),this._filters=new Array(i);for(let t=0;t<i;t++){const e=new TU({context:this.context});e.type=this._type,this.frequency.connect(e.frequency),this.detune.connect(e.detune),this.Q.connect(e.Q),this.gain.connect(e.gain),this._filters[t]=e}this._internalChannels=this._filters,CL(this.input,...this._internalChannels,this.output)}getFrequencyResponse(t=128){const e=new TU({frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),n=new Float32Array(t).map(()=>1);return this._filters.forEach(()=>{e.getFrequencyResponse(t).forEach((t,e)=>n[e]*=t)}),e.dispose(),n}dispose(){return super.dispose(),this._filters.forEach(t=>{t.dispose()}),uq(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}},AU.Filter=kU),AU}var NU,RU,IU=!1;function MU(){return IU||(IU=!0,NU={},vF(),$B(),MW(),FB(),kP(),RU=class t extends XB{constructor(){super(pF(t.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="FrequencyEnvelope";const e=pF(t.getDefaults(),arguments,["attack","decay","sustain","release"]);this._octaves=e.octaves,this._baseFrequency=this.toFrequency(e.baseFrequency),this._exponent=this.input=new MB({context:this.context,value:e.exponent}),this._scale=this.output=new RW({context:this.context,min:this._baseFrequency,max:this._baseFrequency*Math.pow(2,this._octaves)}),this._sig.chain(this._exponent,this._scale)}static getDefaults(){return Object.assign(XB.getDefaults(),{baseFrequency:200,exponent:1,octaves:4})}get baseFrequency(){return this._baseFrequency}set baseFrequency(t){const e=this.toFrequency(t);xP(e,0),this._baseFrequency=e,this._scale.min=this._baseFrequency,this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(t){xP(t,0),this._octaves=t,this._scale.max=this._baseFrequency*Math.pow(2,t)}get exponent(){return this._exponent.value}set exponent(t){this._exponent.value=t}dispose(){return super.dispose(),this._exponent.dispose(),this._scale.dispose(),this}},NU.FrequencyEnvelope=RU),NU}var PU,FU,qU=!1;function LU(){return qU||(qU=!0,PU={},hU(),$B(),DU(),vF(),hq(),oU(),EW(),dj(),MU(),SL(),FU=class t extends rU{constructor(){super(pF(t.getDefaults(),arguments)),this.name="MonoSynth";const e=pF(t.getDefaults(),arguments);this.oscillator=new TW(Object.assign(e.oscillator,{context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)})),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new kU(Object.assign(e.filter,{context:this.context})),this.filterEnvelope=new RU(Object.assign(e.filterEnvelope,{context:this.context})),this.envelope=new cU(Object.assign(e.envelope,{context:this.context})),this.oscillator.chain(this.filter,this.envelope,this.output),this.filterEnvelope.connect(this.filter.frequency),cq(this,["oscillator","frequency","detune","filter","filterEnvelope","envelope"])}static getDefaults(){return Object.assign(rU.getDefaults(),{envelope:Object.assign(_F(XB.getDefaults(),Object.keys(bL.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.9}),filter:Object.assign(_F(kU.getDefaults(),Object.keys(bL.getDefaults())),{Q:1,rolloff:-12,type:"lowpass"}),filterEnvelope:Object.assign(_F(RU.getDefaults(),Object.keys(bL.getDefaults())),{attack:.6,baseFrequency:200,decay:.2,exponent:2,octaves:3,release:2,sustain:.5}),oscillator:Object.assign(_F(TW.getDefaults(),Object.keys(lj.getDefaults())),{type:"sawtooth"})})}_triggerEnvelopeAttack(t,e=1){if(this.envelope.triggerAttack(t,e),this.filterEnvelope.triggerAttack(t),this.oscillator.start(t),0===this.envelope.sustain){const e=this.toSeconds(this.envelope.attack),n=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+e+n)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.filterEnvelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this.filterEnvelope.dispose(),this.filter.dispose(),this}},PU.MonoSynth=FU),PU}var VU,jU,WU=!1;function BU(){return WU||(WU=!0,VU={},oU(),LU(),BL(),hq(),BW(),OL(),eW(),vF(),jU=class t extends rU{constructor(){super(pF(t.getDefaults(),arguments)),this.name="DuoSynth";const e=pF(t.getDefaults(),arguments);this.voice0=new FU(Object.assign(e.voice0,{context:this.context,onsilence:()=>this.onsilence(this)})),this.voice1=new FU(Object.assign(e.voice1,{context:this.context})),this.harmonicity=new Jj({context:this.context,units:"positive",value:e.harmonicity}),this._vibrato=new jW({frequency:e.vibratoRate,context:this.context,min:-50,max:50}),this._vibrato.start(),this.vibratoRate=this._vibrato.frequency,this._vibratoGain=new AL({context:this.context,units:"normalRange",gain:e.vibratoAmount}),this.vibratoAmount=this._vibratoGain.gain,this.frequency=new VL({context:this.context,units:"frequency",value:440}),this.detune=new VL({context:this.context,units:"cents",value:e.detune}),this.frequency.connect(this.voice0.frequency),this.frequency.chain(this.harmonicity,this.voice1.frequency),this._vibrato.connect(this._vibratoGain),this._vibratoGain.fan(this.voice0.detune,this.voice1.detune),this.detune.fan(this.voice0.detune,this.voice1.detune),this.voice0.connect(this.output),this.voice1.connect(this.output),cq(this,["voice0","voice1","frequency","vibratoAmount","vibratoRate"])}getLevelAtTime(t){return t=this.toSeconds(t),this.voice0.envelope.getValueAtTime(t)+this.voice1.envelope.getValueAtTime(t)}static getDefaults(){return hF(rU.getDefaults(),{vibratoAmount:.5,vibratoRate:5,harmonicity:1.5,voice0:hF(_F(FU.getDefaults(),Object.keys(rU.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}}),voice1:hF(_F(FU.getDefaults(),Object.keys(rU.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}})})}_triggerEnvelopeAttack(t,e){this.voice0._triggerEnvelopeAttack(t,e),this.voice1._triggerEnvelopeAttack(t,e)}_triggerEnvelopeRelease(t){return this.voice0._triggerEnvelopeRelease(t),this.voice1._triggerEnvelopeRelease(t),this}dispose(){return super.dispose(),this.voice0.dispose(),this.voice1.dispose(),this.frequency.dispose(),this.detune.dispose(),this._vibrato.dispose(),this.vibratoRate.dispose(),this._vibratoGain.dispose(),this.harmonicity.dispose(),this}},VU.DuoSynth=jU),VU}var UU,zU,QU=!1;function HU(){return QU||(QU=!0,UU={},vF(),eW(),gU(),zU=class t extends vU{constructor(){super(pF(t.getDefaults(),arguments)),this.name="FMSynth";const e=pF(t.getDefaults(),arguments);this.modulationIndex=new Jj({context:this.context,value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output)}static getDefaults(){return Object.assign(vU.getDefaults(),{modulationIndex:10})}dispose(){return super.dispose(),this.modulationIndex.dispose(),this}},UU.FMSynth=zU),UU}var GU,YU,XU,KU=!1;function ZU(){return KU||(KU=!0,GU={},$B(),DU(),OL(),SL(),vF(),hq(),eW(),MW(),BL(),uW(),oU(),YU=[1,1.483,1.932,2.546,2.63,3.897],XU=class t extends rU{constructor(){super(pF(t.getDefaults(),arguments)),this.name="MetalSynth",this._oscillators=[],this._freqMultipliers=[];const e=pF(t.getDefaults(),arguments);this.detune=new VL({context:this.context,units:"cents",value:e.detune}),this.frequency=new VL({context:this.context,units:"frequency"}),this._amplitude=new AL({context:this.context,gain:0}).connect(this.output),this._highpass=new kU({Q:0,context:this.context,type:"highpass"}).connect(this._amplitude);for(let t=0;t<YU.length;t++){const n=new aW({context:this.context,harmonicity:e.harmonicity,modulationIndex:e.modulationIndex,modulationType:"square",onstop:0===t?()=>this.onsilence(this):oq,type:"square"});n.connect(this._highpass),this._oscillators[t]=n;const i=new Jj({context:this.context,value:YU[t]});this._freqMultipliers[t]=i,this.frequency.chain(i,n.frequency),this.detune.connect(n.detune)}this._filterFreqScaler=new RW({context:this.context,max:7e3,min:this.toFrequency(e.resonance)}),this.envelope=new XB({attack:e.envelope.attack,attackCurve:"linear",context:this.context,decay:e.envelope.decay,release:e.envelope.release,sustain:0}),this.envelope.chain(this._filterFreqScaler,this._highpass.frequency),this.envelope.connect(this._amplitude.gain),this._octaves=e.octaves,this.octaves=e.octaves}static getDefaults(){return hF(rU.getDefaults(),{envelope:Object.assign(_F(XB.getDefaults(),Object.keys(bL.getDefaults())),{attack:.001,decay:1.4,release:.2}),harmonicity:5.1,modulationIndex:32,octaves:1.5,resonance:4e3})}_triggerEnvelopeAttack(t,e=1){return this.envelope.triggerAttack(t,e),this._oscillators.forEach(e=>e.start(t)),0===this.envelope.sustain&&this._oscillators.forEach(e=>{e.stop(t+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay))}),this}_triggerEnvelopeRelease(t){return this.envelope.triggerRelease(t),this._oscillators.forEach(e=>e.stop(t+this.toSeconds(this.envelope.release))),this}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}get modulationIndex(){return this._oscillators[0].modulationIndex.value}set modulationIndex(t){this._oscillators.forEach(e=>e.modulationIndex.value=t)}get harmonicity(){return this._oscillators[0].harmonicity.value}set harmonicity(t){this._oscillators.forEach(e=>e.harmonicity.value=t)}get resonance(){return this._filterFreqScaler.min}set resonance(t){this._filterFreqScaler.min=this.toFrequency(t),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(t){this._octaves=t,this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,t)}dispose(){return super.dispose(),this._oscillators.forEach(t=>t.dispose()),this._freqMultipliers.forEach(t=>t.dispose()),this.frequency.dispose(),this.detune.dispose(),this._filterFreqScaler.dispose(),this._amplitude.dispose(),this.envelope.dispose(),this._highpass.dispose(),this}},GU.MetalSynth=XU),GU}var $U,JU,tz=!1;function ez(){return tz||(tz=!0,$U={},eL(),vF(),hq(),oU(),fU(),GW(),JU=class t extends pU{constructor(){super(pF(t.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;const e=pF(t.getDefaults(),arguments);this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,cq(this,["oscillator","envelope"])}static getDefaults(){return hF(rU.getDefaults(),pU.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(t,e){const n=this.toSeconds(e),i=this.toFrequency(t instanceof Kq?t.toFrequency():t),r=i*this.octaves;return this.oscillator.frequency.setValueAtTime(r,n),this.oscillator.frequency.exponentialRampToValueAtTime(i,n+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}},$U.MembraneSynth=JU,m([QW(0)],JU.prototype,"octaves",void 0),m([HW(0)],JU.prototype,"pitchDecay",void 0)),$U}var nz,iz,rz=!1;function sz(){return rz||(rz=!0,nz={},hU(),vF(),xj(),nU(),SL(),$B(),dj(),iz=class t extends tU{constructor(){super(pF(t.getDefaults(),arguments)),this.name="NoiseSynth";const e=pF(t.getDefaults(),arguments);this.noise=new yj(Object.assign({context:this.context},e.noise)),this.envelope=new cU(Object.assign({context:this.context},e.envelope)),this.noise.chain(this.envelope,this.output)}static getDefaults(){return Object.assign(tU.getDefaults(),{envelope:Object.assign(_F(XB.getDefaults(),Object.keys(bL.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(_F(yj.getDefaults(),Object.keys(lj.getDefaults())),{type:"white"})})}triggerAttack(t,e=1){return t=this.toSeconds(t),this.envelope.triggerAttack(t,e),this.noise.start(t),0===this.envelope.sustain&&this.noise.stop(t+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}triggerRelease(t){return t=this.toSeconds(t),this.envelope.triggerRelease(t),this.noise.stop(t+this.toSeconds(this.envelope.release)),this}sync(){return this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0),this}triggerAttackRelease(t,e,n=1){return e=this.toSeconds(e),t=this.toSeconds(t),this.triggerAttack(e,n),this.triggerRelease(e+t),this}dispose(){return super.dispose(),this.noise.dispose(),this.envelope.dispose(),this}},nz.NoiseSynth=iz),nz}var oz,az,cz=!1;function uz(t){az.add(t)}function hz(t,e){const n=`registerProcessor("${t}", ${e})`;az.add(n)}function lz(){return Array.from(az).join("\n")}function pz(){return cz||(cz=!0,oz={},az=new Set,oz.addToWorklet=uz,oz.registerProcessor=hz,oz.getWorkletGlobalScope=lz),oz}var dz,fz,_z=!1;function vz(){return _z||(_z=!0,dz={},SL(),hq(),pz(),fz=class extends bL{constructor(t){super(t),this.name="ToneAudioWorklet",this.workletOptions={},this.onprocessorerror=oq;const e=URL.createObjectURL(new Blob([lz()],{type:"text/javascript"})),n=this._audioWorkletName();this._dummyGain=this.context.createGain(),this._dummyParam=this._dummyGain.gain,this.context.addAudioWorkletModule(e,n).then(()=>{this.disposed||(this._worklet=this.context.createAudioWorkletNode(n,this.workletOptions),this._worklet.onprocessorerror=this.onprocessorerror.bind(this),this.onReady(this._worklet))})}dispose(){return super.dispose(),this._dummyGain.disconnect(),this._worklet&&(this._worklet.port.postMessage("dispose"),this._worklet.disconnect()),this}},dz.ToneAudioWorklet=fz),dz}var mz=!1;function gz(){return mz||(mz=!0,pz(),'\n\t/**\n\t * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. \n\t */\n\tclass ToneAudioWorkletProcessor extends AudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\t\n\t\t\tsuper(options);\n\t\t\t/**\n\t\t\t * If the processor was disposed or not. Keep alive until it\'s disposed.\n\t\t\t */\n\t\t\tthis.disposed = false;\n\t\t   \t/** \n\t\t\t * The number of samples in the processing block\n\t\t\t */\n\t\t\tthis.blockSize = 128;\n\t\t\t/**\n\t\t\t * the sample rate\n\t\t\t */\n\t\t\tthis.sampleRate = sampleRate;\n\n\t\t\tthis.port.onmessage = (event) => {\n\t\t\t\t// when it receives a dispose \n\t\t\t\tif (event.data === "dispose") {\n\t\t\t\t\tthis.disposed = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n',uz('\n\t/**\n\t * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. \n\t */\n\tclass ToneAudioWorkletProcessor extends AudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\t\n\t\t\tsuper(options);\n\t\t\t/**\n\t\t\t * If the processor was disposed or not. Keep alive until it\'s disposed.\n\t\t\t */\n\t\t\tthis.disposed = false;\n\t\t   \t/** \n\t\t\t * The number of samples in the processing block\n\t\t\t */\n\t\t\tthis.blockSize = 128;\n\t\t\t/**\n\t\t\t * the sample rate\n\t\t\t */\n\t\t\tthis.sampleRate = sampleRate;\n\n\t\t\tthis.port.onmessage = (event) => {\n\t\t\t\t// when it receives a dispose \n\t\t\t\tif (event.data === "dispose") {\n\t\t\t\t\tthis.disposed = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n')),{}}var yz,bz,wz=!1;function Cz(){return wz||(wz=!0,yz={},gz(),pz(),bz="\n\t/**\n\t * Abstract class for a single input/output processor. \n\t * has a 'generate' function which processes one sample at a time\n\t */\n\tclass SingleIOProcessor extends ToneAudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(Object.assign(options, {\n\t\t\t\tnumberOfInputs: 1,\n\t\t\t\tnumberOfOutputs: 1\n\t\t\t}));\n\t\t\t/**\n\t\t\t * Holds the name of the parameter and a single value of that\n\t\t\t * parameter at the current sample\n\t\t\t * @type { [name: string]: number }\n\t\t\t */\n\t\t\tthis.params = {}\n\t\t}\n\n\t\t/**\n\t\t * Generate an output sample from the input sample and parameters\n\t\t * @abstract\n\t\t * @param input number\n\t\t * @param channel number\n\t\t * @param parameters { [name: string]: number }\n\t\t * @returns number\n\t\t */\n\t\tgenerate(){}\n\n\t\t/**\n\t\t * Update the private params object with the \n\t\t * values of the parameters at the given index\n\t\t * @param parameters { [name: string]: Float32Array },\n\t\t * @param index number\n\t\t */\n\t\tupdateParams(parameters, index) {\n\t\t\tfor (const paramName in parameters) {\n\t\t\t\tconst param = parameters[paramName];\n\t\t\t\tif (param.length > 1) {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][index];\n\t\t\t\t} else {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Process a single frame of the audio\n\t\t * @param inputs Float32Array[][]\n\t\t * @param outputs Float32Array[][]\n\t\t */\n\t\tprocess(inputs, outputs, parameters) {\n\t\t\tconst input = inputs[0];\n\t\t\tconst output = outputs[0];\n\t\t\t// get the parameter values\n\t\t\tconst channelCount = Math.max(input && input.length || 0, output.length);\n\t\t\tfor (let sample = 0; sample < this.blockSize; sample++) {\n\t\t\t\tthis.updateParams(parameters, sample);\n\t\t\t\tfor (let channel = 0; channel < channelCount; channel++) {\n\t\t\t\t\tconst inputSample = input && input.length ? input[channel][sample] : 0;\n\t\t\t\t\toutput[channel][sample] = this.generate(inputSample, channel, this.params);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn !this.disposed;\n\t\t}\n\t};\n",yz.singleIOProcess=bz,uz(bz)),yz}var xz=!1;function Tz(){return xz||(xz=!0,pz(),"\n\t/**\n\t * A multichannel buffer for use within an AudioWorkletProcessor as a delay line\n\t */\n\tclass DelayLine {\n\t\t\n\t\tconstructor(size, channels) {\n\t\t\tthis.buffer = [];\n\t\t\tthis.writeHead = []\n\t\t\tthis.size = size;\n\n\t\t\t// create the empty channels\n\t\t\tfor (let i = 0; i < channels; i++) {\n\t\t\t\tthis.buffer[i] = new Float32Array(this.size);\n\t\t\t\tthis.writeHead[i] = 0;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Push a value onto the end\n\t\t * @param channel number\n\t\t * @param value number\n\t\t */\n\t\tpush(channel, value) {\n\t\t\tthis.writeHead[channel] += 1;\n\t\t\tif (this.writeHead[channel] > this.size) {\n\t\t\t\tthis.writeHead[channel] = 0;\n\t\t\t}\n\t\t\tthis.buffer[channel][this.writeHead[channel]] = value;\n\t\t}\n\n\t\t/**\n\t\t * Get the recorded value of the channel given the delay\n\t\t * @param channel number\n\t\t * @param delay number delay samples\n\t\t */\n\t\tget(channel, delay) {\n\t\t\tlet readHead = this.writeHead[channel] - Math.floor(delay);\n\t\t\tif (readHead < 0) {\n\t\t\t\treadHead += this.size;\n\t\t\t}\n\t\t\treturn this.buffer[channel][readHead];\n\t\t}\n\t}\n",uz("\n\t/**\n\t * A multichannel buffer for use within an AudioWorkletProcessor as a delay line\n\t */\n\tclass DelayLine {\n\t\t\n\t\tconstructor(size, channels) {\n\t\t\tthis.buffer = [];\n\t\t\tthis.writeHead = []\n\t\t\tthis.size = size;\n\n\t\t\t// create the empty channels\n\t\t\tfor (let i = 0; i < channels; i++) {\n\t\t\t\tthis.buffer[i] = new Float32Array(this.size);\n\t\t\t\tthis.writeHead[i] = 0;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Push a value onto the end\n\t\t * @param channel number\n\t\t * @param value number\n\t\t */\n\t\tpush(channel, value) {\n\t\t\tthis.writeHead[channel] += 1;\n\t\t\tif (this.writeHead[channel] > this.size) {\n\t\t\t\tthis.writeHead[channel] = 0;\n\t\t\t}\n\t\t\tthis.buffer[channel][this.writeHead[channel]] = value;\n\t\t}\n\n\t\t/**\n\t\t * Get the recorded value of the channel given the delay\n\t\t * @param channel number\n\t\t * @param delay number delay samples\n\t\t */\n\t\tget(channel, delay) {\n\t\t\tlet readHead = this.writeHead[channel] - Math.floor(delay);\n\t\t\tif (readHead < 0) {\n\t\t\t\treadHead += this.size;\n\t\t\t}\n\t\t\treturn this.buffer[channel][readHead];\n\t\t}\n\t}\n")),{}}var Sz,Ez,Az=!1;function kz(){return Az||(Az=!0,Sz={},Cz(),Tz(),pz(),Ez="feedback-comb-filter",Sz.workletName=Ez,'\n\tclass FeedbackCombFilterWorklet extends SingleIOProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\t\t\tthis.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);\n\t\t}\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: "delayTime",\n\t\t\t\tdefaultValue: 0.1,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 1,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}, {\n\t\t\t\tname: "feedback",\n\t\t\t\tdefaultValue: 0.5,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 0.9999,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, channel, parameters) {\n\t\t\tconst delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);\n\t\t\tthis.delayLine.push(channel, input + delayedSample * parameters.feedback);\n\t\t\treturn delayedSample;\n\t\t}\n\t}\n',hz(Ez,'\n\tclass FeedbackCombFilterWorklet extends SingleIOProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\t\t\tthis.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);\n\t\t}\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: "delayTime",\n\t\t\t\tdefaultValue: 0.1,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 1,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}, {\n\t\t\t\tname: "feedback",\n\t\t\t\tdefaultValue: 0.5,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 0.9999,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, channel, parameters) {\n\t\t\tconst delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);\n\t\t\tthis.delayLine.push(channel, input + delayedSample * parameters.feedback);\n\t\t\treturn delayedSample;\n\t\t}\n\t}\n')),Sz}var Oz,Dz,Nz=!1;function Rz(){return Nz||(Nz=!0,Oz={},OL(),gL(),SL(),vF(),hq(),vz(),kz(),Dz=class t extends fz{constructor(){super(pF(t.getDefaults(),arguments,["delayTime","resonance"])),this.name="FeedbackCombFilter";const e=pF(t.getDefaults(),arguments,["delayTime","resonance"]);this.input=new AL({context:this.context}),this.output=new AL({context:this.context}),this.delayTime=new vL({context:this.context,value:e.delayTime,units:"time",minValue:0,maxValue:1,param:this._dummyParam,swappable:!0}),this.resonance=new vL({context:this.context,value:e.resonance,units:"normalRange",param:this._dummyParam,swappable:!0}),cq(this,["resonance","delayTime"])}_audioWorkletName(){return Ez}static getDefaults(){return Object.assign(bL.getDefaults(),{delayTime:.1,resonance:.5})}onReady(t){CL(this.input,t,this.output);const e=t.parameters.get("delayTime");this.delayTime.setParam(e);const n=t.parameters.get("feedback");this.resonance.setParam(n)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.delayTime.dispose(),this.resonance.dispose(),this}},Oz.FeedbackCombFilter=Dz),Oz}var Iz,Mz,Pz=!1;function Fz(){return Pz||(Pz=!0,Iz={},SL(),vF(),OL(),Mz=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments,["frequency","type"])),this.name="OnePoleFilter";const e=pF(t.getDefaults(),arguments,["frequency","type"]);this._frequency=e.frequency,this._type=e.type,this.input=new AL({context:this.context}),this.output=new AL({context:this.context}),this._createFilter()}static getDefaults(){return Object.assign(bL.getDefaults(),{frequency:880,type:"lowpass"})}_createFilter(){const t=this._filter,e=this.toFrequency(this._frequency),n=1/(2*Math.PI*e);if("lowpass"===this._type){const t=1/(n*this.context.sampleRate),e=t-1;this._filter=this.context.createIIRFilter([t,0],[1,e])}else{const t=1/(n*this.context.sampleRate)-1;this._filter=this.context.createIIRFilter([1,-1],[1,t])}this.input.chain(this._filter,this.output),t&&this.context.setTimeout(()=>{this.disposed||(this.input.disconnect(t),t.disconnect())},this.blockTime)}get frequency(){return this._frequency}set frequency(t){this._frequency=t,this._createFilter()}get type(){return this._type}set type(t){this._type=t,this._createFilter()}getFrequencyResponse(t=128){const e=new Float32Array(t);for(let n=0;n<t;n++){const i=19980*Math.pow(n/t,2)+20;e[n]=i}const n=new Float32Array(t),i=new Float32Array(t);return this._filter.getFrequencyResponse(e,n,i),n}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this._filter.disconnect(),this}},Iz.OnePoleFilter=Mz),Iz}var qz,Lz,Vz=!1;function jz(){return Vz||(Vz=!0,qz={},SL(),vF(),Rz(),Fz(),Lz=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments,["delayTime","resonance","dampening"])),this.name="LowpassCombFilter";const e=pF(t.getDefaults(),arguments,["delayTime","resonance","dampening"]);this._combFilter=this.output=new Dz({context:this.context,delayTime:e.delayTime,resonance:e.resonance}),this.delayTime=this._combFilter.delayTime,this.resonance=this._combFilter.resonance,this._lowpass=this.input=new Mz({context:this.context,frequency:e.dampening,type:"lowpass"}),this._lowpass.connect(this._combFilter)}static getDefaults(){return Object.assign(bL.getDefaults(),{dampening:3e3,delayTime:.1,resonance:.5})}get dampening(){return this._lowpass.frequency}set dampening(t){this._lowpass.frequency=t}dispose(){return super.dispose(),this._combFilter.dispose(),this._lowpass.dispose(),this}},qz.LowpassCombFilter=Lz),qz}var Wz,Bz,Uz=!1;function zz(){return Uz||(Uz=!0,Wz={},jz(),vF(),vF(),xj(),nU(),Bz=class t extends tU{constructor(){super(pF(t.getDefaults(),arguments)),this.name="PluckSynth";const e=pF(t.getDefaults(),arguments);this._noise=new yj({context:this.context,type:"pink"}),this.attackNoise=e.attackNoise,this._lfcf=new Lz({context:this.context,dampening:e.dampening,resonance:e.resonance}),this.resonance=e.resonance,this.release=e.release,this._noise.connect(this._lfcf),this._lfcf.connect(this.output)}static getDefaults(){return hF(tU.getDefaults(),{attackNoise:1,dampening:4e3,resonance:.7,release:1})}get dampening(){return this._lfcf.dampening}set dampening(t){this._lfcf.dampening=t}triggerAttack(t,e){const n=this.toFrequency(t);e=this.toSeconds(e);const i=1/n;return this._lfcf.delayTime.setValueAtTime(i,e),this._noise.start(e),this._noise.stop(e+i*this.attackNoise),this._lfcf.resonance.cancelScheduledValues(e),this._lfcf.resonance.setValueAtTime(this.resonance,e),this}triggerRelease(t){return this._lfcf.resonance.linearRampTo(0,this.release,t),this}dispose(){return super.dispose(),this._noise.dispose(),this._lfcf.dispose(),this}},Wz.PluckSynth=Bz),Wz}var Qz,Hz,Gz=!1;function Yz(){return Gz||(Gz=!0,Qz={},ej(),vF(),jP(),nU(),fU(),kP(),Hz=class t extends tU{constructor(){super(pF(t.getDefaults(),arguments,["voice","options"])),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0;const e=pF(t.getDefaults(),arguments,["voice","options"]);CP(!MP(e.voice),"DEPRECATED: The polyphony count is no longer the first argument.");const n=e.voice.getDefaults();this.options=Object.assign(n,e.options),this.voice=e.voice,this.maxPolyphony=e.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();const i=this._voices.indexOf(this._dummyVoice);this._voices.splice(i,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(tU.getDefaults(),{maxPolyphony:32,options:{},voice:pU})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(t){this._availableVoices.push(t);const e=this._activeVoices.findIndex(e=>e.voice===t);this._activeVoices.splice(e,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){const t=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return t.connect(this.output),this._voices.push(t),t}AP("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(.95*this._averageActiveVoices,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){const t=this._availableVoices.shift(),e=this._voices.indexOf(t);this._voices.splice(e,1),this.context.isOffline||t.dispose()}}_triggerAttack(t,e,n){t.forEach(t=>{const i=new $V(this.context,t).toMidi(),r=this._getNextAvailableVoice();r&&(r.triggerAttack(t,e,n),this._activeVoices.push({midi:i,voice:r,released:!1}),this.log("triggerAttack",t,e))})}_triggerRelease(t,e){t.forEach(t=>{const n=new $V(this.context,t).toMidi(),i=this._activeVoices.find(({midi:t,released:e})=>t===n&&!e);i&&(i.voice.triggerRelease(e),i.released=!0,this.log("triggerRelease",t,e))})}_scheduleEvent(t,e,n,i){CP(!this.disposed,"Synth was already disposed"),n<=this.now()?"attack"===t?this._triggerAttack(e,n,i):this._triggerRelease(e,n):this.context.setTimeout(()=>{this._scheduleEvent(t,e,n,i)},n-this.now())}triggerAttack(t,e,n){Array.isArray(t)||(t=[t]);const i=this.toSeconds(e);return this._scheduleEvent("attack",t,i,n),this}triggerRelease(t,e){Array.isArray(t)||(t=[t]);const n=this.toSeconds(e);return this._scheduleEvent("release",t,n),this}triggerAttackRelease(t,e,n,i){const r=this.toSeconds(n);if(this.triggerAttack(t,r,i),qP(e)){CP(qP(t),"If the duration is an array, the notes must also be an array"),t=t;for(let n=0;n<t.length;n++){const i=e[Math.min(n,e.length-1)],s=this.toSeconds(i);CP(s>0,"The duration must be greater than 0"),this.triggerRelease(t[n],r+s)}}else{const n=this.toSeconds(e);CP(n>0,"The duration must be greater than 0"),this.triggerRelease(t,r+n)}return this}sync(){return this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1),this}set(t){const e=_F(t,["onsilence","context"]);return this.options=hF(this.options,e),this._voices.forEach(t=>t.set(e)),this._dummyVoice.set(e),this}get(){return this._dummyVoice.get()}releaseAll(t){const e=this.toSeconds(t);return this._activeVoices.forEach(({voice:t})=>{t.triggerRelease(e)}),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach(t=>t.dispose()),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}},Qz.PolySynth=Hz),Qz}var Xz,Kz,Zz=!1;function $z(){return Zz||(Zz=!0,Xz={},KV(),Vq(),eL(),vF(),hq(),jP(),nU(),mj(),GW(),kP(),Kz=class t extends tU{constructor(){super(pF(t.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;const e=pF(t.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),n={};Object.keys(e.urls).forEach(t=>{const i=parseInt(t,10);if(CP(VP(t)||MP(i)&&isFinite(i),"url key is neither a note or midi pitch: "+t),VP(t)){const i=new Kq(this.context,t).toMidi();n[i]=e.urls[t]}else MP(i)&&isFinite(i)&&(n[i]=e.urls[i])}),this._buffers=new YV({urls:n,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(tU.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:oq,onerror:oq,release:.1,urls:{}})}_findClosest(t){let e=0;for(;e<96;){if(this._buffers.has(t+e))return-e;if(this._buffers.has(t-e))return e;e++}throw new Error("No available buffers for note: "+t)}triggerAttack(t,e,n=1){return this.log("triggerAttack",t,e,n),Array.isArray(t)||(t=[t]),t.forEach(t=>{const i=qq(new Kq(this.context,t).toFrequency()),r=Math.round(i),s=i-r,o=this._findClosest(r),a=r-o,c=this._buffers.get(a),u=Iq(o+s),h=new _j({url:c,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:u}).connect(this.output);h.start(e,0,c.duration/u,n),qP(this._activeSources.get(r))||this._activeSources.set(r,[]),this._activeSources.get(r).push(h),h.onended=()=>{if(this._activeSources&&this._activeSources.has(r)){const t=this._activeSources.get(r),e=t.indexOf(h);-1!==e&&t.splice(e,1)}}}),this}triggerRelease(t,e){return this.log("triggerRelease",t,e),Array.isArray(t)||(t=[t]),t.forEach(t=>{const n=new Kq(this.context,t).toMidi();if(this._activeSources.has(n)&&this._activeSources.get(n).length){const t=this._activeSources.get(n);e=this.toSeconds(e),t.forEach(t=>{t.stop(e)}),this._activeSources.set(n,[])}}),this}releaseAll(t){const e=this.toSeconds(t);return this._activeSources.forEach(t=>{for(;t.length;)t.shift().stop(e)}),this}sync(){return this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1),this}triggerAttackRelease(t,e,n,i=1){const r=this.toSeconds(n);return this.triggerAttack(t,r,i),qP(e)?(CP(qP(t),"notes must be an array when duration is array"),t.forEach((t,n)=>{const i=e[Math.min(n,e.length-1)];this.triggerRelease(t,r+this.toSeconds(i))})):this.triggerRelease(t,r+this.toSeconds(e)),this}add(t,e,n){if(CP(VP(t)||isFinite(t),"note must be a pitch or midi: "+t),VP(t)){const i=new Kq(this.context,t).toMidi();this._buffers.add(i,e,n)}else this._buffers.add(t,e,n);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(t=>{t.forEach(t=>t.dispose())}),this._activeSources.clear(),this}},Xz.Sampler=Kz,m([HW(0)],Kz.prototype,"attack",void 0),m([HW(0)],Kz.prototype,"release",void 0)),Xz}var Jz,tQ=!1;function eQ(){return tQ||(tQ=!0,e(Jz={},CU()),e(Jz,BU()),e(Jz,HU()),e(Jz,ZU()),e(Jz,ez()),e(Jz,LU()),e(Jz,sz()),e(Jz,zz()),e(Jz,Yz()),e(Jz,$z()),e(Jz,fU())),Jz}var nQ,iQ,rQ=!1;function sQ(){return rQ||(rQ=!0,nQ={},DV(),hL(),dV(),vF(),hq(),fL(),jP(),iQ=class t extends cL{constructor(){super(pF(t.getDefaults(),arguments,["callback","value"])),this.name="ToneEvent",this._state=new pL("stopped"),this._startOffset=0;const e=pF(t.getDefaults(),arguments,["callback","value"]);this._loop=e.loop,this.callback=e.callback,this.value=e.value,this._loopStart=this.toTicks(e.loopStart),this._loopEnd=this.toTicks(e.loopEnd),this._playbackRate=e.playbackRate,this._probability=e.probability,this._humanize=e.humanize,this.mute=e.mute,this._playbackRate=e.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}static getDefaults(){return Object.assign(cL.getDefaults(),{callback:oq,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(t=-1){this._state.forEachFrom(t,t=>{let e;if("started"===t.state){-1!==t.id&&this.context.transport.clear(t.id);const n=t.time+Math.round(this.startOffset/this._playbackRate);if(!0===this._loop||MP(this._loop)&&this._loop>1){e=1/0,MP(this._loop)&&(e=this._loop*this._getLoopDuration());const i=this._state.getAfter(n);null!==i&&(e=Math.min(e,i.time-n)),e!==1/0&&(this._state.setStateAtTime("stopped",n+e+1,{id:-1}),e=new hV(this.context,e));const r=new hV(this.context,this._getLoopDuration());t.id=this.context.transport.scheduleRepeat(this._tick.bind(this),r,new hV(this.context,n),e)}else t.id=this.context.transport.schedule(this._tick.bind(this),new hV(this.context,n))}})}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(t){this._startOffset=t}get probability(){return this._probability}set probability(t){this._probability=t}get humanize(){return this._humanize}set humanize(t){this._humanize=t}start(t){const e=this.toTicks(t);return"stopped"===this._state.getValueAtTime(e)&&(this._state.add({id:-1,state:"started",time:e}),this._rescheduleEvents(e)),this}stop(t){this.cancel(t);const e=this.toTicks(t);if("started"===this._state.getValueAtTime(e)){this._state.setStateAtTime("stopped",e,{id:-1});const t=this._state.getBefore(e);let n=e;null!==t&&(n=t.time),this._rescheduleEvents(n)}return this}cancel(t){t=fF(t,-1/0);const e=this.toTicks(t);return this._state.forEachFrom(e,t=>{this.context.transport.clear(t.id)}),this._state.cancel(e),this}_tick(t){const e=this.context.transport.getTicksAtTime(t);if(!this.mute&&"started"===this._state.getValueAtTime(e)){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){let e=.02;FP(this.humanize)||(e=this.toSeconds(this.humanize)),t+=(2*Math.random()-1)*e}this.callback(t,this.value)}}_getLoopDuration(){return Math.round((this._loopEnd-this._loopStart)/this._playbackRate)}get loop(){return this._loop}set loop(t){this._loop=t,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._rescheduleEvents()}get loopEnd(){return new hV(this.context,this._loopEnd).toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t),this._loop&&this._rescheduleEvents()}get loopStart(){return new hV(this.context,this._loopStart).toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t),this._loop&&this._rescheduleEvents()}get progress(){if(this._loop){const t=this.context.transport.ticks,e=this._state.get(t);if(null!==e&&"started"===e.state){const n=this._getLoopDuration();return(t-e.time)%n/n}return 0}return 0}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}},nQ.ToneEvent=iQ),nQ}var oQ,aQ,cQ=!1;function uQ(){return cQ||(cQ=!0,oQ={},sQ(),hL(),vF(),hq(),aQ=class t extends cL{constructor(){super(pF(t.getDefaults(),arguments,["callback","interval"])),this.name="Loop";const e=pF(t.getDefaults(),arguments,["callback","interval"]);this._event=new iQ({context:this.context,callback:this._tick.bind(this),loop:!0,loopEnd:e.interval,playbackRate:e.playbackRate,probability:e.probability}),this.callback=e.callback,this.iterations=e.iterations}static getDefaults(){return Object.assign(cL.getDefaults(),{interval:"4n",callback:oq,playbackRate:1,iterations:1/0,probability:1,mute:!1,humanize:!1})}start(t){return this._event.start(t),this}stop(t){return this._event.stop(t),this}cancel(t){return this._event.cancel(t),this}_tick(t){this.callback(t)}get state(){return this._event.state}get progress(){return this._event.progress}get interval(){return this._event.loopEnd}set interval(t){this._event.loopEnd=t}get playbackRate(){return this._event.playbackRate}set playbackRate(t){this._event.playbackRate=t}get humanize(){return this._event.humanize}set humanize(t){this._event.humanize=t}get probability(){return this._event.probability}set probability(t){this._event.probability=t}get mute(){return this._event.mute}set mute(t){this._event.mute=t}get iterations(){return!0===this._event.loop?1/0:this._event.loop}set iterations(t){this._event.loop=t===1/0||t}dispose(){return super.dispose(),this._event.dispose(),this}},oQ.Loop=aQ),oQ}var hQ,lQ,pQ=!1;function dQ(){return pQ||(pQ=!0,hQ={},dV(),oL(),vF(),fL(),jP(),sQ(),lQ=class t extends iQ{constructor(){super(pF(t.getDefaults(),arguments,["callback","events"])),this.name="Part",this._state=new pL("stopped"),this._events=new Set;const e=pF(t.getDefaults(),arguments,["callback","events"]);this._state.increasing=!0,e.events.forEach(t=>{qP(t)?this.add(t[0],t[1]):this.add(t)})}static getDefaults(){return Object.assign(iQ.getDefaults(),{events:[]})}start(t,e){const n=this.toTicks(t);if("started"!==this._state.getValueAtTime(n)){e=fF(e,this._loop?this._loopStart:0),e=this._loop?fF(e,this._loopStart):fF(e,0);const t=this.toTicks(e);this._state.add({id:-1,offset:t,state:"started",time:n}),this._forEach(e=>{this._startNote(e,n,t)})}return this}_startNote(t,e,n){e-=n,this._loop?t.startOffset>=this._loopStart&&t.startOffset<this._loopEnd?(t.startOffset<n&&(e+=this._getLoopDuration()),t.start(new hV(this.context,e))):t.startOffset<this._loopStart&&t.startOffset>=n&&(t.loop=!1,t.start(new hV(this.context,e))):t.startOffset>=n&&t.start(new hV(this.context,e))}get startOffset(){return this._startOffset}set startOffset(t){this._startOffset=t,this._forEach(t=>{t.startOffset+=this._startOffset})}stop(t){const e=this.toTicks(t);return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this._forEach(e=>{e.stop(t)}),this}at(t,e){const n=new iL(this.context,t).toTicks(),i=new hV(this.context,1).toSeconds(),r=this._events.values();let s=r.next();for(;!s.done;){const t=s.value;if(Math.abs(n-t.startOffset)<i)return RP(e)&&(t.value=e),t;s=r.next()}return RP(e)?(this.add(t,e),this.at(t)):null}add(t,e){t instanceof Object&&Reflect.has(t,"time")&&(t=(e=t).time);const n=this.toTicks(t);let i;return e instanceof iQ?(i=e,i.callback=this._tick.bind(this)):i=new iQ({callback:this._tick.bind(this),context:this.context,value:e}),i.startOffset=n,i.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(i),this._restartEvent(i),this}_restartEvent(t){this._state.forEach(e=>{"started"===e.state?this._startNote(t,e.time,e.offset):t.stop(new hV(this.context,e.time))})}remove(t,e){return PP(t)&&t.hasOwnProperty("time")&&(t=(e=t).time),t=this.toTicks(t),this._events.forEach(n=>{n.startOffset===t&&(NP(e)||RP(e)&&n.value===e)&&(this._events.delete(n),n.dispose())}),this}clear(){return this._forEach(t=>t.dispose()),this._events.clear(),this}cancel(t){return this._forEach(e=>e.cancel(t)),this._state.cancel(this.toTicks(t)),this}_forEach(e){return this._events&&this._events.forEach(n=>{n instanceof t?n._forEach(e):e(n)}),this}_setAll(t,e){this._forEach(n=>{n[t]=e})}_tick(t,e){this.mute||this.callback(t,e)}_testLoopBoundries(t){this._loop&&(t.startOffset<this._loopStart||t.startOffset>=this._loopEnd)?t.cancel(0):"stopped"===t.state&&this._restartEvent(t)}get probability(){return this._probability}set probability(t){this._probability=t,this._setAll("probability",t)}get humanize(){return this._humanize}set humanize(t){this._humanize=t,this._setAll("humanize",t)}get loop(){return this._loop}set loop(t){this._loop=t,this._forEach(e=>{e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.loop=t,this._testLoopBoundries(e)})}get loopEnd(){return new hV(this.context,this._loopEnd).toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t),this._loop&&this._forEach(e=>{e.loopEnd=t,this._testLoopBoundries(e)})}get loopStart(){return new hV(this.context,this._loopStart).toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t),this._loop&&this._forEach(t=>{t.loopStart=this.loopStart,this._testLoopBoundries(t)})}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._setAll("playbackRate",t)}get length(){return this._events.size}dispose(){return super.dispose(),this.clear(),this}},hQ.Part=lQ),hQ}var fQ,_Q=!1;function*vQ(t){let e=0;for(;e<t.length;)e=yQ(e,t),yield t[e],e++}function*mQ(t){let e=t.length-1;for(;e>=0;)e=yQ(e,t),yield t[e],e--}function*gQ(t,e){for(;;)yield*e(t)}function yQ(t,e){return kF(t,0,e.length-1)}function*bQ(t,e){let n=e?0:t.length-1;for(;;)n=yQ(n,t),yield t[n],e?(n++,n>=t.length-1&&(e=!1)):(n--,n<=0&&(e=!0))}function*wQ(t){let e=0,n=0;for(;e<t.length;)e=yQ(e,t),yield t[e],n++,e+=n%2?2:-1}function*CQ(t){let e=t.length-1,n=0;for(;e>=0;)e=yQ(e,t),yield t[e],n++,e+=n%2?-2:1}function*xQ(t){const e=[];for(let n=0;n<t.length;n++)e.push(n);for(;e.length>0;){const n=yQ(e.splice(Math.floor(e.length*Math.random()),1)[0],t);yield t[n]}}function*TQ(t,e="up",n=0){switch(CP(t.length>0,"The array must have more than one value in it"),e){case"up":yield*gQ(t,vQ);case"down":yield*gQ(t,mQ);case"upDown":yield*bQ(t,!0);case"downUp":yield*bQ(t,!1);case"alternateUp":yield*gQ(t,wQ);case"alternateDown":yield*gQ(t,CQ);case"random":yield*function*(t){for(;;){const e=Math.floor(Math.random()*t.length);yield t[e]}}(t);case"randomOnce":yield*gQ(t,xQ);case"randomWalk":yield*function*(t){let e=Math.floor(Math.random()*t.length);for(;;)0===e?e++:e===t.length-1||Math.random()<.5?e--:e++,yield t[e]}(t)}}function SQ(){return _Q||(_Q=!0,fQ={},kP(),OF(),fQ.PatternGenerator=TQ),fQ}var EQ,AQ,kQ=!1;function OQ(){return kQ||(kQ=!0,EQ={},uQ(),SQ(),vF(),hq(),AQ=class t extends aQ{constructor(){super(pF(t.getDefaults(),arguments,["callback","values","pattern"])),this.name="Pattern";const e=pF(t.getDefaults(),arguments,["callback","values","pattern"]);this.callback=e.callback,this._values=e.values,this._pattern=TQ(e.values,e.pattern),this._type=e.pattern}static getDefaults(){return Object.assign(aQ.getDefaults(),{pattern:"up",values:[],callback:oq})}_tick(t){const e=this._pattern.next();this._value=e.value,this.callback(t,this._value)}get values(){return this._values}set values(t){this._values=t,this.pattern=this._type}get value(){return this._value}get pattern(){return this._type}set pattern(t){this._type=t,this._pattern=TQ(this._values,this._type)}},EQ.Pattern=AQ),EQ}var DQ,NQ,RQ=!1;function IQ(){return RQ||(RQ=!0,DQ={},dV(),vF(),jP(),dQ(),sQ(),NQ=class t extends iQ{constructor(){super(pF(t.getDefaults(),arguments,["callback","events","subdivision"])),this.name="Sequence",this._part=new lQ({callback:this._seqCallback.bind(this),context:this.context}),this._events=[],this._eventsArray=[];const e=pF(t.getDefaults(),arguments,["callback","events","subdivision"]);this._subdivision=this.toTicks(e.subdivision),this.events=e.events,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.playbackRate=e.playbackRate,this.probability=e.probability,this.humanize=e.humanize,this.mute=e.mute,this.playbackRate=e.playbackRate}static getDefaults(){return Object.assign(_F(iQ.getDefaults(),["value"]),{events:[],loop:!0,loopEnd:0,loopStart:0,subdivision:"8n"})}_seqCallback(t,e){null!==e&&this.callback(t,e)}get events(){return this._events}set events(t){this.clear(),this._eventsArray=t,this._events=this._createSequence(this._eventsArray),this._eventsUpdated()}start(t,e){return this._part.start(t,e?this._indexTime(e):e),this}stop(t){return this._part.stop(t),this}get subdivision(){return new hV(this.context,this._subdivision).toSeconds()}_createSequence(t){return new Proxy(t,{get:(t,e)=>t[e],set:(t,e,n)=>(LP(e)&&isFinite(parseInt(e,10))&&qP(n)?t[e]=this._createSequence(n):t[e]=n,this._eventsUpdated(),!0)})}_eventsUpdated(){this._part.clear(),this._rescheduleSequence(this._eventsArray,this._subdivision,this.startOffset),this.loopEnd=this.loopEnd}_rescheduleSequence(t,e,n){t.forEach((t,i)=>{const r=i*e+n;if(qP(t))this._rescheduleSequence(t,e/t.length,r);else{const e=new hV(this.context,r,"i").toSeconds();this._part.add(e,t)}})}_indexTime(t){return new hV(this.context,t*this._subdivision+this.startOffset).toSeconds()}clear(){return this._part.clear(),this}dispose(){return super.dispose(),this._part.dispose(),this}get loop(){return this._part.loop}set loop(t){this._part.loop=t}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this._part.loopStart=this._indexTime(t)}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this._part.loopEnd=0===t?this._indexTime(this._eventsArray.length):this._indexTime(t)}get startOffset(){return this._part.startOffset}set startOffset(t){this._part.startOffset=t}get playbackRate(){return this._part.playbackRate}set playbackRate(t){this._part.playbackRate=t}get probability(){return this._part.probability}set probability(t){this._part.probability=t}get progress(){return this._part.progress}get humanize(){return this._part.humanize}set humanize(t){this._part.humanize=t}get length(){return this._part.length}},DQ.Sequence=NQ),DQ}var MQ,PQ=!1;function FQ(){return PQ||(PQ=!0,e(MQ={},uQ()),e(MQ,dQ()),e(MQ,OQ()),e(MQ,IQ()),e(MQ,sQ())),MQ}var qQ,LQ,VQ=!1;function jQ(){return VQ||(VQ=!0,qQ={},OL(),SL(),vF(),hq(),vB(),BL(),LQ=class t extends bL{constructor(){super(Object.assign(pF(t.getDefaults(),arguments,["fade"]))),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new fB({context:this.context}),this.a=new AL({context:this.context,gain:0}),this.b=new AL({context:this.context,gain:0}),this.output=new AL({context:this.context}),this._internalChannels=[this.a,this.b];const e=pF(t.getDefaults(),arguments,["fade"]);this.fade=new VL({context:this.context,units:"normalRange",value:e.fade}),cq(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",xL(this._split,this.a.gain,0),xL(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(bL.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}},qQ.CrossFade=LQ),qQ}var WQ,BQ,UQ=!1;function zQ(){return UQ||(UQ=!0,WQ={},jQ(),OL(),SL(),hq(),BQ=class extends bL{constructor(t){super(t),this.name="Effect",this._dryWet=new LQ({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new AL({context:this.context}),this.effectReturn=new AL({context:this.context}),this.input=new AL({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(t.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],cq(this,"wet")}static getDefaults(){return Object.assign(bL.getDefaults(),{wet:1})}connectEffect(t){return this._internalChannels.push(t),this.effectSend.chain(t,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}},WQ.Effect=BQ),WQ}var QQ,HQ,GQ=!1;function YQ(){return GQ||(GQ=!0,QQ={},zQ(),BW(),hq(),HQ=class extends BQ{constructor(t){super(t),this.name="LFOEffect",this._lfo=new jW({context:this.context,frequency:t.frequency,amplitude:t.depth}),this.depth=this._lfo.amplitude,this.frequency=this._lfo.frequency,this.type=t.type,cq(this,["frequency","depth"])}static getDefaults(){return Object.assign(BQ.getDefaults(),{frequency:1,type:"sine",depth:1})}start(t){return this._lfo.start(t),this}stop(t){return this._lfo.stop(t),this}sync(){return this._lfo.sync(),this}unsync(){return this._lfo.unsync(),this}get type(){return this._lfo.type}set type(t){this._lfo.type=t}dispose(){return super.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}},QQ.LFOEffect=HQ),QQ}var XQ,KQ,ZQ=!1;function $Q(){return ZQ||(ZQ=!0,XQ={},DU(),vF(),YQ(),KQ=class t extends HQ{constructor(){super(pF(t.getDefaults(),arguments,["frequency","baseFrequency","octaves"])),this.name="AutoFilter";const e=pF(t.getDefaults(),arguments,["frequency","baseFrequency","octaves"]);this.filter=new kU(Object.assign(e.filter,{context:this.context})),this.connectEffect(this.filter),this._lfo.connect(this.filter.frequency),this.octaves=e.octaves,this.baseFrequency=e.baseFrequency}static getDefaults(){return Object.assign(HQ.getDefaults(),{baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}})}get baseFrequency(){return this._lfo.min}set baseFrequency(t){this._lfo.min=this.toFrequency(t),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(t){this._octaves=t,this._lfo.max=this._lfo.min*Math.pow(2,t)}dispose(){return super.dispose(),this.filter.dispose(),this}},XQ.AutoFilter=KQ),XQ}var JQ,tH,eH=!1;function nH(){return eH||(eH=!0,JQ={},gL(),SL(),vF(),hq(),tH=class t extends bL{constructor(){super(Object.assign(pF(t.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;const e=pF(t.getDefaults(),arguments,["pan"]);this.pan=new vL({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",cq(this,"pan")}static getDefaults(){return Object.assign(bL.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}},JQ.Panner=tH),JQ}var iH,rH,sH=!1;function oH(){return sH||(sH=!0,iH={},nH(),vF(),YQ(),rH=class t extends HQ{constructor(){super(pF(t.getDefaults(),arguments,["frequency"])),this.name="AutoPanner";const e=pF(t.getDefaults(),arguments,["frequency"]);this._panner=new tH({context:this.context,channelCount:e.channelCount}),this.connectEffect(this._panner),this._lfo.connect(this._panner.pan),this._lfo.min=-1,this._lfo.max=1}static getDefaults(){return Object.assign(HQ.getDefaults(),{channelCount:1})}dispose(){return super.dispose(),this._panner.dispose(),this}},iH.AutoPanner=rH),iH}var aH,cH,uH=!1;function hH(){return uH||(uH=!0,aH={},SL(),vF(),Fz(),pB(),cH=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments,["smoothing"])),this.name="Follower";const e=pF(t.getDefaults(),arguments,["smoothing"]);this._abs=this.input=new hB({context:this.context}),this._lowpass=this.output=new Mz({context:this.context,frequency:1/this.toSeconds(e.smoothing),type:"lowpass"}),this._abs.connect(this._lowpass),this._smoothing=e.smoothing}static getDefaults(){return Object.assign(bL.getDefaults(),{smoothing:.05})}get smoothing(){return this._smoothing}set smoothing(t){this._smoothing=t,this._lowpass.frequency=1/this.toSeconds(this.smoothing)}dispose(){return super.dispose(),this._abs.dispose(),this._lowpass.dispose(),this}},aH.Follower=cH),aH}var lH,pH,dH=!1;function fH(){return dH||(dH=!0,lH={},zQ(),DU(),hH(),vF(),OL(),Vq(),jB(),hq(),pH=class t extends BQ{constructor(){super(pF(t.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"])),this.name="AutoWah";const e=pF(t.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"]);this._follower=new cH({context:this.context,smoothing:e.follower}),this._sweepRange=new LB({context:this.context,min:0,max:1,exponent:.5}),this._baseFrequency=this.toFrequency(e.baseFrequency),this._octaves=e.octaves,this._inputBoost=new AL({context:this.context}),this._bandpass=new kU({context:this.context,rolloff:-48,frequency:0,Q:e.Q}),this._peaking=new kU({context:this.context,type:"peaking"}),this._peaking.gain.value=e.gain,this.gain=this._peaking.gain,this.Q=this._bandpass.Q,this.effectSend.chain(this._inputBoost,this._follower,this._sweepRange),this._sweepRange.connect(this._bandpass.frequency),this._sweepRange.connect(this._peaking.frequency),this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn),this._setSweepRange(),this.sensitivity=e.sensitivity,cq(this,["gain","Q"])}static getDefaults(){return Object.assign(BQ.getDefaults(),{baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:.2})}get octaves(){return this._octaves}set octaves(t){this._octaves=t,this._setSweepRange()}get follower(){return this._follower.smoothing}set follower(t){this._follower.smoothing=t}get baseFrequency(){return this._baseFrequency}set baseFrequency(t){this._baseFrequency=this.toFrequency(t),this._setSweepRange()}get sensitivity(){return Rq(1/this._inputBoost.gain.value)}set sensitivity(t){this._inputBoost.gain.value=1/Nq(t)}_setSweepRange(){this._sweepRange.min=this._baseFrequency,this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)}dispose(){return super.dispose(),this._follower.dispose(),this._sweepRange.dispose(),this._bandpass.dispose(),this._peaking.dispose(),this._inputBoost.dispose(),this}},lH.AutoWah=pH),lH}var _H,vH,mH,gH=!1;function yH(){return gH||(gH=!0,_H={},Cz(),pz(),vH="bit-crusher",_H.workletName=vH,mH="\n\tclass BitCrusherWorklet extends SingleIOProcessor {\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: \"bits\",\n\t\t\t\tdefaultValue: 12,\n\t\t\t\tminValue: 1,\n\t\t\t\tmaxValue: 16,\n\t\t\t\tautomationRate: 'k-rate'\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, _channel, parameters) {\n\t\t\tconst step = Math.pow(0.5, parameters.bits - 1);\n\t\t\tconst val = step * Math.floor(input / step + 0.5);\n\t\t\treturn val;\n\t\t}\n\t}\n",_H.bitCrusherWorklet=mH,hz(vH,mH)),_H}var bH,wH,CH,xH=!1;function TH(){return xH||(xH=!0,bH={},vz(),zQ(),OL(),vF(),SL(),gL(),yH(),wH=class t extends BQ{constructor(){super(pF(t.getDefaults(),arguments,["bits"])),this.name="BitCrusher";const e=pF(t.getDefaults(),arguments,["bits"]);this._bitCrusherWorklet=new CH({context:this.context,bits:e.bits}),this.connectEffect(this._bitCrusherWorklet),this.bits=this._bitCrusherWorklet.bits}static getDefaults(){return Object.assign(BQ.getDefaults(),{bits:4})}dispose(){return super.dispose(),this._bitCrusherWorklet.dispose(),this}},bH.BitCrusher=wH,CH=class t extends fz{constructor(){super(pF(t.getDefaults(),arguments)),this.name="BitCrusherWorklet";const e=pF(t.getDefaults(),arguments);this.input=new AL({context:this.context}),this.output=new AL({context:this.context}),this.bits=new vL({context:this.context,value:e.bits,units:"positive",minValue:1,maxValue:16,param:this._dummyParam,swappable:!0})}static getDefaults(){return Object.assign(fz.getDefaults(),{bits:12})}_audioWorkletName(){return vH}onReady(t){CL(this.input,t,this.output);const e=t.parameters.get("bits");this.bits.setParam(e)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.bits.dispose(),this}}),bH}var SH,EH,AH=!1;function kH(){return AH||(AH=!0,SH={},zQ(),vF(),Gj(),EH=class t extends BQ{constructor(){super(pF(t.getDefaults(),arguments,["order"])),this.name="Chebyshev";const e=pF(t.getDefaults(),arguments,["order"]);this._shaper=new Qj({context:this.context,length:4096}),this._order=e.order,this.connectEffect(this._shaper),this.order=e.order,this.oversample=e.oversample}static getDefaults(){return Object.assign(BQ.getDefaults(),{order:1,oversample:"none"})}_getCoefficient(t,e,n){return n.has(e)||(0===e?n.set(e,0):1===e?n.set(e,t):n.set(e,2*t*this._getCoefficient(t,e-1,n)-this._getCoefficient(t,e-2,n))),n.get(e)}get order(){return this._order}set order(t){this._order=t,this._shaper.setMap(e=>this._getCoefficient(e,t,new Map))}get oversample(){return this._shaper.oversample}set oversample(t){this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.dispose(),this}},SH.Chebyshev=EH),SH}var OH,DH,NH=!1;function RH(){return NH||(NH=!0,OH={},SL(),vF(),DH=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments,["channels"])),this.name="Split";const e=pF(t.getDefaults(),arguments,["channels"]);this._splitter=this.input=this.output=this.context.createChannelSplitter(e.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(bL.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}},OH.Split=DH),OH}var IH,MH,PH=!1;function FH(){return PH||(PH=!0,IH={},SL(),vF(),MH=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments,["channels"])),this.name="Merge";const e=pF(t.getDefaults(),arguments,["channels"]);this._merger=this.output=this.input=this.context.createChannelMerger(e.channels)}static getDefaults(){return Object.assign(bL.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}},IH.Merge=MH),IH}var qH,LH,VH=!1;function jH(){return VH||(VH=!0,qH={},SL(),jQ(),RH(),OL(),FH(),hq(),LH=class extends bL{constructor(t){super(t),this.name="StereoEffect",this.input=new AL({context:this.context}),this.input.channelCount=2,this.input.channelCountMode="explicit",this._dryWet=this.output=new LQ({context:this.context,fade:t.wet}),this.wet=this._dryWet.fade,this._split=new DH({context:this.context,channels:2}),this._merge=new MH({context:this.context,channels:2}),this.input.connect(this._split),this.input.connect(this._dryWet.a),this._merge.connect(this._dryWet.b),cq(this,["wet"])}connectEffectLeft(...t){this._split.connect(t[0],0,0),CL(...t),xL(t[t.length-1],this._merge,0,0)}connectEffectRight(...t){this._split.connect(t[0],1,0),CL(...t),xL(t[t.length-1],this._merge,0,1)}static getDefaults(){return Object.assign(bL.getDefaults(),{wet:1})}dispose(){return super.dispose(),this._dryWet.dispose(),this._split.dispose(),this._merge.dispose(),this}},qH.StereoEffect=LH),qH}var WH,BH,UH=!1;function zH(){return UH||(UH=!0,WH={},jH(),BL(),OL(),hq(),RH(),FH(),BH=class extends LH{constructor(t){super(t),this.feedback=new VL({context:this.context,value:t.feedback,units:"normalRange"}),this._feedbackL=new AL({context:this.context}),this._feedbackR=new AL({context:this.context}),this._feedbackSplit=new DH({context:this.context,channels:2}),this._feedbackMerge=new MH({context:this.context,channels:2}),this._merge.connect(this._feedbackSplit),this._feedbackMerge.connect(this._split),this._feedbackSplit.connect(this._feedbackL,0,0),this._feedbackL.connect(this._feedbackMerge,0,0),this._feedbackSplit.connect(this._feedbackR,1,0),this._feedbackR.connect(this._feedbackMerge,0,1),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),cq(this,["feedback"])}static getDefaults(){return Object.assign(LH.getDefaults(),{feedback:.5})}dispose(){return super.dispose(),this.feedback.dispose(),this._feedbackL.dispose(),this._feedbackR.dispose(),this._feedbackSplit.dispose(),this._feedbackMerge.dispose(),this}},WH.StereoFeedbackEffect=BH),WH}var QH,HH,GH=!1;function YH(){return GH||(GH=!0,QH={},zH(),vF(),BW(),MV(),hq(),HH=class t extends BH{constructor(){super(pF(t.getDefaults(),arguments,["frequency","delayTime","depth"])),this.name="Chorus";const e=pF(t.getDefaults(),arguments,["frequency","delayTime","depth"]);this._depth=e.depth,this._delayTime=e.delayTime/1e3,this._lfoL=new jW({context:this.context,frequency:e.frequency,min:0,max:1}),this._lfoR=new jW({context:this.context,frequency:e.frequency,min:0,max:1,phase:180}),this._delayNodeL=new RV({context:this.context}),this._delayNodeR=new RV({context:this.context}),this.frequency=this._lfoL.frequency,cq(this,["frequency"]),this._lfoL.frequency.connect(this._lfoR.frequency),this.connectEffectLeft(this._delayNodeL),this.connectEffectRight(this._delayNodeR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this.depth=this._depth,this.type=e.type,this.spread=e.spread}static getDefaults(){return Object.assign(BH.getDefaults(),{frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180,feedback:0,wet:.5})}get depth(){return this._depth}set depth(t){this._depth=t;const e=this._delayTime*t;this._lfoL.min=Math.max(this._delayTime-e,0),this._lfoL.max=this._delayTime+e,this._lfoR.min=Math.max(this._delayTime-e,0),this._lfoR.max=this._delayTime+e}get delayTime(){return 1e3*this._delayTime}set delayTime(t){this._delayTime=t/1e3,this.depth=this._depth}get type(){return this._lfoL.type}set type(t){this._lfoL.type=t,this._lfoR.type=t}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(t){this._lfoL.phase=90-t/2,this._lfoR.phase=t/2+90}start(t){return this._lfoL.start(t),this._lfoR.start(t),this}stop(t){return this._lfoL.stop(t),this._lfoR.stop(t),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._delayNodeL.dispose(),this._delayNodeR.dispose(),this.frequency.dispose(),this}},QH.Chorus=HH),QH}var XH,KH,ZH=!1;function $H(){return ZH||(ZH=!0,XH={},vF(),Gj(),zQ(),KH=class t extends BQ{constructor(){super(pF(t.getDefaults(),arguments,["distortion"])),this.name="Distortion";const e=pF(t.getDefaults(),arguments,["distortion"]);this._shaper=new Qj({context:this.context,length:4096}),this._distortion=e.distortion,this.connectEffect(this._shaper),this.distortion=e.distortion,this.oversample=e.oversample}static getDefaults(){return Object.assign(BQ.getDefaults(),{distortion:.4,oversample:"none"})}get distortion(){return this._distortion}set distortion(t){this._distortion=t;const e=100*t,n=Math.PI/180;this._shaper.setMap(t=>Math.abs(t)<.001?0:(3+e)*t*20*n/(Math.PI+e*Math.abs(t)))}get oversample(){return this._shaper.oversample}set oversample(t){this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.dispose(),this}},XH.Distortion=KH),XH}var JH,tG,eG=!1;function nG(){return eG||(eG=!0,JH={},OL(),hq(),zQ(),tG=class extends BQ{constructor(t){super(t),this.name="FeedbackEffect",this._feedbackGain=new AL({context:this.context,gain:t.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,cq(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(BQ.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}},JH.FeedbackEffect=tG),JH}var iG,rG,sG=!1;function oG(){return sG||(sG=!0,iG={},MV(),vF(),hq(),nG(),rG=class t extends tG{constructor(){super(pF(t.getDefaults(),arguments,["delayTime","feedback"])),this.name="FeedbackDelay";const e=pF(t.getDefaults(),arguments,["delayTime","feedback"]);this._delayNode=new RV({context:this.context,delayTime:e.delayTime,maxDelay:e.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),cq(this,"delayTime")}static getDefaults(){return Object.assign(tG.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}},iG.FeedbackDelay=rG),iG}var aG,cG,uG=!1;function hG(){return uG||(uG=!0,aG={},OL(),SL(),cG=class extends bL{constructor(t){super(t),this.name="PhaseShiftAllpass",this.input=new AL({context:this.context}),this.output=new AL({context:this.context}),this.offset90=new AL({context:this.context}),this._bank0=this._createAllPassFilterBank([.6923878,.9360654322959,.988229522686,.9987488452737]),this._bank1=this._createAllPassFilterBank([.4021921162426,.856171088242,.9722909545651,.9952884791278]),this._oneSampleDelay=this.context.createIIRFilter([0,1],[1,0]),CL(this.input,...this._bank0,this._oneSampleDelay,this.output),CL(this.input,...this._bank1,this.offset90)}_createAllPassFilterBank(t){return t.map(t=>{const e=[[t*t,0,-1],[1,0,-t*t]];return this.context.createIIRFilter(e[0],e[1])})}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.offset90.dispose(),this._bank0.forEach(t=>t.disconnect()),this._bank1.forEach(t=>t.disconnect()),this._oneSampleDelay.disconnect(),this}},aG.PhaseShiftAllpass=cG),aG}var lG,pG,dG=!1;function fG(){return dG||(dG=!0,lG={},hG(),vF(),zQ(),DW(),eW(),bB(),BL(),Vj(),Pj(),pG=class t extends BQ{constructor(){super(pF(t.getDefaults(),arguments,["frequency"])),this.name="FrequencyShifter";const e=pF(t.getDefaults(),arguments,["frequency"]);this.frequency=new VL({context:this.context,units:"frequency",value:e.frequency,minValue:-this.context.sampleRate/2,maxValue:this.context.sampleRate/2}),this._sine=new Ij({context:this.context,type:"sine"}),this._cosine=new qj({context:this.context,phase:-90,type:"sine"}),this._sineMultiply=new Jj({context:this.context}),this._cosineMultiply=new Jj({context:this.context}),this._negate=new gB({context:this.context}),this._add=new kW({context:this.context}),this._phaseShifter=new cG({context:this.context}),this.effectSend.connect(this._phaseShifter),this.frequency.fan(this._sine.frequency,this._cosine.frequency),this._phaseShifter.offset90.connect(this._cosineMultiply),this._cosine.connect(this._cosineMultiply.factor),this._phaseShifter.connect(this._sineMultiply),this._sine.connect(this._sineMultiply.factor),this._sineMultiply.connect(this._negate),this._cosineMultiply.connect(this._add),this._negate.connect(this._add.addend),this._add.connect(this.effectReturn);const n=this.immediate();this._sine.start(n),this._cosine.start(n)}static getDefaults(){return Object.assign(BQ.getDefaults(),{frequency:0})}dispose(){return super.dispose(),this.frequency.dispose(),this._add.dispose(),this._cosine.dispose(),this._cosineMultiply.dispose(),this._negate.dispose(),this._phaseShifter.dispose(),this._sine.dispose(),this._sineMultiply.dispose(),this}},lG.FrequencyShifter=pG),lG}var _G,vG,mG,gG,yG=!1;function bG(){return yG||(yG=!0,_G={},jH(),vF(),hq(),BL(),jz(),vG=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100],mG=[225,556,441,341],gG=class t extends LH{constructor(){super(pF(t.getDefaults(),arguments,["roomSize","dampening"])),this.name="Freeverb",this._combFilters=[],this._allpassFiltersL=[],this._allpassFiltersR=[];const e=pF(t.getDefaults(),arguments,["roomSize","dampening"]);this.roomSize=new VL({context:this.context,value:e.roomSize,units:"normalRange"}),this._allpassFiltersL=mG.map(t=>{const e=this.context.createBiquadFilter();return e.type="allpass",e.frequency.value=t,e}),this._allpassFiltersR=mG.map(t=>{const e=this.context.createBiquadFilter();return e.type="allpass",e.frequency.value=t,e}),this._combFilters=vG.map((t,n)=>{const i=new Lz({context:this.context,dampening:e.dampening,delayTime:t});return n<vG.length/2?this.connectEffectLeft(i,...this._allpassFiltersL):this.connectEffectRight(i,...this._allpassFiltersR),this.roomSize.connect(i.resonance),i}),cq(this,["roomSize"])}static getDefaults(){return Object.assign(LH.getDefaults(),{roomSize:.7,dampening:3e3})}get dampening(){return this._combFilters[0].dampening}set dampening(t){this._combFilters.forEach(e=>e.dampening=t)}dispose(){return super.dispose(),this._allpassFiltersL.forEach(t=>t.disconnect()),this._allpassFiltersR.forEach(t=>t.disconnect()),this._combFilters.forEach(t=>t.dispose()),this.roomSize.dispose(),this}},_G.Freeverb=gG),_G}var wG,CG,xG,TG,SG,EG=!1;function AG(){return EG||(EG=!0,wG={},jH(),vF(),MW(),BL(),Rz(),hq(),CG=[.06748,.06404,.08212,.09004],xG=[.773,.802,.753,.733],TG=[347,113,37],SG=class t extends LH{constructor(){super(pF(t.getDefaults(),arguments,["roomSize"])),this.name="JCReverb",this._allpassFilters=[],this._feedbackCombFilters=[];const e=pF(t.getDefaults(),arguments,["roomSize"]);this.roomSize=new VL({context:this.context,value:e.roomSize,units:"normalRange"}),this._scaleRoomSize=new RW({context:this.context,min:-.733,max:.197}),this._allpassFilters=TG.map(t=>{const e=this.context.createBiquadFilter();return e.type="allpass",e.frequency.value=t,e}),this._feedbackCombFilters=CG.map((t,e)=>{const n=new Dz({context:this.context,delayTime:t});return this._scaleRoomSize.connect(n.resonance),n.resonance.value=xG[e],e<CG.length/2?this.connectEffectLeft(...this._allpassFilters,n):this.connectEffectRight(...this._allpassFilters,n),n}),this.roomSize.connect(this._scaleRoomSize),cq(this,["roomSize"])}static getDefaults(){return Object.assign(LH.getDefaults(),{roomSize:.5})}dispose(){return super.dispose(),this._allpassFilters.forEach(t=>t.disconnect()),this._feedbackCombFilters.forEach(t=>t.dispose()),this.roomSize.dispose(),this._scaleRoomSize.dispose(),this}},wG.JCReverb=SG),wG}var kG,OG,DG=!1;function NG(){return DG||(DG=!0,kG={},zH(),hq(),OG=class extends BH{constructor(t){super(t),this._feedbackL.disconnect(),this._feedbackL.connect(this._feedbackMerge,0,1),this._feedbackR.disconnect(),this._feedbackR.connect(this._feedbackMerge,0,0),cq(this,["feedback"])}},kG.StereoXFeedbackEffect=OG),kG}var RG,IG,MG=!1;function PG(){return MG||(MG=!0,RG={},NG(),vF(),MV(),BL(),hq(),IG=class t extends OG{constructor(){super(pF(t.getDefaults(),arguments,["delayTime","feedback"])),this.name="PingPongDelay";const e=pF(t.getDefaults(),arguments,["delayTime","feedback"]);this._leftDelay=new RV({context:this.context,maxDelay:e.maxDelay}),this._rightDelay=new RV({context:this.context,maxDelay:e.maxDelay}),this._rightPreDelay=new RV({context:this.context,maxDelay:e.maxDelay}),this.delayTime=new VL({context:this.context,units:"time",value:e.delayTime}),this.connectEffectLeft(this._leftDelay),this.connectEffectRight(this._rightPreDelay,this._rightDelay),this.delayTime.fan(this._leftDelay.delayTime,this._rightDelay.delayTime,this._rightPreDelay.delayTime),this._feedbackL.disconnect(),this._feedbackL.connect(this._rightDelay),cq(this,["delayTime"])}static getDefaults(){return Object.assign(OG.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._leftDelay.dispose(),this._rightDelay.dispose(),this._rightPreDelay.dispose(),this.delayTime.dispose(),this}},RG.PingPongDelay=IG),RG}var FG,qG,LG=!1;function VG(){return LG||(LG=!0,FG={},nG(),vF(),BW(),MV(),jQ(),BL(),hq(),Vq(),qG=class t extends tG{constructor(){super(pF(t.getDefaults(),arguments,["pitch"])),this.name="PitchShift";const e=pF(t.getDefaults(),arguments,["pitch"]);this._frequency=new VL({context:this.context}),this._delayA=new RV({maxDelay:1,context:this.context}),this._lfoA=new jW({context:this.context,min:0,max:.1,type:"sawtooth"}).connect(this._delayA.delayTime),this._delayB=new RV({maxDelay:1,context:this.context}),this._lfoB=new jW({context:this.context,min:0,max:.1,type:"sawtooth",phase:180}).connect(this._delayB.delayTime),this._crossFade=new LQ({context:this.context}),this._crossFadeLFO=new jW({context:this.context,min:0,max:1,type:"triangle",phase:90}).connect(this._crossFade.fade),this._feedbackDelay=new RV({delayTime:e.delayTime,context:this.context}),this.delayTime=this._feedbackDelay.delayTime,cq(this,"delayTime"),this._pitch=e.pitch,this._windowSize=e.windowSize,this._delayA.connect(this._crossFade.a),this._delayB.connect(this._crossFade.b),this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency),this.effectSend.fan(this._delayA,this._delayB),this._crossFade.chain(this._feedbackDelay,this.effectReturn);const n=this.now();this._lfoA.start(n),this._lfoB.start(n),this._crossFadeLFO.start(n),this.windowSize=this._windowSize}static getDefaults(){return Object.assign(tG.getDefaults(),{pitch:0,windowSize:.1,delayTime:0,feedback:0})}get pitch(){return this._pitch}set pitch(t){this._pitch=t;let e=0;t<0?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,e=Iq(t-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,e=Iq(t)-1),this._frequency.value=e*(1.2/this._windowSize)}get windowSize(){return this._windowSize}set windowSize(t){this._windowSize=this.toSeconds(t),this.pitch=this._pitch}dispose(){return super.dispose(),this._frequency.dispose(),this._delayA.dispose(),this._delayB.dispose(),this._lfoA.dispose(),this._lfoB.dispose(),this._crossFade.dispose(),this._crossFadeLFO.dispose(),this._feedbackDelay.dispose(),this}},FG.PitchShift=qG),FG}var jG,WG,BG=!1;function UG(){return BG||(BG=!0,jG={},jH(),vF(),BW(),BL(),hq(),WG=class t extends LH{constructor(){super(pF(t.getDefaults(),arguments,["frequency","octaves","baseFrequency"])),this.name="Phaser";const e=pF(t.getDefaults(),arguments,["frequency","octaves","baseFrequency"]);this._lfoL=new jW({context:this.context,frequency:e.frequency,min:0,max:1}),this._lfoR=new jW({context:this.context,frequency:e.frequency,min:0,max:1,phase:180}),this._baseFrequency=this.toFrequency(e.baseFrequency),this._octaves=e.octaves,this.Q=new VL({context:this.context,value:e.Q,units:"positive"}),this._filtersL=this._makeFilters(e.stages,this._lfoL),this._filtersR=this._makeFilters(e.stages,this._lfoR),this.frequency=this._lfoL.frequency,this.frequency.value=e.frequency,this.connectEffectLeft(...this._filtersL),this.connectEffectRight(...this._filtersR),this._lfoL.frequency.connect(this._lfoR.frequency),this.baseFrequency=e.baseFrequency,this.octaves=e.octaves,this._lfoL.start(),this._lfoR.start(),cq(this,["frequency","Q"])}static getDefaults(){return Object.assign(LH.getDefaults(),{frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350})}_makeFilters(t,e){const n=[];for(let i=0;i<t;i++){const t=this.context.createBiquadFilter();t.type="allpass",this.Q.connect(t.Q),e.connect(t.frequency),n.push(t)}return n}get octaves(){return this._octaves}set octaves(t){this._octaves=t;const e=this._baseFrequency*Math.pow(2,t);this._lfoL.max=e,this._lfoR.max=e}get baseFrequency(){return this._baseFrequency}set baseFrequency(t){this._baseFrequency=this.toFrequency(t),this._lfoL.min=this._baseFrequency,this._lfoR.min=this._baseFrequency,this.octaves=this._octaves}dispose(){return super.dispose(),this.Q.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._filtersL.forEach(t=>t.disconnect()),this._filtersR.forEach(t=>t.disconnect()),this.frequency.dispose(),this}},jG.Phaser=WG),jG}var zG,QG,HG=!1;function GG(){return HG||(HG=!0,zG={},FH(),OL(),vF(),xj(),zQ(),gq(),hq(),kP(),QG=class t extends BQ{constructor(){super(pF(t.getDefaults(),arguments,["decay"])),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();const e=pF(t.getDefaults(),arguments,["decay"]);this._decay=e.decay,this._preDelay=e.preDelay,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(BQ.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(t){xP(t=this.toSeconds(t),.001),this._decay=t,this.generate()}get preDelay(){return this._preDelay}set preDelay(t){xP(t=this.toSeconds(t),0),this._preDelay=t,this.generate()}generate(){return g(this,void 0,void 0,(function*(){const t=this.ready,e=new vq(2,this._decay+this._preDelay,this.context.sampleRate),n=new yj({context:e}),i=new yj({context:e}),r=new MH({context:e});n.connect(r,0,0),i.connect(r,0,1);const s=new AL({context:e}).toDestination();r.connect(s),n.start(0),i.start(0),s.gain.setValueAtTime(0,0),s.gain.setValueAtTime(1,this._preDelay),s.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const o=e.render();return this.ready=o.then(oq),yield t,this._convolver.buffer=(yield o).get(),this}))}dispose(){return super.dispose(),this._convolver.disconnect(),this}},zG.Reverb=QG),zG}var YG,XG,KG=!1;function ZG(){return KG||(KG=!0,YG={},SL(),RH(),DW(),eW(),TB(),vF(),XG=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments)),this.name="MidSideSplit",this._split=this.input=new DH({channels:2,context:this.context}),this._midAdd=new kW({context:this.context}),this.mid=new Jj({context:this.context,value:Math.SQRT1_2}),this._sideSubtract=new CB({context:this.context}),this.side=new Jj({context:this.context,value:Math.SQRT1_2}),this._split.connect(this._midAdd,0),this._split.connect(this._midAdd.addend,1),this._split.connect(this._sideSubtract,0),this._split.connect(this._sideSubtract.subtrahend,1),this._midAdd.connect(this.mid),this._sideSubtract.connect(this.side)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midAdd.dispose(),this._sideSubtract.dispose(),this._split.dispose(),this}},YG.MidSideSplit=XG),YG}var $G,JG,tY=!1;function eY(){return tY||(tY=!0,$G={},SL(),FH(),DW(),eW(),TB(),OL(),vF(),JG=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments)),this.name="MidSideMerge",this.mid=new AL({context:this.context}),this.side=new AL({context:this.context}),this._left=new kW({context:this.context}),this._leftMult=new Jj({context:this.context,value:Math.SQRT1_2}),this._right=new CB({context:this.context}),this._rightMult=new Jj({context:this.context,value:Math.SQRT1_2}),this._merge=this.output=new MH({context:this.context}),this.mid.fan(this._left),this.side.connect(this._left.addend),this.mid.connect(this._right),this.side.connect(this._right.subtrahend),this._left.connect(this._leftMult),this._right.connect(this._rightMult),this._leftMult.connect(this._merge,0,0),this._rightMult.connect(this._merge,0,1)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._leftMult.dispose(),this._rightMult.dispose(),this._left.dispose(),this._right.dispose(),this}},$G.MidSideMerge=JG),$G}var nY,iY,rY=!1;function sY(){return rY||(rY=!0,nY={},zQ(),ZG(),eY(),iY=class extends BQ{constructor(t){super(t),this.name="MidSideEffect",this._midSideMerge=new JG({context:this.context}),this._midSideSplit=new XG({context:this.context}),this._midSend=this._midSideSplit.mid,this._sideSend=this._midSideSplit.side,this._midReturn=this._midSideMerge.mid,this._sideReturn=this._midSideMerge.side,this.effectSend.connect(this._midSideSplit),this._midSideMerge.connect(this.effectReturn)}connectEffectMid(...t){this._midSend.chain(...t,this._midReturn)}connectEffectSide(...t){this._sideSend.chain(...t,this._sideReturn)}dispose(){return super.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this._midSend.dispose(),this._sideSend.dispose(),this._midReturn.dispose(),this._sideReturn.dispose(),this}},nY.MidSideEffect=iY),nY}var oY,aY,cY=!1;function uY(){return cY||(cY=!0,oY={},sY(),BL(),eW(),TB(),vF(),hq(),SL(),aY=class t extends iY{constructor(){super(pF(t.getDefaults(),arguments,["width"])),this.name="StereoWidener";const e=pF(t.getDefaults(),arguments,["width"]);this.width=new VL({context:this.context,value:e.width,units:"normalRange"}),cq(this,["width"]),this._twoTimesWidthMid=new Jj({context:this.context,value:2}),this._twoTimesWidthSide=new Jj({context:this.context,value:2}),this._midMult=new Jj({context:this.context}),this._twoTimesWidthMid.connect(this._midMult.factor),this.connectEffectMid(this._midMult),this._oneMinusWidth=new CB({context:this.context}),this._oneMinusWidth.connect(this._twoTimesWidthMid),xL(this.context.getConstant(1),this._oneMinusWidth),this.width.connect(this._oneMinusWidth.subtrahend),this._sideMult=new Jj({context:this.context}),this.width.connect(this._twoTimesWidthSide),this._twoTimesWidthSide.connect(this._sideMult.factor),this.connectEffectSide(this._sideMult)}static getDefaults(){return Object.assign(iY.getDefaults(),{width:.5})}dispose(){return super.dispose(),this.width.dispose(),this._midMult.dispose(),this._sideMult.dispose(),this._twoTimesWidthMid.dispose(),this._twoTimesWidthSide.dispose(),this._oneMinusWidth.dispose(),this}},oY.StereoWidener=aY),oY}var hY,lY,pY=!1;function dY(){return pY||(pY=!0,hY={},jH(),BW(),OL(),BL(),vF(),hq(),lY=class t extends LH{constructor(){super(pF(t.getDefaults(),arguments,["frequency","depth"])),this.name="Tremolo";const e=pF(t.getDefaults(),arguments,["frequency","depth"]);this._lfoL=new jW({context:this.context,type:e.type,min:1,max:0}),this._lfoR=new jW({context:this.context,type:e.type,min:1,max:0}),this._amplitudeL=new AL({context:this.context}),this._amplitudeR=new AL({context:this.context}),this.frequency=new VL({context:this.context,value:e.frequency,units:"frequency"}),this.depth=new VL({context:this.context,value:e.depth,units:"normalRange"}),cq(this,["frequency","depth"]),this.connectEffectLeft(this._amplitudeL),this.connectEffectRight(this._amplitudeR),this._lfoL.connect(this._amplitudeL.gain),this._lfoR.connect(this._amplitudeR.gain),this.frequency.fan(this._lfoL.frequency,this._lfoR.frequency),this.depth.fan(this._lfoR.amplitude,this._lfoL.amplitude),this.spread=e.spread}static getDefaults(){return Object.assign(LH.getDefaults(),{frequency:10,type:"sine",depth:.5,spread:180})}start(t){return this._lfoL.start(t),this._lfoR.start(t),this}stop(t){return this._lfoL.stop(t),this._lfoR.stop(t),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this.context.transport.syncSignal(this.frequency),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this.context.transport.unsyncSignal(this.frequency),this}get type(){return this._lfoL.type}set type(t){this._lfoL.type=t,this._lfoR.type=t}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(t){this._lfoL.phase=90-t/2,this._lfoR.phase=t/2+90}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._amplitudeL.dispose(),this._amplitudeR.dispose(),this.frequency.dispose(),this.depth.dispose(),this}},hY.Tremolo=lY),hY}var fY,_Y,vY=!1;function mY(){return vY||(vY=!0,fY={},zQ(),vF(),BW(),MV(),hq(),_Y=class t extends BQ{constructor(){super(pF(t.getDefaults(),arguments,["frequency","depth"])),this.name="Vibrato";const e=pF(t.getDefaults(),arguments,["frequency","depth"]);this._delayNode=new RV({context:this.context,delayTime:0,maxDelay:e.maxDelay}),this._lfo=new jW({context:this.context,type:e.type,min:0,max:e.maxDelay,frequency:e.frequency,phase:-90}).start().connect(this._delayNode.delayTime),this.frequency=this._lfo.frequency,this.depth=this._lfo.amplitude,this.depth.value=e.depth,cq(this,["frequency","depth"]),this.effectSend.chain(this._delayNode,this.effectReturn)}static getDefaults(){return Object.assign(BQ.getDefaults(),{maxDelay:.005,frequency:5,depth:.1,type:"sine"})}get type(){return this._lfo.type}set type(t){this._lfo.type=t}dispose(){return super.dispose(),this._delayNode.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}},fY.Vibrato=_Y),fY}var gY,yY=!1;function bY(){return yY||(yY=!0,e(gY={},$Q()),e(gY,oH()),e(gY,fH()),e(gY,TH()),e(gY,kH()),e(gY,YH()),e(gY,$H()),e(gY,oG()),e(gY,fG()),e(gY,bG()),e(gY,AG()),e(gY,PG()),e(gY,VG()),e(gY,UG()),e(gY,GG()),e(gY,uY()),e(gY,dY()),e(gY,mY())),gY}var wY,CY,xY=!1;function TY(){return xY||(xY=!0,wY={},SL(),vF(),RH(),OL(),kP(),CY=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments,["type","size"])),this.name="Analyser",this._analysers=[],this._buffers=[];const e=pF(t.getDefaults(),arguments,["type","size"]);this.input=this.output=this._gain=new AL({context:this.context}),this._split=new DH({context:this.context,channels:e.channels}),this.input.connect(this._split),xP(e.channels,1);for(let t=0;t<e.channels;t++)this._analysers[t]=this.context.createAnalyser(),this._split.connect(this._analysers[t],t,0);this.size=e.size,this.type=e.type}static getDefaults(){return Object.assign(bL.getDefaults(),{size:1024,smoothing:.8,type:"fft",channels:1})}getValue(){return this._analysers.forEach((t,e)=>{const n=this._buffers[e];"fft"===this._type?t.getFloatFrequencyData(n):"waveform"===this._type&&t.getFloatTimeDomainData(n)}),1===this.channels?this._buffers[0]:this._buffers}get size(){return this._analysers[0].frequencyBinCount}set size(t){this._analysers.forEach((e,n)=>{e.fftSize=2*t,this._buffers[n]=new Float32Array(t)})}get channels(){return this._analysers.length}get type(){return this._type}set type(t){CP("waveform"===t||"fft"===t,"Analyser: invalid type: "+t),this._type=t}get smoothing(){return this._analysers[0].smoothingTimeConstant}set smoothing(t){this._analysers.forEach(e=>e.smoothingTimeConstant=t)}dispose(){return super.dispose(),this._analysers.forEach(t=>t.disconnect()),this._split.dispose(),this._gain.dispose(),this}},wY.Analyser=CY),wY}var SY,EY,AY=!1;function kY(){return AY||(AY=!0,SY={},SL(),vF(),TY(),EY=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments)),this.name="MeterBase",this.input=this.output=this._analyser=new CY({context:this.context,size:256,type:"waveform"})}dispose(){return super.dispose(),this._analyser.dispose(),this}},SY.MeterBase=EY),SY}var OY,DY,NY=!1;function RY(){return NY||(NY=!0,OY={},Vq(),vF(),kY(),kP(),TY(),DY=class t extends EY{constructor(){super(pF(t.getDefaults(),arguments,["smoothing"])),this.name="Meter",this._rms=0;const e=pF(t.getDefaults(),arguments,["smoothing"]);this.input=this.output=this._analyser=new CY({context:this.context,size:256,type:"waveform",channels:e.channels}),this.smoothing=e.smoothing,this.normalRange=e.normalRange}static getDefaults(){return Object.assign(EY.getDefaults(),{smoothing:.8,normalRange:!1,channels:1})}getLevel(){return AP("'getLevel' has been changed to 'getValue'"),this.getValue()}getValue(){const t=this._analyser.getValue(),e=(1===this.channels?[t]:t).map(t=>{const e=t.reduce((t,e)=>t+e*e,0),n=Math.sqrt(e/t.length);return this._rms=Math.max(n,this._rms*this.smoothing),this.normalRange?this._rms:Rq(this._rms)});return 1===this.channels?e[0]:e}get channels(){return this._analyser.channels}dispose(){return super.dispose(),this._analyser.dispose(),this}},OY.Meter=DY),OY}var IY,MY,PY=!1;function FY(){return PY||(PY=!0,IY={},SL(),Vq(),vF(),kY(),kP(),MY=class t extends EY{constructor(){super(pF(t.getDefaults(),arguments,["size"])),this.name="FFT";const e=pF(t.getDefaults(),arguments,["size"]);this.normalRange=e.normalRange,this._analyser.type="fft",this.size=e.size}static getDefaults(){return Object.assign(bL.getDefaults(),{normalRange:!1,size:1024,smoothing:.8})}getValue(){return this._analyser.getValue().map(t=>this.normalRange?Nq(t):t)}get size(){return this._analyser.size}set size(t){this._analyser.size=t}get smoothing(){return this._analyser.smoothing}set smoothing(t){this._analyser.smoothing=t}getFrequencyOfIndex(t){return CP(0<=t&&t<this.size,"index must be greater than or equal to 0 and less than "+this.size),t*this.context.sampleRate/(2*this.size)}},IY.FFT=MY),IY}var qY,LY,VY=!1;function jY(){return VY||(VY=!0,qY={},vF(),kY(),LY=class t extends EY{constructor(){super(pF(t.getDefaults(),arguments)),this.name="DCMeter",this._analyser.type="waveform",this._analyser.size=256}getValue(){return this._analyser.getValue()[0]}},qY.DCMeter=LY),qY}var WY,BY,UY=!1;function zY(){return UY||(UY=!0,WY={},vF(),kY(),BY=class t extends EY{constructor(){super(pF(t.getDefaults(),arguments,["size"])),this.name="Waveform";const e=pF(t.getDefaults(),arguments,["size"]);this._analyser.type="waveform",this.size=e.size}static getDefaults(){return Object.assign(EY.getDefaults(),{size:1024})}getValue(){return this._analyser.getValue()}get size(){return this._analyser.size}set size(t){this._analyser.size=t}},WY.Waveform=BY),WY}var QY,HY,GY=!1;function YY(){return GY||(GY=!0,QY={},OL(),SL(),vF(),HY=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments,["solo"])),this.name="Solo";const e=pF(t.getDefaults(),arguments,["solo"]);this.input=this.output=new AL({context:this.context}),t._allSolos.has(this.context)||t._allSolos.set(this.context,new Set),t._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(bL.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),t._allSolos.get(this.context).forEach(t=>t._updateSolo())}get muted(){return 0===this.input.gain.value}_addSolo(){t._soloed.has(this.context)||t._soloed.set(this.context,new Set),t._soloed.get(this.context).add(this)}_removeSolo(){t._soloed.has(this.context)&&t._soloed.get(this.context).delete(this)}_isSoloed(){return t._soloed.has(this.context)&&t._soloed.get(this.context).has(this)}_noSolos(){return!t._soloed.has(this.context)||t._soloed.has(this.context)&&0===t._soloed.get(this.context).size}_updateSolo(){this._isSoloed()||this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),t._allSolos.get(this.context).delete(this),this._removeSolo(),this}},QY.Solo=HY,HY._allSolos=new Map,HY._soloed=new Map),QY}var XY,KY,ZY=!1;function $Y(){return ZY||(ZY=!0,XY={},hq(),SL(),vF(),nH(),LV(),KY=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";const e=pF(t.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new tH({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new FV({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,cq(this,["pan","volume"])}static getDefaults(){return Object.assign(bL.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}},XY.PanVol=KY),XY}var JY,tX,eX=!1;function nX(){return eX||(eX=!0,JY={},SL(),vF(),YY(),$Y(),hq(),OL(),tX=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments,["volume","pan"])),this.name="Channel";const e=pF(t.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new HY({solo:e.solo,context:this.context}),this._panVol=this.output=new KY({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),cq(this,["pan","volume"])}static getDefaults(){return Object.assign(bL.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(t){this._solo.solo=t}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(t){this._panVol.mute=t}_getBus(e){return t.buses.has(e)||t.buses.set(e,new AL({context:this.context})),t.buses.get(e)}send(t,e=0){const n=this._getBus(t),i=new AL({context:this.context,units:"decibels",gain:e});return this.connect(i),i.connect(n),i}receive(t){return this._getBus(t).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}},JY.Channel=tX,tX.buses=new Map),JY}var iX,rX,sX=!1;function oX(){return sX||(sX=!0,iX={},OL(),SL(),vF(),hq(),BL(),DU(),rX=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments,["lowFrequency","highFrequency"])),this.name="MultibandSplit",this.input=new AL({context:this.context}),this.output=void 0,this.low=new kU({context:this.context,frequency:0,type:"lowpass"}),this._lowMidFilter=new kU({context:this.context,frequency:0,type:"highpass"}),this.mid=new kU({context:this.context,frequency:0,type:"lowpass"}),this.high=new kU({context:this.context,frequency:0,type:"highpass"}),this._internalChannels=[this.low,this.mid,this.high];const e=pF(t.getDefaults(),arguments,["lowFrequency","highFrequency"]);this.lowFrequency=new VL({context:this.context,units:"frequency",value:e.lowFrequency}),this.highFrequency=new VL({context:this.context,units:"frequency",value:e.highFrequency}),this.Q=new VL({context:this.context,units:"positive",value:e.Q}),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.fan(this.low.frequency,this._lowMidFilter.frequency),this.highFrequency.fan(this.mid.frequency,this.high.frequency),this.Q.connect(this.low.Q),this.Q.connect(this._lowMidFilter.Q),this.Q.connect(this.mid.Q),this.Q.connect(this.high.Q),cq(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(bL.getDefaults(),{Q:1,highFrequency:2500,lowFrequency:400})}dispose(){return super.dispose(),uq(this,["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this._lowMidFilter.dispose(),this.mid.dispose(),this.high.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this.Q.dispose(),this}},iX.MultibandSplit=rX),iX}var aX,cX,uX=!1;function hX(){return uX||(uX=!0,aX={},SL(),gL(),BF(),cX=class extends bL{constructor(){super(...arguments),this.name="Listener",this.positionX=new vL({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new vL({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new vL({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new vL({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new vL({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new vL({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new vL({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new vL({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new vL({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(bL.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}},aX.Listener=cX,LF(t=>{t.listener=new cX({context:t})}),jF(t=>{t.listener.dispose()})),aX}var lX,pX,dX=!1;function fX(){return dX||(dX=!0,lX={},gL(),SL(),vF(),hX(),pX=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments,["positionX","positionY","positionZ"])),this.name="Panner3D";const e=pF(t.getDefaults(),arguments,["positionX","positionY","positionZ"]);this._panner=this.input=this.output=this.context.createPanner(),this.panningModel=e.panningModel,this.maxDistance=e.maxDistance,this.distanceModel=e.distanceModel,this.coneOuterGain=e.coneOuterGain,this.coneOuterAngle=e.coneOuterAngle,this.coneInnerAngle=e.coneInnerAngle,this.refDistance=e.refDistance,this.rolloffFactor=e.rolloffFactor,this.positionX=new vL({context:this.context,param:this._panner.positionX,value:e.positionX}),this.positionY=new vL({context:this.context,param:this._panner.positionY,value:e.positionY}),this.positionZ=new vL({context:this.context,param:this._panner.positionZ,value:e.positionZ}),this.orientationX=new vL({context:this.context,param:this._panner.orientationX,value:e.orientationX}),this.orientationY=new vL({context:this.context,param:this._panner.orientationY,value:e.orientationY}),this.orientationZ=new vL({context:this.context,param:this._panner.orientationZ,value:e.orientationZ})}static getDefaults(){return Object.assign(bL.getDefaults(),{coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:0,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1})}setPosition(t,e,n){return this.positionX.value=t,this.positionY.value=e,this.positionZ.value=n,this}setOrientation(t,e,n){return this.orientationX.value=t,this.orientationY.value=e,this.orientationZ.value=n,this}get panningModel(){return this._panner.panningModel}set panningModel(t){this._panner.panningModel=t}get refDistance(){return this._panner.refDistance}set refDistance(t){this._panner.refDistance=t}get rolloffFactor(){return this._panner.rolloffFactor}set rolloffFactor(t){this._panner.rolloffFactor=t}get distanceModel(){return this._panner.distanceModel}set distanceModel(t){this._panner.distanceModel=t}get coneInnerAngle(){return this._panner.coneInnerAngle}set coneInnerAngle(t){this._panner.coneInnerAngle=t}get coneOuterAngle(){return this._panner.coneOuterAngle}set coneOuterAngle(t){this._panner.coneOuterAngle=t}get coneOuterGain(){return this._panner.coneOuterGain}set coneOuterGain(t){this._panner.coneOuterGain=t}get maxDistance(){return this._panner.maxDistance}set maxDistance(t){this._panner.maxDistance=t}dispose(){return super.dispose(),this._panner.disconnect(),this.orientationX.dispose(),this.orientationY.dispose(),this.orientationZ.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this}},lX.Panner3D=pX),lX}var _X,vX,mX=!1;function gX(){return mX||(mX=!0,_X={},SL(),OL(),kP(),YP(),vF(),vX=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments)),this.name="Recorder";const e=pF(t.getDefaults(),arguments);this.input=new AL({context:this.context}),CP(t.supported,"Media Recorder API is not available"),this._stream=this.context.createMediaStreamDestination(),this.input.connect(this._stream),this._recorder=new MediaRecorder(this._stream.stream,{mimeType:e.mimeType})}static getDefaults(){return bL.getDefaults()}get mimeType(){return this._recorder.mimeType}static get supported(){return null!==BP&&Reflect.has(BP,"MediaRecorder")}get state(){return"inactive"===this._recorder.state?"stopped":"paused"===this._recorder.state?"paused":"started"}start(){return g(this,void 0,void 0,(function*(){CP("started"!==this.state,"Recorder is already started");const t=new Promise(t=>{const e=()=>{this._recorder.removeEventListener("start",e,!1),t()};this._recorder.addEventListener("start",e,!1)});return this._recorder.start(),yield t}))}stop(){return g(this,void 0,void 0,(function*(){CP("stopped"!==this.state,"Recorder is not started");const t=new Promise(t=>{const e=n=>{this._recorder.removeEventListener("dataavailable",e,!1),t(n.data)};this._recorder.addEventListener("dataavailable",e,!1)});return this._recorder.stop(),yield t}))}pause(){return CP("started"===this.state,"Recorder must be started"),this._recorder.pause(),this}dispose(){return super.dispose(),this.input.dispose(),this._stream.disconnect(),this}},_X.Recorder=vX),_X}var yX,bX,wX=!1;function CX(){return wX||(wX=!0,yX={},gL(),SL(),vF(),hq(),bX=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments,["threshold","ratio"])),this.name="Compressor",this._compressor=this.context.createDynamicsCompressor(),this.input=this._compressor,this.output=this._compressor;const e=pF(t.getDefaults(),arguments,["threshold","ratio"]);this.threshold=new vL({minValue:this._compressor.threshold.minValue,maxValue:this._compressor.threshold.maxValue,context:this.context,convert:!1,param:this._compressor.threshold,units:"decibels",value:e.threshold}),this.attack=new vL({minValue:this._compressor.attack.minValue,maxValue:this._compressor.attack.maxValue,context:this.context,param:this._compressor.attack,units:"time",value:e.attack}),this.release=new vL({minValue:this._compressor.release.minValue,maxValue:this._compressor.release.maxValue,context:this.context,param:this._compressor.release,units:"time",value:e.release}),this.knee=new vL({minValue:this._compressor.knee.minValue,maxValue:this._compressor.knee.maxValue,context:this.context,convert:!1,param:this._compressor.knee,units:"decibels",value:e.knee}),this.ratio=new vL({minValue:this._compressor.ratio.minValue,maxValue:this._compressor.ratio.maxValue,context:this.context,convert:!1,param:this._compressor.ratio,units:"positive",value:e.ratio}),cq(this,["knee","release","attack","ratio","threshold"])}static getDefaults(){return Object.assign(bL.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}},yX.Compressor=bX),yX}var xX,TX,SX=!1;function EX(){return SX||(SX=!0,xX={},SL(),RB(),OL(),hH(),vF(),Vq(),TX=class t extends bL{constructor(){super(Object.assign(pF(t.getDefaults(),arguments,["threshold","smoothing"]))),this.name="Gate";const e=pF(t.getDefaults(),arguments,["threshold","smoothing"]);this._follower=new cH({context:this.context,smoothing:e.smoothing}),this._gt=new DB({context:this.context,value:Nq(e.threshold)}),this.input=new AL({context:this.context}),this._gate=this.output=new AL({context:this.context}),this.input.connect(this._gate),this.input.chain(this._follower,this._gt,this._gate.gain)}static getDefaults(){return Object.assign(bL.getDefaults(),{smoothing:.1,threshold:-40})}get threshold(){return Rq(this._gt.value)}set threshold(t){this._gt.value=Nq(t)}get smoothing(){return this._follower.smoothing}set smoothing(t){this._follower.smoothing=t}dispose(){return super.dispose(),this.input.dispose(),this._follower.dispose(),this._gt.dispose(),this._gate.dispose(),this}},xX.Gate=TX),xX}var AX,kX,OX=!1;function DX(){return OX||(OX=!0,AX={},SL(),vF(),CX(),hq(),kX=class t extends bL{constructor(){super(Object.assign(pF(t.getDefaults(),arguments,["threshold"]))),this.name="Limiter";const e=pF(t.getDefaults(),arguments,["threshold"]);this._compressor=this.input=this.output=new bX({context:this.context,ratio:20,attack:0,release:0,threshold:e.threshold}),this.threshold=this._compressor.threshold,cq(this,"threshold")}static getDefaults(){return Object.assign(bL.getDefaults(),{threshold:-12})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.dispose(),this.threshold.dispose(),this}},AX.Limiter=kX),AX}var NX,RX,IX=!1;function MX(){return IX||(IX=!0,NX={},SL(),CX(),vF(),ZG(),eY(),hq(),RX=class t extends bL{constructor(){super(Object.assign(pF(t.getDefaults(),arguments))),this.name="MidSideCompressor";const e=pF(t.getDefaults(),arguments);this._midSideSplit=this.input=new XG({context:this.context}),this._midSideMerge=this.output=new JG({context:this.context}),this.mid=new bX(Object.assign(e.mid,{context:this.context})),this.side=new bX(Object.assign(e.side,{context:this.context})),this._midSideSplit.mid.chain(this.mid,this._midSideMerge.mid),this._midSideSplit.side.chain(this.side,this._midSideMerge.side),cq(this,["mid","side"])}static getDefaults(){return Object.assign(bL.getDefaults(),{mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},side:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10}})}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this}},NX.MidSideCompressor=RX),NX}var PX,FX,qX=!1;function LX(){return qX||(qX=!0,PX={},SL(),CX(),vF(),hq(),oX(),OL(),FX=class t extends bL{constructor(){super(Object.assign(pF(t.getDefaults(),arguments))),this.name="MultibandCompressor";const e=pF(t.getDefaults(),arguments);this._splitter=this.input=new rX({context:this.context,lowFrequency:e.lowFrequency,highFrequency:e.highFrequency}),this.lowFrequency=this._splitter.lowFrequency,this.highFrequency=this._splitter.highFrequency,this.output=new AL({context:this.context}),this.low=new bX(Object.assign(e.low,{context:this.context})),this.mid=new bX(Object.assign(e.mid,{context:this.context})),this.high=new bX(Object.assign(e.high,{context:this.context})),this._splitter.low.chain(this.low,this.output),this._splitter.mid.chain(this.mid,this.output),this._splitter.high.chain(this.high,this.output),cq(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(bL.getDefaults(),{lowFrequency:250,highFrequency:2e3,low:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10},mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},high:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16}})}dispose(){return super.dispose(),this._splitter.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.output.dispose(),this}},PX.MultibandCompressor=FX),PX}var VX,jX,WX=!1;function BX(){return WX||(WX=!0,VX={},OL(),SL(),vF(),hq(),oX(),jX=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments,["low","mid","high"])),this.name="EQ3",this.output=new AL({context:this.context}),this._internalChannels=[];const e=pF(t.getDefaults(),arguments,["low","mid","high"]);this.input=this._multibandSplit=new rX({context:this.context,highFrequency:e.highFrequency,lowFrequency:e.lowFrequency}),this._lowGain=new AL({context:this.context,gain:e.low,units:"decibels"}),this._midGain=new AL({context:this.context,gain:e.mid,units:"decibels"}),this._highGain=new AL({context:this.context,gain:e.high,units:"decibels"}),this.low=this._lowGain.gain,this.mid=this._midGain.gain,this.high=this._highGain.gain,this.Q=this._multibandSplit.Q,this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),cq(this,["low","mid","high","lowFrequency","highFrequency"]),this._internalChannels=[this._multibandSplit]}static getDefaults(){return Object.assign(bL.getDefaults(),{high:0,highFrequency:2500,low:0,lowFrequency:400,mid:0})}dispose(){return super.dispose(),uq(this,["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this._lowGain.dispose(),this._midGain.dispose(),this._highGain.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.Q.dispose(),this}},VX.EQ3=jX),VX}var UX,zX,QX=!1;function HX(){return QX||(QX=!0,UX={},SL(),fq(),vF(),OL(),hq(),zX=class t extends bL{constructor(){super(pF(t.getDefaults(),arguments,["url","onload"])),this.name="Convolver",this._convolver=this.context.createConvolver();const e=pF(t.getDefaults(),arguments,["url","onload"]);this._buffer=new pq(e.url,t=>{this.buffer=t,e.onload()}),this.input=new AL({context:this.context}),this.output=new AL({context:this.context}),this._buffer.loaded&&(this.buffer=this._buffer),this.normalize=e.normalize,this.input.chain(this._convolver,this.output)}static getDefaults(){return Object.assign(bL.getDefaults(),{normalize:!0,onload:oq})}load(t){return g(this,void 0,void 0,(function*(){this.buffer=yield this._buffer.load(t)}))}get buffer(){return this._buffer.length?this._buffer:null}set buffer(t){t&&this._buffer.set(t),this._convolver.buffer&&(this.input.disconnect(),this._convolver.disconnect(),this._convolver=this.context.createConvolver(),this.input.chain(this._convolver,this.output));const e=this._buffer.get();this._convolver.buffer=e||null}get normalize(){return this._convolver.normalize}set normalize(t){this._convolver.normalize=t}dispose(){return super.dispose(),this._buffer.dispose(),this._convolver.disconnect(),this}},UX.Convolver=zX),UX}var GX,YX=!1;function XX(){return YX||(YX=!0,e(GX={},TY()),e(GX,RY()),e(GX,FY()),e(GX,jY()),e(GX,zY()),e(GX,hH()),e(GX,nX()),e(GX,jQ()),e(GX,FH()),e(GX,eY()),e(GX,ZG()),e(GX,oX()),e(GX,nH()),e(GX,fX()),e(GX,$Y()),e(GX,gX()),e(GX,YY()),e(GX,RH()),e(GX,LV()),e(GX,CX()),e(GX,EX()),e(GX,DX()),e(GX,MX()),e(GX,LX()),e(GX,hU()),e(GX,$B()),e(GX,MU()),e(GX,BX()),e(GX,DU()),e(GX,Fz()),e(GX,Rz()),e(GX,jz()),e(GX,HX()),e(GX,EU())),GX}var KX,ZX=!1;function $X(){e(KX={},(cj||(cj=!0,uj()),aj)),e(KX,cB()),e(KX,GB()),e(KX,eQ()),e(KX,FQ()),e(KX,bY()),e(KX,XX())}var JX,tK,eK,nK,iK,rK,sK,oK,aK,cK,uK=!1;function hK(){return xq().now()}function lK(){return xq().immediate()}function pK(){return xq().transport}function dK(){return xq().destination}function fK(){return xq().listener}function _K(){return xq().draw}function vK(){return pq.loaded()}function mK(){JX={},Eq(),Eq(),fq(),Eq(),YP(),KV(),mj(),JX.setContext=Tq,JX.getContext=xq,e(JX,(ZX||(ZX=!0,$X()),KX)),e(JX,ms()),JX.start=Sq,JX.supported=_P,JX.now=hK,JX.immediate=lK,tK=xq().transport,JX.Transport=kV=tK,JX.getTransport=pK,eK=xq().destination,JX.Destination=jV=eK,nK=xq().destination,JX.Master=nK,JX.getDestination=dK,iK=xq().listener,JX.Listener=iK,JX.getListener=fK,rK=xq().draw,JX.Draw=ij=rK,JX.getDraw=_K,sK=xq(),JX.context=sK,JX.loaded=vK,oK=pq,JX.Buffer=oK,aK=YV,JX.Buffers=aK,cK=_j,JX.BufferSource=cK}function gK(){return uK||(uK=!0,mK()),JX}var yK,bK=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,i;return e=t,(n=[{key:"setup",value:function(t){var e=gK();if(this.agents=[],this.startTime=Date.now(),this.gain=new e.Volume,t){console.log("Getting mic"),this.mic=new e.UserMedia,console.log("Got mic");var n=new e.Filter({frequency:300,type:"highpass",rolloff:-12,Q:.5}),i=new e.Filter({frequency:4e3,type:"lowpass",rolloff:-12,Q:.5});this.mic.connect(n),n.connect(i),i.connect(this.gain),this.mic.open(),console.log("Opened mic!",this.gain)}return this.update(),!0}},{key:"close",value:function(){this.mic.close()}},{key:"addAgents",value:function(t){var e=this;t.forEach((function(t){e.agents.push(t),t.start()}))}},{key:"removeAgents",value:function(t){var e=t.map((function(t){return t.name}));this.agents=this.agents.reduce((function(t,n){return e.includes(n.name)?n.stop():t.push(n),t}),[])}},{key:"update",value:function(){var t=this;setTimeout((function(){t.agents?(t.agents.forEach((function(t){t.update()})),t.update()):t.update()}),10)}}])&&ds(e.prototype,n),i&&ds(e,i),t}();function wK(t){return new tL(t,"midi").toFrequency()}function CK(t,e){return Math.random()*(e-t)+t}function xK(){return window.AudioContext||window.webkitAudioContext}function TK(t){for(var e=window.location.search.substring(1).split("&"),n=0;n<e.length;n++){var i=e[n].split("=");if(decodeURIComponent(i[0])==t)return decodeURIComponent(i[1])}return null}function SK(){var t;TK("debug")&&(t=console).log.apply(t,arguments)}function EK(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function AK(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}yK={a:function(t){var e=t*t;return 187374169.94399998*e*e/((e+424.36)*Math.sqrt((e+11599.29)*(e+544496.41))*(e+14884e4))},b:function(t){var e=t*t;return 151781786.8850557*t*e/((e+424.36)*Math.sqrt(e+25122.25)*(e+14884e4))},c:function(t){var e=t*t;return 149871709.59190252*e/((e+424.36)*(e+14884e4))},d:function(t){var e=t*t;return t/68966888496476e-18*Math.sqrt(((1037918.48-e)*(1037918.48-e)+1080768.16*e)/((9837328-e)*(9837328-e)+11723776*e)/((e+79919.29)*(e+1345600)))},m:function(t){var e=t*t,n=-4737338981378384e-39*e*e*e+2043828333606125e-30*e*e-1.363894795463638e-7*e+1,i=1306612257412824e-34*e*e*t-2118150887518656e-26*e*t+.0005559488023498642*t;return.0010130572010774149*t/Math.sqrt(n*n+i*i)},z:function(t){return 1}},gK(),gK();var kK={filterQ:.75,filterRange:7,filterRolloff:-24,minInitialNote:60,maxInitialNote:82,minLFOFrequency:.1,maxLFOFrequency:.75,minVelocity:.01,maxVelocity:.05,velocityRange:1,minVolume:0,maxVolume:.5,triggerChord:[60,67]},OK=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;EK(this,t),this.visuals=n,this.options=Object.assign({},kK,e),this.synth=new pU({oscillator:{type:"sine"},envelope:{attack:.005,decay:.1,sustain:1,release:1}}),this.synthGainNode=new AL,this.synthGainNode.toDestination(),this.synth.connect(this.synthGainNode),this.filterLeft=new kU({frequency:440,type:"bandpass",rolloff:this.options.filterRolloff,Q:this.options.filterQ,gain:0}),this.filterRight=new kU({frequency:440,type:"bandpass",rolloff:this.options.filterRolloff,Q:this.options.filterQ,gain:0}),this.meterLeft=new DY,this.meterRight=new DY,i.connect(this.filterLeft),i.connect(this.filterRight),this.filterLeft.connect(this.meterLeft),this.filterRight.connect(this.meterRight),this.newRandomNote();var r=CK(this.options.minLFOFrequency,this.options.maxLFOFrequency);this.gainLFO=new jW(r,this.options.minVolume,this.options.maxVolume),this.gainLFO.connect(this.synthGainNode.gain),this.interval=null}var e,n,i;return e=t,(n=[{key:"newRandomNote",value:function(){this.velocity=CK(this.options.minVelocity,this.options.maxVelocity),this.initialNote=CK(this.options.minInitialNote,this.options.maxInitialNote),this.currentNote=this.initialNote,this.currentVelocity=this.velocity,this.setFilterPoles(this.initialNote)}},{key:"start",value:function(){var t=this;this.newRandomNote(),this.synth.triggerAttack(wK(this.initialNote)),this.gainLFO.start(),this.interval=setInterval((function(){var e=wK(t.currentNote);t.visuals.setToColor([0,0,105+Math.round(e)%150])}),1e3)}},{key:"stop",value:function(){this.synth.triggerRelease(),this.gainLFO.stop(),this.visuals.resetColor(),clearInterval(this.interval)}},{key:"setFilterPoles",value:function(t){var e=this.options.filterRange,n=wK(t-e),i=wK(t+e);this.filterLeft.frequency.setValueAtTime(n,"+0"),this.filterRight.frequency.setValueAtTime(i,"+0")}},{key:"update",value:function(){var t=this.meterLeft.getValue(),e=this.meterRight.getValue(),n=this.filterLeft.frequency.value,i=this.filterRight.frequency.value;if(yK.a(n),yK.a(i),isFinite(e)&&isFinite(t)){this.currentVelocity=Math.min(Math.max((e-t)*this.velocity,-this.options.velocityRange),this.options.velocityRange),this.currentNote+=this.currentVelocity,this.setFilterPoles(this.currentNote);var r=wK(this.currentNote);this.synth.setNote(r),SK("========="),SK(t,e,this.currentVelocity),SK(r)}}}])&&AK(e.prototype,n),i&&AK(e,i),t}();function DK(t){return null!=t&&"object"==typeof t&&!0===t["@@functional/placeholder"]}function NK(t){return function e(n){return 0===arguments.length||DK(n)?e:t.apply(this,arguments)}}function RK(t){return function e(n,i){switch(arguments.length){case 0:return e;case 1:return DK(n)?e:NK((function(e){return t(n,e)}));default:return DK(n)&&DK(i)?e:DK(n)?NK((function(e){return t(e,i)})):DK(i)?NK((function(e){return t(n,e)})):t(n,i)}}}gK();var IK=Array.isArray||function(t){return null!=t&&t.length>=0&&"[object Array]"===Object.prototype.toString.call(t)};function MK(t){return null!=t&&"function"==typeof t["@@transducer/step"]}function PK(t,e,n){return function(){if(0===arguments.length)return n();var i=Array.prototype.slice.call(arguments,0),r=i.pop();if(!IK(r)){for(var s=0;s<t.length;){if("function"==typeof r[t[s]])return r[t[s]].apply(r,i);s+=1}if(MK(r)){var o=e.apply(null,i);return o(r)}}return n.apply(this,arguments)}}var FK=function(){return this.xf["@@transducer/init"]()},qK=function(){function t(t,e){this.xf=e,this.f=t,this.all=!0}return t.prototype["@@transducer/init"]=FK,t.prototype["@@transducer/result"]=function(t){return this.all&&(t=this.xf["@@transducer/step"](t,!0)),this.xf["@@transducer/result"](t)},t.prototype["@@transducer/step"]=function(t,e){var n;return this.f(e)||(this.all=!1,t=(n=this.xf["@@transducer/step"](t,!1))&&n["@@transducer/reduced"]?n:{"@@transducer/value":n,"@@transducer/reduced":!0}),t},t}(),LK=RK(PK(["all"],RK((function(t,e){return new qK(t,e)})),(function(t,e){for(var n=0;n<e.length;){if(!t(e[n]))return!1;n+=1}return!0})));gK();function VK(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.9,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=e;return function(e){return!isFinite(e)||isNaN(e)?n:n=null===n?e:t*n+(1-t)*e}}function jK(t,e){var n=t.map((function(t){var n=new kU({frequency:wK(t),type:"bandpass",rolloff:-48,Q:20,gain:0}),i=new DY;return e.connect(n),n.connect(i),i})).map((function(t){var e=VK(.94);return function(){return e(t.getValue())}})),i=new DY,r=VK(.94);e.connect(i);var s=!1;return function(){var t=n.map((function(t){return t()})),e=r(i.getValue());if(null===e)return!1;var o=t.map((function(t){return t-e})),a=LK((function(t){return t>-40}),o)&&e>-30,c=!s&&a;return s=a,c}}function WK(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function BK(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var UK,zK=[{name:"C",notes:[60],next:"E"},{name:"E",notes:[64],next:"C"}],QK={minLFOFrequency:.1,maxLFOFrequency:.5,minVolume:0,maxVolume:.4},HK=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;WK(this,t),this.converter=new tL,this.visuals=n,this.options=Object.assign({},QK,e),this.synth=new Hz,this.synth.set({oscillator:{type:"sine"},envelope:{attack:.005,decay:.1,sustain:.7,release:1}}),this.synthGainNode=new AL(.2),this.synthGainNode.toDestination(),this.synth.connect(this.synthGainNode);var r=CK(this.options.minLFOFrequency,this.options.maxLFOFrequency);this.gainLFO=new jW(r,this.options.minVolume,this.options.maxVolume),this.gainLFO.connect(this.synthGainNode.gain),this.chordDetectors=Object.keys(zK).map((function(t){return jK(zK[t].notes,i)})),this.playingChord=null}var e,n,i;return e=t,(n=[{key:"start",value:function(){this.gainLFO.start()}},{key:"stop",value:function(){}},{key:"update",value:function(){var t,e=this,n=zK.map((function(t,n){return{name:t.name,triggered:e.chordDetectors[n]()}})).filter((function(t){return t.triggered})).map((function(t){return t.name}));if(n.length>0&&console.log("chordsTriggered",n),n.length>0){var i=(t=n)[Math.floor(Math.random()*t.length)],r=zK.find((function(t){return t.name===i})).next,s=zK.find((function(t){return t.name===r})).notes;this.synth.triggerAttackRelease(s.map(wK),"1n","+1n"),this.visuals.flash(),console.log(i),console.log("next",r)}}}])&&BK(e.prototype,n),i&&BK(e,i),t}();UK=JSON.parse('{"apiKey":"AIzaSyA72_qMzv8M1kjhSw_0TafCgaMpDoTq2TY","authDomain":"swarm-animism.firebaseapp.com","databaseURL":"https://swarm-animism.firebaseio.com","projectId":"swarm-animism","storageBucket":"","messagingSenderId":"996873372497"}');var GK,YK=[],XK={},KK=document.getElementById("control"),ZK=document.getElementsByClassName("control__button"),$K=document.getElementById("error"),JK=document.getElementById("main"),tZ=document.getElementById("start"),eZ=TK("agent"),nZ=TK("control"),iZ=new ps(JK);function rZ(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,i=0;i<ZK.length;i+=1){var r=ZK[i];t==r.dataset.agent?e?r.classList.add("control__button--active"):r.classList.remove("control__button--active"):void 0!==n&&(r.disabled=n)}}function sZ(t){var e=XK[t];return e.name=t,e}function oZ(t){return t.map((function(t){return sZ(t)}))}var aZ=t(UK);var cZ=t(s);function uZ(){(GK=new bK).setup(!nZ),XK={chord:new HK({},iZ,GK.gain),flocking:new OK({},iZ,GK.gain)},eZ||(function(){p.initializeApp(aZ);var t=p.database();t.ref("clients").push({timestamp:Date.now(),userAgent:window.navigator.userAgent});var e=t.ref("state/agentNames");rZ(null,null,!0),e.on("value",(function(t){if(GK){rZ(null,null,!1),YK=t.val()||[];var e=GK.agents?GK.agents.map((function(t){return t.name})):[],n=YK.reduce((function(t,n){return e.includes(n)||(t.push(n),rZ(n,!0)),t}),[]),i=e.reduce((function(t,e){return YK.includes(e)||(t.push(e),rZ(e,!1)),t}),[]);GK.removeAgents(oZ(i)),GK.addAgents(oZ(n))}}))}(),nZ&&function(){var t=p.database().ref("state/agentNames");KK.classList.add("control--visible");for(var e=function(e){var n=ZK[e];n.addEventListener("click",(function(e){e.preventDefault();var i=n.dataset.agent;YK.includes(i)?YK.splice(YK.findIndex((function(t){return t===i})),1):YK.push(i),rZ(null,null,!0),t.set(YK)}))},n=0;n<ZK.length;n+=1)e(n)}()),eZ&&GK.addAgents([sZ(eZ)])}xK()?(console.log("Initializing"),tZ.classList.add("start--visible"),tZ.addEventListener("click",(function(){var t,e="image".concat(Math.floor(CK(1,7)));iZ.setAnimal(e),/iPad|iPhone|iPod/.test(window.navigator.userAgent)&&!nZ?(t=document.createElement("audio"),JK.appendChild(t),t.src=cZ,t.loop=!0,t.play()):uZ(),tZ.classList.remove("start--visible")}))):(console.log("error",!xK()),$K.classList.add("error--visible"))}();
//# sourceMappingURL=scripts.794546a5.js.map
